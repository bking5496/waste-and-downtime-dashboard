[{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\App.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\ChatWidget.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'userName'. Either include it or remove the dependency array.","line":123,"column":6,"nodeType":"ArrayExpression","endLine":123,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [userName]","fix":{"range":[4566,4568],"text":"[userName]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\ConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\DashboardCharts.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\DowntimeSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\ErrorBoundary.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[896,957],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { Component, ErrorInfo, ReactNode } from 'react';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\r\n}\r\n\r\ninterface State {\r\n  hasError: boolean;\r\n  error: Error | null;\r\n  errorInfo: ErrorInfo | null;\r\n  errorId: string | null;\r\n}\r\n\r\n// Generate unique error ID for tracking\r\nconst generateErrorId = (): string => {\r\n  return `err_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\r\n};\r\n\r\n// Log error to console and optionally to external service\r\nconst logError = (error: Error, errorInfo: ErrorInfo, errorId: string) => {\r\n  const errorReport = {\r\n    id: errorId,\r\n    message: error.message,\r\n    stack: error.stack,\r\n    componentStack: errorInfo.componentStack,\r\n    timestamp: new Date().toISOString(),\r\n    url: window.location.href,\r\n    userAgent: navigator.userAgent,\r\n  };\r\n\r\n  console.error('ErrorBoundary caught an error:', errorReport);\r\n\r\n  // Store in localStorage for debugging (keep last 10 errors)\r\n  try {\r\n    const storedErrors = JSON.parse(localStorage.getItem('app_errors') || '[]');\r\n    storedErrors.unshift(errorReport);\r\n    localStorage.setItem('app_errors', JSON.stringify(storedErrors.slice(0, 10)));\r\n  } catch (e) {\r\n    // Ignore storage errors\r\n  }\r\n\r\n  // Future: Send to external error tracking service\r\n  // if (process.env.REACT_APP_ERROR_REPORTING_URL) {\r\n  //   fetch(process.env.REACT_APP_ERROR_REPORTING_URL, {\r\n  //     method: 'POST',\r\n  //     headers: { 'Content-Type': 'application/json' },\r\n  //     body: JSON.stringify(errorReport),\r\n  //   }).catch(() => {});\r\n  // }\r\n};\r\n\r\nclass ErrorBoundary extends Component<Props, State> {\r\n  public state: State = {\r\n    hasError: false,\r\n    error: null,\r\n    errorInfo: null,\r\n    errorId: null,\r\n  };\r\n\r\n  public static getDerivedStateFromError(error: Error): Partial<State> {\r\n    return { hasError: true, error, errorId: generateErrorId() };\r\n  }\r\n\r\n  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    const { errorId } = this.state;\r\n    if (errorId) {\r\n      logError(error, errorInfo, errorId);\r\n    }\r\n    this.setState({ errorInfo });\r\n\r\n    // Call optional error callback\r\n    this.props.onError?.(error, errorInfo);\r\n  }\r\n\r\n  private handleRetry = () => {\r\n    this.setState({\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n      errorId: null,\r\n    });\r\n  };\r\n\r\n  private handleReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  private handleGoHome = () => {\r\n    window.location.hash = '/';\r\n    window.location.reload();\r\n  };\r\n\r\n  private handleCopyError = () => {\r\n    const { error, errorInfo, errorId } = this.state;\r\n    const errorText = `Error ID: ${errorId}\r\nMessage: ${error?.message}\r\nStack: ${error?.stack}\r\nComponent Stack: ${errorInfo?.componentStack}\r\nURL: ${window.location.href}\r\nTime: ${new Date().toISOString()}`;\r\n\r\n    navigator.clipboard.writeText(errorText).then(() => {\r\n      alert('Error details copied to clipboard');\r\n    }).catch(() => {\r\n      alert('Failed to copy error details');\r\n    });\r\n  };\r\n\r\n  public render() {\r\n    if (this.state.hasError) {\r\n      // Allow custom fallback UI\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      return (\r\n        <div className=\"error-boundary\" role=\"alert\" aria-live=\"assertive\">\r\n          <div className=\"error-boundary-content\">\r\n            <div className=\"error-icon\" aria-hidden=\"true\">\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"64\" height=\"64\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\" />\r\n                <path d=\"M12 8v4M12 16h.01\" />\r\n              </svg>\r\n            </div>\r\n            <h1>Something went wrong</h1>\r\n            <p className=\"error-message\">\r\n              {this.state.error?.message || 'An unexpected error occurred'}\r\n            </p>\r\n            {this.state.errorId && (\r\n              <p className=\"error-id\">\r\n                Error ID: <code>{this.state.errorId}</code>\r\n              </p>\r\n            )}\r\n            <div className=\"error-actions\">\r\n              <button\r\n                className=\"error-btn primary\"\r\n                onClick={this.handleRetry}\r\n                aria-label=\"Try again without reloading\"\r\n              >\r\n                Try Again\r\n              </button>\r\n              <button\r\n                className=\"error-btn secondary\"\r\n                onClick={this.handleReload}\r\n                aria-label=\"Reload the page\"\r\n              >\r\n                Reload Page\r\n              </button>\r\n              <button\r\n                className=\"error-btn tertiary\"\r\n                onClick={this.handleGoHome}\r\n                aria-label=\"Go to dashboard\"\r\n              >\r\n                Go to Dashboard\r\n              </button>\r\n            </div>\r\n            <button\r\n              className=\"error-btn copy-btn\"\r\n              onClick={this.handleCopyError}\r\n              aria-label=\"Copy error details to clipboard\"\r\n            >\r\n              Copy Error Details\r\n            </button>\r\n            {process.env.NODE_ENV === 'development' && this.state.errorInfo && (\r\n              <details className=\"error-details\">\r\n                <summary>Error Details (Development Only)</summary>\r\n                <pre>{this.state.error?.stack}</pre>\r\n                <pre>{this.state.errorInfo.componentStack}</pre>\r\n              </details>\r\n            )}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\LatestMessageBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\LoadingSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\MachineSettingsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\MainForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\QRScanner.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":50,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":50,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[1756,1802],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2604,2644],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startScannerInternal'. Either include it or remove the dependency array.","line":39,"column":6,"nodeType":"ArrayExpression","endLine":39,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, startScannerInternal]","fix":{"range":[1417,1425],"text":"[isOpen, startScannerInternal]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef, useState } from 'react';\r\nimport { Html5Qrcode, Html5QrcodeScannerState } from 'html5-qrcode';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface QRScannerProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onScan: (qrData: string) => void;\r\n  recentScans?: string[]; // To prevent duplicate scans\r\n}\r\n\r\nconst QRScanner: React.FC<QRScannerProps> = ({ isOpen, onClose, onScan, recentScans = [] }) => {\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [, setIsScanning] = useState(false); // Tracks scanning state for future UI enhancements\r\n  const [lastScanned, setLastScanned] = useState<string | null>(null);\r\n  const [showSuccess, setShowSuccess] = useState(false);\r\n  const scannerRef = useRef<Html5Qrcode | null>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const isOpenRef = useRef(isOpen);\r\n\r\n  // Keep ref in sync with prop\r\n  useEffect(() => {\r\n    isOpenRef.current = isOpen;\r\n  }, [isOpen]);\r\n\r\n  // Initialize scanner when modal opens\r\n  useEffect(() => {\r\n    if (isOpen && containerRef.current) {\r\n      // Delay to ensure DOM is ready\r\n      const timeoutId = setTimeout(() => {\r\n        startScannerInternal();\r\n      }, 100);\r\n      return () => clearTimeout(timeoutId);\r\n    }\r\n    return () => {\r\n      stopScannerInternal();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [isOpen]);\r\n\r\n  const stopScannerInternal = async () => {\r\n    if (scannerRef.current) {\r\n      try {\r\n        const state = scannerRef.current.getState();\r\n        if (state === Html5QrcodeScannerState.SCANNING) {\r\n          await scannerRef.current.stop();\r\n        }\r\n        scannerRef.current.clear();\r\n      } catch (err) {\r\n        console.error('Error stopping scanner:', err);\r\n      }\r\n      scannerRef.current = null;\r\n    }\r\n    setIsScanning(false);\r\n  };\r\n\r\n  const startScannerInternal = async () => {\r\n    if (scannerRef.current) {\r\n      await stopScannerInternal();\r\n    }\r\n\r\n    try {\r\n      setError(null);\r\n      setIsScanning(true);\r\n      \r\n      const scanner = new Html5Qrcode('qr-reader');\r\n      scannerRef.current = scanner;\r\n\r\n      await scanner.start(\r\n        { facingMode: 'environment' }, // Use back camera\r\n        {\r\n          fps: 10,\r\n          qrbox: { width: 250, height: 250 },\r\n          aspectRatio: 1.0,\r\n        },\r\n        (decodedText) => {\r\n          handleSuccessfulScan(decodedText);\r\n        },\r\n        () => {\r\n          // QR code not found - this is normal, just keep scanning\r\n        }\r\n      );\r\n    } catch (err: any) {\r\n      console.error('QR Scanner error:', err);\r\n      setIsScanning(false);\r\n      \r\n      if (err.toString().includes('NotAllowedError')) {\r\n        setError('Camera permission denied. Please allow camera access to scan QR codes.');\r\n      } else if (err.toString().includes('NotFoundError')) {\r\n        setError('No camera found. Please ensure your device has a camera.');\r\n      } else {\r\n        setError(`Failed to start scanner: ${err.message || err}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSuccessfulScan = async (qrData: string) => {\r\n    // Prevent duplicate scans (same QR within 3 seconds)\r\n    if (lastScanned === qrData) {\r\n      return;\r\n    }\r\n\r\n    // Check if this pallet was already scanned this session\r\n    if (recentScans.includes(qrData)) {\r\n      setError(`Pallet \"${qrData}\" was already scanned this session!`);\r\n      setTimeout(() => setError(null), 3000);\r\n      return;\r\n    }\r\n\r\n    setLastScanned(qrData);\r\n    setShowSuccess(true);\r\n    \r\n    // Vibrate on successful scan (if supported)\r\n    if (navigator.vibrate) {\r\n      navigator.vibrate(200);\r\n    }\r\n\r\n    // Stop scanning briefly to show success\r\n    await stopScannerInternal();\r\n    \r\n    // Call the parent callback\r\n    onScan(qrData);\r\n\r\n    // Show success for 1.5 seconds then continue scanning\r\n    setTimeout(() => {\r\n      setShowSuccess(false);\r\n      setLastScanned(null);\r\n      if (isOpen) {\r\n        startScannerInternal();\r\n      }\r\n    }, 1500);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    stopScannerInternal();\r\n    onClose();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div \r\n        className=\"qr-scanner-overlay\"\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        exit={{ opacity: 0 }}\r\n        onClick={handleClose}\r\n      >\r\n        <motion.div \r\n          className=\"qr-scanner-modal\"\r\n          initial={{ scale: 0.9, opacity: 0 }}\r\n          animate={{ scale: 1, opacity: 1 }}\r\n          exit={{ scale: 0.9, opacity: 0 }}\r\n          onClick={e => e.stopPropagation()}\r\n        >\r\n          <div className=\"qr-scanner-header\">\r\n            <h3>\r\n              <span className=\"scanner-icon\">≡ƒô╖</span>\r\n              Scan Pallet QR Code\r\n            </h3>\r\n            <button className=\"qr-close-btn\" onClick={handleClose}>Γ£ò</button>\r\n          </div>\r\n\r\n          <div className=\"qr-scanner-body\" ref={containerRef}>\r\n            {/* Success overlay */}\r\n            <AnimatePresence>\r\n              {showSuccess && (\r\n                <motion.div \r\n                  className=\"scan-success-overlay\"\r\n                  initial={{ opacity: 0, scale: 0.8 }}\r\n                  animate={{ opacity: 1, scale: 1 }}\r\n                  exit={{ opacity: 0, scale: 0.8 }}\r\n                >\r\n                  <div className=\"success-checkmark\">Γ£ô</div>\r\n                  <p>Pallet Scanned!</p>\r\n                  <span className=\"scanned-code\">{lastScanned}</span>\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n\r\n            {/* Error message */}\r\n            {error && (\r\n              <div className=\"qr-error-message\">\r\n                <span className=\"error-icon\">ΓÜá∩╕Å</span>\r\n                {error}\r\n              </div>\r\n            )}\r\n\r\n            {/* QR Reader container */}\r\n            <div id=\"qr-reader\" className=\"qr-reader-container\"></div>\r\n\r\n            {/* Instructions */}\r\n            <div className=\"qr-instructions\">\r\n              <p>Position the QR code within the frame</p>\r\n              {recentScans.length > 0 && (\r\n                <span className=\"scan-count\">{recentScans.length} pallets scanned this shift</span>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"qr-scanner-footer\">\r\n            <button className=\"qr-cancel-btn\" onClick={handleClose}>\r\n              Done Scanning\r\n            </button>\r\n          </div>\r\n        </motion.div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default QRScanner;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\ShiftInfo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\SubMachineModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\components\\WasteSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\index.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":23,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":23,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[613,657],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":26,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":26,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[702,759],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":33,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":33,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[951,997],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1030,1064],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1235,1307],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport './index.css';\r\nimport './mobile.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\n\r\nconst root = ReactDOM.createRoot(\r\n  document.getElementById('root') as HTMLElement\r\n);\r\n\r\nroot.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>\r\n);\r\n\r\n// Register service worker for offline support in production\r\nserviceWorkerRegistration.register({\r\n  onSuccess: () => {\r\n    console.log('App is ready for offline use');\r\n  },\r\n  onUpdate: (registration) => {\r\n    console.log('New version available. Refresh to update.');\r\n    // Optionally show a notification to the user\r\n    if (registration.waiting) {\r\n      registration.waiting.postMessage({ type: 'SKIP_WAITING' });\r\n    }\r\n  },\r\n  onOffline: () => {\r\n    console.log('App is running in offline mode');\r\n  },\r\n  onOnline: () => {\r\n    console.log('App is back online');\r\n  },\r\n});\r\n\r\n// Performance monitoring\r\nreportWebVitals((metric) => {\r\n  // Log performance metrics in development\r\n  if (process.env.NODE_ENV === 'development') {\r\n    console.log(`[Performance] ${metric.name}: ${metric.value.toFixed(2)}`);\r\n  }\r\n  // In production, send to analytics\r\n  // sendToAnalytics(metric);\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\accessibility.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReactNode' is defined but never used.","line":6,"column":59,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":68},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":304,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":316,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Accessibility utilities and hooks\r\n * Provides focus management, keyboard navigation, and screen reader support\r\n */\r\n\r\nimport React, { useEffect, useCallback, useRef, useState, ReactNode } from 'react';\r\n\r\n// Focus trap for modals\r\nexport const useFocusTrap = (isActive: boolean) => {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (!isActive || !containerRef.current) return;\r\n\r\n    const container = containerRef.current;\r\n    const focusableElements = container.querySelectorAll<HTMLElement>(\r\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\r\n    );\r\n    const firstElement = focusableElements[0];\r\n    const lastElement = focusableElements[focusableElements.length - 1];\r\n\r\n    // Focus first element when trap is activated\r\n    firstElement?.focus();\r\n\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key !== 'Tab') return;\r\n\r\n      if (e.shiftKey) {\r\n        if (document.activeElement === firstElement) {\r\n          e.preventDefault();\r\n          lastElement?.focus();\r\n        }\r\n      } else {\r\n        if (document.activeElement === lastElement) {\r\n          e.preventDefault();\r\n          firstElement?.focus();\r\n        }\r\n      }\r\n    };\r\n\r\n    container.addEventListener('keydown', handleKeyDown);\r\n    return () => container.removeEventListener('keydown', handleKeyDown);\r\n  }, [isActive]);\r\n\r\n  return containerRef;\r\n};\r\n\r\n// Restore focus after modal closes\r\nexport const useRestoreFocus = (isOpen: boolean) => {\r\n  const previousActiveElement = useRef<HTMLElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      previousActiveElement.current = document.activeElement as HTMLElement;\r\n    } else if (previousActiveElement.current) {\r\n      previousActiveElement.current.focus();\r\n      previousActiveElement.current = null;\r\n    }\r\n  }, [isOpen]);\r\n};\r\n\r\n// Keyboard navigation for lists/grids\r\nexport const useKeyboardNavigation = <T extends HTMLElement>(\r\n  items: T[],\r\n  options: {\r\n    orientation?: 'horizontal' | 'vertical' | 'grid';\r\n    gridColumns?: number;\r\n    loop?: boolean;\r\n    onSelect?: (index: number) => void;\r\n  } = {}\r\n) => {\r\n  const {\r\n    orientation = 'vertical',\r\n    gridColumns = 1,\r\n    loop = true,\r\n    onSelect,\r\n  } = options;\r\n\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n\r\n  const handleKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (items.length === 0) return;\r\n\r\n      let newIndex = currentIndex;\r\n      const isHorizontal = orientation === 'horizontal' || orientation === 'grid';\r\n      const isVertical = orientation === 'vertical' || orientation === 'grid';\r\n\r\n      switch (e.key) {\r\n        case 'ArrowRight':\r\n          if (isHorizontal) {\r\n            e.preventDefault();\r\n            newIndex = currentIndex + 1;\r\n          }\r\n          break;\r\n        case 'ArrowLeft':\r\n          if (isHorizontal) {\r\n            e.preventDefault();\r\n            newIndex = currentIndex - 1;\r\n          }\r\n          break;\r\n        case 'ArrowDown':\r\n          if (isVertical) {\r\n            e.preventDefault();\r\n            newIndex = orientation === 'grid'\r\n              ? currentIndex + gridColumns\r\n              : currentIndex + 1;\r\n          }\r\n          break;\r\n        case 'ArrowUp':\r\n          if (isVertical) {\r\n            e.preventDefault();\r\n            newIndex = orientation === 'grid'\r\n              ? currentIndex - gridColumns\r\n              : currentIndex - 1;\r\n          }\r\n          break;\r\n        case 'Home':\r\n          e.preventDefault();\r\n          newIndex = 0;\r\n          break;\r\n        case 'End':\r\n          e.preventDefault();\r\n          newIndex = items.length - 1;\r\n          break;\r\n        case 'Enter':\r\n        case ' ':\r\n          e.preventDefault();\r\n          onSelect?.(currentIndex);\r\n          return;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      // Handle bounds\r\n      if (loop) {\r\n        if (newIndex < 0) newIndex = items.length - 1;\r\n        if (newIndex >= items.length) newIndex = 0;\r\n      } else {\r\n        newIndex = Math.max(0, Math.min(items.length - 1, newIndex));\r\n      }\r\n\r\n      setCurrentIndex(newIndex);\r\n      items[newIndex]?.focus();\r\n    },\r\n    [currentIndex, items, orientation, gridColumns, loop, onSelect]\r\n  );\r\n\r\n  return { currentIndex, setCurrentIndex, handleKeyDown };\r\n};\r\n\r\n// Skip link for keyboard users\r\nexport const SkipLink: React.FC<{ targetId: string; children: React.ReactNode }> = ({\r\n  targetId,\r\n  children,\r\n}) => {\r\n  const handleClick = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    const target = document.getElementById(targetId);\r\n    if (target) {\r\n      target.focus();\r\n      target.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <a\r\n      href={`#${targetId}`}\r\n      className=\"skip-link\"\r\n      onClick={handleClick}\r\n      style={{\r\n        position: 'absolute',\r\n        left: '-10000px',\r\n        top: 'auto',\r\n        width: '1px',\r\n        height: '1px',\r\n        overflow: 'hidden',\r\n      }}\r\n      onFocus={(e) => {\r\n        const el = e.currentTarget;\r\n        el.style.left = '10px';\r\n        el.style.top = '10px';\r\n        el.style.width = 'auto';\r\n        el.style.height = 'auto';\r\n        el.style.overflow = 'visible';\r\n        el.style.zIndex = '10000';\r\n        el.style.padding = '8px 16px';\r\n        el.style.background = '#3b82f6';\r\n        el.style.color = 'white';\r\n        el.style.borderRadius = '4px';\r\n        el.style.textDecoration = 'none';\r\n      }}\r\n      onBlur={(e) => {\r\n        const el = e.currentTarget;\r\n        el.style.left = '-10000px';\r\n        el.style.width = '1px';\r\n        el.style.height = '1px';\r\n        el.style.overflow = 'hidden';\r\n      }}\r\n    >\r\n      {children}\r\n    </a>\r\n  );\r\n};\r\n\r\n// Announce to screen readers\r\nexport const announce = (message: string, priority: 'polite' | 'assertive' = 'polite') => {\r\n  const announcerId = `announcer-${priority}`;\r\n  let announcer = document.getElementById(announcerId);\r\n\r\n  if (!announcer) {\r\n    announcer = document.createElement('div');\r\n    announcer.id = announcerId;\r\n    announcer.setAttribute('aria-live', priority);\r\n    announcer.setAttribute('aria-atomic', 'true');\r\n    announcer.className = 'sr-only';\r\n    announcer.style.cssText = 'position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;';\r\n    document.body.appendChild(announcer);\r\n  }\r\n\r\n  // Clear and set message for announcement\r\n  announcer.textContent = '';\r\n  setTimeout(() => {\r\n    announcer!.textContent = message;\r\n  }, 100);\r\n};\r\n\r\n// Hook for live region announcements\r\nexport const useAnnounce = () => {\r\n  return useCallback((message: string, priority: 'polite' | 'assertive' = 'polite') => {\r\n    announce(message, priority);\r\n  }, []);\r\n};\r\n\r\n// Detect reduced motion preference\r\nexport const usePrefersReducedMotion = (): boolean => {\r\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(\r\n    () => window.matchMedia('(prefers-reduced-motion: reduce)').matches\r\n  );\r\n\r\n  useEffect(() => {\r\n    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\r\n    const handler = (e: MediaQueryListEvent) => setPrefersReducedMotion(e.matches);\r\n\r\n    mediaQuery.addEventListener('change', handler);\r\n    return () => mediaQuery.removeEventListener('change', handler);\r\n  }, []);\r\n\r\n  return prefersReducedMotion;\r\n};\r\n\r\n// High contrast mode detection\r\nexport const usePrefersHighContrast = (): boolean => {\r\n  const [prefersHighContrast, setPrefersHighContrast] = useState(\r\n    () => window.matchMedia('(prefers-contrast: more)').matches\r\n  );\r\n\r\n  useEffect(() => {\r\n    const mediaQuery = window.matchMedia('(prefers-contrast: more)');\r\n    const handler = (e: MediaQueryListEvent) => setPrefersHighContrast(e.matches);\r\n\r\n    mediaQuery.addEventListener('change', handler);\r\n    return () => mediaQuery.removeEventListener('change', handler);\r\n  }, []);\r\n\r\n  return prefersHighContrast;\r\n};\r\n\r\n// Generate unique IDs for ARIA attributes\r\nlet idCounter = 0;\r\nexport const useId = (prefix = 'id'): string => {\r\n  const idRef = useRef<string>();\r\n  if (!idRef.current) {\r\n    idRef.current = `${prefix}-${++idCounter}`;\r\n  }\r\n  return idRef.current;\r\n};\r\n\r\n// Visible focus styles helper\r\nexport const focusRingStyles = {\r\n  outline: '2px solid #3b82f6',\r\n  outlineOffset: '2px',\r\n};\r\n\r\n// Common ARIA attributes for interactive elements\r\nexport const getButtonAriaProps = (\r\n  label: string,\r\n  options: {\r\n    pressed?: boolean;\r\n    expanded?: boolean;\r\n    controls?: string;\r\n    describedBy?: string;\r\n    disabled?: boolean;\r\n  } = {}\r\n) => ({\r\n  'aria-label': label,\r\n  ...(options.pressed !== undefined && { 'aria-pressed': options.pressed }),\r\n  ...(options.expanded !== undefined && { 'aria-expanded': options.expanded }),\r\n  ...(options.controls && { 'aria-controls': options.controls }),\r\n  ...(options.describedBy && { 'aria-describedby': options.describedBy }),\r\n  ...(options.disabled && { 'aria-disabled': true }),\r\n});\r\n\r\nexport default {\r\n  useFocusTrap,\r\n  useRestoreFocus,\r\n  useKeyboardNavigation,\r\n  SkipLink,\r\n  announce,\r\n  useAnnounce,\r\n  usePrefersReducedMotion,\r\n  usePrefersHighContrast,\r\n  useId,\r\n  focusRingStyles,\r\n  getButtonAriaProps,\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\config.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":91,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":91,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"group"},"fix":{"range":[2537,2577],"text":""},"desc":"Remove the console.group()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":92,"column":29,"nodeType":"MemberExpression","messageId":"unexpected","endLine":92,"endColumn":41},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":93,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":93,"endColumn":21,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"groupEnd"},"fix":{"range":[2630,2649],"text":""},"desc":"Remove the console.groupEnd()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Environment configuration and validation\r\n * Provides type-safe access to environment variables with validation\r\n */\r\n\r\n// Environment types\r\ntype Environment = 'development' | 'production' | 'test';\r\n\r\n// Configuration interface\r\ninterface AppConfig {\r\n  env: Environment;\r\n  isProduction: boolean;\r\n  isDevelopment: boolean;\r\n  isTest: boolean;\r\n  supabase: {\r\n    url: string | null;\r\n    anonKey: string | null;\r\n    isConfigured: boolean;\r\n  };\r\n  app: {\r\n    name: string;\r\n    version: string;\r\n    homepage: string;\r\n  };\r\n  features: {\r\n    enableChat: boolean;\r\n    enableQRScanner: boolean;\r\n    enableOfflineMode: boolean;\r\n    enableErrorReporting: boolean;\r\n  };\r\n}\r\n\r\n// Validate required environment variables\r\nconst validateEnvVars = (): string[] => {\r\n  const warnings: string[] = [];\r\n\r\n  // Supabase is optional but warn if partially configured\r\n  const supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\r\n  const supabaseKey = process.env.REACT_APP_SUPABASE_ANON_KEY;\r\n\r\n  if ((supabaseUrl && !supabaseKey) || (!supabaseUrl && supabaseKey)) {\r\n    warnings.push(\r\n      'Supabase is partially configured. Set both REACT_APP_SUPABASE_URL and REACT_APP_SUPABASE_ANON_KEY for full functionality.'\r\n    );\r\n  }\r\n\r\n  return warnings;\r\n};\r\n\r\n// Get environment\r\nconst getEnvironment = (): Environment => {\r\n  const env = process.env.NODE_ENV;\r\n  if (env === 'production') return 'production';\r\n  if (env === 'test') return 'test';\r\n  return 'development';\r\n};\r\n\r\n// Build configuration object\r\nconst buildConfig = (): AppConfig => {\r\n  const env = getEnvironment();\r\n  const supabaseUrl = process.env.REACT_APP_SUPABASE_URL || null;\r\n  const supabaseKey = process.env.REACT_APP_SUPABASE_ANON_KEY || null;\r\n\r\n  return {\r\n    env,\r\n    isProduction: env === 'production',\r\n    isDevelopment: env === 'development',\r\n    isTest: env === 'test',\r\n    supabase: {\r\n      url: supabaseUrl,\r\n      anonKey: supabaseKey,\r\n      isConfigured: Boolean(supabaseUrl && supabaseKey),\r\n    },\r\n    app: {\r\n      name: 'Production Control',\r\n      version: process.env.REACT_APP_VERSION || '1.0.0',\r\n      homepage: 'https://bking5496.github.io/waste-and-downtime-dashboard',\r\n    },\r\n    features: {\r\n      enableChat: true,\r\n      enableQRScanner: true,\r\n      enableOfflineMode: true,\r\n      enableErrorReporting: env === 'production',\r\n    },\r\n  };\r\n};\r\n\r\n// Log configuration warnings on startup\r\nconst logConfigWarnings = (warnings: string[]): void => {\r\n  if (warnings.length > 0 && process.env.NODE_ENV !== 'test') {\r\n    console.group('Configuration Warnings');\r\n    warnings.forEach((w) => console.warn(w));\r\n    console.groupEnd();\r\n  }\r\n};\r\n\r\n// Initialize and export configuration\r\nconst warnings = validateEnvVars();\r\nlogConfigWarnings(warnings);\r\n\r\nexport const config = buildConfig();\r\n\r\n// Helper function to check if a feature is enabled\r\nexport const isFeatureEnabled = (feature: keyof AppConfig['features']): boolean => {\r\n  return config.features[feature];\r\n};\r\n\r\n// Helper function to get Supabase config\r\nexport const getSupabaseConfig = (): { url: string; anonKey: string } | null => {\r\n  if (!config.supabase.isConfigured) {\r\n    return null;\r\n  }\r\n  return {\r\n    url: config.supabase.url!,\r\n    anonKey: config.supabase.anonKey!,\r\n  };\r\n};\r\n\r\n// Check if running in offline mode (no Supabase)\r\nexport const isOfflineMode = (): boolean => {\r\n  return !config.supabase.isConfigured;\r\n};\r\n\r\n// Export config warnings for debugging\r\nexport const getConfigWarnings = (): string[] => warnings;\r\n\r\n// Type-safe environment variable access\r\nexport const getEnvVar = (key: string, defaultValue = ''): string => {\r\n  return process.env[`REACT_APP_${key}`] || defaultValue;\r\n};\r\n\r\nexport default config;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\liveSession.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":81,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":81,"endColumn":30,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2770,2833],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2893,2954],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3017,3068],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":118,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":118,"endColumn":30,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3885,3948],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":123,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":123,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4057,4108],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":150,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":150,"endColumn":30,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4899,4962],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":164,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":164,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5425,5535],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":167,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":167,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[5604,5655],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'today' is assigned a value but never used.","line":216,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":216,"endColumn":16},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":224,"column":17,"nodeType":"MemberExpression","messageId":"unexpected","endLine":224,"endColumn":28,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7426,7498],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":231,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":231,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7727,7782],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":263,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":263,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8956,9012],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase, isSupabaseConfigured } from './supabase';\r\n\r\n// ==========================================\r\n// LIVE SESSIONS - Cross-device sync with offline fallback\r\n// ==========================================\r\n\r\nexport interface LiveSession {\r\n    id: string; // Format: \"machineName_shift_date\"\r\n    machine_name: string;\r\n    operator_name: string;\r\n    order_number: string;\r\n    product: string;\r\n    batch_number: string;\r\n    shift: string;\r\n    session_date: string;\r\n    is_locked: boolean;\r\n    created_at?: string;\r\n    updated_at?: string;\r\n}\r\n\r\n// Generate session ID from components\r\nexport const getLiveSessionId = (machineName: string, shift: string, date: string): string => {\r\n    return `${machineName}_${shift}_${date}`;\r\n};\r\n\r\n// Cache for active sessions (used when offline or for quick lookups)\r\nlet sessionsCache: Map<string, LiveSession> = new Map();\r\nlet lastFetchTime: number = 0;\r\nconst CACHE_TTL_MS = 30000; // 30 seconds cache\r\n\r\n// ==========================================\r\n// UPSERT SESSION (Save/Update)\r\n// ==========================================\r\nexport const upsertLiveSession = async (session: {\r\n    machineName: string;\r\n    operatorName: string;\r\n    orderNumber: string;\r\n    product: string;\r\n    batchNumber: string;\r\n    shift: string;\r\n    date: string;\r\n    locked: boolean;\r\n}): Promise<boolean> => {\r\n    const sessionId = getLiveSessionId(session.machineName, session.shift, session.date);\r\n\r\n    const liveSession: LiveSession = {\r\n        id: sessionId,\r\n        machine_name: session.machineName,\r\n        operator_name: session.operatorName,\r\n        order_number: session.orderNumber,\r\n        product: session.product,\r\n        batch_number: session.batchNumber,\r\n        shift: session.shift,\r\n        session_date: session.date,\r\n        is_locked: session.locked,\r\n        updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    // Always update local cache first\r\n    sessionsCache.set(sessionId, liveSession);\r\n\r\n    // Try to sync to Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('live_sessions')\r\n                .upsert({\r\n                    id: sessionId,\r\n                    machine_name: session.machineName,\r\n                    operator_name: session.operatorName,\r\n                    order_number: session.orderNumber,\r\n                    product: session.product,\r\n                    batch_number: session.batchNumber,\r\n                    shift: session.shift,\r\n                    session_date: session.date,\r\n                    is_locked: session.locked,\r\n                    updated_at: new Date().toISOString(),\r\n                }, { onConflict: 'id' });\r\n\r\n            if (error) {\r\n                console.error('Failed to upsert live session:', error.message);\r\n                return false;\r\n            }\r\n            console.log('Γ£à Live session synced to Supabase:', sessionId);\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Failed to upsert live session:', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // Offline - cached locally, will sync later\r\n    return true;\r\n};\r\n\r\n// ==========================================\r\n// DELETE SESSION (When submitted or cleared)\r\n// ==========================================\r\nexport const deleteLiveSession = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string\r\n): Promise<boolean> => {\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    // Remove from local cache\r\n    sessionsCache.delete(sessionId);\r\n\r\n    // Try to delete from Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('live_sessions')\r\n                .delete()\r\n                .eq('id', sessionId);\r\n\r\n            if (error) {\r\n                console.error('Failed to delete live session:', error.message);\r\n                return false;\r\n            }\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Failed to delete live session:', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n// ==========================================\r\n// FETCH ACTIVE SESSIONS (For Dashboard)\r\n// ==========================================\r\nexport const fetchActiveSessions = async (): Promise<LiveSession[]> => {\r\n    const now = Date.now();\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    // Return cache if fresh and online fetch fails\r\n    const shouldUseCache = now - lastFetchTime < CACHE_TTL_MS;\r\n\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('live_sessions')\r\n                .select('*')\r\n                .eq('session_date', today)\r\n                .eq('is_locked', true);\r\n\r\n            if (error) {\r\n                console.error('Failed to fetch live sessions:', error.message);\r\n                // Fall back to cache\r\n                return Array.from(sessionsCache.values()).filter(\r\n                    s => s.session_date === today && s.is_locked\r\n                );\r\n            }\r\n\r\n            // Update cache with fetched data\r\n            sessionsCache.clear();\r\n            (data || []).forEach(session => {\r\n                sessionsCache.set(session.id, session);\r\n            });\r\n            lastFetchTime = now;\r\n\r\n            console.log('≡ƒôï Fetched active sessions from Supabase:', (data || []).length, data?.map(s => s.machine_name));\r\n            return data || [];\r\n        } catch (e) {\r\n            console.error('Failed to fetch live sessions:', e);\r\n            // Fall back to cache\r\n            return Array.from(sessionsCache.values()).filter(\r\n                s => s.session_date === today && s.is_locked\r\n            );\r\n        }\r\n    }\r\n\r\n    // Offline - return cached sessions\r\n    if (shouldUseCache) {\r\n        return Array.from(sessionsCache.values()).filter(\r\n            s => s.session_date === today && s.is_locked\r\n        );\r\n    }\r\n\r\n    return [];\r\n};\r\n\r\n// ==========================================\r\n// GET ACTIVE SUB-MACHINES (Replacement for localStorage check)\r\n// ==========================================\r\nexport const getActiveSubMachinesFromSupabase = async (\r\n    parentMachineName: string,\r\n    subMachineCount: number\r\n): Promise<Set<number>> => {\r\n    const activeSet = new Set<number>();\r\n    const sessions = await fetchActiveSessions();\r\n\r\n    for (let i = 1; i <= subMachineCount; i++) {\r\n        const fullName = `${parentMachineName} - Machine ${i}`;\r\n        const isActive = sessions.some(s => s.machine_name === fullName && s.is_locked);\r\n        if (isActive) {\r\n            activeSet.add(i);\r\n        }\r\n    }\r\n\r\n    return activeSet;\r\n};\r\n\r\n// ==========================================\r\n// SUBSCRIBE TO SESSION CHANGES (Real-time)\r\n// ==========================================\r\nexport const subscribeToSessionChanges = (\r\n    onUpdate: (sessions: LiveSession[]) => void\r\n) => {\r\n    if (!isSupabaseConfigured) {\r\n        return () => { }; // No-op unsubscribe\r\n    }\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    const channel = supabase\r\n        .channel('live-sessions-changes')\r\n        .on(\r\n            'postgres_changes',\r\n            { event: '*', schema: 'public', table: 'live_sessions' },\r\n            async (payload) => {\r\n                console.log('≡ƒöä Real-time session update received:', payload.eventType);\r\n                // Refetch all sessions on any change\r\n                const sessions = await fetchActiveSessions();\r\n                onUpdate(sessions);\r\n            }\r\n        )\r\n        .subscribe((status) => {\r\n            console.log('≡ƒôí Session subscription status:', status);\r\n        });\r\n\r\n    return () => {\r\n        supabase.removeChannel(channel);\r\n    };\r\n};\r\n\r\n// ==========================================\r\n// SYNC PENDING SESSIONS (On reconnection)\r\n// ==========================================\r\nexport const syncPendingSessions = async (): Promise<void> => {\r\n    if (!isSupabaseConfigured) return;\r\n\r\n    // Any sessions in cache that might not be synced yet\r\n    for (const session of Array.from(sessionsCache.values())) {\r\n        try {\r\n            await supabase\r\n                .from('live_sessions')\r\n                .upsert({\r\n                    id: session.id,\r\n                    machine_name: session.machine_name,\r\n                    operator_name: session.operator_name,\r\n                    order_number: session.order_number,\r\n                    product: session.product,\r\n                    batch_number: session.batch_number,\r\n                    shift: session.shift,\r\n                    session_date: session.session_date,\r\n                    is_locked: session.is_locked,\r\n                    updated_at: new Date().toISOString(),\r\n                }, { onConflict: 'id' });\r\n        } catch (e) {\r\n            console.error('Failed to sync session:', session.id, e);\r\n        }\r\n    }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\performance.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":5,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":59},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'options'. Either include it or remove the dependency array.","line":97,"column":6,"nodeType":"ArrayExpression","endLine":97,"endColumn":68,"suggestions":[{"desc":"Update the dependencies array to be: [element, options, options.root, options.rootMargin, options.threshold]","fix":{"range":[2688,2750],"text":"[element, options, options.root, options.rootMargin, options.threshold]"}}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":112,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":112,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3168,3233],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":124,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":124,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3596,3661],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":250,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":250,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7193,7257],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":258,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":273,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Performance optimization utilities and hooks\r\n */\r\n\r\nimport { useCallback, useRef, useEffect, useState, useMemo } from 'react';\r\n\r\n// Debounce hook\r\nexport const useDebounce = <T>(value: T, delay: number): T => {\r\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => setDebouncedValue(value), delay);\r\n    return () => clearTimeout(timer);\r\n  }, [value, delay]);\r\n\r\n  return debouncedValue;\r\n};\r\n\r\n// Throttle hook\r\nexport const useThrottle = <T>(value: T, interval: number): T => {\r\n  const [throttledValue, setThrottledValue] = useState<T>(value);\r\n  const lastUpdated = useRef<number>(Date.now());\r\n\r\n  useEffect(() => {\r\n    const now = Date.now();\r\n    if (now - lastUpdated.current >= interval) {\r\n      lastUpdated.current = now;\r\n      setThrottledValue(value);\r\n    } else {\r\n      const timer = setTimeout(() => {\r\n        lastUpdated.current = Date.now();\r\n        setThrottledValue(value);\r\n      }, interval - (now - lastUpdated.current));\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [value, interval]);\r\n\r\n  return throttledValue;\r\n};\r\n\r\n// Debounced callback hook\r\nexport const useDebouncedCallback = <T extends (...args: never[]) => void>(\r\n  callback: T,\r\n  delay: number\r\n): ((...args: Parameters<T>) => void) => {\r\n  const timeoutRef = useRef<ReturnType<typeof setTimeout>>();\r\n  const callbackRef = useRef(callback);\r\n\r\n  // Keep callback ref up to date\r\n  useEffect(() => {\r\n    callbackRef.current = callback;\r\n  }, [callback]);\r\n\r\n  const debouncedCallback = useCallback(\r\n    (...args: Parameters<T>) => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n      timeoutRef.current = setTimeout(() => {\r\n        callbackRef.current(...args);\r\n      }, delay);\r\n    },\r\n    [delay]\r\n  );\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return debouncedCallback;\r\n};\r\n\r\n// Intersection observer hook for lazy loading\r\nexport const useIntersectionObserver = (\r\n  options: IntersectionObserverInit = {}\r\n): [React.RefCallback<Element>, boolean] => {\r\n  const [isIntersecting, setIsIntersecting] = useState(false);\r\n  const [element, setElement] = useState<Element | null>(null);\r\n\r\n  const callbackRef = useCallback((node: Element | null) => {\r\n    setElement(node);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!element) return;\r\n\r\n    const observer = new IntersectionObserver(([entry]) => {\r\n      setIsIntersecting(entry.isIntersecting);\r\n    }, options);\r\n\r\n    observer.observe(element);\r\n    return () => observer.disconnect();\r\n  }, [element, options.root, options.rootMargin, options.threshold]);\r\n\r\n  return [callbackRef, isIntersecting];\r\n};\r\n\r\n// Memoized local storage hook\r\nexport const useLocalStorage = <T>(\r\n  key: string,\r\n  initialValue: T\r\n): [T, (value: T | ((prev: T) => T)) => void] => {\r\n  const [storedValue, setStoredValue] = useState<T>(() => {\r\n    try {\r\n      const item = window.localStorage.getItem(key);\r\n      return item ? JSON.parse(item) : initialValue;\r\n    } catch (error) {\r\n      console.error(`Error reading localStorage key \"${key}\":`, error);\r\n      return initialValue;\r\n    }\r\n  });\r\n\r\n  const setValue = useCallback(\r\n    (value: T | ((prev: T) => T)) => {\r\n      try {\r\n        const valueToStore = value instanceof Function ? value(storedValue) : value;\r\n        setStoredValue(valueToStore);\r\n        window.localStorage.setItem(key, JSON.stringify(valueToStore));\r\n      } catch (error) {\r\n        console.error(`Error setting localStorage key \"${key}\":`, error);\r\n      }\r\n    },\r\n    [key, storedValue]\r\n  );\r\n\r\n  return [storedValue, setValue];\r\n};\r\n\r\n// Previous value hook for comparison\r\nexport const usePrevious = <T>(value: T): T | undefined => {\r\n  const ref = useRef<T>();\r\n\r\n  useEffect(() => {\r\n    ref.current = value;\r\n  }, [value]);\r\n\r\n  return ref.current;\r\n};\r\n\r\n// Request animation frame hook for smooth updates\r\nexport const useAnimationFrame = (callback: (deltaTime: number) => void) => {\r\n  const requestRef = useRef<number>();\r\n  const previousTimeRef = useRef<number>();\r\n\r\n  const animate = useCallback(\r\n    (time: number) => {\r\n      if (previousTimeRef.current !== undefined) {\r\n        const deltaTime = time - previousTimeRef.current;\r\n        callback(deltaTime);\r\n      }\r\n      previousTimeRef.current = time;\r\n      requestRef.current = requestAnimationFrame(animate);\r\n    },\r\n    [callback]\r\n  );\r\n\r\n  useEffect(() => {\r\n    requestRef.current = requestAnimationFrame(animate);\r\n    return () => {\r\n      if (requestRef.current) {\r\n        cancelAnimationFrame(requestRef.current);\r\n      }\r\n    };\r\n  }, [animate]);\r\n};\r\n\r\n// Window size hook with debounce\r\nexport const useWindowSize = (debounceMs = 200) => {\r\n  const [size, setSize] = useState({\r\n    width: window.innerWidth,\r\n    height: window.innerHeight,\r\n  });\r\n\r\n  const debouncedSetSize = useDebouncedCallback(\r\n    (newSize: { width: number; height: number }) => setSize(newSize),\r\n    debounceMs\r\n  );\r\n\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      debouncedSetSize({\r\n        width: window.innerWidth,\r\n        height: window.innerHeight,\r\n      });\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, [debouncedSetSize]);\r\n\r\n  return size;\r\n};\r\n\r\n// Media query hook\r\nexport const useMediaQuery = (query: string): boolean => {\r\n  const [matches, setMatches] = useState(\r\n    () => window.matchMedia(query).matches\r\n  );\r\n\r\n  useEffect(() => {\r\n    const mediaQuery = window.matchMedia(query);\r\n    const handler = (e: MediaQueryListEvent) => setMatches(e.matches);\r\n\r\n    mediaQuery.addEventListener('change', handler);\r\n    return () => mediaQuery.removeEventListener('change', handler);\r\n  }, [query]);\r\n\r\n  return matches;\r\n};\r\n\r\n// Common breakpoint hooks\r\nexport const useIsMobile = () => useMediaQuery('(max-width: 767px)');\r\nexport const useIsTablet = () => useMediaQuery('(min-width: 768px) and (max-width: 1023px)');\r\nexport const useIsDesktop = () => useMediaQuery('(min-width: 1024px)');\r\n\r\n// Memoize expensive calculations with deep comparison\r\nexport const useDeepMemo = <T>(value: T, deps: React.DependencyList): T => {\r\n  const ref = useRef<T>(value);\r\n  const prevDeps = useRef<React.DependencyList>(deps);\r\n\r\n  const depsChanged = deps.some((dep, i) => {\r\n    return JSON.stringify(dep) !== JSON.stringify(prevDeps.current[i]);\r\n  });\r\n\r\n  if (depsChanged) {\r\n    ref.current = value;\r\n    prevDeps.current = deps;\r\n  }\r\n\r\n  return ref.current;\r\n};\r\n\r\n// Performance mark helper\r\nexport const measurePerformance = (name: string) => {\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    const startMark = `${name}-start`;\r\n    const endMark = `${name}-end`;\r\n\r\n    return {\r\n      start: () => performance.mark(startMark),\r\n      end: () => {\r\n        performance.mark(endMark);\r\n        performance.measure(name, startMark, endMark);\r\n        const entries = performance.getEntriesByName(name);\r\n        const duration = entries[entries.length - 1]?.duration;\r\n        console.log(`[Performance] ${name}: ${duration?.toFixed(2)}ms`);\r\n        return duration;\r\n      },\r\n    };\r\n  }\r\n  return { start: () => {}, end: () => 0 };\r\n};\r\n\r\nexport default {\r\n  useDebounce,\r\n  useThrottle,\r\n  useDebouncedCallback,\r\n  useIntersectionObserver,\r\n  useLocalStorage,\r\n  usePrevious,\r\n  useAnimationFrame,\r\n  useWindowSize,\r\n  useMediaQuery,\r\n  useIsMobile,\r\n  useIsTablet,\r\n  useIsDesktop,\r\n  useDeepMemo,\r\n  measurePerformance,\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\security.test.ts","messages":[{"ruleId":"no-script-url","severity":1,"message":"Script URL is a form of eval.","line":115,"column":24,"nodeType":"Literal","messageId":"unexpectedScriptURL","endLine":115,"endColumn":49},{"ruleId":"no-script-url","severity":1,"message":"Script URL is a form of eval.","line":159,"column":33,"nodeType":"Literal","messageId":"unexpectedScriptURL","endLine":159,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests for security utilities\r\n */\r\n\r\nimport {\r\n  escapeHtml,\r\n  sanitizeString,\r\n  sanitizeNumber,\r\n  sanitizeEmail,\r\n  sanitizeUrl,\r\n  checkRateLimit,\r\n  detectMaliciousInput,\r\n} from './security';\r\n\r\ndescribe('escapeHtml', () => {\r\n  it('should escape HTML entities', () => {\r\n    expect(escapeHtml('<script>')).toBe('&lt;script&gt;');\r\n    expect(escapeHtml('a & b')).toBe('a &amp; b');\r\n    expect(escapeHtml('\"quoted\"')).toBe('&quot;quoted&quot;');\r\n    expect(escapeHtml(\"'single'\")).toBe('&#39;single&#39;');\r\n  });\r\n\r\n  it('should handle empty strings', () => {\r\n    expect(escapeHtml('')).toBe('');\r\n  });\r\n\r\n  it('should handle strings without special characters', () => {\r\n    expect(escapeHtml('hello world')).toBe('hello world');\r\n  });\r\n});\r\n\r\ndescribe('sanitizeString', () => {\r\n  it('should trim whitespace', () => {\r\n    expect(sanitizeString('  hello  ')).toBe('hello');\r\n  });\r\n\r\n  it('should remove HTML tags', () => {\r\n    expect(sanitizeString('<script>alert(\"xss\")</script>')).toBe('');\r\n    expect(sanitizeString('Hello <b>world</b>')).toBe('Hello world');\r\n  });\r\n\r\n  it('should remove null bytes', () => {\r\n    expect(sanitizeString('hello\\x00world')).toBe('helloworld');\r\n  });\r\n\r\n  it('should remove control characters', () => {\r\n    expect(sanitizeString('hello\\x01\\x02world')).toBe('helloworld');\r\n  });\r\n\r\n  it('should respect maxLength', () => {\r\n    expect(sanitizeString('a'.repeat(100), { maxLength: 50 })).toHaveLength(50);\r\n  });\r\n\r\n  it('should preserve newlines when allowed', () => {\r\n    expect(sanitizeString('hello\\nworld', { allowNewlines: true })).toBe('hello\\nworld');\r\n    expect(sanitizeString('hello\\nworld', { allowNewlines: false })).toBe('helloworld');\r\n  });\r\n\r\n  it('should remove special chars when not allowed', () => {\r\n    expect(sanitizeString('hello@world!', { allowSpecialChars: false })).toBe('helloworld');\r\n  });\r\n});\r\n\r\ndescribe('sanitizeNumber', () => {\r\n  it('should parse valid numbers', () => {\r\n    expect(sanitizeNumber('42')).toBe(42);\r\n    expect(sanitizeNumber(42)).toBe(42);\r\n    expect(sanitizeNumber('3.14')).toBe(3.14);\r\n    expect(sanitizeNumber('-10')).toBe(-10);\r\n  });\r\n\r\n  it('should return default for invalid input', () => {\r\n    expect(sanitizeNumber('abc')).toBe(0);\r\n    expect(sanitizeNumber('abc', { defaultValue: -1 })).toBe(-1);\r\n  });\r\n\r\n  it('should clamp to min/max', () => {\r\n    expect(sanitizeNumber(5, { min: 10 })).toBe(10);\r\n    expect(sanitizeNumber(150, { max: 100 })).toBe(100);\r\n  });\r\n\r\n  it('should round to decimals', () => {\r\n    expect(sanitizeNumber(3.14159, { decimals: 2 })).toBe(3.14);\r\n    expect(sanitizeNumber(3.145, { decimals: 2 })).toBe(3.15);\r\n  });\r\n\r\n  it('should strip non-numeric characters', () => {\r\n    expect(sanitizeNumber('$100.50')).toBe(100.5);\r\n    expect(sanitizeNumber('abc123def')).toBe(123);\r\n  });\r\n});\r\n\r\ndescribe('sanitizeEmail', () => {\r\n  it('should accept valid emails', () => {\r\n    expect(sanitizeEmail('test@example.com')).toBe('test@example.com');\r\n    expect(sanitizeEmail('TEST@EXAMPLE.COM')).toBe('test@example.com');\r\n    expect(sanitizeEmail('  test@example.com  ')).toBe('test@example.com');\r\n  });\r\n\r\n  it('should reject invalid emails', () => {\r\n    expect(sanitizeEmail('notanemail')).toBeNull();\r\n    expect(sanitizeEmail('missing@domain')).toBeNull();\r\n    expect(sanitizeEmail('@nodomain.com')).toBeNull();\r\n    expect(sanitizeEmail('')).toBeNull();\r\n  });\r\n});\r\n\r\ndescribe('sanitizeUrl', () => {\r\n  it('should accept valid http/https URLs', () => {\r\n    expect(sanitizeUrl('https://example.com')).toBe('https://example.com/');\r\n    expect(sanitizeUrl('http://example.com/path')).toBe('http://example.com/path');\r\n  });\r\n\r\n  it('should reject non-http protocols', () => {\r\n    expect(sanitizeUrl('javascript:alert(\"xss\")')).toBeNull();\r\n    expect(sanitizeUrl('ftp://files.example.com')).toBeNull();\r\n    expect(sanitizeUrl('data:text/html,<script>alert(\"xss\")</script>')).toBeNull();\r\n  });\r\n\r\n  it('should reject invalid URLs', () => {\r\n    expect(sanitizeUrl('not a url')).toBeNull();\r\n    expect(sanitizeUrl('')).toBeNull();\r\n  });\r\n});\r\n\r\ndescribe('checkRateLimit', () => {\r\n  beforeEach(() => {\r\n    // Clear rate limit store between tests by using unique keys\r\n  });\r\n\r\n  it('should allow requests under limit', () => {\r\n    const key = `test-${Date.now()}-${Math.random()}`;\r\n    const result1 = checkRateLimit(key, 3, 60000);\r\n    expect(result1.allowed).toBe(true);\r\n    expect(result1.remaining).toBe(2);\r\n\r\n    const result2 = checkRateLimit(key, 3, 60000);\r\n    expect(result2.allowed).toBe(true);\r\n    expect(result2.remaining).toBe(1);\r\n  });\r\n\r\n  it('should block requests over limit', () => {\r\n    const key = `test-${Date.now()}-${Math.random()}`;\r\n    checkRateLimit(key, 2, 60000);\r\n    checkRateLimit(key, 2, 60000);\r\n    const result = checkRateLimit(key, 2, 60000);\r\n    expect(result.allowed).toBe(false);\r\n    expect(result.remaining).toBe(0);\r\n  });\r\n});\r\n\r\ndescribe('detectMaliciousInput', () => {\r\n  it('should detect script tags', () => {\r\n    expect(detectMaliciousInput('<script>alert(\"xss\")</script>')).toBe(true);\r\n    expect(detectMaliciousInput('<SCRIPT>alert(\"xss\")</SCRIPT>')).toBe(true);\r\n  });\r\n\r\n  it('should detect javascript: protocol', () => {\r\n    expect(detectMaliciousInput('javascript:alert(\"xss\")')).toBe(true);\r\n  });\r\n\r\n  it('should detect event handlers', () => {\r\n    expect(detectMaliciousInput('onclick=alert(\"xss\")')).toBe(true);\r\n    expect(detectMaliciousInput('onerror=alert(\"xss\")')).toBe(true);\r\n  });\r\n\r\n  it('should detect eval calls', () => {\r\n    expect(detectMaliciousInput('eval(userInput)')).toBe(true);\r\n  });\r\n\r\n  it('should pass safe input', () => {\r\n    expect(detectMaliciousInput('Hello, World!')).toBe(false);\r\n    expect(detectMaliciousInput('Just some normal text')).toBe(false);\r\n    expect(detectMaliciousInput('Order #12345')).toBe(false);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\security.ts","messages":[{"ruleId":"no-control-regex","severity":1,"message":"Unexpected control character(s) in regular expression: \\x00, \\x09, \\x0b, \\x0c, \\x0e, \\x1f.","line":41,"column":35,"nodeType":"Literal","messageId":"unexpected","endLine":41,"endColumn":70},{"ruleId":"no-control-regex","severity":1,"message":"Unexpected control character(s) in regular expression: \\x00, \\x1f.","line":43,"column":35,"nodeType":"Literal","messageId":"unexpected","endLine":43,"endColumn":53},{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":251,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":264,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Security utilities for input sanitization and validation\r\n */\r\n\r\n// HTML entities for escaping\r\nconst HTML_ENTITIES: Record<string, string> = {\r\n  '&': '&amp;',\r\n  '<': '&lt;',\r\n  '>': '&gt;',\r\n  '\"': '&quot;',\r\n  \"'\": '&#39;',\r\n  '/': '&#x2F;',\r\n  '`': '&#x60;',\r\n  '=': '&#x3D;',\r\n};\r\n\r\n// Escape HTML to prevent XSS\r\nexport const escapeHtml = (str: string): string => {\r\n  return String(str).replace(/[&<>\"'`=/]/g, (char) => HTML_ENTITIES[char] || char);\r\n};\r\n\r\n// Sanitize string input - removes dangerous characters\r\nexport const sanitizeString = (input: string, options: {\r\n  maxLength?: number;\r\n  allowNewlines?: boolean;\r\n  allowSpecialChars?: boolean;\r\n} = {}): string => {\r\n  const {\r\n    maxLength = 1000,\r\n    allowNewlines = false,\r\n    allowSpecialChars = true,\r\n  } = options;\r\n\r\n  let sanitized = input.trim();\r\n\r\n  // Remove null bytes\r\n  sanitized = sanitized.replace(/\\0/g, '');\r\n\r\n  // Remove control characters (except newlines if allowed)\r\n  if (allowNewlines) {\r\n    sanitized = sanitized.replace(/[\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '');\r\n  } else {\r\n    sanitized = sanitized.replace(/[\\x00-\\x1F\\x7F]/g, '');\r\n  }\r\n\r\n  // Remove HTML tags\r\n  sanitized = sanitized.replace(/<[^>]*>/g, '');\r\n\r\n  // Optionally remove special characters\r\n  if (!allowSpecialChars) {\r\n    sanitized = sanitized.replace(/[^\\w\\s-]/g, '');\r\n  }\r\n\r\n  // Truncate to max length\r\n  if (sanitized.length > maxLength) {\r\n    sanitized = sanitized.substring(0, maxLength);\r\n  }\r\n\r\n  return sanitized;\r\n};\r\n\r\n// Sanitize number input\r\nexport const sanitizeNumber = (\r\n  input: string | number,\r\n  options: {\r\n    min?: number;\r\n    max?: number;\r\n    decimals?: number;\r\n    defaultValue?: number;\r\n  } = {}\r\n): number => {\r\n  const { min, max, decimals, defaultValue = 0 } = options;\r\n\r\n  let num = typeof input === 'number' ? input : parseFloat(String(input).replace(/[^\\d.-]/g, ''));\r\n\r\n  if (isNaN(num)) {\r\n    return defaultValue;\r\n  }\r\n\r\n  // Clamp to range\r\n  if (min !== undefined) num = Math.max(min, num);\r\n  if (max !== undefined) num = Math.min(max, num);\r\n\r\n  // Round to decimals\r\n  if (decimals !== undefined) {\r\n    const factor = Math.pow(10, decimals);\r\n    num = Math.round(num * factor) / factor;\r\n  }\r\n\r\n  return num;\r\n};\r\n\r\n// Validate and sanitize email\r\nexport const sanitizeEmail = (email: string): string | null => {\r\n  const sanitized = email.trim().toLowerCase();\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n\r\n  if (!emailRegex.test(sanitized)) {\r\n    return null;\r\n  }\r\n\r\n  return sanitized.substring(0, 254); // Max email length\r\n};\r\n\r\n// Sanitize URL\r\nexport const sanitizeUrl = (url: string): string | null => {\r\n  const sanitized = url.trim();\r\n\r\n  try {\r\n    const parsed = new URL(sanitized);\r\n\r\n    // Only allow http and https protocols\r\n    if (!['http:', 'https:'].includes(parsed.protocol)) {\r\n      return null;\r\n    }\r\n\r\n    return parsed.href;\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\n// Rate limiting helper (client-side, use with caution)\r\nconst rateLimitStore = new Map<string, { count: number; resetTime: number }>();\r\n\r\nexport const checkRateLimit = (\r\n  key: string,\r\n  maxRequests: number,\r\n  windowMs: number\r\n): { allowed: boolean; remaining: number; resetIn: number } => {\r\n  const now = Date.now();\r\n  const record = rateLimitStore.get(key);\r\n\r\n  if (!record || now > record.resetTime) {\r\n    rateLimitStore.set(key, {\r\n      count: 1,\r\n      resetTime: now + windowMs,\r\n    });\r\n    return { allowed: true, remaining: maxRequests - 1, resetIn: windowMs };\r\n  }\r\n\r\n  if (record.count >= maxRequests) {\r\n    return {\r\n      allowed: false,\r\n      remaining: 0,\r\n      resetIn: record.resetTime - now,\r\n    };\r\n  }\r\n\r\n  record.count++;\r\n  return {\r\n    allowed: true,\r\n    remaining: maxRequests - record.count,\r\n    resetIn: record.resetTime - now,\r\n  };\r\n};\r\n\r\n// CSRF token generation (for forms)\r\nexport const generateCSRFToken = (): string => {\r\n  const array = new Uint8Array(32);\r\n  crypto.getRandomValues(array);\r\n  return Array.from(array, (byte) => byte.toString(16).padStart(2, '0')).join('');\r\n};\r\n\r\n// Store and validate CSRF tokens\r\nconst csrfTokens = new Set<string>();\r\n\r\nexport const createCSRFToken = (): string => {\r\n  const token = generateCSRFToken();\r\n  csrfTokens.add(token);\r\n  // Auto-expire tokens after 1 hour\r\n  setTimeout(() => csrfTokens.delete(token), 3600000);\r\n  return token;\r\n};\r\n\r\nexport const validateCSRFToken = (token: string): boolean => {\r\n  if (csrfTokens.has(token)) {\r\n    csrfTokens.delete(token); // Single use\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\n// Content Security Policy helper\r\nexport const getCSPDirectives = (): string => {\r\n  return [\r\n    \"default-src 'self'\",\r\n    \"script-src 'self' 'unsafe-inline' 'unsafe-eval'\", // Required for React\r\n    \"style-src 'self' 'unsafe-inline'\", // Required for styled components\r\n    \"img-src 'self' data: blob: https:\",\r\n    \"font-src 'self' data:\",\r\n    \"connect-src 'self' https://*.supabase.co wss://*.supabase.co\",\r\n    \"frame-ancestors 'none'\",\r\n    \"form-action 'self'\",\r\n  ].join('; ');\r\n};\r\n\r\n// Secure storage wrapper (with expiration)\r\nexport const secureStorage = {\r\n  set: (key: string, value: unknown, expirationMs?: number): void => {\r\n    const item = {\r\n      value,\r\n      expiration: expirationMs ? Date.now() + expirationMs : null,\r\n    };\r\n    localStorage.setItem(key, JSON.stringify(item));\r\n  },\r\n\r\n  get: <T>(key: string, defaultValue?: T): T | undefined => {\r\n    try {\r\n      const item = localStorage.getItem(key);\r\n      if (!item) return defaultValue;\r\n\r\n      const parsed = JSON.parse(item);\r\n      if (parsed.expiration && Date.now() > parsed.expiration) {\r\n        localStorage.removeItem(key);\r\n        return defaultValue;\r\n      }\r\n\r\n      return parsed.value as T;\r\n    } catch {\r\n      return defaultValue;\r\n    }\r\n  },\r\n\r\n  remove: (key: string): void => {\r\n    localStorage.removeItem(key);\r\n  },\r\n\r\n  clear: (): void => {\r\n    localStorage.clear();\r\n  },\r\n};\r\n\r\n// Detect potentially malicious input patterns\r\nexport const detectMaliciousInput = (input: string): boolean => {\r\n  const maliciousPatterns = [\r\n    /<script/i,\r\n    /javascript:/i,\r\n    /on\\w+\\s*=/i, // onclick=, onerror=, etc.\r\n    /data:text\\/html/i,\r\n    /vbscript:/i,\r\n    /expression\\s*\\(/i,\r\n    /eval\\s*\\(/i,\r\n    /document\\./i,\r\n    /window\\./i,\r\n  ];\r\n\r\n  return maliciousPatterns.some((pattern) => pattern.test(input));\r\n};\r\n\r\nexport default {\r\n  escapeHtml,\r\n  sanitizeString,\r\n  sanitizeNumber,\r\n  sanitizeEmail,\r\n  sanitizeUrl,\r\n  checkRateLimit,\r\n  generateCSRFToken,\r\n  createCSRFToken,\r\n  validateCSRFToken,\r\n  getCSPDirectives,\r\n  secureStorage,\r\n  detectMaliciousInput,\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\shiftUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\storage.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":159,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":159,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[4593,4650],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":216,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":216,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6164,6261],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":266,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":266,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[7953,8013],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":274,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":274,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8290,8370],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":423,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":423,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13132,13199],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":441,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":441,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13624,13688],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":458,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":458,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14126,14190],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":473,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":473,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14549,14611],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ShiftData, Machine, MACHINES } from '../types';\r\nimport {\r\n  fetchMachines,\r\n  upsertMachine,\r\n  removeMachine,\r\n  syncMachinesToSupabase,\r\n  subscribeMachineChanges,\r\n  MachineRecord,\r\n  submitShiftData,\r\n  isSupabaseConfigured\r\n} from './supabase';\r\n\r\nconst STORAGE_KEY = 'waste_downtime_history';\r\nconst MACHINES_KEY = 'machines_data';\r\nconst MACHINES_SYNC_KEY = 'machines_last_sync';\r\nconst FAILED_SUBMISSIONS_KEY = 'failed_submissions_queue';\r\nconst HISTORY_MAX_DAYS = 90; // Keep history for 90 days\r\nconst HISTORY_MAX_ENTRIES = 1000; // Maximum entries to keep\r\n\r\n// ==========================================\r\n// FAILED SUBMISSIONS RETRY QUEUE\r\n// ==========================================\r\n\r\ninterface FailedSubmission {\r\n  id: string;\r\n  timestamp: string;\r\n  retryCount: number;\r\n  maxRetries: number;\r\n  data: {\r\n    shiftData: any;\r\n    wasteEntries: any[];\r\n    downtimeEntries: any[];\r\n    speedEntries?: any[];\r\n    sachetMassEntries?: any[];\r\n    looseCasesEntries?: any[];\r\n    palletScanEntries?: any[];\r\n  };\r\n  error: string;\r\n}\r\n\r\n// Get failed submissions queue\r\nexport const getFailedSubmissions = (): FailedSubmission[] => {\r\n  const stored = localStorage.getItem(FAILED_SUBMISSIONS_KEY);\r\n  if (!stored) return [];\r\n  try {\r\n    return JSON.parse(stored);\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\n// Add a failed submission to the retry queue\r\nexport const addFailedSubmission = (\r\n  data: FailedSubmission['data'],\r\n  error: string\r\n): void => {\r\n  const queue = getFailedSubmissions();\r\n  const newEntry: FailedSubmission = {\r\n    id: `failed_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n    timestamp: new Date().toISOString(),\r\n    retryCount: 0,\r\n    maxRetries: 3,\r\n    data,\r\n    error,\r\n  };\r\n  queue.push(newEntry);\r\n  localStorage.setItem(FAILED_SUBMISSIONS_KEY, JSON.stringify(queue));\r\n};\r\n\r\n// Remove a submission from the failed queue\r\nexport const removeFailedSubmission = (id: string): void => {\r\n  const queue = getFailedSubmissions();\r\n  const filtered = queue.filter(s => s.id !== id);\r\n  localStorage.setItem(FAILED_SUBMISSIONS_KEY, JSON.stringify(filtered));\r\n};\r\n\r\n// Retry all failed submissions\r\nexport const retryFailedSubmissions = async (): Promise<{\r\n  succeeded: number;\r\n  failed: number;\r\n  remaining: number;\r\n}> => {\r\n  if (!isSupabaseConfigured) {\r\n    return { succeeded: 0, failed: 0, remaining: getFailedSubmissions().length };\r\n  }\r\n\r\n  const queue = getFailedSubmissions();\r\n  let succeeded = 0;\r\n  let failed = 0;\r\n\r\n  for (const submission of queue) {\r\n    if (submission.retryCount >= submission.maxRetries) {\r\n      // Max retries reached, keep in queue but don't retry\r\n      failed++;\r\n      continue;\r\n    }\r\n\r\n    try {\r\n      await submitShiftData(\r\n        submission.data.shiftData,\r\n        submission.data.wasteEntries,\r\n        submission.data.downtimeEntries,\r\n        submission.data.speedEntries,\r\n        submission.data.sachetMassEntries,\r\n        submission.data.looseCasesEntries,\r\n        submission.data.palletScanEntries\r\n      );\r\n      removeFailedSubmission(submission.id);\r\n      succeeded++;\r\n    } catch (e) {\r\n      // Update retry count\r\n      const updatedQueue = getFailedSubmissions().map(s =>\r\n        s.id === submission.id\r\n          ? { ...s, retryCount: s.retryCount + 1, error: String(e) }\r\n          : s\r\n      );\r\n      localStorage.setItem(FAILED_SUBMISSIONS_KEY, JSON.stringify(updatedQueue));\r\n      failed++;\r\n    }\r\n  }\r\n\r\n  return {\r\n    succeeded,\r\n    failed,\r\n    remaining: getFailedSubmissions().length,\r\n  };\r\n};\r\n\r\n// Clear all failed submissions (manual clear)\r\nexport const clearFailedSubmissions = (): void => {\r\n  localStorage.removeItem(FAILED_SUBMISSIONS_KEY);\r\n};\r\n\r\n// ==========================================\r\n// LOCALSTORAGE CLEANUP\r\n// ==========================================\r\n\r\n// Clean up old history entries\r\nexport const cleanupOldHistory = (): { removed: number; remaining: number } => {\r\n  const history = getShiftHistory();\r\n  const now = new Date();\r\n  const cutoffDate = new Date(now.getTime() - HISTORY_MAX_DAYS * 24 * 60 * 60 * 1000);\r\n\r\n  // Filter out entries older than cutoff date\r\n  let cleaned = history.filter(item => {\r\n    const itemDate = new Date(item.date);\r\n    return itemDate >= cutoffDate;\r\n  });\r\n\r\n  // Also limit to max entries (keep most recent)\r\n  if (cleaned.length > HISTORY_MAX_ENTRIES) {\r\n    cleaned = cleaned.slice(0, HISTORY_MAX_ENTRIES);\r\n  }\r\n\r\n  const removed = history.length - cleaned.length;\r\n\r\n  if (removed > 0) {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(cleaned));\r\n    console.log(`Cleaned up ${removed} old history entries`);\r\n  }\r\n\r\n  return { removed, remaining: cleaned.length };\r\n};\r\n\r\n// Get localStorage usage stats\r\nexport const getStorageStats = (): {\r\n  historyCount: number;\r\n  failedCount: number;\r\n  totalSizeKB: number;\r\n  oldestEntry: string | null;\r\n} => {\r\n  const history = getShiftHistory();\r\n  const failed = getFailedSubmissions();\r\n\r\n  // Estimate total localStorage size\r\n  let totalSize = 0;\r\n  for (let i = 0; i < localStorage.length; i++) {\r\n    const key = localStorage.key(i);\r\n    if (key) {\r\n      const value = localStorage.getItem(key) || '';\r\n      totalSize += key.length + value.length;\r\n    }\r\n  }\r\n\r\n  const oldestEntry = history.length > 0\r\n    ? history[history.length - 1].date\r\n    : null;\r\n\r\n  return {\r\n    historyCount: history.length,\r\n    failedCount: failed.length,\r\n    totalSizeKB: Math.round(totalSize / 1024),\r\n    oldestEntry,\r\n  };\r\n};\r\n\r\n// Run cleanup on app startup (debounced to run once per day)\r\nexport const maybeRunCleanup = (): void => {\r\n  const lastCleanupKey = 'last_storage_cleanup';\r\n  const lastCleanup = localStorage.getItem(lastCleanupKey);\r\n  const now = new Date();\r\n\r\n  if (lastCleanup) {\r\n    const lastDate = new Date(lastCleanup);\r\n    const hoursSinceCleanup = (now.getTime() - lastDate.getTime()) / (1000 * 60 * 60);\r\n    if (hoursSinceCleanup < 24) {\r\n      return; // Already cleaned up today\r\n    }\r\n  }\r\n\r\n  // Run cleanup\r\n  const result = cleanupOldHistory();\r\n  localStorage.setItem(lastCleanupKey, now.toISOString());\r\n\r\n  if (result.removed > 0) {\r\n    console.log(`Storage cleanup: removed ${result.removed} entries, ${result.remaining} remaining`);\r\n  }\r\n};\r\n\r\n// Flag to track if we're using Supabase\r\nlet useSupabase = true;\r\nlet machinesCache: Machine[] | null = null;\r\nlet machinesListeners: ((machines: Machine[]) => void)[] = [];\r\n\r\n// Convert Supabase record to local Machine type\r\nconst toLocalMachine = (record: MachineRecord): Machine => ({\r\n  id: record.id,\r\n  name: record.name,\r\n  status: record.status,\r\n  currentOperator: record.current_operator,\r\n  currentOrder: record.current_order,\r\n  currentShift: record.current_shift,\r\n  lastSubmission: record.last_submission,\r\n  todayWaste: record.today_waste,\r\n  todayDowntime: record.today_downtime,\r\n  subMachineCount: record.sub_machine_count,\r\n});\r\n\r\n// Convert local Machine to Supabase record\r\nconst toSupabaseRecord = (machine: Machine): MachineRecord => ({\r\n  id: machine.id,\r\n  name: machine.name,\r\n  status: machine.status,\r\n  current_operator: machine.currentOperator,\r\n  current_order: machine.currentOrder,\r\n  current_shift: machine.currentShift,\r\n  last_submission: machine.lastSubmission,\r\n  today_waste: machine.todayWaste,\r\n  today_downtime: machine.todayDowntime,\r\n  sub_machine_count: machine.subMachineCount,\r\n});\r\n\r\n// Initialize machines from Supabase\r\nexport const initializeMachines = async (): Promise<Machine[]> => {\r\n  try {\r\n    const records = await fetchMachines();\r\n\r\n    if (records.length > 0) {\r\n      machinesCache = records.map(toLocalMachine);\r\n      // Also save to localStorage as backup\r\n      localStorage.setItem(MACHINES_KEY, JSON.stringify(machinesCache));\r\n      localStorage.setItem(MACHINES_SYNC_KEY, new Date().toISOString());\r\n      return machinesCache;\r\n    } else {\r\n      // No machines in Supabase, sync default machines\r\n      console.log('No machines in Supabase, syncing defaults...');\r\n      const defaultMachines = MACHINES.map(toSupabaseRecord);\r\n      await syncMachinesToSupabase(defaultMachines);\r\n      machinesCache = MACHINES;\r\n      localStorage.setItem(MACHINES_KEY, JSON.stringify(MACHINES));\r\n      return MACHINES;\r\n    }\r\n  } catch (error) {\r\n    console.error('Failed to initialize from Supabase, using localStorage:', error);\r\n    useSupabase = false;\r\n    return getMachinesDataLocal();\r\n  }\r\n};\r\n\r\n// Subscribe to real-time machine updates - OPTIMIZED\r\nexport const subscribeToMachineUpdates = (callback: (machines: Machine[]) => void) => {\r\n  machinesListeners.push(callback);\r\n\r\n  // Provide current machines getter for optimized real-time updates\r\n  const getCurrentMachines = (): MachineRecord[] => {\r\n    const current = machinesCache || getMachinesDataLocal();\r\n    return current.map(toSupabaseRecord);\r\n  };\r\n\r\n  // Set up Supabase real-time subscription with optimized handler\r\n  const unsubscribe = subscribeMachineChanges(\r\n    (records) => {\r\n      machinesCache = records.map(toLocalMachine);\r\n      localStorage.setItem(MACHINES_KEY, JSON.stringify(machinesCache));\r\n\r\n      // Notify all listeners\r\n      machinesListeners.forEach(listener => listener(machinesCache!));\r\n    },\r\n    getCurrentMachines\r\n  );\r\n\r\n  // Return cleanup function\r\n  return () => {\r\n    machinesListeners = machinesListeners.filter(l => l !== callback);\r\n    if (machinesListeners.length === 0) {\r\n      unsubscribe();\r\n    }\r\n  };\r\n};\r\n\r\n// Get machines from localStorage (fallback)\r\nconst getMachinesDataLocal = (): Machine[] => {\r\n  const stored = localStorage.getItem(MACHINES_KEY);\r\n  if (!stored) {\r\n    localStorage.setItem(MACHINES_KEY, JSON.stringify(MACHINES));\r\n    return MACHINES;\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(stored);\r\n  } catch {\r\n    return MACHINES;\r\n  }\r\n};\r\n\r\n// Save shift data to local storage\r\nexport const saveShiftData = (data: ShiftData): void => {\r\n  const existing = getShiftHistory();\r\n  existing.unshift(data);\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(existing));\r\n\r\n  // Update machine data\r\n  updateMachineLastSubmission(data.machine, data.submittedAt.toISOString());\r\n};\r\n\r\n// Get all shift history\r\nexport const getShiftHistory = (): ShiftData[] => {\r\n  const stored = localStorage.getItem(STORAGE_KEY);\r\n  if (!stored) return [];\r\n\r\n  try {\r\n    const parsed = JSON.parse(stored);\r\n    return parsed.map((item: any) => ({\r\n      ...item,\r\n      submittedAt: new Date(item.submittedAt),\r\n      wasteEntries: item.wasteEntries.map((w: any) => ({\r\n        ...w,\r\n        timestamp: new Date(w.timestamp),\r\n      })),\r\n      downtimeEntries: item.downtimeEntries.map((d: any) => ({\r\n        ...d,\r\n        timestamp: new Date(d.timestamp),\r\n      })),\r\n    }));\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\n// Get shift history for a specific date range\r\nexport const getShiftHistoryByDateRange = (startDate: Date, endDate: Date): ShiftData[] => {\r\n  const history = getShiftHistory();\r\n  return history.filter(item => {\r\n    const itemDate = new Date(item.date);\r\n    return itemDate >= startDate && itemDate <= endDate;\r\n  });\r\n};\r\n\r\n// Get shift history for a specific machine\r\nexport const getShiftHistoryByMachine = (machineName: string): ShiftData[] => {\r\n  const history = getShiftHistory();\r\n  return history.filter(item => item.machine === machineName);\r\n};\r\n\r\n// Get today's statistics\r\nexport const getTodayStats = () => {\r\n  const today = new Date().toISOString().split('T')[0];\r\n  const history = getShiftHistory();\r\n  const todayData = history.filter(item => item.date === today);\r\n\r\n  const totalWaste = todayData.reduce((sum, item) => sum + item.totalWaste, 0);\r\n  const totalDowntime = todayData.reduce((sum, item) => sum + item.totalDowntime, 0);\r\n  const submissionCount = todayData.length;\r\n\r\n  return { totalWaste, totalDowntime, submissionCount };\r\n};\r\n\r\n// Update machine last submission\r\nexport const updateMachineLastSubmission = (machineName: string, timestamp: string): void => {\r\n  const machines = getMachinesData();\r\n  const machineIndex = machines.findIndex(m => m.name === machineName);\r\n  if (machineIndex !== -1) {\r\n    machines[machineIndex].lastSubmission = getTimeAgo(new Date(timestamp));\r\n  }\r\n  localStorage.setItem(MACHINES_KEY, JSON.stringify(machines));\r\n};\r\n\r\n// Get machines data with local modifications\r\nexport const getMachinesData = (): Machine[] => {\r\n  // Return cache if available\r\n  if (machinesCache) {\r\n    return machinesCache;\r\n  }\r\n\r\n  // Otherwise return from localStorage\r\n  return getMachinesDataLocal();\r\n};\r\n\r\n// Update a single machine\r\nexport const updateMachine = async (machineId: string, updates: Partial<Machine>): Promise<void> => {\r\n  const machines = getMachinesData();\r\n  const index = machines.findIndex(m => m.id === machineId);\r\n  if (index !== -1) {\r\n    machines[index] = { ...machines[index], ...updates };\r\n    machinesCache = machines;\r\n    localStorage.setItem(MACHINES_KEY, JSON.stringify(machines));\r\n\r\n    // Sync to Supabase\r\n    if (useSupabase) {\r\n      try {\r\n        await upsertMachine(toSupabaseRecord(machines[index]));\r\n      } catch (error) {\r\n        console.error('Failed to sync machine update to Supabase:', error);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n// Add a new machine\r\nexport const addMachine = async (machine: Machine): Promise<void> => {\r\n  const machines = getMachinesData();\r\n  machines.push(machine);\r\n  machinesCache = machines;\r\n  localStorage.setItem(MACHINES_KEY, JSON.stringify(machines));\r\n\r\n  // Sync to Supabase\r\n  if (useSupabase) {\r\n    try {\r\n      await upsertMachine(toSupabaseRecord(machine));\r\n    } catch (error) {\r\n      console.error('Failed to sync new machine to Supabase:', error);\r\n    }\r\n  }\r\n};\r\n\r\n// Delete a machine\r\nexport const deleteMachine = async (machineId: string): Promise<void> => {\r\n  const machines = getMachinesData();\r\n  const filtered = machines.filter(m => m.id !== machineId);\r\n  machinesCache = filtered;\r\n  localStorage.setItem(MACHINES_KEY, JSON.stringify(filtered));\r\n\r\n  // Sync to Supabase\r\n  if (useSupabase) {\r\n    try {\r\n      await removeMachine(machineId);\r\n    } catch (error) {\r\n      console.error('Failed to delete machine from Supabase:', error);\r\n    }\r\n  }\r\n};\r\n\r\n// Reset machines to default\r\nexport const resetMachines = async (): Promise<void> => {\r\n  machinesCache = MACHINES;\r\n  localStorage.setItem(MACHINES_KEY, JSON.stringify(MACHINES));\r\n\r\n  // Sync to Supabase\r\n  if (useSupabase) {\r\n    try {\r\n      await syncMachinesToSupabase(MACHINES.map(toSupabaseRecord));\r\n    } catch (error) {\r\n      console.error('Failed to reset machines in Supabase:', error);\r\n    }\r\n  }\r\n};\r\n\r\n// Helper function to format time ago\r\nexport const getTimeAgo = (date: Date): string => {\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffMins = Math.floor(diffMs / 60000);\r\n  const diffHours = Math.floor(diffMins / 60);\r\n  const diffDays = Math.floor(diffHours / 24);\r\n\r\n  if (diffMins < 1) return 'Just now';\r\n  if (diffMins < 60) return `${diffMins} min ago`;\r\n  if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\r\n  return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\r\n};\r\n\r\n// Export data to CSV\r\nexport const exportToCSV = (data: ShiftData[], filename: string): void => {\r\n  const headers = [\r\n    'Date',\r\n    'Shift',\r\n    'Operator',\r\n    'Machine',\r\n    'Order Number',\r\n    'Product',\r\n    'Batch Number',\r\n    'Entry Type',\r\n    'Waste Type',\r\n    'Waste (kg)',\r\n    'Downtime Reason',\r\n    'Downtime (min)',\r\n    'Submitted At',\r\n  ];\r\n\r\n  const rows: string[][] = [];\r\n\r\n  data.forEach(item => {\r\n    const baseRow = [\r\n      item.date,\r\n      item.shift,\r\n      item.operatorName,\r\n      item.machine,\r\n      item.orderNumber,\r\n      item.product,\r\n      item.batchNumber,\r\n    ];\r\n    const submittedAt = new Date(item.submittedAt).toLocaleString();\r\n\r\n    // Add a row for each waste entry\r\n    if (item.wasteEntries && item.wasteEntries.length > 0) {\r\n      item.wasteEntries.forEach(w => {\r\n        rows.push([\r\n          ...baseRow,\r\n          'Waste',\r\n          w.wasteType,\r\n          w.waste.toFixed(2),\r\n          '',\r\n          '',\r\n          submittedAt,\r\n        ]);\r\n      });\r\n    }\r\n\r\n    // Add a row for each downtime entry\r\n    if (item.downtimeEntries && item.downtimeEntries.length > 0) {\r\n      item.downtimeEntries.forEach(d => {\r\n        rows.push([\r\n          ...baseRow,\r\n          'Downtime',\r\n          '',\r\n          '',\r\n          d.downtimeReason,\r\n          d.downtime.toString(),\r\n          submittedAt,\r\n        ]);\r\n      });\r\n    }\r\n\r\n    // If no entries at all, still add one summary row\r\n    if ((!item.wasteEntries || item.wasteEntries.length === 0) &&\r\n      (!item.downtimeEntries || item.downtimeEntries.length === 0)) {\r\n      rows.push([\r\n        ...baseRow,\r\n        'Summary',\r\n        '',\r\n        item.totalWaste.toFixed(2),\r\n        '',\r\n        item.totalDowntime.toString(),\r\n        submittedAt,\r\n      ]);\r\n    }\r\n  });\r\n\r\n  const csvContent = [\r\n    headers.join(','),\r\n    ...rows.map(row => row.map(cell => `\"${cell}\"`).join(',')),\r\n  ].join('\\n');\r\n\r\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const link = document.createElement('a');\r\n  const url = URL.createObjectURL(blob);\r\n  link.setAttribute('href', url);\r\n  link.setAttribute('download', `${filename}.csv`);\r\n  link.style.visibility = 'hidden';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  // Clean up the object URL to prevent memory leak\r\n  URL.revokeObjectURL(url);\r\n};\r\n\r\n// Clear all history (for testing)\r\nexport const clearHistory = (): void => {\r\n  localStorage.removeItem(STORAGE_KEY);\r\n  localStorage.removeItem(MACHINES_KEY);\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\supabase.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":239,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":239,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7514,7533],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":258,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":258,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8127,8146],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":278,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":278,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8802,8821],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":300,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":300,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[9534,9553],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":361,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":361,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10934,10992],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":388,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":388,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11744,11802],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":404,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":404,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[12120,12178],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":444,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":444,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13249,13314],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":450,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":450,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[13385,13438],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":476,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":476,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[14156,14213],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":636,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":636,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[18856,18918],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":642,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":642,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[18988,19039],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":677,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":677,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[19880,19930],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":695,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":695,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[20321,20372],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":714,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":714,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[20826,20877],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":750,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":750,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[21820,21872],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":770,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":770,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[22389,22445],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":812,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":812,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[23547,23596],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":830,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":830,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[23999,24051],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":881,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":881,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[25816,25871],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":900,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":900,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[26346,26398],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@supabase/supabase-js';\r\n\r\n// Supabase project credentials must be provided via environment variables.\r\n// CRA only exposes env vars prefixed with REACT_APP_ and they are baked into the build.\r\n// IMPORTANT: The anon key is a *public* client key; the real protection is Row Level Security (RLS).\r\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\r\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY;\r\nexport const isSupabaseConfigured = Boolean(supabaseUrl && supabaseAnonKey);\r\n\r\n// Use placeholders so importing this module doesn't crash in tests/dev when env vars are missing.\r\nexport const supabase = createClient(\r\n  isSupabaseConfigured ? supabaseUrl! : 'http://localhost:54321',\r\n  isSupabaseConfigured ? supabaseAnonKey! : 'public-anon-key'\r\n);\r\n\r\nexport const requireSupabaseConfigured = () => {\r\n  if (!isSupabaseConfigured) {\r\n    throw new Error(\r\n      'Supabase is not configured. Set REACT_APP_SUPABASE_URL and REACT_APP_SUPABASE_ANON_KEY (for CRA builds) before calling Supabase operations.'\r\n    );\r\n  }\r\n};\r\n\r\n// Database types\r\nexport interface ShiftSubmission {\r\n  id?: number;\r\n  operator_name: string;\r\n  machine: string;\r\n  sub_machine?: string;\r\n  order_number: string;\r\n  product: string;\r\n  batch_number: string;\r\n  shift: string;\r\n  submission_date: string;\r\n  is_early_submission?: boolean;\r\n  will_changeover?: boolean;\r\n  will_maintenance_cleaning?: boolean;\r\n  total_waste?: number;\r\n  total_downtime?: number;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface WasteRecord {\r\n  id?: number;\r\n  shift_submission_id: number;\r\n  waste_amount: number;\r\n  waste_type: string;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface DowntimeRecord {\r\n  id?: number;\r\n  shift_submission_id: number;\r\n  downtime_minutes: number;\r\n  downtime_reason: string;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface SpeedRecord {\r\n  id?: number;\r\n  shift_submission_id: number;\r\n  speed_ppm: number;\r\n  recorded_at: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface SachetMassRecord {\r\n  id?: number;\r\n  shift_submission_id: number;\r\n  mass_grams: number;\r\n  recorded_at: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface CasesPerHourRecord {\r\n  id?: number;\r\n  shift_submission_id: number;\r\n  cases_count: number;\r\n  hour_of_day: number;\r\n  recorded_at: string;\r\n  created_at?: string;\r\n}\r\n\r\n// New: Loose Cases Record (cases not part of a full pallet)\r\nexport interface LooseCasesRecord {\r\n  id?: number;\r\n  shift_submission_id: number;\r\n  batch_number: string;\r\n  cases_count: number;\r\n  recorded_at: string;\r\n  created_at?: string;\r\n}\r\n\r\n// Updated: Pallet Scan Record with parsed QR data\r\nexport interface PalletScanRecord {\r\n  id?: number;\r\n  shift_submission_id: number;\r\n  qr_code: string;\r\n  batch_number: string;\r\n  pallet_number: string;\r\n  cases_count: number;\r\n  recorded_at: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface ShiftSessionRecord {\r\n  id?: number;\r\n  machine_name: string;\r\n  operator_name: string;\r\n  order_number: string;\r\n  product: string;\r\n  batch_number: string;\r\n  shift: string;\r\n  session_date: string;\r\n  is_locked: boolean;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// ==========================================\r\n// CHAT\r\n// ==========================================\r\n\r\nexport interface ChatMessageRecord {\r\n  id?: number;\r\n  user_name: string;\r\n  content: string;\r\n  created_at?: string;\r\n}\r\n\r\n// Enhanced shift data submission with all new fields\r\nexport interface FullShiftSubmission {\r\n  shiftData: Omit<ShiftSubmission, 'id' | 'created_at'>;\r\n  wasteEntries: { waste: number; wasteType: string; timestamp: Date }[];\r\n  downtimeEntries: { downtime: number; downtimeReason: string; timestamp: Date }[];\r\n  speedEntries?: { speed: number; timestamp: Date }[];\r\n  sachetMassEntries?: { mass: number; timestamp: Date }[];\r\n  casesPerHourEntries?: { cases: number; hour: number; timestamp: Date }[]; // Legacy\r\n  looseCasesEntries?: { batchNumber: string; cases: number; timestamp: Date }[];\r\n  palletScanEntries?: { qrCode: string; batchNumber: string; palletNumber: string; casesCount: number; timestamp: Date }[];\r\n}\r\n\r\n// Result type for submission with warnings\r\nexport interface SubmitShiftResult {\r\n  success: boolean;\r\n  shiftSubmission: ShiftSubmission | null;\r\n  warnings: string[];\r\n  errors: string[];\r\n}\r\n\r\n// Database operations\r\nexport const submitShiftData = async (\r\n  shiftData: Omit<ShiftSubmission, 'id' | 'created_at'>,\r\n  wasteEntries: { waste: number; wasteType: string; timestamp?: Date }[],\r\n  downtimeEntries: { downtime: number; downtimeReason: string; timestamp?: Date }[],\r\n  speedEntries?: { speed: number; timestamp: Date }[],\r\n  sachetMassEntries?: { mass: number; timestamp: Date }[],\r\n  looseCasesEntries?: { batchNumber: string; cases: number; timestamp: Date }[],\r\n  palletScanEntries?: { qrCode: string; batchNumber: string; palletNumber: string; casesCount: number; timestamp: Date }[]\r\n): Promise<SubmitShiftResult> => {\r\n  requireSupabaseConfigured();\r\n\r\n  const warnings: string[] = [];\r\n  const errors: string[] = [];\r\n\r\n  // Calculate totals\r\n  const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n  const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n  // Insert shift submission (critical - must succeed)\r\n  const { data: shiftSubmission, error: shiftError } = await supabase\r\n    .from('shift_submissions')\r\n    .insert([{\r\n      ...shiftData,\r\n      total_waste: totalWaste,\r\n      total_downtime: totalDowntime,\r\n    }])\r\n    .select()\r\n    .single();\r\n\r\n  if (shiftError) {\r\n    throw new Error(`Failed to submit shift data: ${shiftError.message}`);\r\n  }\r\n\r\n  const shiftId = shiftSubmission.id;\r\n\r\n  // Insert waste records (critical - must succeed)\r\n  if (wasteEntries.length > 0) {\r\n    const wasteRecords = wasteEntries.map(entry => ({\r\n      shift_submission_id: shiftId,\r\n      waste_amount: entry.waste,\r\n      waste_type: entry.wasteType,\r\n      recorded_at: entry.timestamp ? new Date(entry.timestamp).toISOString() : new Date().toISOString(),\r\n    }));\r\n\r\n    const { error: wasteError } = await supabase\r\n      .from('waste_records')\r\n      .insert(wasteRecords);\r\n\r\n    if (wasteError) {\r\n      throw new Error(`Failed to submit waste records: ${wasteError.message}`);\r\n    }\r\n  }\r\n\r\n  // Insert downtime records (critical - must succeed)\r\n  if (downtimeEntries.length > 0) {\r\n    const downtimeRecords = downtimeEntries.map(entry => ({\r\n      shift_submission_id: shiftId,\r\n      downtime_minutes: entry.downtime,\r\n      downtime_reason: entry.downtimeReason,\r\n      recorded_at: entry.timestamp ? new Date(entry.timestamp).toISOString() : new Date().toISOString(),\r\n    }));\r\n\r\n    const { error: downtimeError } = await supabase\r\n      .from('downtime_records')\r\n      .insert(downtimeRecords);\r\n\r\n    if (downtimeError) {\r\n      throw new Error(`Failed to submit downtime records: ${downtimeError.message}`);\r\n    }\r\n  }\r\n\r\n  // Insert speed records (non-critical - warn on failure)\r\n  if (speedEntries && speedEntries.length > 0) {\r\n    const speedRecords = speedEntries.map(entry => ({\r\n      shift_submission_id: shiftId,\r\n      speed_ppm: entry.speed,\r\n      recorded_at: new Date(entry.timestamp).toISOString(),\r\n    }));\r\n\r\n    const { error: speedError } = await supabase\r\n      .from('speed_records')\r\n      .insert(speedRecords);\r\n\r\n    if (speedError) {\r\n      const msg = `Speed records failed: ${speedError.message}`;\r\n      console.error(msg);\r\n      warnings.push(msg);\r\n    }\r\n  }\r\n\r\n  // Insert sachet mass records (non-critical - warn on failure)\r\n  if (sachetMassEntries && sachetMassEntries.length > 0) {\r\n    const sachetRecords = sachetMassEntries.map(entry => ({\r\n      shift_submission_id: shiftId,\r\n      mass_grams: entry.mass,\r\n      recorded_at: new Date(entry.timestamp).toISOString(),\r\n    }));\r\n\r\n    const { error: sachetError } = await supabase\r\n      .from('sachet_mass_records')\r\n      .insert(sachetRecords);\r\n\r\n    if (sachetError) {\r\n      const msg = `Sachet mass records failed: ${sachetError.message}`;\r\n      console.error(msg);\r\n      warnings.push(msg);\r\n    }\r\n  }\r\n\r\n  // Insert loose cases records (non-critical - warn on failure)\r\n  if (looseCasesEntries && looseCasesEntries.length > 0) {\r\n    const looseCasesRecords = looseCasesEntries.map(entry => ({\r\n      shift_submission_id: shiftId,\r\n      batch_number: entry.batchNumber,\r\n      cases_count: entry.cases,\r\n      recorded_at: new Date(entry.timestamp).toISOString(),\r\n    }));\r\n\r\n    const { error: looseCasesError } = await supabase\r\n      .from('loose_cases_records')\r\n      .insert(looseCasesRecords);\r\n\r\n    if (looseCasesError) {\r\n      const msg = `Loose cases records failed: ${looseCasesError.message}`;\r\n      console.error(msg);\r\n      warnings.push(msg);\r\n    }\r\n  }\r\n\r\n  // Insert pallet scan records (non-critical - warn on failure)\r\n  if (palletScanEntries && palletScanEntries.length > 0) {\r\n    const palletRecords = palletScanEntries.map(entry => ({\r\n      shift_submission_id: shiftId,\r\n      qr_code: entry.qrCode,\r\n      batch_number: entry.batchNumber,\r\n      pallet_number: entry.palletNumber,\r\n      cases_count: entry.casesCount,\r\n      recorded_at: new Date(entry.timestamp).toISOString(),\r\n    }));\r\n\r\n    const { error: palletError } = await supabase\r\n      .from('pallet_scan_records')\r\n      .insert(palletRecords);\r\n\r\n    if (palletError) {\r\n      const msg = `Pallet scan records failed: ${palletError.message}`;\r\n      console.error(msg);\r\n      warnings.push(msg);\r\n    }\r\n  }\r\n\r\n  return {\r\n    success: true,\r\n    shiftSubmission,\r\n    warnings,\r\n    errors,\r\n  };\r\n};\r\n\r\n// Fetch recent submissions\r\nexport const getRecentSubmissions = async (limit = 10) => {\r\n  requireSupabaseConfigured();\r\n  const { data, error } = await supabase\r\n    .from('shift_submissions')\r\n    .select(`\r\n      *,\r\n      waste_records (*),\r\n      downtime_records (*)\r\n    `)\r\n    .order('created_at', { ascending: false })\r\n    .limit(limit);\r\n\r\n  if (error) {\r\n    throw new Error(`Failed to fetch submissions: ${error.message}`);\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\n// ==========================================\r\n// MACHINES TABLE OPERATIONS\r\n// ==========================================\r\n\r\nexport interface MachineRecord {\r\n  id: string;\r\n  name: string;\r\n  status: 'running' | 'idle' | 'maintenance';\r\n  current_operator?: string;\r\n  current_order?: string;\r\n  current_shift?: string;\r\n  last_submission?: string;\r\n  today_waste?: number;\r\n  today_downtime?: number;\r\n  sub_machine_count?: number;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Fetch all machines from Supabase\r\nexport const fetchMachines = async (): Promise<MachineRecord[]> => {\r\n  requireSupabaseConfigured();\r\n  const { data, error } = await supabase\r\n    .from('machines')\r\n    .select('*')\r\n    .order('name', { ascending: true });\r\n\r\n  if (error) {\r\n    console.error('Failed to fetch machines:', error.message);\r\n    return [];\r\n  }\r\n\r\n  return data || [];\r\n};\r\n\r\n// Upsert a machine (insert or update)\r\nexport const upsertMachine = async (machine: MachineRecord): Promise<MachineRecord | null> => {\r\n  requireSupabaseConfigured();\r\n  const { data, error } = await supabase\r\n    .from('machines')\r\n    .upsert({\r\n      id: machine.id,\r\n      name: machine.name,\r\n      status: machine.status,\r\n      current_operator: machine.current_operator,\r\n      last_submission: machine.last_submission,\r\n      today_waste: machine.today_waste,\r\n      today_downtime: machine.today_downtime,\r\n      sub_machine_count: machine.sub_machine_count,\r\n      updated_at: new Date().toISOString(),\r\n    }, { onConflict: 'id' })\r\n    .select()\r\n    .single();\r\n\r\n  if (error) {\r\n    console.error('Failed to upsert machine:', error.message);\r\n    return null;\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\n// Delete a machine from Supabase\r\nexport const removeMachine = async (machineId: string): Promise<boolean> => {\r\n  requireSupabaseConfigured();\r\n  const { error } = await supabase\r\n    .from('machines')\r\n    .delete()\r\n    .eq('id', machineId);\r\n\r\n  if (error) {\r\n    console.error('Failed to delete machine:', error.message);\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\n// Update machine status (running/idle/maintenance)\r\nexport const updateMachineStatus = async (\r\n  machineId: string,\r\n  status: 'running' | 'idle' | 'maintenance',\r\n  operatorName?: string,\r\n  orderNumber?: string,\r\n  shift?: string\r\n): Promise<boolean> => {\r\n  if (!isSupabaseConfigured) return false;\r\n\r\n  try {\r\n    const updateData: Record<string, unknown> = {\r\n      status,\r\n      updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    // Set or clear operator/order based on status\r\n    if (status === 'running') {\r\n      if (operatorName) updateData.current_operator = operatorName;\r\n      if (orderNumber) updateData.current_order = orderNumber;\r\n      if (shift) updateData.current_shift = shift;\r\n    } else if (status === 'idle') {\r\n      updateData.current_operator = null;\r\n      updateData.current_order = null;\r\n      updateData.current_shift = null;\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from('machines')\r\n      .update(updateData)\r\n      .eq('id', machineId);\r\n\r\n    if (error) {\r\n      console.error('Failed to update machine status:', error.message);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  } catch (e) {\r\n    console.error('Failed to update machine status:', e);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Sync local machines to Supabase (bulk upsert)\r\nexport const syncMachinesToSupabase = async (machines: MachineRecord[]): Promise<boolean> => {\r\n  requireSupabaseConfigured();\r\n  const { error } = await supabase\r\n    .from('machines')\r\n    .upsert(\r\n      machines.map(m => ({\r\n        id: m.id,\r\n        name: m.name,\r\n        status: m.status,\r\n        current_operator: m.current_operator,\r\n        last_submission: m.last_submission,\r\n        today_waste: m.today_waste,\r\n        today_downtime: m.today_downtime,\r\n        sub_machine_count: m.sub_machine_count,\r\n        updated_at: new Date().toISOString(),\r\n      })),\r\n      { onConflict: 'id' }\r\n    );\r\n\r\n  if (error) {\r\n    console.error('Failed to sync machines:', error.message);\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\n// Subscribe to real-time machine updates - OPTIMIZED\r\n// Now processes specific changes instead of refetching all machines\r\nexport const subscribeMachineChanges = (\r\n  callback: (machines: MachineRecord[]) => void,\r\n  getCurrentMachines: () => MachineRecord[]\r\n) => {\r\n  requireSupabaseConfigured();\r\n\r\n  const channel = supabase\r\n    .channel('machines-changes')\r\n    .on(\r\n      'postgres_changes',\r\n      { event: 'INSERT', schema: 'public', table: 'machines' },\r\n      (payload) => {\r\n        // Add new machine to current list\r\n        const newMachine = payload.new as MachineRecord;\r\n        const currentMachines = getCurrentMachines();\r\n        const updatedMachines = [...currentMachines, newMachine];\r\n        callback(updatedMachines);\r\n      }\r\n    )\r\n    .on(\r\n      'postgres_changes',\r\n      { event: 'UPDATE', schema: 'public', table: 'machines' },\r\n      (payload) => {\r\n        // Update specific machine in current list\r\n        const updatedMachine = payload.new as MachineRecord;\r\n        const currentMachines = getCurrentMachines();\r\n        const updatedMachines = currentMachines.map(m =>\r\n          m.id === updatedMachine.id ? updatedMachine : m\r\n        );\r\n        callback(updatedMachines);\r\n      }\r\n    )\r\n    .on(\r\n      'postgres_changes',\r\n      { event: 'DELETE', schema: 'public', table: 'machines' },\r\n      (payload) => {\r\n        // Remove deleted machine from current list\r\n        const deletedMachine = payload.old as MachineRecord;\r\n        const currentMachines = getCurrentMachines();\r\n        const updatedMachines = currentMachines.filter(m => m.id !== deletedMachine.id);\r\n        callback(updatedMachines);\r\n      }\r\n    )\r\n    .subscribe();\r\n\r\n  return () => {\r\n    supabase.removeChannel(channel);\r\n  };\r\n};\r\n\r\nexport const fetchRecentChatMessages = async (limit = 100): Promise<ChatMessageRecord[]> => {\r\n  requireSupabaseConfigured();\r\n  const { data, error } = await supabase\r\n    .from('chat_messages')\r\n    .select('*')\r\n    .order('created_at', { ascending: false })\r\n    .limit(limit);\r\n\r\n  if (error) {\r\n    throw new Error(`Failed to fetch chat messages: ${error.message}`);\r\n  }\r\n\r\n  // Reverse so UI can render oldest -> newest.\r\n  return (data || []).slice().reverse();\r\n};\r\n\r\nexport const sendChatMessage = async (userName: string, content: string): Promise<ChatMessageRecord> => {\r\n  requireSupabaseConfigured();\r\n\r\n  const MAX_MESSAGE_LENGTH = 500;\r\n  const trimmedName = userName.trim();\r\n  const trimmedContent = content.trim();\r\n\r\n  if (!trimmedName) {\r\n    throw new Error('User name is required to send a chat message.');\r\n  }\r\n  if (!trimmedContent) {\r\n    throw new Error('Message cannot be empty.');\r\n  }\r\n  if (trimmedContent.length > MAX_MESSAGE_LENGTH) {\r\n    throw new Error(`Message too long. Maximum ${MAX_MESSAGE_LENGTH} characters allowed.`);\r\n  }\r\n\r\n  const { data, error } = await supabase\r\n    .from('chat_messages')\r\n    .insert([{ user_name: trimmedName, content: trimmedContent }])\r\n    .select('*')\r\n    .single();\r\n\r\n  if (error) {\r\n    throw new Error(`Failed to send chat message: ${error.message}`);\r\n  }\r\n\r\n  // Let other UI update immediately (useful if Realtime is not enabled).\r\n  try {\r\n    window.dispatchEvent(new CustomEvent('chat_message_sent', { detail: data }));\r\n  } catch {\r\n    // no-op\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\nexport const subscribeChatMessages = (onInsert: (message: ChatMessageRecord) => void) => {\r\n  requireSupabaseConfigured();\r\n\r\n  const channel = supabase\r\n    .channel('chat-messages')\r\n    .on(\r\n      'postgres_changes',\r\n      { event: 'INSERT', schema: 'public', table: 'chat_messages' },\r\n      (payload) => {\r\n        const message = payload.new as ChatMessageRecord;\r\n        onInsert(message);\r\n      }\r\n    )\r\n    .subscribe();\r\n\r\n  return () => {\r\n    supabase.removeChannel(channel);\r\n  };\r\n};\r\n\r\n// ==========================================\r\n// ORDER DETAILS (Admin Console)\r\n// ==========================================\r\n\r\nexport interface OrderDetailsRecord {\r\n  id?: number;\r\n  order_number: string;\r\n  product: string;\r\n  batch_number: string;\r\n  is_active: boolean;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Fetch the currently active order details\r\nexport const fetchActiveOrderDetails = async (): Promise<OrderDetailsRecord | null> => {\r\n  if (!isSupabaseConfigured) return null;\r\n\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('order_details')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('created_at', { ascending: false })\r\n      .limit(1)\r\n      .maybeSingle();\r\n\r\n    if (error) {\r\n      console.error('Error fetching order details:', error.message);\r\n      return null;\r\n    }\r\n\r\n    return data;\r\n  } catch (e) {\r\n    console.error('Failed to fetch order details:', e);\r\n    return null;\r\n  }\r\n};\r\n\r\n// Save new order details (deactivates previous active order)\r\nexport const saveOrderDetails = async (\r\n  orderNumber: string,\r\n  product: string,\r\n  batchNumber: string\r\n): Promise<OrderDetailsRecord | null> => {\r\n  requireSupabaseConfigured();\r\n\r\n  try {\r\n    // Deactivate all currently active orders\r\n    await supabase\r\n      .from('order_details')\r\n      .update({ is_active: false })\r\n      .eq('is_active', true);\r\n\r\n    // Insert new active order\r\n    const { data, error } = await supabase\r\n      .from('order_details')\r\n      .insert([{\r\n        order_number: orderNumber.trim(),\r\n        product: product.trim(),\r\n        batch_number: batchNumber.trim(),\r\n        is_active: true\r\n      }])\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data;\r\n  } catch (e) {\r\n    console.error('Failed to save order details:', e);\r\n    throw e;\r\n  }\r\n};\r\n\r\n// Clear active order details\r\nexport const clearActiveOrderDetails = async (): Promise<boolean> => {\r\n  if (!isSupabaseConfigured) return false;\r\n\r\n  try {\r\n    const { error } = await supabase\r\n      .from('order_details')\r\n      .update({ is_active: false })\r\n      .eq('is_active', true);\r\n\r\n    if (error) throw error;\r\n    return true;\r\n  } catch (e) {\r\n    console.error('Failed to clear order details:', e);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Fetch recent order details history\r\nexport const fetchOrderHistory = async (limit = 10): Promise<OrderDetailsRecord[]> => {\r\n  if (!isSupabaseConfigured) return [];\r\n\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('order_details')\r\n      .select('*')\r\n      .order('created_at', { ascending: false })\r\n      .limit(limit);\r\n\r\n    if (error) throw error;\r\n    return data || [];\r\n  } catch (e) {\r\n    console.error('Failed to fetch order history:', e);\r\n    return [];\r\n  }\r\n};\r\n\r\n// ==========================================\r\n// MACHINE ORDER QUEUE (Orders per machine with priority)\r\n// ==========================================\r\n\r\nexport interface MachineOrderQueueRecord {\r\n  id?: number;\r\n  machine_id: string;\r\n  order_number: string;\r\n  product: string;\r\n  batch_number: string;\r\n  priority: number;\r\n  is_active: boolean;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Fetch all orders for a specific machine (sorted by priority)\r\nexport const fetchMachineOrders = async (machineId: string): Promise<MachineOrderQueueRecord[]> => {\r\n  if (!isSupabaseConfigured) return [];\r\n\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('machine_order_queue')\r\n      .select('*')\r\n      .eq('machine_id', machineId)\r\n      .eq('is_active', true)\r\n      .order('priority', { ascending: true });\r\n\r\n    if (error) throw error;\r\n    return data || [];\r\n  } catch (e) {\r\n    console.error('Failed to fetch machine orders:', e);\r\n    return [];\r\n  }\r\n};\r\n\r\n// Fetch all active orders for all machines\r\nexport const fetchAllMachineOrders = async (): Promise<MachineOrderQueueRecord[]> => {\r\n  if (!isSupabaseConfigured) return [];\r\n\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('machine_order_queue')\r\n      .select('*')\r\n      .eq('is_active', true)\r\n      .order('machine_id', { ascending: true })\r\n      .order('priority', { ascending: true });\r\n\r\n    if (error) throw error;\r\n    return data || [];\r\n  } catch (e) {\r\n    console.error('Failed to fetch all machine orders:', e);\r\n    return [];\r\n  }\r\n};\r\n\r\n// Add an order to a machine's queue\r\nexport const addMachineOrder = async (\r\n  machineId: string,\r\n  orderNumber: string,\r\n  product: string,\r\n  batchNumber: string\r\n): Promise<MachineOrderQueueRecord | null> => {\r\n  requireSupabaseConfigured();\r\n\r\n  try {\r\n    // Get the next priority number for this machine\r\n    const { data: existing } = await supabase\r\n      .from('machine_order_queue')\r\n      .select('priority')\r\n      .eq('machine_id', machineId)\r\n      .eq('is_active', true)\r\n      .order('priority', { ascending: false })\r\n      .limit(1);\r\n\r\n    const nextPriority = existing && existing.length > 0 ? existing[0].priority + 1 : 0;\r\n\r\n    const { data, error } = await supabase\r\n      .from('machine_order_queue')\r\n      .insert([{\r\n        machine_id: machineId,\r\n        order_number: orderNumber.trim(),\r\n        product: product.trim(),\r\n        batch_number: batchNumber.trim(),\r\n        priority: nextPriority,\r\n        is_active: true\r\n      }])\r\n      .select()\r\n      .single();\r\n\r\n    if (error) throw error;\r\n    return data;\r\n  } catch (e) {\r\n    console.error('Failed to add machine order:', e);\r\n    throw e;\r\n  }\r\n};\r\n\r\n// Remove an order from a machine's queue\r\nexport const removeMachineOrder = async (orderId: number): Promise<boolean> => {\r\n  requireSupabaseConfigured();\r\n\r\n  try {\r\n    const { error } = await supabase\r\n      .from('machine_order_queue')\r\n      .update({ is_active: false })\r\n      .eq('id', orderId);\r\n\r\n    if (error) throw error;\r\n    return true;\r\n  } catch (e) {\r\n    console.error('Failed to remove machine order:', e);\r\n    return false;\r\n  }\r\n};\r\n\r\n// Update priorities for a machine's orders (for reordering) - ATOMIC version\r\nexport const updateMachineOrderPriorities = async (\r\n  machineId: string,\r\n  orderIds: number[]\r\n): Promise<boolean> => {\r\n  requireSupabaseConfigured();\r\n\r\n  try {\r\n    // Use a single RPC call or sequential updates with rollback tracking\r\n    const errors: string[] = [];\r\n    const successfulUpdates: { id: number; oldPriority?: number }[] = [];\r\n\r\n    // First, fetch current priorities for potential rollback\r\n    const { data: currentOrders } = await supabase\r\n      .from('machine_order_queue')\r\n      .select('id, priority')\r\n      .eq('machine_id', machineId)\r\n      .in('id', orderIds);\r\n\r\n    const priorityMap = new Map(currentOrders?.map(o => [o.id, o.priority]) || []);\r\n\r\n    // Update each order sequentially to maintain consistency\r\n    for (let index = 0; index < orderIds.length; index++) {\r\n      const id = orderIds[index];\r\n      const { error } = await supabase\r\n        .from('machine_order_queue')\r\n        .update({ priority: index, updated_at: new Date().toISOString() })\r\n        .eq('id', id)\r\n        .eq('machine_id', machineId);\r\n\r\n      if (error) {\r\n        errors.push(`Order ${id}: ${error.message}`);\r\n        // Rollback successful updates\r\n        for (const update of successfulUpdates) {\r\n          await supabase\r\n            .from('machine_order_queue')\r\n            .update({ priority: priorityMap.get(update.id) ?? update.oldPriority })\r\n            .eq('id', update.id);\r\n        }\r\n        throw new Error(`Priority update failed, rolled back. Errors: ${errors.join('; ')}`);\r\n      }\r\n      successfulUpdates.push({ id, oldPriority: priorityMap.get(id) });\r\n    }\r\n\r\n    return true;\r\n  } catch (e) {\r\n    console.error('Failed to update order priorities:', e);\r\n    throw e; // Re-throw so caller knows it failed\r\n  }\r\n};\r\n\r\n// Clear all orders for a machine\r\nexport const clearMachineOrders = async (machineId: string): Promise<boolean> => {\r\n  requireSupabaseConfigured();\r\n\r\n  try {\r\n    const { error } = await supabase\r\n      .from('machine_order_queue')\r\n      .update({ is_active: false })\r\n      .eq('machine_id', machineId)\r\n      .eq('is_active', true);\r\n\r\n    if (error) throw error;\r\n    return true;\r\n  } catch (e) {\r\n    console.error('Failed to clear machine orders:', e);\r\n    return false;\r\n  }\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\validation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\lib\\validation.ts","messages":[{"ruleId":"import/no-anonymous-default-export","severity":1,"message":"Assign object to a variable before exporting as module default","line":257,"column":1,"nodeType":"ExportDefaultDeclaration","endLine":270,"endColumn":3}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Form validation utilities for production-ready validation\r\n */\r\n\r\n// Validation result type\r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  errors: Record<string, string>;\r\n}\r\n\r\n// Field validation rule\r\nexport interface ValidationRule {\r\n  required?: boolean;\r\n  minLength?: number;\r\n  maxLength?: number;\r\n  min?: number;\r\n  max?: number;\r\n  pattern?: RegExp;\r\n  custom?: (value: unknown) => string | null;\r\n  message?: string;\r\n}\r\n\r\n// Validate a single field\r\nexport const validateField = (\r\n  value: unknown,\r\n  rules: ValidationRule\r\n): string | null => {\r\n  const strValue = typeof value === 'string' ? value : String(value ?? '');\r\n  const numValue = typeof value === 'number' ? value : parseFloat(strValue);\r\n\r\n  // Required check\r\n  if (rules.required) {\r\n    if (value === null || value === undefined || strValue.trim() === '') {\r\n      return rules.message || 'This field is required';\r\n    }\r\n  }\r\n\r\n  // Skip other validations if value is empty and not required\r\n  if (!rules.required && strValue.trim() === '') {\r\n    return null;\r\n  }\r\n\r\n  // Min length\r\n  if (rules.minLength !== undefined && strValue.length < rules.minLength) {\r\n    return rules.message || `Must be at least ${rules.minLength} characters`;\r\n  }\r\n\r\n  // Max length\r\n  if (rules.maxLength !== undefined && strValue.length > rules.maxLength) {\r\n    return rules.message || `Must be no more than ${rules.maxLength} characters`;\r\n  }\r\n\r\n  // Min value (numeric)\r\n  if (rules.min !== undefined && !isNaN(numValue) && numValue < rules.min) {\r\n    return rules.message || `Must be at least ${rules.min}`;\r\n  }\r\n\r\n  // Max value (numeric)\r\n  if (rules.max !== undefined && !isNaN(numValue) && numValue > rules.max) {\r\n    return rules.message || `Must be no more than ${rules.max}`;\r\n  }\r\n\r\n  // Pattern\r\n  if (rules.pattern && !rules.pattern.test(strValue)) {\r\n    return rules.message || 'Invalid format';\r\n  }\r\n\r\n  // Custom validation\r\n  if (rules.custom) {\r\n    return rules.custom(value);\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\n// Validate multiple fields\r\nexport const validateForm = <T extends Record<string, unknown>>(\r\n  data: T,\r\n  schema: Record<keyof T, ValidationRule>\r\n): ValidationResult => {\r\n  const errors: Record<string, string> = {};\r\n\r\n  for (const field of Object.keys(schema) as Array<keyof T>) {\r\n    const error = validateField(data[field], schema[field]);\r\n    if (error) {\r\n      errors[field as string] = error;\r\n    }\r\n  }\r\n\r\n  return {\r\n    isValid: Object.keys(errors).length === 0,\r\n    errors,\r\n  };\r\n};\r\n\r\n// Pre-built validation schemas for common forms\r\nexport const shiftDetailsSchema = {\r\n  operatorName: {\r\n    required: true,\r\n    minLength: 2,\r\n    maxLength: 100,\r\n    message: 'Operator name is required',\r\n  },\r\n  orderNumber: {\r\n    required: true,\r\n    minLength: 1,\r\n    maxLength: 50,\r\n    message: 'Order number is required',\r\n  },\r\n  product: {\r\n    required: true,\r\n    minLength: 1,\r\n    maxLength: 100,\r\n    message: 'Product is required',\r\n  },\r\n  batchNumber: {\r\n    required: true,\r\n    minLength: 1,\r\n    maxLength: 50,\r\n    message: 'Batch number is required',\r\n  },\r\n};\r\n\r\nexport const wasteEntrySchema = {\r\n  waste: {\r\n    required: true,\r\n    min: 0.1,\r\n    max: 10000,\r\n    message: 'Waste amount must be between 0.1 and 10000 kg',\r\n  },\r\n  wasteType: {\r\n    required: true,\r\n    message: 'Please select a waste type',\r\n  },\r\n};\r\n\r\nexport const downtimeEntrySchema = {\r\n  downtime: {\r\n    required: true,\r\n    min: 1,\r\n    max: 1440,\r\n    message: 'Downtime must be between 1 and 1440 minutes',\r\n  },\r\n  downtimeReason: {\r\n    required: true,\r\n    message: 'Please select a downtime reason',\r\n  },\r\n};\r\n\r\nexport const speedEntrySchema = {\r\n  speed: {\r\n    required: true,\r\n    min: 1,\r\n    max: 2000,\r\n    message: 'Speed must be between 1 and 2000 PPM',\r\n  },\r\n};\r\n\r\nexport const sachetMassSchema = {\r\n  mass: {\r\n    required: true,\r\n    min: 0.1,\r\n    max: 1000,\r\n    message: 'Mass must be between 0.1 and 1000 grams',\r\n  },\r\n};\r\n\r\nexport const looseCasesSchema = {\r\n  batchNumber: {\r\n    required: true,\r\n    pattern: /^\\d{5}$/,\r\n    message: 'Batch number must be exactly 5 digits',\r\n  },\r\n  cases: {\r\n    required: true,\r\n    min: 1,\r\n    max: 9999,\r\n    message: 'Cases must be between 1 and 9999',\r\n  },\r\n};\r\n\r\nexport const palletQRSchema = {\r\n  qrCode: {\r\n    required: true,\r\n    pattern: /^\\d{13}$/,\r\n    message: 'QR code must be exactly 13 digits',\r\n  },\r\n};\r\n\r\n// Input sanitization\r\nexport const sanitizeInput = (input: string): string => {\r\n  return input\r\n    .trim()\r\n    .replace(/[<>]/g, '') // Remove potential HTML tags\r\n    .substring(0, 1000); // Limit length\r\n};\r\n\r\n// Sanitize number input\r\nexport const sanitizeNumber = (\r\n  input: string | number,\r\n  min?: number,\r\n  max?: number\r\n): number | null => {\r\n  const num = typeof input === 'number' ? input : parseFloat(input);\r\n\r\n  if (isNaN(num)) return null;\r\n  if (min !== undefined && num < min) return min;\r\n  if (max !== undefined && num > max) return max;\r\n\r\n  return num;\r\n};\r\n\r\n// Validate and parse QR code\r\nexport const parseAndValidateQRCode = (\r\n  qrCode: string\r\n): { valid: boolean; data?: { batchNumber: string; palletNumber: string; casesCount: number }; error?: string } => {\r\n  const cleaned = qrCode.trim();\r\n\r\n  if (!/^\\d{13}$/.test(cleaned)) {\r\n    return {\r\n      valid: false,\r\n      error: 'QR code must be exactly 13 digits',\r\n    };\r\n  }\r\n\r\n  const casesCount = parseInt(cleaned.substring(9, 13), 10);\r\n\r\n  if (isNaN(casesCount) || casesCount < 1) {\r\n    return {\r\n      valid: false,\r\n      error: 'Invalid cases count in QR code',\r\n    };\r\n  }\r\n\r\n  return {\r\n    valid: true,\r\n    data: {\r\n      batchNumber: cleaned.substring(0, 5),\r\n      palletNumber: cleaned.substring(5, 9),\r\n      casesCount,\r\n    },\r\n  };\r\n};\r\n\r\n// Hook for form validation\r\nexport const useFormValidation = <T extends Record<string, unknown>>(\r\n  schema: Record<keyof T, ValidationRule>\r\n) => {\r\n  const validate = (data: T): ValidationResult => validateForm(data, schema);\r\n\r\n  const validateSingleField = (field: keyof T, value: unknown): string | null =>\r\n    validateField(value, schema[field]);\r\n\r\n  return { validate, validateSingleField };\r\n};\r\n\r\nexport default {\r\n  validateField,\r\n  validateForm,\r\n  sanitizeInput,\r\n  sanitizeNumber,\r\n  parseAndValidateQRCode,\r\n  shiftDetailsSchema,\r\n  wasteEntrySchema,\r\n  downtimeEntrySchema,\r\n  speedEntrySchema,\r\n  sachetMassSchema,\r\n  looseCasesSchema,\r\n  palletQRSchema,\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\pages\\AdminConsole.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":77,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":77,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2865,2909],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":196,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":196,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[7321,7369],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":227,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":227,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8403,8447],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":242,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":242,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[8902,8948],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":270,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":270,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10022,10079],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":286,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":286,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10657,10704],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n    isSupabaseConfigured,\r\n    fetchAllMachineOrders,\r\n    addMachineOrder,\r\n    removeMachineOrder,\r\n    updateMachineOrderPriorities,\r\n    clearMachineOrders,\r\n    MachineOrderQueueRecord\r\n} from '../lib/supabase';\r\nimport { getMachinesData } from '../lib/storage';\r\nimport { Machine } from '../types';\r\n\r\n// Parsed order from bulk paste\r\ninterface ParsedOrder {\r\n    machineName: string;\r\n    machineId: string;\r\n    orderNumber: string;\r\n    product: string;\r\n    batchNumber: string;\r\n    valid: boolean;\r\n    error?: string;\r\n}\r\n\r\nconst AdminConsole: React.FC = () => {\r\n    const navigate = useNavigate();\r\n\r\n    // Form state for adding new orders\r\n    const [selectedMachine, setSelectedMachine] = useState('');\r\n    const [orderNumber, setOrderNumber] = useState('');\r\n    const [product, setProduct] = useState('');\r\n    const [batchNumber, setBatchNumber] = useState('');\r\n\r\n    // Bulk paste state\r\n    const [bulkPasteText, setBulkPasteText] = useState('');\r\n    const [parsedOrders, setParsedOrders] = useState<ParsedOrder[]>([]);\r\n    const [showBulkPreview, setShowBulkPreview] = useState(false);\r\n    const [activeTab, setActiveTab] = useState<'single' | 'bulk'>('bulk');\r\n\r\n    // Data state\r\n    const [machines, setMachines] = useState<Machine[]>([]);\r\n    const [machineOrders, setMachineOrders] = useState<Record<string, MachineOrderQueueRecord[]>>({});\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\r\n\r\n    const showToast = (message: string, type: 'success' | 'error') => {\r\n        setToast({ message, type });\r\n        setTimeout(() => setToast(null), 4000);\r\n    };\r\n\r\n    // Load machines and orders\r\n    const loadData = useCallback(async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            // Load machines from storage\r\n            const machinesData = getMachinesData();\r\n            setMachines(machinesData);\r\n\r\n            if (machinesData.length > 0 && !selectedMachine) {\r\n                setSelectedMachine(machinesData[0].id);\r\n            }\r\n\r\n            // Load orders from Supabase\r\n            if (isSupabaseConfigured) {\r\n                const allOrders = await fetchAllMachineOrders();\r\n                // Group orders by machine\r\n                const grouped: Record<string, MachineOrderQueueRecord[]> = {};\r\n                machinesData.forEach(m => {\r\n                    grouped[m.id] = allOrders.filter(o => o.machine_id === m.id);\r\n                });\r\n                setMachineOrders(grouped);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading data:', error);\r\n            showToast('Failed to load data', 'error');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [selectedMachine]);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [loadData]);\r\n\r\n    // Find machine by name (case-insensitive, partial match)\r\n    const findMachine = useCallback((name: string): Machine | undefined => {\r\n        const normalizedName = name.trim().toLowerCase();\r\n        return machines.find(m =>\r\n            m.name.toLowerCase() === normalizedName ||\r\n            m.name.toLowerCase().includes(normalizedName) ||\r\n            normalizedName.includes(m.name.toLowerCase())\r\n        );\r\n    }, [machines]);\r\n\r\n    // Parse bulk paste text\r\n    const parseBulkText = useCallback((text: string): ParsedOrder[] => {\r\n        if (!text.trim()) return [];\r\n\r\n        const lines = text.split('\\n').filter(line => line.trim());\r\n        const orders: ParsedOrder[] = [];\r\n\r\n        for (const line of lines) {\r\n            // Try to split by tab first, then comma\r\n            let parts = line.split('\\t');\r\n            if (parts.length < 4) {\r\n                parts = line.split(',');\r\n            }\r\n\r\n            // Clean up parts\r\n            parts = parts.map(p => p.trim());\r\n\r\n            if (parts.length >= 4) {\r\n                const [machineName, orderNum, prod, batch] = parts;\r\n                const machine = findMachine(machineName);\r\n\r\n                orders.push({\r\n                    machineName: machineName,\r\n                    machineId: machine?.id || '',\r\n                    orderNumber: orderNum,\r\n                    product: prod,\r\n                    batchNumber: batch,\r\n                    valid: !!machine && !!orderNum && !!prod && !!batch,\r\n                    error: !machine ? `Machine \"${machineName}\" not found` :\r\n                           !orderNum ? 'Missing order number' :\r\n                           !prod ? 'Missing product' :\r\n                           !batch ? 'Missing batch' : undefined\r\n                });\r\n            } else if (parts.length > 0 && parts[0]) {\r\n                // Invalid line format\r\n                orders.push({\r\n                    machineName: parts[0] || 'Unknown',\r\n                    machineId: '',\r\n                    orderNumber: parts[1] || '',\r\n                    product: parts[2] || '',\r\n                    batchNumber: parts[3] || '',\r\n                    valid: false,\r\n                    error: 'Invalid format. Expected: Machine, Order, Product, Batch'\r\n                });\r\n            }\r\n        }\r\n\r\n        return orders;\r\n    }, [findMachine]);\r\n\r\n    // Handle bulk text change\r\n    const handleBulkTextChange = (text: string) => {\r\n        setBulkPasteText(text);\r\n        const parsed = parseBulkText(text);\r\n        setParsedOrders(parsed);\r\n        setShowBulkPreview(parsed.length > 0);\r\n    };\r\n\r\n    // Import all valid orders\r\n    const handleBulkImport = async () => {\r\n        const validOrders = parsedOrders.filter(o => o.valid);\r\n        if (validOrders.length === 0) {\r\n            showToast('No valid orders to import', 'error');\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            // Group orders by machine to maintain priority within each machine\r\n            const ordersByMachine: Record<string, ParsedOrder[]> = {};\r\n            validOrders.forEach(order => {\r\n                if (!ordersByMachine[order.machineId]) {\r\n                    ordersByMachine[order.machineId] = [];\r\n                }\r\n                ordersByMachine[order.machineId].push(order);\r\n            });\r\n\r\n            // Add orders for each machine in sequence\r\n            for (const machineId of Object.keys(ordersByMachine)) {\r\n                const machineOrders = ordersByMachine[machineId];\r\n                for (const order of machineOrders) {\r\n                    await addMachineOrder(\r\n                        order.machineId,\r\n                        order.orderNumber,\r\n                        order.product,\r\n                        order.batchNumber\r\n                    );\r\n                }\r\n            }\r\n\r\n            await loadData();\r\n            showToast(`Successfully imported ${validOrders.length} orders`, 'success');\r\n\r\n            // Clear the form\r\n            setBulkPasteText('');\r\n            setParsedOrders([]);\r\n            setShowBulkPreview(false);\r\n        } catch (error) {\r\n            console.error('Error importing orders:', error);\r\n            showToast('Failed to import orders', 'error');\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleAddOrder = async () => {\r\n        if (!selectedMachine) {\r\n            showToast('Please select a machine', 'error');\r\n            return;\r\n        }\r\n        if (!orderNumber.trim() || !product.trim() || !batchNumber.trim()) {\r\n            showToast('Please fill in all fields', 'error');\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            if (isSupabaseConfigured) {\r\n                await addMachineOrder(selectedMachine, orderNumber, product, batchNumber);\r\n                await loadData();\r\n                showToast('Order added successfully', 'success');\r\n                // Clear form\r\n                setOrderNumber('');\r\n                setProduct('');\r\n                setBatchNumber('');\r\n            } else {\r\n                showToast('Supabase not configured', 'error');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error adding order:', error);\r\n            showToast('Failed to add order', 'error');\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleRemoveOrder = async (orderId: number) => {\r\n        if (!window.confirm('Remove this order from the queue?')) return;\r\n\r\n        try {\r\n            await removeMachineOrder(orderId);\r\n            await loadData();\r\n            showToast('Order removed', 'success');\r\n        } catch (error) {\r\n            console.error('Error removing order:', error);\r\n            showToast('Failed to remove order', 'error');\r\n        }\r\n    };\r\n\r\n    const handleMoveOrder = async (machineId: string, orderId: number, direction: 'up' | 'down') => {\r\n        const orders = machineOrders[machineId] || [];\r\n        const currentIndex = orders.findIndex(o => o.id === orderId);\r\n        if (currentIndex === -1) return;\r\n\r\n        const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;\r\n        if (newIndex < 0 || newIndex >= orders.length) return;\r\n\r\n        // Swap orders\r\n        const newOrders = [...orders];\r\n        [newOrders[currentIndex], newOrders[newIndex]] = [newOrders[newIndex], newOrders[currentIndex]];\r\n\r\n        // Update local state immediately for responsiveness\r\n        setMachineOrders(prev => ({\r\n            ...prev,\r\n            [machineId]: newOrders\r\n        }));\r\n\r\n        // Update priorities in database\r\n        try {\r\n            const orderIds = newOrders.map(o => o.id!);\r\n            await updateMachineOrderPriorities(machineId, orderIds);\r\n        } catch (error) {\r\n            console.error('Error updating order priorities:', error);\r\n            // Reload data to restore correct state\r\n            await loadData();\r\n            showToast('Failed to reorder', 'error');\r\n        }\r\n    };\r\n\r\n    const handleClearMachineOrders = async (machineId: string) => {\r\n        const machine = machines.find(m => m.id === machineId);\r\n        if (!window.confirm(`Clear all orders for ${machine?.name || machineId}?`)) return;\r\n\r\n        try {\r\n            await clearMachineOrders(machineId);\r\n            await loadData();\r\n            showToast('Orders cleared', 'success');\r\n        } catch (error) {\r\n            console.error('Error clearing orders:', error);\r\n            showToast('Failed to clear orders', 'error');\r\n        }\r\n    };\r\n\r\n    // Count valid and invalid orders\r\n    const validCount = parsedOrders.filter(o => o.valid).length;\r\n    const invalidCount = parsedOrders.filter(o => !o.valid).length;\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"admin-console loading\">\r\n                <div className=\"spinner-v2\"></div>\r\n                <p>Loading order queues...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <motion.div\r\n            className=\"admin-console\"\r\n            initial={{ opacity: 0, y: 20 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            exit={{ opacity: 0, y: -20 }}\r\n        >\r\n            {/* Toast */}\r\n            <AnimatePresence>\r\n                {toast && (\r\n                    <motion.div\r\n                        className=\"toast-container-v2\"\r\n                        initial={{ opacity: 0, y: -20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: -20 }}\r\n                    >\r\n                        <div className={`toast-message-v2 ${toast.type}`}>\r\n                            <span className=\"toast-icon\">{toast.type === 'success' ? 'Γ£ô' : '!'}</span>\r\n                            {toast.message}\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Header */}\r\n            <header className=\"admin-header\">\r\n                <button className=\"back-btn-v2\" onClick={() => navigate('/')}>\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                        <path d=\"M19 12H5M12 19l-7-7 7-7\" />\r\n                    </svg>\r\n                    Back\r\n                </button>\r\n                <div className=\"admin-title\">\r\n                    <h1>Admin Console</h1>\r\n                    <span className=\"admin-subtitle\">Machine Order Queues</span>\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"admin-main\">\r\n                {/* Add Order Section with Tabs */}\r\n                <section className=\"admin-form-section\">\r\n                    <div className=\"admin-tabs\">\r\n                        <button\r\n                            className={`admin-tab ${activeTab === 'bulk' ? 'active' : ''}`}\r\n                            onClick={() => setActiveTab('bulk')}\r\n                        >\r\n                            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n                                <path d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n                            </svg>\r\n                            Bulk Import\r\n                        </button>\r\n                        <button\r\n                            className={`admin-tab ${activeTab === 'single' ? 'active' : ''}`}\r\n                            onClick={() => setActiveTab('single')}\r\n                        >\r\n                            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n                                <path d=\"M12 5v14M5 12h14\" />\r\n                            </svg>\r\n                            Single Order\r\n                        </button>\r\n                    </div>\r\n\r\n                    {activeTab === 'bulk' ? (\r\n                        <div className=\"admin-form bulk-form\">\r\n                            <div className=\"form-field\">\r\n                                <label className=\"form-label\">\r\n                                    Paste Orders (one per line)\r\n                                    <span className=\"form-hint\">Format: Machine, Order Number, Product, Batch Number</span>\r\n                                </label>\r\n                                <textarea\r\n                                    className=\"form-textarea\"\r\n                                    placeholder={`Example:\\nCanline, ORD-001, Product A, BATCH001\\nSachet Line, ORD-002, Product B, BATCH002\\nCanline, ORD-003, Product C, BATCH003`}\r\n                                    value={bulkPasteText}\r\n                                    onChange={e => handleBulkTextChange(e.target.value)}\r\n                                    rows={8}\r\n                                />\r\n                            </div>\r\n\r\n                            {/* Preview */}\r\n                            {showBulkPreview && (\r\n                                <div className=\"bulk-preview\">\r\n                                    <div className=\"preview-header\">\r\n                                        <h3>Preview ({validCount} valid, {invalidCount} invalid)</h3>\r\n                                    </div>\r\n                                    <div className=\"preview-list\">\r\n                                        {parsedOrders.map((order, index) => (\r\n                                            <div\r\n                                                key={index}\r\n                                                className={`preview-item ${order.valid ? 'valid' : 'invalid'}`}\r\n                                            >\r\n                                                <span className=\"preview-priority\">{index + 1}</span>\r\n                                                <div className=\"preview-details\">\r\n                                                    <span className=\"preview-machine\">{order.machineName}</span>\r\n                                                    <span className=\"preview-order\">{order.orderNumber}</span>\r\n                                                    <span className=\"preview-product\">{order.product}</span>\r\n                                                    <span className=\"preview-batch\">{order.batchNumber}</span>\r\n                                                </div>\r\n                                                {!order.valid && (\r\n                                                    <span className=\"preview-error\">{order.error}</span>\r\n                                                )}\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"admin-actions\">\r\n                                <button\r\n                                    className=\"admin-save-btn\"\r\n                                    onClick={handleBulkImport}\r\n                                    disabled={isSaving || validCount === 0}\r\n                                >\r\n                                    {isSaving ? 'Importing...' : `Import ${validCount} Orders`}\r\n                                </button>\r\n                                {bulkPasteText && (\r\n                                    <button\r\n                                        className=\"admin-clear-btn\"\r\n                                        onClick={() => {\r\n                                            setBulkPasteText('');\r\n                                            setParsedOrders([]);\r\n                                            setShowBulkPreview(false);\r\n                                        }}\r\n                                    >\r\n                                        Clear\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"admin-form\">\r\n                            <div className=\"form-field\">\r\n                                <label className=\"form-label\">Machine</label>\r\n                                <select\r\n                                    className=\"form-input\"\r\n                                    value={selectedMachine}\r\n                                    onChange={e => setSelectedMachine(e.target.value)}\r\n                                >\r\n                                    <option value=\"\">Select a machine...</option>\r\n                                    {machines.map(machine => (\r\n                                        <option key={machine.id} value={machine.id}>\r\n                                            {machine.name}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div className=\"form-field\">\r\n                                <label className=\"form-label\">Order Number</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-input\"\r\n                                    placeholder=\"Enter order number\"\r\n                                    value={orderNumber}\r\n                                    onChange={e => setOrderNumber(e.target.value)}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"form-field\">\r\n                                <label className=\"form-label\">Product</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-input\"\r\n                                    placeholder=\"Enter product name\"\r\n                                    value={product}\r\n                                    onChange={e => setProduct(e.target.value)}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"form-field\">\r\n                                <label className=\"form-label\">Batch Number</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-input\"\r\n                                    placeholder=\"Enter batch number\"\r\n                                    value={batchNumber}\r\n                                    onChange={e => setBatchNumber(e.target.value)}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"admin-actions\">\r\n                                <button\r\n                                    className=\"admin-save-btn\"\r\n                                    onClick={handleAddOrder}\r\n                                    disabled={isSaving}\r\n                                >\r\n                                    {isSaving ? 'Adding...' : 'Add to Queue'}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </section>\r\n\r\n                {/* Machine Order Queues */}\r\n                <section className=\"admin-queues-section\">\r\n                    <h2 className=\"section-heading\">\r\n                        <span className=\"section-icon\">#</span>\r\n                        Order Queues by Machine\r\n                    </h2>\r\n\r\n                    {machines.length === 0 ? (\r\n                        <div className=\"info-card\">\r\n                            <span className=\"info-icon\">!</span>\r\n                            <p>No machines configured. Add machines in Machine Settings first.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"machine-queues-grid\">\r\n                            {machines.map(machine => {\r\n                                const orders = machineOrders[machine.id] || [];\r\n                                return (\r\n                                    <div key={machine.id} className=\"machine-queue-card\">\r\n                                        <div className=\"machine-queue-header\">\r\n                                            <h3>{machine.name}</h3>\r\n                                            <span className=\"queue-count\">{orders.length} orders</span>\r\n                                            {orders.length > 0 && (\r\n                                                <button\r\n                                                    className=\"clear-queue-btn\"\r\n                                                    onClick={() => handleClearMachineOrders(machine.id)}\r\n                                                    title=\"Clear all orders\"\r\n                                                >\r\n                                                    Clear\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {orders.length === 0 ? (\r\n                                            <div className=\"empty-queue\">\r\n                                                <p>No orders in queue</p>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className=\"queue-list\">\r\n                                                {orders.map((order, index) => (\r\n                                                    <motion.div\r\n                                                        key={order.id}\r\n                                                        className=\"queue-item\"\r\n                                                        initial={{ opacity: 0, x: -10 }}\r\n                                                        animate={{ opacity: 1, x: 0 }}\r\n                                                        transition={{ delay: index * 0.05 }}\r\n                                                    >\r\n                                                        <div className=\"queue-item-priority\">\r\n                                                            {index + 1}\r\n                                                        </div>\r\n                                                        <div className=\"queue-item-details\">\r\n                                                            <div className=\"queue-order-number\">{order.order_number}</div>\r\n                                                            <div className=\"queue-product\">{order.product}</div>\r\n                                                            <div className=\"queue-batch\">Batch: {order.batch_number}</div>\r\n                                                        </div>\r\n                                                        <div className=\"queue-item-actions\">\r\n                                                            <button\r\n                                                                className=\"queue-move-btn\"\r\n                                                                onClick={() => handleMoveOrder(machine.id, order.id!, 'up')}\r\n                                                                disabled={index === 0}\r\n                                                                title=\"Move up\"\r\n                                                            >\r\n                                                                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"16\" height=\"16\">\r\n                                                                    <path d=\"M18 15l-6-6-6 6\" />\r\n                                                                </svg>\r\n                                                            </button>\r\n                                                            <button\r\n                                                                className=\"queue-move-btn\"\r\n                                                                onClick={() => handleMoveOrder(machine.id, order.id!, 'down')}\r\n                                                                disabled={index === orders.length - 1}\r\n                                                                title=\"Move down\"\r\n                                                            >\r\n                                                                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"16\" height=\"16\">\r\n                                                                    <path d=\"M6 9l6 6 6-6\" />\r\n                                                                </svg>\r\n                                                            </button>\r\n                                                            <button\r\n                                                                className=\"queue-remove-btn\"\r\n                                                                onClick={() => handleRemoveOrder(order.id!)}\r\n                                                                title=\"Remove order\"\r\n                                                            >\r\n                                                                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"16\" height=\"16\">\r\n                                                                    <path d=\"M18 6L6 18M6 6l12 12\" />\r\n                                                                </svg>\r\n                                                            </button>\r\n                                                        </div>\r\n                                                    </motion.div>\r\n                                                ))}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    )}\r\n                </section>\r\n\r\n                <section className=\"admin-info-section\">\r\n                    <div className=\"info-card\">\r\n                        <span className=\"info-icon\">i</span>\r\n                        <p>\r\n                            <strong>Bulk Import:</strong> Paste from Excel or CSV. Each line: Machine, Order, Product, Batch.\r\n                            Top to bottom = priority order (1st line = highest priority).\r\n                        </p>\r\n                    </div>\r\n                </section>\r\n            </main>\r\n        </motion.div>\r\n    );\r\n};\r\n\r\nexport default AdminConsole;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\pages\\CaptureScreen.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'showToast' function makes the dependencies of useCallback Hook (at line 408) change on every render. To fix this, wrap the definition of 'showToast' in its own useCallback() Hook.","line":109,"column":9,"nodeType":"VariableDeclarator","endLine":112,"endColumn":4,"suggestions":[{"desc":"Wrap the definition of 'showToast' in its own useCallback() Hook.","fix":{"range":[5413,5546],"text":"useCallback((message: string, type: 'success' | 'error') => {\r\n    setToast({ message, type });\r\n    setTimeout(() => setToast(null), 4000);\r\n  })"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'showToast' function makes the dependencies of useCallback Hook (at line 445) change on every render. To fix this, wrap the definition of 'showToast' in its own useCallback() Hook.","line":109,"column":9,"nodeType":"VariableDeclarator","endLine":112,"endColumn":4,"suggestions":[{"desc":"Wrap the definition of 'showToast' in its own useCallback() Hook.","fix":{"range":[5413,5546],"text":"useCallback((message: string, type: 'success' | 'error') => {\r\n    setToast({ message, type });\r\n    setTimeout(() => setToast(null), 4000);\r\n  })"}}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":198,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":198,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[9031,9075],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":214,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":214,"endColumn":24,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[9694,9744],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":226,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":226,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[10238,10294],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":298,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":298,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[12518,12569],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":679,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":679,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[25577,25619],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useParams, useLocation, useNavigate } from 'react-router-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport ShiftInfo from '../components/ShiftInfo';\r\nimport MainForm from '../components/MainForm';\r\nimport DashboardCharts from '../components/DashboardCharts';\r\nimport ConfirmDialog from '../components/ConfirmDialog';\r\nimport QRScanner from '../components/QRScanner';\r\nimport { WasteEntry, DowntimeEntry, ShiftData, SpeedEntry, SachetMassEntry, LooseCasesEntry, PalletScanEntry, ShiftSession, ProductionState, WASTE_TYPES, DOWNTIME_REASONS } from '../types';\r\nimport { submitShiftData, fetchMachineOrders, MachineOrderQueueRecord, updateMachineStatus } from '../lib/supabase';\r\nimport { saveShiftData, addFailedSubmission } from '../lib/storage';\r\nimport { upsertLiveSession, deleteLiveSession } from '../lib/liveSession';\r\n\r\n// Storage key for shift session\r\nconst getSessionKey = (machineName: string, shift: string, date: string) =>\r\n  `shift_session_${machineName}_${shift}_${date}`;\r\n\r\nconst CaptureScreen: React.FC = () => {\r\n  const { machineId } = useParams<{ machineId: string }>();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const machineName = (location.state as { machineName?: string })?.machineName || machineId || '';\r\n\r\n  // Track current machine for chat widget location context\r\n  useEffect(() => {\r\n    if (machineName) {\r\n      localStorage.setItem('chat_current_machine', machineName);\r\n    }\r\n    return () => {\r\n      localStorage.removeItem('chat_current_machine');\r\n    };\r\n  }, [machineName]);\r\n\r\n  const [dateTime, setDateTime] = useState(new Date());\r\n  const [shift, setShift] = useState('');\r\n\r\n  // Loading and feedback states\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\r\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\r\n\r\n  // State for the main form\r\n  const [operatorName, setOperatorName] = useState('');\r\n  const [orderNumber, setOrderNumber] = useState('');\r\n  const [product, setProduct] = useState('');\r\n  const [batchNumber, setBatchNumber] = useState('');\r\n  const [isSessionLocked, setIsSessionLocked] = useState(false);\r\n\r\n  // State for waste and downtime inputs\r\n  const [waste, setWaste] = useState<number | ''>('');\r\n  const [wasteType, setWasteType] = useState('');\r\n  const [downtime, setDowntime] = useState<number | ''>('');\r\n  const [downtimeReason, setDowntimeReason] = useState('');\r\n\r\n  // State for storing submitted entries\r\n  const [wasteEntries, setWasteEntries] = useState<WasteEntry[]>([]);\r\n  const [downtimeEntries, setDowntimeEntries] = useState<DowntimeEntry[]>([]);\r\n\r\n  // New states for Machine Speed, Sachet Mass, Loose Cases, Pallet Scans\r\n  const [speedEntries, setSpeedEntries] = useState<SpeedEntry[]>([]);\r\n  const [sachetMassEntries, setSachetMassEntries] = useState<SachetMassEntry[]>([]);\r\n  const [looseCasesEntries, setLooseCasesEntries] = useState<LooseCasesEntry[]>([]);\r\n  const [palletScanEntries, setPalletScanEntries] = useState<PalletScanEntry[]>([]);\r\n\r\n  // Modal states for new entries\r\n  const [showSpeedModal, setShowSpeedModal] = useState(false);\r\n  const [showSachetModal, setShowSachetModal] = useState(false);\r\n  const [showLooseCasesModal, setShowLooseCasesModal] = useState(false);\r\n  const [showQRScanner, setShowQRScanner] = useState(false);\r\n  const [showWasteModal, setShowWasteModal] = useState(false);\r\n  const [showDowntimeModal, setShowDowntimeModal] = useState(false);\r\n  const [speedInput, setSpeedInput] = useState<number | ''>('');\r\n  const [sachetMassInput, setSachetMassInput] = useState<number | ''>('');\r\n  const [looseCasesBatchInput, setLooseCasesBatchInput] = useState('');\r\n  const [looseCasesQuantityInput, setLooseCasesQuantityInput] = useState<number | ''>('');\r\n\r\n  // Submission window state\r\n  const [isInSubmissionWindow, setIsInSubmissionWindow] = useState(false);\r\n  const [, setTimeToWindow] = useState(''); // Time display for submission window\r\n\r\n  // Order queue state\r\n  const [availableOrders, setAvailableOrders] = useState<MachineOrderQueueRecord[]>([]);\r\n  const [showOrderSelect, setShowOrderSelect] = useState(false);\r\n\r\n  // Shift change detection\r\n  const [lastKnownShift, setLastKnownShift] = useState<string | null>(null);\r\n  const [showShiftChangeModal, setShowShiftChangeModal] = useState(false);\r\n  const [newOperatorName, setNewOperatorName] = useState('');\r\n\r\n  // Changeover dialog state (shown when submitting outside window)\r\n  const [showChangeoverDialog, setShowChangeoverDialog] = useState(false);\r\n  const [willChangeover, setWillChangeover] = useState<boolean | null>(null);\r\n  const [willMaintenance, setWillMaintenance] = useState<boolean | null>(null);\r\n\r\n  // Production Timer state\r\n  const [productionState, setProductionState] = useState<ProductionState>({\r\n    isRunning: false,\r\n    startTime: null,\r\n    pausedAt: null,\r\n    totalRunTimeMs: 0,\r\n    lastResumedAt: null,\r\n  });\r\n  const [displayRunTime, setDisplayRunTime] = useState<string>('00:00:00');\r\n  const [showContinueModal, setShowContinueModal] = useState(false);\r\n  const [pauseDowntimeReason, setPauseDowntimeReason] = useState('');\r\n\r\n  // Show toast notification\r\n  const showToast = (message: string, type: 'success' | 'error') => {\r\n    setToast({ message, type });\r\n    setTimeout(() => setToast(null), 4000);\r\n  };\r\n\r\n  // Handle order selection from queue\r\n  const handleOrderSelect = (order: MachineOrderQueueRecord) => {\r\n    setOrderNumber(order.order_number);\r\n    setProduct(order.product);\r\n    setBatchNumber(order.batch_number);\r\n    setShowOrderSelect(false);\r\n    showToast(`Selected order: ${order.order_number}`, 'success');\r\n  };\r\n\r\n  // Check if within submission window (15 min before/after shift end)\r\n  const checkSubmissionWindow = useCallback((currentDateTime: Date) => {\r\n    const hours = currentDateTime.getUTCHours() + 2; // GMT+2\r\n    const minutes = currentDateTime.getMinutes();\r\n    const totalMinutes = hours * 60 + minutes;\r\n\r\n    // Day shift ends at 18:00 (1080 min), Night shift ends at 06:00 (360 min)\r\n    const dayShiftEnd = 18 * 60; // 1080\r\n    const nightShiftEnd = 6 * 60; // 360\r\n\r\n    // Check if within 15 minutes of shift end\r\n    const dayWindowStart = dayShiftEnd - 15;\r\n    const dayWindowEnd = dayShiftEnd + 15;\r\n    const nightWindowStart = nightShiftEnd - 15;\r\n    const nightWindowEnd = nightShiftEnd + 15;\r\n\r\n    let inWindow = false;\r\n    let minutesToWindow = 0;\r\n\r\n    if (totalMinutes >= dayWindowStart && totalMinutes <= dayWindowEnd) {\r\n      inWindow = true;\r\n    } else if (totalMinutes >= nightWindowStart && totalMinutes <= nightWindowEnd) {\r\n      inWindow = true;\r\n    } else if (totalMinutes >= (24 * 60 - 15)) {\r\n      // Handle night shift window that wraps around midnight\r\n      inWindow = true;\r\n    } else {\r\n      // Calculate time to next window\r\n      if (totalMinutes < nightWindowStart) {\r\n        minutesToWindow = nightWindowStart - totalMinutes;\r\n      } else if (totalMinutes < dayWindowStart) {\r\n        minutesToWindow = dayWindowStart - totalMinutes;\r\n      } else {\r\n        minutesToWindow = (24 * 60 - 15) - totalMinutes;\r\n      }\r\n    }\r\n\r\n    setIsInSubmissionWindow(inWindow);\r\n\r\n    if (!inWindow && minutesToWindow > 0) {\r\n      const hoursTo = Math.floor(minutesToWindow / 60);\r\n      const minsTo = minutesToWindow % 60;\r\n      setTimeToWindow(hoursTo > 0 ? `${hoursTo}h ${minsTo}m` : `${minsTo}m`);\r\n    } else {\r\n      setTimeToWindow('');\r\n    }\r\n  }, []);\r\n\r\n  // Load saved session data\r\n  const loadSession = useCallback(() => {\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const hours = new Date().getUTCHours() + 2;\r\n    const currentShift = hours >= 6 && hours < 18 ? 'Day' : 'Night';\r\n    const sessionKey = getSessionKey(machineName, currentShift, currentDate);\r\n\r\n    const savedSession = localStorage.getItem(sessionKey);\r\n    if (savedSession) {\r\n      try {\r\n        const session: ShiftSession = JSON.parse(savedSession);\r\n        if (session.locked) {\r\n          setOperatorName(session.operatorName);\r\n          setOrderNumber(session.orderNumber);\r\n          setProduct(session.product);\r\n          setBatchNumber(session.batchNumber);\r\n          setIsSessionLocked(true);\r\n\r\n          // Restore entry arrays\r\n          if (session.wasteEntries) setWasteEntries(session.wasteEntries);\r\n          if (session.downtimeEntries) setDowntimeEntries(session.downtimeEntries);\r\n          if (session.speedEntries) setSpeedEntries(session.speedEntries);\r\n          if (session.sachetMassEntries) setSachetMassEntries(session.sachetMassEntries);\r\n          if (session.looseCasesEntries) setLooseCasesEntries(session.looseCasesEntries);\r\n          if (session.palletScanEntries) setPalletScanEntries(session.palletScanEntries);\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to load session:', e);\r\n      }\r\n    } else {\r\n      // No session - try to load admin order details from database\r\n      const loadAdminOrderDetails = async () => {\r\n        try {\r\n          // Import dynamically to avoid circular dependency\r\n          const { fetchActiveOrderDetails } = await import('../lib/supabase');\r\n          const activeOrder = await fetchActiveOrderDetails();\r\n          if (activeOrder) {\r\n            setOrderNumber(activeOrder.order_number);\r\n            setProduct(activeOrder.product);\r\n            setBatchNumber(activeOrder.batch_number);\r\n            return;\r\n          }\r\n        } catch (e) {\r\n          console.error('Failed to load from database:', e);\r\n        }\r\n\r\n        // Fall back to localStorage\r\n        const adminOrderDetails = localStorage.getItem('admin_order_details');\r\n        if (adminOrderDetails) {\r\n          try {\r\n            const details = JSON.parse(adminOrderDetails);\r\n            if (details.orderNumber) setOrderNumber(details.orderNumber);\r\n            if (details.product) setProduct(details.product);\r\n            if (details.batchNumber) setBatchNumber(details.batchNumber);\r\n          } catch (e) {\r\n            console.error('Failed to load admin order details:', e);\r\n          }\r\n        }\r\n      };\r\n      loadAdminOrderDetails();\r\n    }\r\n  }, [machineName]);\r\n\r\n  // Save session data\r\n  const saveSession = useCallback((showMessage = true) => {\r\n    if (!operatorName || !orderNumber || !product || !batchNumber) return;\r\n\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    // Calculate shift consistently (don't rely on state which may not be set yet)\r\n    const hours = new Date().getUTCHours() + 2;\r\n    const currentShift = hours >= 6 && hours < 18 ? 'Day' : 'Night';\r\n    const sessionKey = getSessionKey(machineName, currentShift, currentDate);\r\n\r\n    const session: ShiftSession = {\r\n      machineName,\r\n      operatorName,\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift: currentShift,\r\n      date: currentDate,\r\n      locked: true,\r\n      // Persist entry arrays\r\n      wasteEntries,\r\n      downtimeEntries,\r\n      speedEntries,\r\n      sachetMassEntries,\r\n      looseCasesEntries,\r\n      palletScanEntries,\r\n    };\r\n\r\n    localStorage.setItem(sessionKey, JSON.stringify(session));\r\n\r\n    // Sync to Supabase for cross-browser visibility\r\n    upsertLiveSession({\r\n      machineName,\r\n      operatorName,\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift: currentShift,\r\n      date: currentDate,\r\n      locked: true,\r\n    });\r\n\r\n    if (!isSessionLocked) {\r\n      setIsSessionLocked(true);\r\n      // Update machine status to 'running' in Supabase\r\n      if (machineId) {\r\n        updateMachineStatus(machineId, 'running', operatorName, orderNumber, currentShift);\r\n      }\r\n      if (showMessage) showToast('Shift details locked for this session', 'success');\r\n    }\r\n  }, [machineName, operatorName, orderNumber, product, batchNumber, wasteEntries, downtimeEntries, speedEntries, sachetMassEntries, looseCasesEntries, palletScanEntries, isSessionLocked, machineId]);\r\n\r\n  useEffect(() => {\r\n    loadSession();\r\n  }, [loadSession]);\r\n\r\n  // Load available orders from machine queue\r\n  useEffect(() => {\r\n    const loadMachineOrders = async () => {\r\n      if (!machineId) return;\r\n      try {\r\n        const orders = await fetchMachineOrders(machineId);\r\n        setAvailableOrders(orders);\r\n      } catch (e) {\r\n        console.error('Failed to load machine orders:', e);\r\n      }\r\n    };\r\n    loadMachineOrders();\r\n  }, [machineId]);\r\n\r\n  // Auto-save entries when they change (if session is locked)\r\n  useEffect(() => {\r\n    if (isSessionLocked && operatorName && orderNumber && product && batchNumber) {\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const hours = new Date().getUTCHours() + 2;\r\n      const currentShift = hours >= 6 && hours < 18 ? 'Day' : 'Night';\r\n      const sessionKey = getSessionKey(machineName, currentShift, currentDate);\r\n\r\n      const session: ShiftSession = {\r\n        machineName,\r\n        operatorName,\r\n        orderNumber,\r\n        product,\r\n        batchNumber,\r\n        shift: currentShift,\r\n        date: currentDate,\r\n        locked: true,\r\n        wasteEntries,\r\n        downtimeEntries,\r\n        speedEntries,\r\n        sachetMassEntries,\r\n        looseCasesEntries,\r\n        palletScanEntries,\r\n      };\r\n\r\n      localStorage.setItem(sessionKey, JSON.stringify(session));\r\n    }\r\n  }, [wasteEntries, downtimeEntries, speedEntries, sachetMassEntries, looseCasesEntries, palletScanEntries, isSessionLocked, machineName, operatorName, orderNumber, product, batchNumber]);\r\n\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      const now = new Date();\r\n      setDateTime(now);\r\n      checkSubmissionWindow(now);\r\n    }, 1000);\r\n\r\n    // Set the shift\r\n    const hours = dateTime.getUTCHours() + 2; // GMT+2\r\n    const newShift = hours >= 6 && hours < 18 ? 'Day' : 'Night';\r\n\r\n    // Detect shift change\r\n    if (lastKnownShift !== null && lastKnownShift !== newShift && isSessionLocked) {\r\n      // Shift has changed while session is active - prompt for new operator\r\n      setShowShiftChangeModal(true);\r\n    }\r\n\r\n    setShift(newShift);\r\n    setLastKnownShift(newShift);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [dateTime, checkSubmissionWindow, lastKnownShift, isSessionLocked]);\r\n\r\n  // Production Timer - Update display every second when running\r\n  useEffect(() => {\r\n    if (!productionState.isRunning || !productionState.lastResumedAt) return;\r\n\r\n    const timerInterval = setInterval(() => {\r\n      const now = Date.now();\r\n      const currentSessionMs = now - productionState.lastResumedAt!.getTime();\r\n      const totalMs = productionState.totalRunTimeMs + currentSessionMs;\r\n\r\n      // Format as HH:MM:SS\r\n      const totalSeconds = Math.floor(totalMs / 1000);\r\n      const hours = Math.floor(totalSeconds / 3600);\r\n      const minutes = Math.floor((totalSeconds % 3600) / 60);\r\n      const seconds = totalSeconds % 60;\r\n      setDisplayRunTime(\r\n        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`\r\n      );\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timerInterval);\r\n  }, [productionState.isRunning, productionState.lastResumedAt, productionState.totalRunTimeMs]);\r\n\r\n  // Start production timer (called when session is locked)\r\n  const handleStartProduction = useCallback(() => {\r\n    const now = new Date();\r\n    setProductionState({\r\n      isRunning: true,\r\n      startTime: now,\r\n      pausedAt: null,\r\n      totalRunTimeMs: 0,\r\n      lastResumedAt: now,\r\n    });\r\n    setDisplayRunTime('00:00:00');\r\n  }, []);\r\n\r\n  // Pause production - record pause start time\r\n  const handlePauseProduction = useCallback(() => {\r\n    if (!productionState.isRunning) return;\r\n\r\n    const now = new Date();\r\n    // Calculate run time accumulated so far\r\n    const currentSessionMs = productionState.lastResumedAt\r\n      ? now.getTime() - productionState.lastResumedAt.getTime()\r\n      : 0;\r\n\r\n    setProductionState(prev => ({\r\n      ...prev,\r\n      isRunning: false,\r\n      pausedAt: now,\r\n      totalRunTimeMs: prev.totalRunTimeMs + currentSessionMs,\r\n    }));\r\n    showToast('Production paused - timer stopped', 'success');\r\n  }, [productionState.isRunning, productionState.lastResumedAt, showToast]);\r\n\r\n  // Continue production - show modal to get reason, then record downtime\r\n  const handleContinueProduction = useCallback(() => {\r\n    if (!pauseDowntimeReason) {\r\n      showToast('Please select a downtime reason', 'error');\r\n      return;\r\n    }\r\n\r\n    if (!productionState.pausedAt) return;\r\n\r\n    const now = new Date();\r\n    const pauseDurationMs = now.getTime() - productionState.pausedAt.getTime();\r\n    const pauseDurationMinutes = Math.ceil(pauseDurationMs / 60000); // Round up to nearest minute\r\n\r\n    // Create downtime entry automatically\r\n    const newDowntimeEntry: DowntimeEntry = {\r\n      id: uuidv4(),\r\n      downtime: pauseDurationMinutes,\r\n      downtimeReason: pauseDowntimeReason,\r\n      notes: 'Auto-recorded from production pause',\r\n      timestamp: productionState.pausedAt,\r\n    };\r\n    setDowntimeEntries(prev => [...prev, newDowntimeEntry]);\r\n\r\n    // Resume production\r\n    setProductionState(prev => ({\r\n      ...prev,\r\n      isRunning: true,\r\n      pausedAt: null,\r\n      lastResumedAt: now,\r\n    }));\r\n\r\n    // Reset modal state\r\n    setShowContinueModal(false);\r\n    setPauseDowntimeReason('');\r\n    showToast(`Production resumed. ${pauseDurationMinutes} min downtime recorded.`, 'success');\r\n  }, [pauseDowntimeReason, productionState.pausedAt, showToast]);\r\n\r\n  // Handle Waste Entry from Modal\r\n  const handleWasteSubmit = () => {\r\n    if (waste && wasteType) {\r\n      const newEntry: WasteEntry = {\r\n        id: uuidv4(),\r\n        waste: Number(waste),\r\n        wasteType,\r\n        timestamp: new Date()\r\n      };\r\n      setWasteEntries([...wasteEntries, newEntry]);\r\n      setWaste('');\r\n      setWasteType('');\r\n      setShowWasteModal(false);\r\n      showToast('Waste entry added', 'success');\r\n    }\r\n  };\r\n\r\n  const handleDeleteWasteEntry = (id: string) => {\r\n    setWasteEntries(wasteEntries.filter(entry => entry.id !== id));\r\n    showToast('Entry removed', 'success');\r\n  };\r\n\r\n  const handleDeleteDowntimeEntry = (id: string) => {\r\n    setDowntimeEntries(downtimeEntries.filter(entry => entry.id !== id));\r\n    showToast('Entry removed', 'success');\r\n  };\r\n\r\n  // Handle Downtime Entry from Modal\r\n  const handleDowntimeSubmit = () => {\r\n    if (downtime && downtimeReason) {\r\n      const newEntry: DowntimeEntry = {\r\n        id: uuidv4(),\r\n        downtime: Number(downtime),\r\n        downtimeReason,\r\n        notes: undefined,\r\n        timestamp: new Date()\r\n      };\r\n      setDowntimeEntries([...downtimeEntries, newEntry]);\r\n      setDowntime('');\r\n      setDowntimeReason('');\r\n      setShowDowntimeModal(false);\r\n      showToast('Downtime entry added', 'success');\r\n    }\r\n  };\r\n\r\n  const handleSubmitClick = (e: React.MouseEvent<HTMLButtonElement>) => {\r\n    e.preventDefault();\r\n\r\n    // Validation\r\n    if (!operatorName || !orderNumber || !product || !batchNumber) {\r\n      showToast('Please fill in all shift details', 'error');\r\n      return;\r\n    }\r\n\r\n    if (wasteEntries.length === 0 && downtimeEntries.length === 0) {\r\n      showToast('Please add at least one waste or downtime entry', 'error');\r\n      return;\r\n    }\r\n\r\n    // If outside submission window, show changeover dialog first\r\n    if (!isInSubmissionWindow) {\r\n      setWillChangeover(null);\r\n      setWillMaintenance(null);\r\n      setShowChangeoverDialog(true);\r\n    } else {\r\n      // Within window, go directly to confirmation\r\n      setShowConfirmDialog(true);\r\n    }\r\n  };\r\n\r\n  const handleChangeoverConfirm = () => {\r\n    if (willChangeover === null || willMaintenance === null) {\r\n      showToast('Please answer both questions', 'error');\r\n      return;\r\n    }\r\n    setShowChangeoverDialog(false);\r\n    setShowConfirmDialog(true);\r\n  };\r\n\r\n  // Handle shift change confirmation - update operator for new shift\r\n  const handleShiftChangeConfirm = () => {\r\n    if (!newOperatorName.trim()) {\r\n      showToast('Please enter the new operator name/number', 'error');\r\n      return;\r\n    }\r\n\r\n    // Update the operator name for the new shift\r\n    setOperatorName(newOperatorName.trim());\r\n    setShowShiftChangeModal(false);\r\n    setNewOperatorName('');\r\n\r\n    // Update machine status with new operator\r\n    if (machineId) {\r\n      updateMachineStatus(machineId, 'running', newOperatorName.trim(), orderNumber, shift);\r\n    }\r\n\r\n    // Update the session with new operator\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const sessionKey = getSessionKey(machineName, shift, currentDate);\r\n\r\n    const session: ShiftSession = {\r\n      machineName,\r\n      operatorName: newOperatorName.trim(),\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift,\r\n      date: currentDate,\r\n      locked: true,\r\n      wasteEntries,\r\n      downtimeEntries,\r\n      speedEntries,\r\n      sachetMassEntries,\r\n      looseCasesEntries,\r\n      palletScanEntries,\r\n    };\r\n\r\n    localStorage.setItem(sessionKey, JSON.stringify(session));\r\n    showToast(`Operator changed to ${newOperatorName.trim()} for ${shift} shift`, 'success');\r\n  };\r\n\r\n  const handleConfirmedSubmit = async () => {\r\n    setShowConfirmDialog(false);\r\n    setIsSubmitting(true);\r\n\r\n    // Calculate totals\r\n    const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n    const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n    // Create shift data object\r\n    const shiftData: ShiftData = {\r\n      id: uuidv4(),\r\n      operatorName,\r\n      machine: machineName,\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift,\r\n      date: dateTime.toISOString().split('T')[0],\r\n      wasteEntries,\r\n      downtimeEntries,\r\n      speedEntries,\r\n      sachetMassEntries,\r\n      looseCasesEntries,\r\n      palletScanEntries,\r\n      totalWaste,\r\n      totalDowntime,\r\n      submittedAt: new Date()\r\n    };\r\n\r\n    // Prepare submission data for potential retry queue\r\n    const submissionPayload = {\r\n      shiftData: {\r\n        operator_name: operatorName,\r\n        machine: machineName,\r\n        order_number: orderNumber,\r\n        product,\r\n        batch_number: batchNumber,\r\n        shift,\r\n        submission_date: dateTime.toISOString().split('T')[0],\r\n        is_early_submission: !isInSubmissionWindow,\r\n        will_changeover: willChangeover ?? undefined,\r\n        will_maintenance_cleaning: willMaintenance ?? undefined,\r\n      },\r\n      wasteEntries: wasteEntries.map(e => ({ waste: e.waste, wasteType: e.wasteType, timestamp: e.timestamp })),\r\n      downtimeEntries: downtimeEntries.map(e => ({ downtime: e.downtime, downtimeReason: e.downtimeReason, timestamp: e.timestamp })),\r\n      speedEntries: speedEntries.map(e => ({ speed: e.speed, timestamp: e.timestamp })),\r\n      sachetMassEntries: sachetMassEntries.map(e => ({ mass: e.mass, timestamp: e.timestamp })),\r\n      looseCasesEntries: looseCasesEntries.map(e => ({ batchNumber: e.batchNumber, cases: e.cases, timestamp: e.timestamp })),\r\n      palletScanEntries: palletScanEntries.map(e => ({ qrCode: e.qrCode, batchNumber: e.batchNumber, palletNumber: e.palletNumber, casesCount: e.casesCount, timestamp: e.timestamp })),\r\n    };\r\n\r\n    try {\r\n      // Save to local storage first\r\n      saveShiftData(shiftData);\r\n\r\n      // Try to submit to Supabase with all data including changeover info\r\n      const result = await submitShiftData(\r\n        submissionPayload.shiftData,\r\n        submissionPayload.wasteEntries,\r\n        submissionPayload.downtimeEntries,\r\n        submissionPayload.speedEntries,\r\n        submissionPayload.sachetMassEntries,\r\n        submissionPayload.looseCasesEntries,\r\n        submissionPayload.palletScanEntries\r\n      );\r\n\r\n      // Show success with any warnings\r\n      if (result.warnings.length > 0) {\r\n        showToast(`Submitted with warnings: ${result.warnings.join(', ')}`, 'success');\r\n      } else {\r\n        showToast('Shift data submitted successfully', 'success');\r\n      }\r\n\r\n      // Reset form for new submission\r\n      // Unlock shift details\r\n      setIsSessionLocked(false);\r\n\r\n      // Update machine status to 'idle' since order is complete\r\n      if (machineId) {\r\n        updateMachineStatus(machineId, 'idle');\r\n      }\r\n\r\n      // Clear all entries\r\n      setWasteEntries([]);\r\n      setDowntimeEntries([]);\r\n      setSpeedEntries([]);\r\n      setSachetMassEntries([]);\r\n      setLooseCasesEntries([]);\r\n      setPalletScanEntries([]);\r\n\r\n      // Reset changeover state\r\n      setWillChangeover(null);\r\n      setWillMaintenance(false);\r\n\r\n      // Clear session storage so new details can be entered\r\n      sessionStorage.removeItem(`session_${machineId}`);\r\n\r\n      // Clear the localStorage session key as well\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const sessionKey = getSessionKey(machineName, shift, currentDate);\r\n      localStorage.removeItem(sessionKey);\r\n\r\n      // Delete from Supabase live_sessions so other browsers see it as available\r\n      deleteLiveSession(machineName, shift, currentDate);\r\n\r\n      // Keep operator name but clear order-specific fields for new order\r\n      setOrderNumber('');\r\n      setProduct('');\r\n      setBatchNumber('');\r\n\r\n    } catch (error) {\r\n      console.error('Submission error:', error);\r\n\r\n      // Add to failed submissions queue for retry\r\n      addFailedSubmission(submissionPayload, String(error));\r\n\r\n      // Still saved locally, show partial success with retry info\r\n      showToast('Saved locally. Will retry sync automatically.', 'error');\r\n\r\n      // Clear form since data is saved locally\r\n      setIsSessionLocked(false);\r\n\r\n      // Update machine status to 'idle' since order is \"complete\" (saved locally)\r\n      if (machineId) {\r\n        updateMachineStatus(machineId, 'idle');\r\n      }\r\n\r\n      // Clear the localStorage session key\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const sessionKey = getSessionKey(machineName, shift, currentDate);\r\n      localStorage.removeItem(sessionKey);\r\n\r\n      // Also delete from Supabase live_sessions\r\n      deleteLiveSession(machineName, shift, currentDate);\r\n\r\n      setWasteEntries([]);\r\n      setDowntimeEntries([]);\r\n      setSpeedEntries([]);\r\n      setSachetMassEntries([]);\r\n      setLooseCasesEntries([]);\r\n      setPalletScanEntries([]);\r\n      setWillChangeover(null);\r\n      setWillMaintenance(false);\r\n      setOrderNumber('');\r\n      setProduct('');\r\n      setBatchNumber('');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleBack = () => {\r\n    // Only warn if session is NOT locked (entries won't be auto-saved)\r\n    const hasEntries = wasteEntries.length > 0 || downtimeEntries.length > 0 ||\r\n      speedEntries.length > 0 || sachetMassEntries.length > 0 ||\r\n      looseCasesEntries.length > 0 || palletScanEntries.length > 0;\r\n\r\n    if (hasEntries && !isSessionLocked) {\r\n      if (window.confirm('You have entries that are not saved to a session. Are you sure you want to go back? Lock your shift details first to save entries.')) {\r\n        navigate('/');\r\n      }\r\n    } else {\r\n      // Session is locked = entries are auto-saved, safe to go back\r\n      navigate('/');\r\n    }\r\n  };\r\n\r\n  // Handle Speed Entry\r\n  const handleSpeedSubmit = () => {\r\n    if (speedInput && speedInput > 0) {\r\n      const newEntry: SpeedEntry = {\r\n        id: uuidv4(),\r\n        speed: Number(speedInput),\r\n        timestamp: new Date()\r\n      };\r\n      setSpeedEntries([...speedEntries, newEntry]);\r\n      setSpeedInput('');\r\n      setShowSpeedModal(false);\r\n      showToast('Machine speed recorded', 'success');\r\n    }\r\n  };\r\n\r\n  // Speed entry deletion (available for future UI enhancement)\r\n  const _handleDeleteSpeedEntry = (id: string) => {\r\n    setSpeedEntries(speedEntries.filter(entry => entry.id !== id));\r\n    showToast('Speed entry removed', 'success');\r\n  };\r\n  // Suppress unused variable warning\r\n  void _handleDeleteSpeedEntry;\r\n\r\n  // Handle Sachet Mass Entry\r\n  const handleSachetMassSubmit = () => {\r\n    if (sachetMassInput && sachetMassInput > 0) {\r\n      const newEntry: SachetMassEntry = {\r\n        id: uuidv4(),\r\n        mass: Number(sachetMassInput),\r\n        timestamp: new Date()\r\n      };\r\n      setSachetMassEntries([...sachetMassEntries, newEntry]);\r\n      setSachetMassInput('');\r\n      setShowSachetModal(false);\r\n      showToast('Sachet mass recorded', 'success');\r\n    }\r\n  };\r\n\r\n  const handleToggleSachetIgnore = (id: string) => {\r\n    setSachetMassEntries(sachetMassEntries.map(entry =>\r\n      entry.id === id ? { ...entry, ignored: !entry.ignored } : entry\r\n    ));\r\n  };\r\n\r\n  // Handle Loose Cases Entry (cases not part of a full pallet)\r\n  const handleLooseCasesSubmit = () => {\r\n    if (looseCasesBatchInput && looseCasesBatchInput.length === 5 && looseCasesQuantityInput && looseCasesQuantityInput > 0) {\r\n      const newEntry: LooseCasesEntry = {\r\n        id: uuidv4(),\r\n        batchNumber: looseCasesBatchInput,\r\n        cases: Number(looseCasesQuantityInput),\r\n        timestamp: new Date()\r\n      };\r\n      setLooseCasesEntries([...looseCasesEntries, newEntry]);\r\n      setLooseCasesBatchInput('');\r\n      setLooseCasesQuantityInput('');\r\n      setShowLooseCasesModal(false);\r\n      showToast('Loose cases recorded', 'success');\r\n    } else if (looseCasesBatchInput.length !== 5) {\r\n      showToast('Batch number must be 5 digits', 'error');\r\n    }\r\n  };\r\n\r\n  const handleToggleLooseCasesIgnore = (id: string) => {\r\n    setLooseCasesEntries(looseCasesEntries.map(entry =>\r\n      entry.id === id ? { ...entry, ignored: !entry.ignored } : entry\r\n    ));\r\n  };\r\n\r\n  // Parse 13-digit QR code: BBBBBPPPPCCCC\r\n  // B = batch (5 digits), P = pallet number (4 digits), C = cases count (4 digits)\r\n  const parsePalletQRCode = (qrData: string): { batchNumber: string; palletNumber: string; casesCount: number } | null => {\r\n    // Remove any whitespace\r\n    const cleaned = qrData.trim();\r\n\r\n    // Check if it's exactly 13 digits\r\n    if (!/^\\d{13}$/.test(cleaned)) {\r\n      return null;\r\n    }\r\n\r\n    const casesCount = parseInt(cleaned.substring(9, 13), 10);\r\n\r\n    // Extra safety check for NaN (shouldn't happen given regex validation)\r\n    if (Number.isNaN(casesCount)) {\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      batchNumber: cleaned.substring(0, 5),    // First 5 digits\r\n      palletNumber: cleaned.substring(5, 9),   // Next 4 digits\r\n      casesCount\r\n    };\r\n  };\r\n\r\n  // Handle QR Code Pallet Scan\r\n  const handlePalletScan = (qrData: string) => {\r\n    const parsed = parsePalletQRCode(qrData);\r\n\r\n    if (!parsed) {\r\n      showToast('Invalid QR code format. Expected 13 digits: BBBBBPPPPCCCC', 'error');\r\n      return;\r\n    }\r\n\r\n    // Check for duplicate pallet scan (same QR code already scanned)\r\n    const isDuplicate = palletScanEntries.some(entry => entry.qrCode === qrData);\r\n    if (isDuplicate) {\r\n      showToast(`Pallet ${parsed.palletNumber} has already been scanned!`, 'error');\r\n      return;\r\n    }\r\n\r\n    const newEntry: PalletScanEntry = {\r\n      id: uuidv4(),\r\n      qrCode: qrData,\r\n      batchNumber: parsed.batchNumber,\r\n      palletNumber: parsed.palletNumber,\r\n      casesCount: parsed.casesCount,\r\n      timestamp: new Date()\r\n    };\r\n    setPalletScanEntries([...palletScanEntries, newEntry]);\r\n    showToast(`Pallet ${parsed.palletNumber} scanned (${parsed.casesCount} cases)`, 'success');\r\n  };\r\n\r\n  const handleTogglePalletIgnore = (id: string) => {\r\n    setPalletScanEntries(palletScanEntries.map(entry =>\r\n      entry.id === id ? { ...entry, ignored: !entry.ignored } : entry\r\n    ));\r\n  };\r\n\r\n  // Format timestamp for pallet scans\r\n  const formatScanTime = (timestamp: Date) => {\r\n    const date = new Date(timestamp);\r\n    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n  };\r\n\r\n  // Calculate totals for preview\r\n  const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n  const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"capture-screen-v2\"\r\n      initial={{ opacity: 0, x: 20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: -20 }}\r\n    >\r\n      {/* Loading Overlay */}\r\n      {isSubmitting && (\r\n        <div className=\"spinner-overlay-v2\">\r\n          <div className=\"spinner-v2\"></div>\r\n          <p>Submitting shift data...</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Toast Notification */}\r\n      {toast && (\r\n        <motion.div\r\n          className=\"toast-container-v2\"\r\n          initial={{ opacity: 0, y: -20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          exit={{ opacity: 0, y: -20 }}\r\n        >\r\n          <div className={`toast-message-v2 ${toast.type}`}>\r\n            <span className=\"toast-icon\">{toast.type === 'success' ? 'Γ£ô' : '!'}</span>\r\n            {toast.message}\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Header */}\r\n      <header className=\"capture-header-v2\">\r\n        <button className=\"back-btn-v2\" onClick={handleBack}>\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n            <path d=\"M19 12H5M12 19l-7-7 7-7\" />\r\n          </svg>\r\n          Back\r\n        </button>\r\n        <div className=\"capture-title-v2\">\r\n          <h1>{machineName}</h1>\r\n          <span className=\"capture-subtitle\">Recording Waste & Downtime</span>\r\n        </div>\r\n        <div className={`shift-badge-v2 ${shift.toLowerCase()}`}>\r\n          <span className=\"shift-icon\">{shift === 'Day' ? 'ΓùÉ' : 'Γùæ'}</span>\r\n          {shift} Shift\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"capture-main\">\r\n        {/* Left Column - Form */}\r\n        <div className=\"capture-form-column\">\r\n          <section className=\"form-section\">\r\n            <h2 className=\"section-heading\">\r\n              Shift Details\r\n              {isSessionLocked && <span className=\"locked-badge\">≡ƒöÆ Locked</span>}\r\n            </h2>\r\n\r\n            {/* Order Queue Selection */}\r\n            {!isSessionLocked && availableOrders.length > 0 && (\r\n              <div className=\"order-queue-select\">\r\n                <button\r\n                  className=\"select-order-btn\"\r\n                  onClick={() => setShowOrderSelect(true)}\r\n                >\r\n                  <span className=\"btn-icon\">≡ƒôï</span>\r\n                  Select from Order Queue ({availableOrders.length} available)\r\n                </button>\r\n                {orderNumber && (\r\n                  <span className=\"current-order-badge\">\r\n                    Current: {orderNumber}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"form-grid\">\r\n              <MainForm\r\n                operatorName={operatorName}\r\n                setOperatorName={isSessionLocked ? () => { } : setOperatorName}\r\n                machine={machineName}\r\n                setMachine={() => { }}\r\n                orderNumber={orderNumber}\r\n                setOrderNumber={isSessionLocked ? () => { } : setOrderNumber}\r\n                product={product}\r\n                setProduct={isSessionLocked ? () => { } : setProduct}\r\n                batchNumber={batchNumber}\r\n                setBatchNumber={isSessionLocked ? () => { } : setBatchNumber}\r\n                hideMachine={true}\r\n                disabled={isSessionLocked}\r\n              />\r\n              <ShiftInfo dateTime={dateTime} shift={shift} />\r\n            </div>\r\n\r\n            {/* Machine Speed in Shift Details */}\r\n            <div className=\"speed-setting\">\r\n              <div className=\"speed-display\">\r\n                <span className=\"speed-label\">ΓÜí Machine Speed</span>\r\n                <span className=\"speed-value\">\r\n                  {speedEntries.length > 0\r\n                    ? `${speedEntries[speedEntries.length - 1].speed} PPM`\r\n                    : 'Not Set'}\r\n                </span>\r\n                {speedEntries.length > 1 && (\r\n                  <span className=\"speed-history-count\" title=\"Speed change history\">\r\n                    ({speedEntries.length} changes)\r\n                  </span>\r\n                )}\r\n              </div>\r\n              <button\r\n                className=\"speed-change-btn\"\r\n                onClick={() => setShowSpeedModal(true)}\r\n              >\r\n                {speedEntries.length > 0 ? 'Change' : 'Set Speed'}\r\n              </button>\r\n            </div>\r\n\r\n            {!isSessionLocked && operatorName && orderNumber && product && batchNumber && (\r\n              <button\r\n                className=\"lock-session-btn\"\r\n                onClick={() => {\r\n                  saveSession(true);\r\n                  handleStartProduction();\r\n                }}\r\n              >\r\n                ≡ƒöÆ Lock Shift Details & Start Production\r\n              </button>\r\n            )}\r\n          </section>\r\n\r\n          {/* Machine Details Section - Production Timer */}\r\n          {isSessionLocked && (\r\n            <section className=\"form-section machine-details-section\">\r\n              <h2 className=\"section-heading\">\r\n                <span className=\"section-icon\">ΓÜÖ∩╕Å</span>\r\n                Machine Details\r\n                <span className={`production-status-badge ${productionState.isRunning ? 'running' : 'paused'}`}>\r\n                  {productionState.isRunning ? 'ΓùÅ Running' : 'Γùë Paused'}\r\n                </span>\r\n              </h2>\r\n\r\n              <div className=\"machine-details-grid\">\r\n                {/* Production Start Time */}\r\n                <div className=\"detail-card\">\r\n                  <span className=\"detail-label\">Production Started</span>\r\n                  <span className=\"detail-value\">\r\n                    {productionState.startTime\r\n                      ? productionState.startTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\r\n                      : '--:--'}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Run Time Timer */}\r\n                <div className=\"detail-card timer-card\">\r\n                  <span className=\"detail-label\">Run Time</span>\r\n                  <span className=\"detail-value timer-value\">{displayRunTime}</span>\r\n                </div>\r\n\r\n                {/* Pause/Continue Button */}\r\n                <div className=\"detail-card action-card\">\r\n                  {productionState.isRunning ? (\r\n                    <button\r\n                      className=\"pause-continue-btn pause\"\r\n                      onClick={handlePauseProduction}\r\n                    >\r\n                      <span className=\"btn-icon\">ΓÅ╕</span>\r\n                      Pause Production\r\n                    </button>\r\n                  ) : (\r\n                    <button\r\n                      className=\"pause-continue-btn continue\"\r\n                      onClick={() => setShowContinueModal(true)}\r\n                    >\r\n                      <span className=\"btn-icon\">Γû╢</span>\r\n                      Continue Production\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Pause Duration Display */}\r\n              {productionState.pausedAt && (\r\n                <div className=\"pause-duration-display\">\r\n                  <span className=\"pause-icon\">ΓÅ▒∩╕Å</span>\r\n                  Paused since {productionState.pausedAt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                </div>\r\n              )}\r\n            </section>\r\n          )}\r\n\r\n          {/* Waste Section - Button Based */}\r\n          <section className=\"form-section capture-section compact-capture waste-section\">\r\n            <h2 className=\"section-heading\">\r\n              <span className=\"section-icon\">≡ƒùæ∩╕Å</span>\r\n              Record Waste\r\n              {wasteEntries.length > 0 && (\r\n                <span className=\"entry-count-badge waste-badge\">{wasteEntries.length}</span>\r\n              )}\r\n            </h2>\r\n            <div className=\"capture-section-content\">\r\n              <button\r\n                className=\"capture-add-btn waste-btn\"\r\n                onClick={() => setShowWasteModal(true)}\r\n              >\r\n                <span className=\"btn-icon\">+</span>\r\n                Record Waste\r\n              </button>\r\n              {wasteEntries.length > 0 && (\r\n                <div className=\"capture-entries-list\">\r\n                  {wasteEntries.slice().reverse().map((entry, index) => (\r\n                    <div key={entry.id} className={`capture-entry-item waste-entry ${index === 0 ? 'latest' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"entry-value\">{entry.waste}</span>\r\n                        <span className=\"entry-unit\">kg</span>\r\n                      </div>\r\n                      <span className=\"entry-type\">{entry.wasteType}</span>\r\n                      <span className=\"entry-time\">\r\n                        {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                      </span>\r\n                      <button\r\n                        className=\"entry-delete-btn\"\r\n                        onClick={() => handleDeleteWasteEntry(entry.id)}\r\n                        title=\"Delete this entry\"\r\n                      >\r\n                        Γ£ò\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n              {wasteEntries.length > 0 && (\r\n                <div className=\"section-total\">\r\n                  <span>Total Waste:</span>\r\n                  <strong>{wasteEntries.reduce((sum, e) => sum + e.waste, 0).toFixed(1)} kg</strong>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </section>\r\n\r\n          {/* Downtime Section - Button Based */}\r\n          <section className=\"form-section capture-section compact-capture downtime-section\">\r\n            <h2 className=\"section-heading\">\r\n              <span className=\"section-icon\">ΓÅ▒∩╕Å</span>\r\n              Record Downtime\r\n              {downtimeEntries.length > 0 && (\r\n                <span className=\"entry-count-badge downtime-badge\">{downtimeEntries.length}</span>\r\n              )}\r\n            </h2>\r\n            <div className=\"capture-section-content\">\r\n              <button\r\n                className=\"capture-add-btn downtime-btn\"\r\n                onClick={() => setShowDowntimeModal(true)}\r\n              >\r\n                <span className=\"btn-icon\">+</span>\r\n                Record Downtime\r\n              </button>\r\n              {downtimeEntries.length > 0 && (\r\n                <div className=\"capture-entries-list\">\r\n                  {downtimeEntries.slice().reverse().map((entry, index) => (\r\n                    <div key={entry.id} className={`capture-entry-item downtime-entry ${index === 0 ? 'latest' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"entry-value\">{entry.downtime}</span>\r\n                        <span className=\"entry-unit\">min</span>\r\n                      </div>\r\n                      <span className=\"entry-reason\">{entry.downtimeReason}</span>\r\n                      <span className=\"entry-time\">\r\n                        {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                      </span>\r\n                      <button\r\n                        className=\"entry-delete-btn\"\r\n                        onClick={() => handleDeleteDowntimeEntry(entry.id)}\r\n                        title=\"Delete this entry\"\r\n                      >\r\n                        Γ£ò\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n              {downtimeEntries.length > 0 && (\r\n                <div className=\"section-total\">\r\n                  <span>Total Downtime:</span>\r\n                  <strong>{Math.floor(downtimeEntries.reduce((sum, e) => sum + e.downtime, 0) / 60)}h {downtimeEntries.reduce((sum, e) => sum + e.downtime, 0) % 60}m</strong>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </section>\r\n\r\n          {/* Sachet Mass Section */}\r\n          <section className=\"form-section capture-section compact-capture\">\r\n            <h2 className=\"section-heading\">\r\n              <span className=\"section-icon\">ΓÜû∩╕Å</span>\r\n              Sachet Mass\r\n            </h2>\r\n            <div className=\"capture-section-content\">\r\n              <button\r\n                className=\"capture-add-btn\"\r\n                onClick={() => setShowSachetModal(true)}\r\n              >\r\n                <span className=\"btn-icon\">+</span>\r\n                Record\r\n              </button>\r\n              {sachetMassEntries.length > 0 && (\r\n                <div className=\"capture-entries-list\">\r\n                  {sachetMassEntries.map(entry => (\r\n                    <div key={entry.id} className={`capture-entry-item ${entry.ignored ? 'ignored' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"entry-value\">{entry.mass}</span>\r\n                        <span className=\"entry-unit\">g</span>\r\n                      </div>\r\n                      <span className=\"entry-time\">\r\n                        {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                      </span>\r\n                      <button\r\n                        className={`entry-ignore-btn ${entry.ignored ? 'ignored' : ''}`}\r\n                        onClick={() => handleToggleSachetIgnore(entry.id)}\r\n                        title={entry.ignored ? 'Include this entry' : 'Ignore this entry'}\r\n                      >\r\n                        {entry.ignored ? 'Γå⌐' : 'Γèÿ'}\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </section>\r\n\r\n          {/* Product Confirmation Section - Pallets and Loose Cases */}\r\n          <section className=\"form-section capture-section product-confirmation-section\">\r\n            <h2 className=\"section-heading\">\r\n              <span className=\"section-icon\">≡ƒôª</span>\r\n              Product Confirmation\r\n              {(palletScanEntries.length > 0 || looseCasesEntries.length > 0) && (\r\n                <span className=\"entry-count-badge\">\r\n                  {palletScanEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.casesCount, 0) +\r\n                    looseCasesEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.cases, 0)} cases\r\n                </span>\r\n              )}\r\n            </h2>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"product-action-buttons\">\r\n              <button\r\n                className=\"capture-add-btn scan-btn\"\r\n                onClick={() => setShowQRScanner(true)}\r\n              >\r\n                <span className=\"btn-icon\">≡ƒô╖</span>\r\n                Scan Pallet\r\n              </button>\r\n              <button\r\n                className=\"capture-add-btn loose-cases-btn\"\r\n                onClick={() => setShowLooseCasesModal(true)}\r\n              >\r\n                <span className=\"btn-icon\">+</span>\r\n                Add Loose Cases\r\n              </button>\r\n            </div>\r\n\r\n            {/* Pallet Scans List */}\r\n            {palletScanEntries.length > 0 && (\r\n              <div className=\"product-entries-section\">\r\n                <h4 className=\"entries-subheading\">Scanned Pallets ({palletScanEntries.filter(e => !e.ignored).length})</h4>\r\n                <div className=\"capture-entries-list pallet-list\">\r\n                  {palletScanEntries.slice().reverse().map((entry, index) => (\r\n                    <div key={entry.id} className={`capture-entry-item pallet-entry ${entry.ignored ? 'ignored' : ''} ${index === 0 ? 'latest' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"pallet-badge\">P{entry.palletNumber}</span>\r\n                        <div className=\"pallet-details\">\r\n                          <span className=\"pallet-batch\">Batch: {entry.batchNumber}</span>\r\n                          <span className=\"pallet-cases\">{entry.casesCount} cases</span>\r\n                        </div>\r\n                      </div>\r\n                      <span className=\"entry-time\">\r\n                        {formatScanTime(entry.timestamp)}\r\n                      </span>\r\n                      <button\r\n                        className={`entry-ignore-btn ${entry.ignored ? 'ignored' : ''}`}\r\n                        onClick={() => handleTogglePalletIgnore(entry.id)}\r\n                        title={entry.ignored ? 'Include this pallet' : 'Ignore this pallet'}\r\n                      >\r\n                        {entry.ignored ? 'Γå⌐' : 'Γèÿ'}\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Loose Cases List */}\r\n            {looseCasesEntries.length > 0 && (\r\n              <div className=\"product-entries-section\">\r\n                <h4 className=\"entries-subheading\">Loose Cases ({looseCasesEntries.filter(e => !e.ignored).length})</h4>\r\n                <div className=\"capture-entries-list loose-cases-list\">\r\n                  {looseCasesEntries.slice().reverse().map((entry, index) => (\r\n                    <div key={entry.id} className={`capture-entry-item loose-entry ${entry.ignored ? 'ignored' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"loose-badge\">LC</span>\r\n                        <div className=\"loose-details\">\r\n                          <span className=\"loose-batch\">Batch: {entry.batchNumber}</span>\r\n                          <span className=\"loose-cases\">{entry.cases} cases</span>\r\n                        </div>\r\n                      </div>\r\n                      <span className=\"entry-time\">\r\n                        {formatScanTime(entry.timestamp)}\r\n                      </span>\r\n                      <button\r\n                        className={`entry-ignore-btn ${entry.ignored ? 'ignored' : ''}`}\r\n                        onClick={() => handleToggleLooseCasesIgnore(entry.id)}\r\n                        title={entry.ignored ? 'Include this entry' : 'Ignore this entry'}\r\n                      >\r\n                        {entry.ignored ? 'Γå⌐' : 'Γèÿ'}\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Summary */}\r\n            {(palletScanEntries.length > 0 || looseCasesEntries.length > 0) && (\r\n              <div className=\"product-summary\">\r\n                <div className=\"summary-item\">\r\n                  <span className=\"summary-label\">Total Pallets:</span>\r\n                  <span className=\"summary-value\">{palletScanEntries.filter(e => !e.ignored).length}</span>\r\n                </div>\r\n                <div className=\"summary-item\">\r\n                  <span className=\"summary-label\">Total Cases:</span>\r\n                  <span className=\"summary-value\">\r\n                    {palletScanEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.casesCount, 0) +\r\n                      looseCasesEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.cases, 0)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </section>\r\n        </div>\r\n\r\n        {/* Right Column - Summary & Charts */}\r\n        <div className=\"capture-summary-column\">\r\n          {/* Live Stats */}\r\n          <div className=\"live-stats-card\">\r\n            <h3>Session Totals</h3>\r\n            <div className=\"stats-grid\">\r\n              <div className=\"stat-box waste\">\r\n                <span className=\"stat-number\">{totalWaste.toFixed(1)}</span>\r\n                <span className=\"stat-unit\">kg waste</span>\r\n              </div>\r\n              <div className=\"stat-box downtime\">\r\n                <span className=\"stat-number\">{totalDowntime}</span>\r\n                <span className=\"stat-unit\">min downtime</span>\r\n              </div>\r\n              <div className=\"stat-box cases\">\r\n                <span className=\"stat-number\">\r\n                  {palletScanEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.casesCount, 0) +\r\n                    looseCasesEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.cases, 0)}\r\n                </span>\r\n                <span className=\"stat-unit\">cases</span>\r\n              </div>\r\n              <div className=\"stat-box pallets\">\r\n                <span className=\"stat-number\">{palletScanEntries.filter(e => !e.ignored).length}</span>\r\n                <span className=\"stat-unit\">pallets</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Charts */}\r\n          <div className=\"charts-card\">\r\n            <h3>Visual Summary</h3>\r\n            <DashboardCharts wasteEntries={wasteEntries} downtimeEntries={downtimeEntries} />\r\n          </div>\r\n\r\n          {/* Submission Preview */}\r\n          {(wasteEntries.length > 0 || downtimeEntries.length > 0) && (\r\n            <motion.div\r\n              className=\"submission-card\"\r\n              initial={{ opacity: 0, scale: 0.95 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n            >\r\n              <h3>Ready to Submit</h3>\r\n              <div className=\"submission-details\">\r\n                <div className=\"detail-row\">\r\n                  <span>Operator</span>\r\n                  <strong>{operatorName || 'ΓÇö'}</strong>\r\n                </div>\r\n                <div className=\"detail-row\">\r\n                  <span>Machine</span>\r\n                  <strong>{machineName}</strong>\r\n                </div>\r\n                <div className=\"detail-row\">\r\n                  <span>Order</span>\r\n                  <strong>{orderNumber || 'ΓÇö'}</strong>\r\n                </div>\r\n                <div className=\"detail-row highlight waste\">\r\n                  <span>Total Waste</span>\r\n                  <strong>{totalWaste.toFixed(1)} kg</strong>\r\n                </div>\r\n                <div className=\"detail-row highlight downtime\">\r\n                  <span>Total Downtime</span>\r\n                  <strong>{Math.floor(totalDowntime / 60)}h {totalDowntime % 60}m</strong>\r\n                </div>\r\n              </div>\r\n              <button\r\n                className={`submit-btn-v2 ${!isInSubmissionWindow ? 'early-submit' : ''}`}\r\n                onClick={handleSubmitClick}\r\n                disabled={isSubmitting || !operatorName || !orderNumber || !product || !batchNumber}\r\n              >\r\n                {isSubmitting ? (\r\n                  <>\r\n                    <span className=\"btn-spinner\"></span>\r\n                    Submitting...\r\n                  </>\r\n                ) : (\r\n                  'Finalize Submission'\r\n                )}\r\n              </button>\r\n              {!isInSubmissionWindow && (\r\n                <p className=\"submission-window-note\">\r\n                  ΓÜá∩╕Å Submitting early - you'll be asked about changeover\r\n                </p>\r\n              )}\r\n            </motion.div>\r\n          )}\r\n        </div>\r\n      </main>\r\n\r\n      {/* Confirmation Dialog */}\r\n      <ConfirmDialog\r\n        isOpen={showConfirmDialog}\r\n        title=\"Confirm Submission\"\r\n        message={`You are about to submit ${wasteEntries.length} waste entries and ${downtimeEntries.length} downtime entries for ${machineName}.${willChangeover !== null ? ` Changeover: ${willChangeover ? 'Yes' : 'No'}. Maintenance/Cleaning: ${willMaintenance ? 'Yes' : 'No'}.` : ''} This action cannot be undone.`}\r\n        confirmText=\"Submit\"\r\n        cancelText=\"Review\"\r\n        type=\"success\"\r\n        onConfirm={handleConfirmedSubmit}\r\n        onCancel={() => setShowConfirmDialog(false)}\r\n      />\r\n\r\n      {/* Changeover Dialog (shown when submitting outside window) */}\r\n      <AnimatePresence>\r\n        {showChangeoverDialog && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal changeover-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">ΓÜá∩╕Å</span>\r\n                Early Submission\r\n              </h3>\r\n              <p className=\"changeover-intro\">\r\n                You are submitting before the end of shift window. Please answer the following:\r\n              </p>\r\n\r\n              <div className=\"changeover-question\">\r\n                <label className=\"question-label\">\r\n                  Will there be a changeover to a new product and order?\r\n                </label>\r\n                <div className=\"question-options\">\r\n                  <button\r\n                    className={`option-btn ${willChangeover === true ? 'selected yes' : ''}`}\r\n                    onClick={() => setWillChangeover(true)}\r\n                  >\r\n                    Γ£ô Yes\r\n                  </button>\r\n                  <button\r\n                    className={`option-btn ${willChangeover === false ? 'selected no' : ''}`}\r\n                    onClick={() => setWillChangeover(false)}\r\n                  >\r\n                    Γ£ù No\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"changeover-question\">\r\n                <label className=\"question-label\">\r\n                  Will there be maintenance or cleaning before next production start?\r\n                </label>\r\n                <div className=\"question-options\">\r\n                  <button\r\n                    className={`option-btn ${willMaintenance === true ? 'selected yes' : ''}`}\r\n                    onClick={() => setWillMaintenance(true)}\r\n                  >\r\n                    Γ£ô Yes\r\n                  </button>\r\n                  <button\r\n                    className={`option-btn ${willMaintenance === false ? 'selected no' : ''}`}\r\n                    onClick={() => setWillMaintenance(false)}\r\n                  >\r\n                    Γ£ù No\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => setShowChangeoverDialog(false)}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleChangeoverConfirm}\r\n                  disabled={willChangeover === null || willMaintenance === null}\r\n                >\r\n                  Continue to Submit\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Shift Change Modal */}\r\n      <AnimatePresence>\r\n        {showShiftChangeModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal shift-change-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">≡ƒöä</span>\r\n                Shift Change Detected\r\n              </h3>\r\n              <p className=\"modal-description\">\r\n                The shift has changed to <strong>{shift}</strong> shift.\r\n                Please enter the new operator's name or number.\r\n              </p>\r\n              <div className=\"modal-form\">\r\n                <label className=\"modal-label\">New Operator Name/Number</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"modal-input\"\r\n                  placeholder=\"Enter operator name or number...\"\r\n                  value={newOperatorName}\r\n                  onChange={e => setNewOperatorName(e.target.value)}\r\n                  autoFocus\r\n                />\r\n              </div>\r\n              <div className=\"shift-change-info\">\r\n                <p><strong>Current Order:</strong> {orderNumber}</p>\r\n                <p><strong>Previous Operator:</strong> {operatorName}</p>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleShiftChangeConfirm}\r\n                  disabled={!newOperatorName.trim()}\r\n                >\r\n                  Confirm Operator Change\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Machine Speed Modal */}\r\n      <AnimatePresence>\r\n        {showSpeedModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowSpeedModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">ΓÜí</span>\r\n                Record Machine Speed\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <label className=\"modal-label\">Speed (PPM - Packs Per Minute)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  className=\"modal-input\"\r\n                  placeholder=\"Enter speed...\"\r\n                  value={speedInput}\r\n                  onChange={e => setSpeedInput(e.target.value ? Number(e.target.value) : '')}\r\n                  autoFocus\r\n                />\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => { setShowSpeedModal(false); setSpeedInput(''); }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleSpeedSubmit}\r\n                  disabled={!speedInput || speedInput <= 0}\r\n                >\r\n                  Confirm\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Sachet Mass Modal */}\r\n      <AnimatePresence>\r\n        {showSachetModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowSachetModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">ΓÜû∩╕Å</span>\r\n                Record Sachet Mass\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <label className=\"modal-label\">Mass (grams)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.1\"\r\n                  className=\"modal-input\"\r\n                  placeholder=\"Enter mass in grams...\"\r\n                  value={sachetMassInput}\r\n                  onChange={e => setSachetMassInput(e.target.value ? Number(e.target.value) : '')}\r\n                  autoFocus\r\n                />\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => { setShowSachetModal(false); setSachetMassInput(''); }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleSachetMassSubmit}\r\n                  disabled={!sachetMassInput || sachetMassInput <= 0}\r\n                >\r\n                  Confirm\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Waste Modal */}\r\n      <AnimatePresence>\r\n        {showWasteModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowWasteModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal waste-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">≡ƒùæ∩╕Å</span>\r\n                Record Waste\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Waste Type</label>\r\n                  <select\r\n                    className=\"modal-select\"\r\n                    value={wasteType}\r\n                    onChange={e => setWasteType(e.target.value)}\r\n                  >\r\n                    <option value=\"\">Select waste type...</option>\r\n                    {WASTE_TYPES.map(type => (\r\n                      <option key={type} value={type}>{type}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Weight (kg)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    step=\"0.1\"\r\n                    className=\"modal-input\"\r\n                    placeholder=\"Enter weight in kg...\"\r\n                    value={waste}\r\n                    onChange={e => setWaste(e.target.value ? Number(e.target.value) : '')}\r\n                    min={0}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => {\r\n                    setShowWasteModal(false);\r\n                    setWaste('');\r\n                    setWasteType('');\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm waste-confirm\"\r\n                  onClick={handleWasteSubmit}\r\n                  disabled={!waste || waste <= 0 || !wasteType}\r\n                >\r\n                  Add Waste Entry\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Downtime Modal */}\r\n      <AnimatePresence>\r\n        {showDowntimeModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowDowntimeModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal downtime-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">ΓÅ▒∩╕Å</span>\r\n                Record Downtime\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Downtime Reason</label>\r\n                  <select\r\n                    className=\"modal-select\"\r\n                    value={downtimeReason}\r\n                    onChange={e => setDowntimeReason(e.target.value)}\r\n                  >\r\n                    <option value=\"\">Select reason...</option>\r\n                    {DOWNTIME_REASONS.map(reason => (\r\n                      <option key={reason} value={reason}>{reason}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Duration (minutes)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    className=\"modal-input\"\r\n                    placeholder=\"Enter minutes...\"\r\n                    value={downtime}\r\n                    onChange={e => setDowntime(e.target.value ? Number(e.target.value) : '')}\r\n                    min={1}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => {\r\n                    setShowDowntimeModal(false);\r\n                    setDowntime('');\r\n                    setDowntimeReason('');\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm downtime-confirm\"\r\n                  onClick={handleDowntimeSubmit}\r\n                  disabled={!downtime || downtime <= 0 || !downtimeReason}\r\n                >\r\n                  Add Downtime Entry\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Continue Production Modal */}\r\n      <AnimatePresence>\r\n        {showContinueModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowContinueModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal continue-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">Γû╢</span>\r\n                Continue Production\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <div className=\"pause-info\">\r\n                  <span className=\"pause-duration-label\">Paused Duration:</span>\r\n                  <span className=\"pause-duration-value\">\r\n                    {productionState.pausedAt\r\n                      ? `${Math.ceil((Date.now() - productionState.pausedAt.getTime()) / 60000)} minutes`\r\n                      : '0 minutes'}\r\n                  </span>\r\n                </div>\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">What was the reason for this downtime?</label>\r\n                  <select\r\n                    className=\"modal-select\"\r\n                    value={pauseDowntimeReason}\r\n                    onChange={e => setPauseDowntimeReason(e.target.value)}\r\n                    autoFocus\r\n                  >\r\n                    <option value=\"\">Select reason...</option>\r\n                    {DOWNTIME_REASONS.map(reason => (\r\n                      <option key={reason} value={reason}>{reason}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => {\r\n                    setShowContinueModal(false);\r\n                    setPauseDowntimeReason('');\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm continue-confirm\"\r\n                  onClick={handleContinueProduction}\r\n                  disabled={!pauseDowntimeReason}\r\n                >\r\n                  Record & Continue\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Loose Cases Modal */}\r\n      <AnimatePresence>\r\n        {showLooseCasesModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowLooseCasesModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal loose-cases-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">≡ƒôª</span>\r\n                Add Loose Cases\r\n              </h3>\r\n              <p className=\"modal-description\">\r\n                Enter cases that are not part of a full pallet scan\r\n              </p>\r\n              <div className=\"modal-form\">\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Batch Number (5 digits)</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className=\"modal-input\"\r\n                    placeholder=\"e.g., 12345\"\r\n                    value={looseCasesBatchInput}\r\n                    onChange={e => {\r\n                      const value = e.target.value.replace(/\\D/g, '').slice(0, 5);\r\n                      setLooseCasesBatchInput(value);\r\n                    }}\r\n                    maxLength={5}\r\n                    autoFocus\r\n                  />\r\n                </div>\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Number of Cases</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    className=\"modal-input\"\r\n                    placeholder=\"Enter quantity...\"\r\n                    value={looseCasesQuantityInput}\r\n                    onChange={e => setLooseCasesQuantityInput(e.target.value ? Number(e.target.value) : '')}\r\n                    min={1}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => {\r\n                    setShowLooseCasesModal(false);\r\n                    setLooseCasesBatchInput('');\r\n                    setLooseCasesQuantityInput('');\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleLooseCasesSubmit}\r\n                  disabled={looseCasesBatchInput.length !== 5 || !looseCasesQuantityInput || looseCasesQuantityInput <= 0}\r\n                >\r\n                  Add Cases\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* QR Scanner for Pallet Scans */}\r\n      <QRScanner\r\n        isOpen={showQRScanner}\r\n        onClose={() => setShowQRScanner(false)}\r\n        onScan={handlePalletScan}\r\n        recentScans={palletScanEntries.map(e => e.qrCode)}\r\n      />\r\n\r\n      {/* Order Queue Selection Modal */}\r\n      <AnimatePresence>\r\n        {showOrderSelect && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowOrderSelect(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal order-select-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\">≡ƒôï</span>\r\n                Select Order\r\n              </h3>\r\n              <p className=\"modal-description\">\r\n                Choose an order from the queue (sorted by priority)\r\n              </p>\r\n              <div className=\"order-queue-list\">\r\n                {availableOrders.map((order, index) => (\r\n                  <button\r\n                    key={order.id}\r\n                    className={`order-queue-item ${orderNumber === order.order_number ? 'selected' : ''}`}\r\n                    onClick={() => handleOrderSelect(order)}\r\n                  >\r\n                    <span className=\"order-priority\">#{index + 1}</span>\r\n                    <div className=\"order-details\">\r\n                      <span className=\"order-number\">{order.order_number}</span>\r\n                      <span className=\"order-product\">{order.product}</span>\r\n                      <span className=\"order-batch\">Batch: {order.batch_number}</span>\r\n                    </div>\r\n                    {orderNumber === order.order_number && (\r\n                      <span className=\"order-selected-badge\">Γ£ô</span>\r\n                    )}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => setShowOrderSelect(false)}\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default CaptureScreen;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\pages\\Dashboard.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":105,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":105,"endColumn":25,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[4421,4478],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":149,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":149,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5647,5708],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":152,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":152,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[5818,5903],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":155,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":155,"endColumn":27,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"warn"},"fix":{"range":[5975,6043],"text":""},"desc":"Remove the console.warn()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":160,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":160,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[6119,6165],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":171,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":171,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6434,6512],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":177,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":177,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[6713,6789],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { format } from 'date-fns';\r\nimport {\r\n  AreaChart, Area, XAxis, YAxis, ResponsiveContainer, Tooltip,\r\n  PieChart, Pie, Cell\r\n} from 'recharts';\r\nimport { getMachinesData, getTodayStats, getShiftHistory, initializeMachines, subscribeToMachineUpdates, maybeRunCleanup, retryFailedSubmissions, getFailedSubmissions } from '../lib/storage';\r\nimport { fetchActiveSessions, subscribeToSessionChanges, LiveSession } from '../lib/liveSession';\r\nimport { Machine, ShiftData } from '../types';\r\nimport MachineSettingsModal from '../components/MachineSettingsModal';\r\nimport SubMachineModal from '../components/SubMachineModal';\r\n\r\n// Animated number component\r\nconst AnimatedNumber: React.FC<{ value: number; decimals?: number; suffix?: string }> = ({\r\n  value, decimals = 0, suffix = ''\r\n}) => {\r\n  const [displayValue, setDisplayValue] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const duration = 1000;\r\n    const steps = 30;\r\n    const increment = value / steps;\r\n    let current = 0;\r\n\r\n    const timer = setInterval(() => {\r\n      current += increment;\r\n      if (current >= value) {\r\n        setDisplayValue(value);\r\n        clearInterval(timer);\r\n      } else {\r\n        setDisplayValue(current);\r\n      }\r\n    }, duration / steps);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [value]);\r\n\r\n  return <>{displayValue.toFixed(decimals)}{suffix}</>;\r\n};\r\n\r\n// Pulse animation for live indicator\r\nconst PulseIndicator: React.FC<{ color: string }> = ({ color }) => (\r\n  <span className=\"pulse-indicator\">\r\n    <span className=\"pulse-dot\" style={{ backgroundColor: color }}></span>\r\n    <span className=\"pulse-ring\" style={{ borderColor: color }}></span>\r\n  </span>\r\n);\r\n\r\nconst Dashboard: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n  const [shift, setShift] = useState('');\r\n  const [machines, setMachines] = useState<Machine[]>([]);\r\n  const [todayStats, setTodayStats] = useState({ totalWaste: 0, totalDowntime: 0, submissionCount: 0 });\r\n  const [recentHistory, setRecentHistory] = useState<ShiftData[]>([]);\r\n  const [selectedView, setSelectedView] = useState<'grid' | 'list'>('grid');\r\n  const [showSettings, setShowSettings] = useState(false);\r\n  const [selectedMachineForSub, setSelectedMachineForSub] = useState<Machine | null>(null);\r\n  const [, setIsLoading] = useState(true); // Used only for setting, UI shows content after load\r\n  const [multiSelectMode, setMultiSelectMode] = useState(false);\r\n  const [selectedMachines, setSelectedMachines] = useState<string[]>([]);\r\n  const [activeSessions, setActiveSessions] = useState<LiveSession[]>([]);\r\n  const longPressTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n  const LONG_PRESS_DURATION = 500; // ms\r\n\r\n  // Cleanup long-press timer on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (longPressTimerRef.current) {\r\n        clearTimeout(longPressTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Helper function to detect active sub-machine sessions from Supabase (with localStorage fallback)\r\n  const getActiveSubMachines = useCallback((machineName: string, subMachineCount: number): Set<number> => {\r\n    const activeSet = new Set<number>();\r\n\r\n    // Check Supabase sessions first\r\n    for (let i = 1; i <= subMachineCount; i++) {\r\n      const fullName = `${machineName} - Machine ${i}`;\r\n      const isActive = activeSessions.some(s => s.machine_name === fullName && s.is_locked);\r\n      if (isActive) {\r\n        activeSet.add(i);\r\n      }\r\n    }\r\n\r\n    // If no Supabase sessions, fallback to localStorage (offline mode)\r\n    if (activeSet.size === 0) {\r\n      const today = new Date().toISOString().split('T')[0];\r\n      const hours = new Date().getUTCHours() + 2;\r\n      const currentShift = hours >= 6 && hours < 18 ? 'Day' : 'Night';\r\n\r\n      for (let i = 1; i <= subMachineCount; i++) {\r\n        const fullName = `${machineName} - Machine ${i}`;\r\n        const sessionKey = `shift_session_${fullName}_${currentShift}_${today}`;\r\n        const session = localStorage.getItem(sessionKey);\r\n        if (session) {\r\n          try {\r\n            const parsed = JSON.parse(session);\r\n            if (parsed.locked) activeSet.add(i);\r\n          } catch (e) {\r\n            console.warn(`Invalid session data for ${fullName}:`, e);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return activeSet;\r\n  }, [activeSessions]);\r\n\r\n  const loadData = useCallback(() => {\r\n    const machineData = getMachinesData();\r\n    setMachines(machineData);\r\n\r\n    const stats = getTodayStats();\r\n    setTodayStats(stats);\r\n\r\n    const history = getShiftHistory().slice(0, 7);\r\n    setRecentHistory(history);\r\n  }, []);\r\n\r\n  // Initialize machines from Supabase on mount\r\n  useEffect(() => {\r\n    const init = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        // Run daily cleanup if needed\r\n        maybeRunCleanup();\r\n\r\n        const machineData = await initializeMachines();\r\n        setMachines(machineData);\r\n\r\n        const stats = getTodayStats();\r\n        setTodayStats(stats);\r\n\r\n        const history = getShiftHistory().slice(0, 7);\r\n        setRecentHistory(history);\r\n\r\n        // Fetch active sessions from Supabase for cross-browser sync\r\n        const sessions = await fetchActiveSessions();\r\n        setActiveSessions(sessions);\r\n\r\n        // Retry any failed submissions in background\r\n        const failedCount = getFailedSubmissions().length;\r\n        if (failedCount > 0) {\r\n          console.log(`Retrying ${failedCount} failed submissions...`);\r\n          retryFailedSubmissions().then(result => {\r\n            if (result.succeeded > 0) {\r\n              console.log(`Successfully synced ${result.succeeded} previously failed submissions`);\r\n            }\r\n            if (result.remaining > 0) {\r\n              console.warn(`${result.remaining} submissions still pending retry`);\r\n            }\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to initialize:', error);\r\n        loadData(); // Fallback to localStorage\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    init();\r\n\r\n    // Subscribe to real-time machine updates\r\n    const unsubscribeMachines = subscribeToMachineUpdates((updatedMachines) => {\r\n      console.log('Real-time update received:', updatedMachines.length, 'machines');\r\n      setMachines(updatedMachines);\r\n    });\r\n\r\n    // Subscribe to real-time session updates for cross-browser sync\r\n    const unsubscribeSessions = subscribeToSessionChanges((sessions) => {\r\n      console.log('Session update received:', sessions.length, 'active sessions');\r\n      setActiveSessions(sessions);\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeMachines();\r\n      unsubscribeSessions();\r\n    };\r\n  }, [loadData]);\r\n\r\n  // Update time every second - no dependencies to avoid infinite recreation\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      const now = new Date();\r\n      setCurrentTime(now);\r\n      // Update shift based on current time\r\n      const hours = now.getUTCHours() + 2;\r\n      setShift(hours >= 6 && hours < 18 ? 'Day' : 'Night');\r\n    }, 1000);\r\n\r\n    // Set initial shift\r\n    const initialHours = new Date().getUTCHours() + 2;\r\n    setShift(initialHours >= 6 && initialHours < 18 ? 'Day' : 'Night');\r\n\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  const handleMachineClick = (machine: Machine) => {\r\n    if (machine.status === 'maintenance') return;\r\n\r\n    // If machine has sub-machines, show the selection modal\r\n    if (machine.subMachineCount && machine.subMachineCount > 0) {\r\n      setSelectedMachineForSub(machine);\r\n    } else {\r\n      navigate(`/capture/${machine.id}`, { state: { machineName: machine.name } });\r\n    }\r\n  };\r\n\r\n  const handleSubMachineSelect = (machine: Machine, subMachineNumber: number, isActive: boolean) => {\r\n    const fullName = `${machine.name} - Machine ${subMachineNumber}`;\r\n\r\n    // Note: isActive is for visual display only - machine is still clickable to continue session\r\n\r\n    if (multiSelectMode) {\r\n      // Only allow selection from the same parent group\r\n      if (selectedMachines.length > 0) {\r\n        const firstSelectedParent = selectedMachines[0].split(' - ')[0];\r\n        if (machine.name !== firstSelectedParent) {\r\n          // Different group - don't allow\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Toggle selection\r\n      setSelectedMachines(prev =>\r\n        prev.includes(fullName)\r\n          ? prev.filter(m => m !== fullName)\r\n          : [...prev, fullName]\r\n      );\r\n    } else {\r\n      // Direct navigation\r\n      navigate(`/capture/${machine.id}`, {\r\n        state: {\r\n          machineName: fullName,\r\n          parentMachine: machine.name,\r\n          subMachineNumber: subMachineNumber\r\n        }\r\n      });\r\n    }\r\n    setSelectedMachineForSub(null);\r\n  };\r\n\r\n  const handleStartMultiCapture = () => {\r\n    if (selectedMachines.length === 0) return;\r\n\r\n    // Extract parent group from first selected machine\r\n    const parentGroup = selectedMachines[0].split(' - ')[0];\r\n\r\n    navigate(`/capture/multi`, {\r\n      state: {\r\n        machineNames: selectedMachines,\r\n        parentGroup: parentGroup,\r\n        isMultiMachine: true\r\n      }\r\n    });\r\n  };\r\n\r\n  // Long-press handlers for entering multi-select mode\r\n  const handleLongPressStart = (machine: Machine, subMachineNumber: number, isActive: boolean) => {\r\n    // isActive is kept for future use but doesn't block interaction\r\n    const fullName = `${machine.name} - Machine ${subMachineNumber}`;\r\n\r\n    longPressTimerRef.current = setTimeout(() => {\r\n      // Enter multi-select mode and select this machine\r\n      setMultiSelectMode(true);\r\n      setSelectedMachines([fullName]);\r\n    }, LONG_PRESS_DURATION);\r\n  };\r\n\r\n  const handleLongPressEnd = () => {\r\n    if (longPressTimerRef.current) {\r\n      clearTimeout(longPressTimerRef.current);\r\n      longPressTimerRef.current = null;\r\n    }\r\n  };\r\n\r\n  const cancelMultiSelect = () => {\r\n    setMultiSelectMode(false);\r\n    setSelectedMachines([]);\r\n  };\r\n\r\n  // Get the parent group of currently selected machines (for highlighting)\r\n  const selectedParentGroup = selectedMachines.length > 0\r\n    ? selectedMachines[0].split(' - ')[0]\r\n    : null;\r\n\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'running': return '#10b981';\r\n      case 'idle': return '#f59e0b';\r\n      case 'maintenance': return '#ef4444';\r\n      default: return '#64748b';\r\n    }\r\n  };\r\n\r\n  const getStatusGradient = (status: string) => {\r\n    switch (status) {\r\n      case 'running': return 'linear-gradient(135deg, #10b981 0%, #059669 100%)';\r\n      case 'idle': return 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';\r\n      case 'maintenance': return 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';\r\n      default: return 'linear-gradient(135deg, #64748b 0%, #475569 100%)';\r\n    }\r\n  };\r\n\r\n  // Calculate efficiency (mock calculation - running / total * 100)\r\n  const efficiency = useMemo(() => {\r\n    const running = machines.filter(m => m.status === 'running').length;\r\n    const total = machines.filter(m => m.status !== 'maintenance').length;\r\n    return total > 0 ? Math.round((running / total) * 100) : 0;\r\n  }, [machines]);\r\n\r\n  // Chart data\r\n  const trendData = useMemo(() => {\r\n    return recentHistory.map((item) => ({\r\n      name: format(new Date(item.date), 'EEE'),\r\n      waste: item.totalWaste,\r\n      downtime: item.totalDowntime / 60, // convert to hours\r\n    })).reverse();\r\n  }, [recentHistory]);\r\n\r\n  const statusData = useMemo(() => [\r\n    { name: 'Running', value: machines.filter(m => m.status === 'running').length, color: '#10b981' },\r\n    { name: 'Idle', value: machines.filter(m => m.status === 'idle').length, color: '#f59e0b' },\r\n    { name: 'Maintenance', value: machines.filter(m => m.status === 'maintenance').length, color: '#ef4444' },\r\n  ].filter(d => d.value > 0), [machines]);\r\n\r\n  const runningCount = machines.filter(m => m.status === 'running').length;\r\n  const idleCount = machines.filter(m => m.status === 'idle').length;\r\n  const maintenanceCount = machines.filter(m => m.status === 'maintenance').length;\r\n\r\n  return (\r\n    <div className=\"dashboard-v2\">\r\n      {/* Top Navigation Bar */}\r\n      <header className=\"top-nav\">\r\n        <div className=\"nav-brand\">\r\n          <div className=\"brand-icon\">\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\" />\r\n            </svg>\r\n          </div>\r\n          <div className=\"brand-text\">\r\n            <span className=\"brand-name\">Production Control</span>\r\n            <span className=\"brand-subtitle\">Waste & Downtime Tracking</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"nav-center\">\r\n          <div className=\"live-clock\">\r\n            <PulseIndicator color=\"#10b981\" />\r\n            <span className=\"clock-time\">{format(currentTime, 'HH:mm:ss')}</span>\r\n            <span className=\"clock-date\">{format(currentTime, 'dd MMM yyyy')}</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"nav-actions\">\r\n          <div className={`shift-indicator ${shift.toLowerCase()}`}>\r\n            <span className=\"shift-icon\">{shift === 'Day' ? 'ΓùÉ' : 'Γùæ'}</span>\r\n            <span className=\"shift-text\">{shift} Shift</span>\r\n          </div>\r\n          <button className=\"nav-btn admin-btn\" onClick={() => navigate('/admin')}>\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n              <path d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n            </svg>\r\n            Admin\r\n          </button>\r\n          <button className=\"nav-btn\" onClick={() => navigate('/history')}>\r\n            History\r\n          </button>\r\n          <button className=\"nav-btn settings-btn\" onClick={() => setShowSettings(true)}>\r\n            <svg className=\"settings-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"3\" />\r\n              <path d=\"M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83\" />\r\n            </svg>\r\n            <span className=\"settings-text\">Settings</span>\r\n          </button>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Machine Settings Modal */}\r\n      <MachineSettingsModal\r\n        isOpen={showSettings}\r\n        onClose={() => setShowSettings(false)}\r\n        onMachinesUpdated={loadData}\r\n      />\r\n\r\n      {/* Sub-Machine Selection Modal */}\r\n      <SubMachineModal\r\n        isOpen={!!selectedMachineForSub}\r\n        machine={selectedMachineForSub}\r\n        onClose={() => setSelectedMachineForSub(null)}\r\n        onSelectSubMachine={handleSubMachineSelect}\r\n        activeSubMachines={selectedMachineForSub ? getActiveSubMachines(selectedMachineForSub.name, selectedMachineForSub.subMachineCount || 0) : new Set()}\r\n      />\r\n\r\n      <main className=\"dashboard-main\">\r\n        {/* Left Panel - Stats */}\r\n        <aside className=\"stats-panel\">\r\n          {/* Efficiency Gauge */}\r\n          <div className=\"efficiency-card\">\r\n            <div className=\"efficiency-ring\">\r\n              <svg viewBox=\"0 0 120 120\">\r\n                <circle cx=\"60\" cy=\"60\" r=\"50\" className=\"ring-bg\" />\r\n                <circle\r\n                  cx=\"60\" cy=\"60\" r=\"50\"\r\n                  className=\"ring-progress\"\r\n                  strokeDasharray={`${efficiency * 3.14} 314`}\r\n                  style={{ stroke: efficiency > 70 ? '#10b981' : efficiency > 40 ? '#f59e0b' : '#ef4444' }}\r\n                />\r\n              </svg>\r\n              <div className=\"efficiency-value\">\r\n                <AnimatedNumber value={efficiency} suffix=\"%\" />\r\n              </div>\r\n            </div>\r\n            <span className=\"efficiency-label\">Line Efficiency</span>\r\n          </div>\r\n\r\n          {/* Quick Stats */}\r\n          <div className=\"quick-stats\">\r\n            <div className=\"stat-item running\">\r\n              <div className=\"stat-indicator\"></div>\r\n              <div className=\"stat-info\">\r\n                <span className=\"stat-value\">{runningCount}</span>\r\n                <span className=\"stat-label\">Running</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"stat-item idle\">\r\n              <div className=\"stat-indicator\"></div>\r\n              <div className=\"stat-info\">\r\n                <span className=\"stat-value\">{idleCount}</span>\r\n                <span className=\"stat-label\">Idle</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"stat-item maintenance\">\r\n              <div className=\"stat-indicator\"></div>\r\n              <div className=\"stat-info\">\r\n                <span className=\"stat-value\">{maintenanceCount}</span>\r\n                <span className=\"stat-label\">Maintenance</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Today's Metrics */}\r\n          <div className=\"metrics-section\">\r\n            <h3 className=\"section-title\">Today's Performance</h3>\r\n            <div className=\"metric-block waste\">\r\n              <div className=\"metric-header\">\r\n                <span className=\"metric-icon\">Γùå</span>\r\n                <span>Total Waste</span>\r\n              </div>\r\n              <div className=\"metric-value\">\r\n                <AnimatedNumber value={todayStats.totalWaste} decimals={1} suffix=\" kg\" />\r\n              </div>\r\n              <div className=\"metric-bar\">\r\n                <div className=\"bar-fill\" style={{ width: `${Math.min(todayStats.totalWaste / 100 * 100, 100)}%` }}></div>\r\n              </div>\r\n            </div>\r\n            <div className=\"metric-block downtime\">\r\n              <div className=\"metric-header\">\r\n                <span className=\"metric-icon\">Γùç</span>\r\n                <span>Total Downtime</span>\r\n              </div>\r\n              <div className=\"metric-value\">\r\n                {Math.floor(todayStats.totalDowntime / 60)}h {todayStats.totalDowntime % 60}m\r\n              </div>\r\n              <div className=\"metric-bar\">\r\n                <div className=\"bar-fill\" style={{ width: `${Math.min(todayStats.totalDowntime / 480 * 100, 100)}%` }}></div>\r\n              </div>\r\n            </div>\r\n            <div className=\"metric-block entries\">\r\n              <div className=\"metric-header\">\r\n                <span className=\"metric-icon\">Γùê</span>\r\n                <span>Submissions</span>\r\n              </div>\r\n              <div className=\"metric-value\">\r\n                <AnimatedNumber value={todayStats.submissionCount} suffix=\" entries\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Mini Chart */}\r\n          {trendData.length > 0 && (\r\n            <div className=\"trend-chart\">\r\n              <h3 className=\"section-title\">7-Day Trend</h3>\r\n              <ResponsiveContainer width=\"100%\" height={120}>\r\n                <AreaChart data={trendData}>\r\n                  <defs>\r\n                    <linearGradient id=\"wasteGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                      <stop offset=\"0%\" stopColor=\"#ef4444\" stopOpacity={0.3} />\r\n                      <stop offset=\"100%\" stopColor=\"#ef4444\" stopOpacity={0} />\r\n                    </linearGradient>\r\n                  </defs>\r\n                  <XAxis dataKey=\"name\" tick={{ fontSize: 10, fill: '#94a3b8' }} axisLine={false} tickLine={false} />\r\n                  <YAxis hide />\r\n                  <Tooltip\r\n                    contentStyle={{\r\n                      background: '#1e293b',\r\n                      border: 'none',\r\n                      borderRadius: '8px',\r\n                      fontSize: '12px'\r\n                    }}\r\n                  />\r\n                  <Area type=\"monotone\" dataKey=\"waste\" stroke=\"#ef4444\" fill=\"url(#wasteGradient)\" strokeWidth={2} />\r\n                </AreaChart>\r\n              </ResponsiveContainer>\r\n            </div>\r\n          )}\r\n        </aside>\r\n\r\n        {/* Main Content - Machine Grid */}\r\n        <section className={`machines-section ${multiSelectMode ? 'multi-select-mode' : ''}`}>\r\n          <div className=\"section-header\">\r\n            <h2>\r\n              Production Lines\r\n              {multiSelectMode && <span className=\"multi-select-hint\"> ΓÇö Hold to select machines</span>}\r\n            </h2>\r\n            <div className=\"header-actions\">\r\n              {multiSelectMode && (\r\n                <button\r\n                  className=\"cancel-select-btn\"\r\n                  onClick={cancelMultiSelect}\r\n                >\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n                    <path d=\"M18 6L6 18M6 6l12 12\" />\r\n                  </svg>\r\n                  Cancel\r\n                </button>\r\n              )}\r\n              <div className=\"view-toggle\">\r\n                <button\r\n                  className={selectedView === 'grid' ? 'active' : ''}\r\n                  onClick={() => setSelectedView('grid')}\r\n                >\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"18\" height=\"18\">\r\n                    <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                    <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                    <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                    <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  className={selectedView === 'list' ? 'active' : ''}\r\n                  onClick={() => setSelectedView('list')}\r\n                >\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"18\" height=\"18\">\r\n                    <rect x=\"3\" y=\"4\" width=\"18\" height=\"4\" rx=\"1\" />\r\n                    <rect x=\"3\" y=\"10\" width=\"18\" height=\"4\" rx=\"1\" />\r\n                    <rect x=\"3\" y=\"16\" width=\"18\" height=\"4\" rx=\"1\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <AnimatePresence mode=\"wait\">\r\n            {selectedView === 'grid' ? (\r\n              <motion.div\r\n                key=\"grid\"\r\n                className=\"machines-grid-v2\"\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n              >\r\n                {machines.map((machine, index) => {\r\n                  // Machine is running if status is 'running' OR has a current order\r\n                  const isRunning = machine.status === 'running' || !!machine.currentOrder;\r\n                  const isBlocked = isRunning || machine.status === 'maintenance';\r\n                  const displayStatus = isRunning ? 'running' : machine.status;\r\n                  const activeSubMachines = machine.subMachineCount && machine.subMachineCount > 0\r\n                    ? getActiveSubMachines(machine.name, machine.subMachineCount)\r\n                    : new Set<number>();\r\n\r\n                  const handleTileClick = () => {\r\n                    if (machine.subMachineCount && machine.subMachineCount > 0) return;\r\n                    // Allow access to running machines (to continue session)\r\n                    handleMachineClick(machine);\r\n                  };\r\n\r\n                  return (\r\n                    <motion.div\r\n                      key={machine.id}\r\n                      className={`machine-tile ${displayStatus} ${isBlocked ? 'disabled' : ''} ${machine.subMachineCount && machine.subMachineCount > 0 ? 'has-sub-machines' : ''}`}\r\n                      initial={{ opacity: 0, scale: 0.9 }}\r\n                      animate={{ opacity: 1, scale: 1 }}\r\n                      transition={{ delay: index * 0.05 }}\r\n                      onClick={handleTileClick}\r\n                      whileHover={!isBlocked && !(machine.subMachineCount && machine.subMachineCount > 0) ? { scale: 1.02, y: -4 } : {}}\r\n                      whileTap={!isBlocked && !(machine.subMachineCount && machine.subMachineCount > 0) ? { scale: 0.98 } : {}}\r\n                    >\r\n                      <div\r\n                        className=\"tile-glow\"\r\n                        style={{ background: getStatusGradient(displayStatus) }}\r\n                      />\r\n                      <div className=\"tile-content\">\r\n                        <div className=\"tile-header\">\r\n                          <span className=\"tile-name\">{machine.name}</span>\r\n                          <div className=\"tile-status\">\r\n                            <PulseIndicator color={getStatusColor(displayStatus)} />\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"tile-status-text\">\r\n                          {isRunning ? 'Running' : machine.status.charAt(0).toUpperCase() + machine.status.slice(1)}\r\n                          {machine.subMachineCount && machine.subMachineCount > 0 && (\r\n                            <span className=\"sub-count-badge\">\r\n                              {activeSubMachines.size > 0\r\n                                ? `${activeSubMachines.size}/${machine.subMachineCount} active`\r\n                                : `${machine.subMachineCount} units`}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* Show current order if running */}\r\n                        {isRunning && machine.currentOrder && (\r\n                          <div className=\"tile-order\">Order: {machine.currentOrder}</div>\r\n                        )}\r\n\r\n                        {machine.currentOperator && (\r\n                          <div className=\"tile-operator\">{machine.currentOperator}</div>\r\n                        )}\r\n\r\n                        {/* Inline sub-machine selection */}\r\n                        {machine.subMachineCount && machine.subMachineCount > 0 && machine.status !== 'maintenance' ? (\r\n                          <div className=\"sub-machine-inline-grid\">\r\n                            {Array.from({ length: machine.subMachineCount }, (_, i) => i + 1).map(num => {\r\n                              const fullName = `${machine.name} - Machine ${num}`;\r\n                              const isActive = activeSubMachines.has(num);\r\n                              const isSelected = selectedMachines.includes(fullName);\r\n                              const isOtherGroup = Boolean(multiSelectMode && selectedParentGroup && selectedParentGroup !== machine.name);\r\n                              // Only disable for other-group, NOT for isActive (reserved machines are still clickable)\r\n                              const isDisabled = isOtherGroup;\r\n\r\n                              return (\r\n                                <motion.button\r\n                                  key={num}\r\n                                  className={`sub-machine-inline-btn ${isActive ? 'busy' : ''} ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}`}\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    handleSubMachineSelect(machine, num, isActive);\r\n                                  }}\r\n                                  onMouseDown={() => handleLongPressStart(machine, num, isActive)}\r\n                                  onMouseUp={handleLongPressEnd}\r\n                                  onMouseLeave={handleLongPressEnd}\r\n                                  onTouchStart={() => handleLongPressStart(machine, num, isActive)}\r\n                                  onTouchEnd={handleLongPressEnd}\r\n                                  whileHover={!isDisabled ? { scale: 1.1 } : {}}\r\n                                  whileTap={!isDisabled ? { scale: 0.95 } : {}}\r\n                                  title={isActive ? 'In Use - Click to continue' : (isOtherGroup ? 'Different group' : (multiSelectMode ? 'Tap to select' : 'Hold to multi-select'))}\r\n                                  disabled={isDisabled}\r\n                                >\r\n                                  {num}\r\n                                  {isActive && <span className=\"status-dot busy\" />}\r\n                                  {isSelected && <span className=\"check-mark\">Γ£ô</span>}\r\n                                </motion.button>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"tile-footer\">\r\n                            <span className=\"tile-time\">{machine.lastSubmission || 'No entries'}</span>\r\n                            {machine.status !== 'maintenance' && (\r\n                              <span className=\"tile-action\">Record ΓåÆ</span>\r\n                            )}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </motion.div>\r\n                  );\r\n                })}\r\n              </motion.div>\r\n            ) : (\r\n              <motion.div\r\n                key=\"list\"\r\n                className=\"machines-list\"\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n              >\r\n                {machines.map((machine, index) => (\r\n                  <motion.div\r\n                    key={machine.id}\r\n                    className={`machine-row ${machine.status} ${machine.status === 'maintenance' ? 'disabled' : ''}`}\r\n                    initial={{ opacity: 0, x: -20 }}\r\n                    animate={{ opacity: 1, x: 0 }}\r\n                    transition={{ delay: index * 0.03 }}\r\n                    onClick={() => handleMachineClick(machine)}\r\n                  >\r\n                    <div className=\"row-indicator\" style={{ background: getStatusGradient(machine.status) }} />\r\n                    <div className=\"row-name\">{machine.name}</div>\r\n                    <div className=\"row-status\">\r\n                      <PulseIndicator color={getStatusColor(machine.status)} />\r\n                      <span>{machine.status.charAt(0).toUpperCase() + machine.status.slice(1)}</span>\r\n                    </div>\r\n                    <div className=\"row-operator\">{machine.currentOperator || 'ΓÇö'}</div>\r\n                    <div className=\"row-time\">{machine.lastSubmission || 'No entries'}</div>\r\n                    {machine.status !== 'maintenance' && (\r\n                      <button className=\"row-action\">Record</button>\r\n                    )}\r\n                  </motion.div>\r\n                ))}\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {/* Multi-Select Floating Action Bar */}\r\n          <AnimatePresence>\r\n            {multiSelectMode && selectedMachines.length > 0 && (\r\n              <motion.div\r\n                className=\"multi-select-bar\"\r\n                initial={{ opacity: 0, y: 50 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: 50 }}\r\n              >\r\n                <div className=\"selection-info\">\r\n                  <span className=\"selection-parent-group\">{selectedParentGroup}</span>\r\n                  <span className=\"selection-divider\">ΓÇö</span>\r\n                  <span className=\"selection-machines\">\r\n                    {selectedMachines.map(m => m.split(' - Machine ')[1]).join(', ')}\r\n                  </span>\r\n                </div>\r\n                <button\r\n                  className=\"start-capture-btn\"\r\n                  onClick={handleStartMultiCapture}\r\n                >\r\n                  Start Recording ({selectedMachines.length})\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n                    <path d=\"M5 12h14M12 5l7 7-7 7\" />\r\n                  </svg>\r\n                </button>\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n        </section>\r\n\r\n        {/* Right Panel - Status Overview */}\r\n        <aside className=\"overview-panel\">\r\n          <div className=\"status-donut\">\r\n            <h3 className=\"section-title\">Machine Status</h3>\r\n            <ResponsiveContainer width=\"100%\" height={180}>\r\n              <PieChart>\r\n                <Pie\r\n                  data={statusData}\r\n                  cx=\"50%\"\r\n                  cy=\"50%\"\r\n                  innerRadius={50}\r\n                  outerRadius={70}\r\n                  paddingAngle={4}\r\n                  dataKey=\"value\"\r\n                >\r\n                  {statusData.map((entry, index) => (\r\n                    <Cell key={index} fill={entry.color} />\r\n                  ))}\r\n                </Pie>\r\n                <Tooltip\r\n                  contentStyle={{\r\n                    background: '#1e293b',\r\n                    border: 'none',\r\n                    borderRadius: '8px',\r\n                    fontSize: '12px'\r\n                  }}\r\n                />\r\n              </PieChart>\r\n            </ResponsiveContainer>\r\n            <div className=\"donut-legend\">\r\n              {statusData.map((item, index) => (\r\n                <div key={index} className=\"legend-item\">\r\n                  <span className=\"legend-dot\" style={{ backgroundColor: item.color }}></span>\r\n                  <span className=\"legend-label\">{item.name}</span>\r\n                  <span className=\"legend-value\">{item.value}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Recent Activity */}\r\n          <div className=\"recent-activity\">\r\n            <h3 className=\"section-title\">Recent Submissions</h3>\r\n            <div className=\"activity-list\">\r\n              {recentHistory.slice(0, 5).map((item, index) => (\r\n                <motion.div\r\n                  key={item.id || index}\r\n                  className=\"activity-item\"\r\n                  initial={{ opacity: 0, y: 10 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ delay: index * 0.1 }}\r\n                >\r\n                  <div className=\"activity-icon\">\r\n                    <span className=\"icon-dot\"></span>\r\n                  </div>\r\n                  <div className=\"activity-details\">\r\n                    <span className=\"activity-machine\">{item.machine}</span>\r\n                    <span className=\"activity-meta\">\r\n                      {item.totalWaste.toFixed(1)}kg waste ┬╖ {item.totalDowntime}m downtime\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"activity-time\">\r\n                    {format(new Date(item.submittedAt), 'HH:mm')}\r\n                  </div>\r\n                </motion.div>\r\n              ))}\r\n              {recentHistory.length === 0 && (\r\n                <div className=\"activity-empty\">No recent activity</div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </aside>\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\pages\\HistoryPage.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":125,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":125,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[4131,4175],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { format, subDays, startOfDay, endOfDay } from 'date-fns';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  useReactTable,\r\n  getCoreRowModel,\r\n  getSortedRowModel,\r\n  getFilteredRowModel,\r\n  getPaginationRowModel,\r\n  flexRender,\r\n  SortingState,\r\n  ColumnDef,\r\n} from '@tanstack/react-table';\r\nimport { ShiftData } from '../types';\r\nimport { getShiftHistory, exportToCSV } from '../lib/storage';\r\nimport { getRecentSubmissions } from '../lib/supabase';\r\n\r\n// Type definitions for Supabase response\r\ninterface WasteRecordResponse {\r\n  id: number;\r\n  waste_amount: number;\r\n  waste_type: string;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface DowntimeRecordResponse {\r\n  id: number;\r\n  downtime_minutes: number;\r\n  downtime_reason: string;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface SubmissionResponse {\r\n  id: number;\r\n  operator_name: string;\r\n  machine: string;\r\n  order_number: string;\r\n  product: string;\r\n  batch_number: string;\r\n  shift: string;\r\n  submission_date: string;\r\n  total_waste?: number;\r\n  total_downtime?: number;\r\n  created_at: string;\r\n  waste_records?: WasteRecordResponse[];\r\n  downtime_records?: DowntimeRecordResponse[];\r\n}\r\n\r\nconst HistoryPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [data, setData] = useState<ShiftData[]>([]);\r\n  const [sorting, setSorting] = useState<SortingState>([{ id: 'submittedAt', desc: true }]);\r\n  const [globalFilter, setGlobalFilter] = useState('');\r\n  const [dateRange, setDateRange] = useState<'today' | 'week' | 'month' | 'all'>('all');\r\n  const [dataSource, setDataSource] = useState<'local' | 'database'>('database');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Transform Supabase submission to ShiftData\r\n  const transformSubmission = useCallback((sub: SubmissionResponse): ShiftData => ({\r\n    id: sub.id.toString(),\r\n    operatorName: sub.operator_name,\r\n    machine: sub.machine,\r\n    orderNumber: sub.order_number,\r\n    product: sub.product,\r\n    batchNumber: sub.batch_number,\r\n    shift: sub.shift,\r\n    date: sub.submission_date,\r\n    wasteEntries: (sub.waste_records || []).map((w: WasteRecordResponse) => ({\r\n      id: w.id.toString(),\r\n      waste: w.waste_amount,\r\n      wasteType: w.waste_type,\r\n      timestamp: new Date(w.recorded_at || w.created_at || Date.now()),\r\n    })),\r\n    downtimeEntries: (sub.downtime_records || []).map((d: DowntimeRecordResponse) => ({\r\n      id: d.id.toString(),\r\n      downtime: d.downtime_minutes,\r\n      downtimeReason: d.downtime_reason,\r\n      timestamp: new Date(d.recorded_at || d.created_at || Date.now()),\r\n    })),\r\n    totalWaste: sub.total_waste || 0,\r\n    totalDowntime: sub.total_downtime || 0,\r\n    submittedAt: new Date(sub.created_at),\r\n  }), []);\r\n\r\n  const loadData = useCallback(async () => {\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      let history: ShiftData[] = [];\r\n\r\n      if (dataSource === 'database') {\r\n        // Fetch from Supabase\r\n        const submissions = await getRecentSubmissions(100) as SubmissionResponse[];\r\n        history = submissions.map(transformSubmission);\r\n      } else {\r\n        // Fetch from localStorage\r\n        history = getShiftHistory();\r\n      }\r\n\r\n      const now = new Date();\r\n      switch (dateRange) {\r\n        case 'today':\r\n          const todayStart = startOfDay(now);\r\n          const todayEnd = endOfDay(now);\r\n          history = history.filter(item => {\r\n            const itemDate = new Date(item.submittedAt);\r\n            return itemDate >= todayStart && itemDate <= todayEnd;\r\n          });\r\n          break;\r\n        case 'week':\r\n          const weekAgo = subDays(now, 7);\r\n          history = history.filter(item => new Date(item.submittedAt) >= weekAgo);\r\n          break;\r\n        case 'month':\r\n          const monthAgo = subDays(now, 30);\r\n          history = history.filter(item => new Date(item.submittedAt) >= monthAgo);\r\n          break;\r\n      }\r\n\r\n      setData(history);\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n      // Fallback to local storage if database fails\r\n      if (dataSource === 'database') {\r\n        setDataSource('local');\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [dataSource, dateRange, transformSubmission]);\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, [loadData]);\r\n\r\n  const columns = useMemo<ColumnDef<ShiftData>[]>(() => [\r\n    {\r\n      accessorKey: 'date',\r\n      header: 'Date',\r\n      cell: info => format(new Date(info.getValue() as string), 'MMM dd, yyyy'),\r\n    },\r\n    {\r\n      accessorKey: 'shift',\r\n      header: 'Shift',\r\n      cell: info => (\r\n        <span className={`shift-tag ${(info.getValue() as string).toLowerCase()}`}>\r\n          {info.getValue() as string}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      accessorKey: 'operatorName',\r\n      header: 'Operator',\r\n    },\r\n    {\r\n      accessorKey: 'machine',\r\n      header: 'Machine',\r\n    },\r\n    {\r\n      accessorKey: 'orderNumber',\r\n      header: 'Order',\r\n    },\r\n    {\r\n      accessorKey: 'totalWaste',\r\n      header: 'Waste (kg)',\r\n      cell: info => (\r\n        <span className=\"waste-value\">{(info.getValue() as number).toFixed(1)}</span>\r\n      ),\r\n    },\r\n    {\r\n      accessorKey: 'totalDowntime',\r\n      header: 'Downtime',\r\n      cell: info => {\r\n        const mins = info.getValue() as number;\r\n        const hours = Math.floor(mins / 60);\r\n        const remainingMins = mins % 60;\r\n        return (\r\n          <span className=\"downtime-value\">\r\n            {hours > 0 ? `${hours}h ` : ''}{remainingMins}m\r\n          </span>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      accessorKey: 'submittedAt',\r\n      header: 'Submitted',\r\n      cell: info => format(new Date(info.getValue() as Date), 'HH:mm'),\r\n    },\r\n  ], []);\r\n\r\n  const table = useReactTable({\r\n    data,\r\n    columns,\r\n    state: {\r\n      sorting,\r\n      globalFilter,\r\n    },\r\n    onSortingChange: setSorting,\r\n    onGlobalFilterChange: setGlobalFilter,\r\n    getCoreRowModel: getCoreRowModel(),\r\n    getSortedRowModel: getSortedRowModel(),\r\n    getFilteredRowModel: getFilteredRowModel(),\r\n    getPaginationRowModel: getPaginationRowModel(),\r\n    initialState: {\r\n      pagination: {\r\n        pageSize: 10,\r\n      },\r\n    },\r\n  });\r\n\r\n  const handleExport = () => {\r\n    const filename = `shift_history_${format(new Date(), 'yyyy-MM-dd')}`;\r\n    exportToCSV(data, filename);\r\n  };\r\n\r\n  // Calculate summary stats\r\n  const stats = useMemo(() => {\r\n    const totalWaste = data.reduce((sum, item) => sum + item.totalWaste, 0);\r\n    const totalDowntime = data.reduce((sum, item) => sum + item.totalDowntime, 0);\r\n    const avgWaste = data.length > 0 ? totalWaste / data.length : 0;\r\n    const avgDowntime = data.length > 0 ? totalDowntime / data.length : 0;\r\n    \r\n    return { totalWaste, totalDowntime, avgWaste, avgDowntime, count: data.length };\r\n  }, [data]);\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"history-page-v2\"\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n    >\r\n      {/* Header */}\r\n      <header className=\"history-header-v2\">\r\n        <div className=\"header-left-v2\">\r\n          <button className=\"back-btn-v2\" onClick={() => navigate('/')}>\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M19 12H5M12 19l-7-7 7-7\"/>\r\n            </svg>\r\n            Back\r\n          </button>\r\n          <div className=\"header-titles\">\r\n            <h1>Submission History</h1>\r\n            <span className=\"header-subtitle\">\r\n              {isLoading ? 'Loading...' : `${data.length} records from ${dataSource === 'database' ? 'Supabase' : 'Local Storage'}`}\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div className=\"header-actions-v2\">\r\n          <button \r\n            className=\"export-btn-v2\" \r\n            onClick={handleExport} \r\n            disabled={data.length === 0}\r\n          >\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3\"/>\r\n            </svg>\r\n            Export CSV\r\n          </button>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"history-main\">\r\n        {/* Filters */}\r\n        <div className=\"history-filters-v2\">\r\n          <div className=\"filter-group-v2\">\r\n            <label>Data Source</label>\r\n            <div className=\"filter-pills\">\r\n              <button\r\n                className={`filter-pill ${dataSource === 'database' ? 'active' : ''}`}\r\n                onClick={() => setDataSource('database')}\r\n              >\r\n                Γÿü∩╕Å Database\r\n              </button>\r\n              <button\r\n                className={`filter-pill ${dataSource === 'local' ? 'active' : ''}`}\r\n                onClick={() => setDataSource('local')}\r\n              >\r\n                ≡ƒÆ╛ Local\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div className=\"filter-group-v2\">\r\n            <label>Time Period</label>\r\n            <div className=\"filter-pills\">\r\n              {(['today', 'week', 'month', 'all'] as const).map(range => (\r\n                <button\r\n                  key={range}\r\n                  className={`filter-pill ${dateRange === range ? 'active' : ''}`}\r\n                  onClick={() => setDateRange(range)}\r\n                >\r\n                  {range === 'today' ? 'Today' : range === 'week' ? '7 Days' : range === 'month' ? '30 Days' : 'All Time'}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          <div className=\"filter-group-v2 search-group\">\r\n            <label>Search</label>\r\n            <div className=\"search-input-wrapper\">\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n                <path d=\"M21 21l-4.35-4.35\"/>\r\n              </svg>\r\n              <input\r\n                type=\"text\"\r\n                className=\"search-input-v2\"\r\n                placeholder=\"Search operator, machine, order...\"\r\n                value={globalFilter}\r\n                onChange={e => setGlobalFilter(e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Summary */}\r\n        <div className=\"history-stats-v2\">\r\n          <div className=\"stat-card-v2\">\r\n            <span className=\"stat-value-v2\">{stats.count}</span>\r\n            <span className=\"stat-label-v2\">Submissions</span>\r\n          </div>\r\n          <div className=\"stat-card-v2 waste\">\r\n            <span className=\"stat-value-v2\">{stats.totalWaste.toFixed(1)}<small>kg</small></span>\r\n            <span className=\"stat-label-v2\">Total Waste</span>\r\n          </div>\r\n          <div className=\"stat-card-v2 downtime\">\r\n            <span className=\"stat-value-v2\">{Math.floor(stats.totalDowntime / 60)}h {stats.totalDowntime % 60}m</span>\r\n            <span className=\"stat-label-v2\">Total Downtime</span>\r\n          </div>\r\n          <div className=\"stat-card-v2\">\r\n            <span className=\"stat-value-v2\">{stats.avgWaste.toFixed(1)}<small>kg</small></span>\r\n            <span className=\"stat-label-v2\">Avg per Shift</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Data Table */}\r\n        <div className=\"history-table-container-v2\">\r\n          {data.length === 0 ? (\r\n            <div className=\"empty-state-v2\">\r\n              <div className=\"empty-icon\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\r\n                  <path d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"/>\r\n                </svg>\r\n              </div>\r\n              <h3>No submissions found</h3>\r\n              <p>There are no shift submissions for the selected time period.</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <div className=\"table-wrapper\">\r\n                <table className=\"history-table-v2\">\r\n                  <thead>\r\n                    {table.getHeaderGroups().map(headerGroup => (\r\n                      <tr key={headerGroup.id}>\r\n                        {headerGroup.headers.map(header => (\r\n                          <th\r\n                            key={header.id}\r\n                            onClick={header.column.getToggleSortingHandler()}\r\n                            className={header.column.getCanSort() ? 'sortable' : ''}\r\n                          >\r\n                            <div className=\"th-content\">\r\n                              {flexRender(header.column.columnDef.header, header.getContext())}\r\n                              {header.column.getIsSorted() && (\r\n                                <span className=\"sort-indicator\">\r\n                                  {header.column.getIsSorted() === 'asc' ? 'Γåæ' : 'Γåô'}\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          </th>\r\n                        ))}\r\n                      </tr>\r\n                    ))}\r\n                  </thead>\r\n                  <tbody>\r\n                    <AnimatePresence>\r\n                      {table.getRowModel().rows.map(row => (\r\n                        <motion.tr\r\n                          key={row.id}\r\n                          initial={{ opacity: 0, y: -10 }}\r\n                          animate={{ opacity: 1, y: 0 }}\r\n                          exit={{ opacity: 0, y: 10 }}\r\n                        >\r\n                          {row.getVisibleCells().map(cell => (\r\n                            <td key={cell.id}>\r\n                              {flexRender(cell.column.columnDef.cell, cell.getContext())}\r\n                            </td>\r\n                          ))}\r\n                        </motion.tr>\r\n                      ))}\r\n                    </AnimatePresence>\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n\r\n              {/* Pagination */}\r\n              <div className=\"table-pagination-v2\">\r\n                <div className=\"pagination-info-v2\">\r\n                  Showing {table.getState().pagination.pageIndex * table.getState().pagination.pageSize + 1} to{' '}\r\n                  {Math.min(\r\n                    (table.getState().pagination.pageIndex + 1) * table.getState().pagination.pageSize,\r\n                    data.length\r\n                  )}{' '}\r\n                  of {data.length} entries\r\n                </div>\r\n                <div className=\"pagination-controls-v2\">\r\n                  <button\r\n                    className=\"page-btn\"\r\n                    onClick={() => table.previousPage()}\r\n                    disabled={!table.getCanPreviousPage()}\r\n                  >\r\n                    ΓåÉ Previous\r\n                  </button>\r\n                  <span className=\"page-indicator-v2\">\r\n                    {table.getState().pagination.pageIndex + 1} / {table.getPageCount()}\r\n                  </span>\r\n                  <button\r\n                    className=\"page-btn\"\r\n                    onClick={() => table.nextPage()}\r\n                    disabled={!table.getCanNextPage()}\r\n                  >\r\n                    Next ΓåÆ\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </main>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default HistoryPage;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\pages\\MultiCaptureScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OPERATORS' is defined but never used.","line":7,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":71},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":277,"column":13,"nodeType":"MemberExpression","messageId":"unexpected","endLine":277,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[11043,11085],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport ShiftInfo from '../components/ShiftInfo';\r\nimport ConfirmDialog from '../components/ConfirmDialog';\r\nimport { WasteEntry, DowntimeEntry, ShiftData, ShiftSession, OPERATORS, WASTE_TYPES, DOWNTIME_REASONS } from '../types';\r\nimport { submitShiftData } from '../lib/supabase';\r\nimport { saveShiftData } from '../lib/storage';\r\n\r\n// Storage key for shift session\r\nconst getSessionKey = (machineName: string, shift: string, date: string) =>\r\n    `shift_session_${machineName}_${shift}_${date}`;\r\n\r\n// Interface for per-machine data\r\ninterface MachineData {\r\n    machineName: string;\r\n    operatorName: string;\r\n    speed: number | '';\r\n}\r\n\r\nconst MultiCaptureScreen: React.FC = () => {\r\n    const location = useLocation();\r\n    const navigate = useNavigate();\r\n\r\n    // Get machine names from navigation state - memoized to prevent re-renders\r\n    const machineNames = useMemo(() =>\r\n        (location.state as { machineNames?: string[] })?.machineNames || [],\r\n        [location.state]\r\n    );\r\n    const parentGroup = (location.state as { parentGroup?: string })?.parentGroup || '';\r\n    const isMultiMachine = (location.state as { isMultiMachine?: boolean })?.isMultiMachine || false;\r\n\r\n    // Extract machine numbers for display (e.g., \"1, 2\" from \"Canline - Machine 1, Canline - Machine 2\")\r\n    const machineNumbers = useMemo(() =>\r\n        machineNames.map(name => name.split(' - Machine ')[1] || '?').join(', '),\r\n        [machineNames]\r\n    );\r\n\r\n    // Redirect if no machines selected\r\n    useEffect(() => {\r\n        if (!isMultiMachine || machineNames.length === 0) {\r\n            navigate('/');\r\n        }\r\n    }, [isMultiMachine, machineNames, navigate]);\r\n\r\n    // Track current machine(s) for chat widget location context\r\n    useEffect(() => {\r\n        if (parentGroup && machineNumbers) {\r\n            localStorage.setItem('chat_current_machine', `${parentGroup} - Machine ${machineNumbers}`);\r\n        }\r\n        return () => {\r\n            localStorage.removeItem('chat_current_machine');\r\n        };\r\n    }, [parentGroup, machineNumbers]);\r\n\r\n\r\n    const [dateTime, setDateTime] = useState(new Date());\r\n    const [shift, setShift] = useState('');\r\n\r\n    // Loading and feedback states\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\r\n    const [showConfirmDialog, setShowConfirmDialog] = useState(false);\r\n\r\n    // Per-machine data: operator and speed for each machine\r\n    const [machineDataList, setMachineDataList] = useState<MachineData[]>(\r\n        machineNames.map(name => ({ machineName: name, operatorName: '', speed: '' }))\r\n    );\r\n\r\n    // Shared order details\r\n    const [orderNumber, setOrderNumber] = useState('');\r\n    const [product, setProduct] = useState('');\r\n    const [batchNumber, setBatchNumber] = useState('');\r\n    const [isSessionLocked, setIsSessionLocked] = useState(false);\r\n\r\n    // Shared waste and downtime entries (apply to all machines)\r\n    const [wasteEntries, setWasteEntries] = useState<WasteEntry[]>([]);\r\n    const [downtimeEntries, setDowntimeEntries] = useState<DowntimeEntry[]>([]);\r\n\r\n    // Modal states\r\n    const [showWasteModal, setShowWasteModal] = useState(false);\r\n    const [showDowntimeModal, setShowDowntimeModal] = useState(false);\r\n    const [waste, setWaste] = useState<number | ''>('');\r\n    const [wasteType, setWasteType] = useState('');\r\n    const [downtime, setDowntime] = useState<number | ''>('');\r\n    const [downtimeReason, setDowntimeReason] = useState('');\r\n\r\n    // Toast notification\r\n    const showToast = (message: string, type: 'success' | 'error') => {\r\n        setToast({ message, type });\r\n        setTimeout(() => setToast(null), 4000);\r\n    };\r\n\r\n    // Update shift and time\r\n    useEffect(() => {\r\n        const timer = setInterval(() => {\r\n            const now = new Date();\r\n            setDateTime(now);\r\n        }, 1000);\r\n\r\n        const hours = dateTime.getUTCHours() + 2;\r\n        setShift(hours >= 6 && hours < 18 ? 'Day' : 'Night');\r\n\r\n        return () => clearInterval(timer);\r\n    }, [dateTime]);\r\n\r\n    // Update a specific machine's data\r\n    const updateMachineData = (index: number, field: keyof MachineData, value: string | number) => {\r\n        setMachineDataList(prev => {\r\n            const updated = [...prev];\r\n            updated[index] = { ...updated[index], [field]: value };\r\n            return updated;\r\n        });\r\n    };\r\n\r\n    // Check if all machines have operators assigned\r\n    const allMachinesHaveOperators = machineDataList.every(m => m.operatorName !== '');\r\n    const canLockSession = allMachinesHaveOperators && orderNumber && product && batchNumber;\r\n\r\n    // Lock session\r\n    const handleLockSession = () => {\r\n        if (!canLockSession) {\r\n            showToast('Please fill in all required fields', 'error');\r\n            return;\r\n        }\r\n\r\n        // Save session for each machine\r\n        const currentDate = new Date().toISOString().split('T')[0];\r\n        const hours = new Date().getUTCHours() + 2;\r\n        const currentShift = hours >= 6 && hours < 18 ? 'Day' : 'Night';\r\n\r\n        machineDataList.forEach(machineData => {\r\n            const sessionKey = getSessionKey(machineData.machineName, currentShift, currentDate);\r\n            const session: ShiftSession = {\r\n                machineName: machineData.machineName,\r\n                operatorName: machineData.operatorName,\r\n                orderNumber,\r\n                product,\r\n                batchNumber,\r\n                shift: currentShift,\r\n                date: currentDate,\r\n                locked: true,\r\n                wasteEntries,\r\n                downtimeEntries,\r\n                speedEntries: machineData.speed ? [{ id: uuidv4(), speed: Number(machineData.speed), timestamp: new Date() }] : [],\r\n            };\r\n            localStorage.setItem(sessionKey, JSON.stringify(session));\r\n        });\r\n\r\n        setIsSessionLocked(true);\r\n        showToast('Sessions locked for all machines', 'success');\r\n    };\r\n\r\n    // Handle Waste Entry\r\n    const handleWasteSubmit = () => {\r\n        if (waste && wasteType) {\r\n            const newEntry: WasteEntry = {\r\n                id: uuidv4(),\r\n                waste: Number(waste),\r\n                wasteType,\r\n                timestamp: new Date()\r\n            };\r\n            setWasteEntries([...wasteEntries, newEntry]);\r\n            setWaste('');\r\n            setWasteType('');\r\n            setShowWasteModal(false);\r\n            showToast('Waste entry added', 'success');\r\n        }\r\n    };\r\n\r\n    // Handle Downtime Entry\r\n    const handleDowntimeSubmit = () => {\r\n        if (downtime && downtimeReason) {\r\n            const newEntry: DowntimeEntry = {\r\n                id: uuidv4(),\r\n                downtime: Number(downtime),\r\n                downtimeReason,\r\n                timestamp: new Date()\r\n            };\r\n            setDowntimeEntries([...downtimeEntries, newEntry]);\r\n            setDowntime('');\r\n            setDowntimeReason('');\r\n            setShowDowntimeModal(false);\r\n            showToast('Downtime entry added', 'success');\r\n        }\r\n    };\r\n\r\n    const handleDeleteWasteEntry = (id: string) => {\r\n        setWasteEntries(wasteEntries.filter(entry => entry.id !== id));\r\n        showToast('Entry removed', 'success');\r\n    };\r\n\r\n    const handleDeleteDowntimeEntry = (id: string) => {\r\n        setDowntimeEntries(downtimeEntries.filter(entry => entry.id !== id));\r\n        showToast('Entry removed', 'success');\r\n    };\r\n\r\n    // Submit all machines\r\n    const handleSubmitClick = () => {\r\n        if (!isSessionLocked) {\r\n            showToast('Please lock session details first', 'error');\r\n            return;\r\n        }\r\n\r\n        if (wasteEntries.length === 0 && downtimeEntries.length === 0) {\r\n            showToast('Please add at least one waste or downtime entry', 'error');\r\n            return;\r\n        }\r\n\r\n        setShowConfirmDialog(true);\r\n    };\r\n\r\n    const handleConfirmedSubmit = async () => {\r\n        setShowConfirmDialog(false);\r\n        setIsSubmitting(true);\r\n\r\n        const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n        const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n        try {\r\n            // Submit for each machine\r\n            for (const machineData of machineDataList) {\r\n                const shiftData: ShiftData = {\r\n                    id: uuidv4(),\r\n                    operatorName: machineData.operatorName,\r\n                    machine: machineData.machineName,\r\n                    orderNumber,\r\n                    product,\r\n                    batchNumber,\r\n                    shift,\r\n                    date: dateTime.toISOString().split('T')[0],\r\n                    wasteEntries,\r\n                    downtimeEntries,\r\n                    speedEntries: machineData.speed ? [{ id: uuidv4(), speed: Number(machineData.speed), timestamp: new Date() }] : [],\r\n                    totalWaste,\r\n                    totalDowntime,\r\n                    submittedAt: new Date()\r\n                };\r\n\r\n                // Save to local storage\r\n                saveShiftData(shiftData);\r\n\r\n                // Submit to Supabase\r\n                await submitShiftData(\r\n                    {\r\n                        operator_name: machineData.operatorName,\r\n                        machine: machineData.machineName,\r\n                        order_number: orderNumber,\r\n                        product,\r\n                        batch_number: batchNumber,\r\n                        shift,\r\n                        submission_date: dateTime.toISOString().split('T')[0],\r\n                        is_early_submission: false,\r\n                    },\r\n                    wasteEntries.map(e => ({ waste: e.waste, wasteType: e.wasteType, timestamp: e.timestamp })),\r\n                    downtimeEntries.map(e => ({ downtime: e.downtime, downtimeReason: e.downtimeReason, timestamp: e.timestamp })),\r\n                    machineData.speed ? [{ speed: Number(machineData.speed), timestamp: new Date() }] : [],\r\n                    [],\r\n                    [],\r\n                    []\r\n                );\r\n            }\r\n\r\n            showToast(`Submitted for ${machineDataList.length} machines`, 'success');\r\n\r\n            // Clear sessions\r\n            const currentDate = new Date().toISOString().split('T')[0];\r\n            const hours = new Date().getUTCHours() + 2;\r\n            const currentShift = hours >= 6 && hours < 18 ? 'Day' : 'Night';\r\n            machineDataList.forEach(m => {\r\n                localStorage.removeItem(getSessionKey(m.machineName, currentShift, currentDate));\r\n            });\r\n\r\n            setTimeout(() => navigate('/'), 2000);\r\n        } catch (error) {\r\n            console.error('Submission error:', error);\r\n            showToast('Saved locally. Database sync failed.', 'error');\r\n            setTimeout(() => navigate('/'), 2000);\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const handleBack = () => {\r\n        navigate('/');\r\n    };\r\n\r\n    // Calculate totals\r\n    const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n    const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n    return (\r\n        <motion.div\r\n            className=\"capture-screen-v2 multi-capture\"\r\n            initial={{ opacity: 0, x: 20 }}\r\n            animate={{ opacity: 1, x: 0 }}\r\n            exit={{ opacity: 0, x: -20 }}\r\n        >\r\n            {/* Loading Overlay */}\r\n            {isSubmitting && (\r\n                <div className=\"spinner-overlay-v2\">\r\n                    <div className=\"spinner-v2\"></div>\r\n                    <p>Submitting for {machineDataList.length} machines...</p>\r\n                </div>\r\n            )}\r\n\r\n            {/* Toast Notification */}\r\n            {toast && (\r\n                <motion.div\r\n                    className=\"toast-container-v2\"\r\n                    initial={{ opacity: 0, y: -20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    exit={{ opacity: 0, y: -20 }}\r\n                >\r\n                    <div className={`toast-message-v2 ${toast.type}`}>\r\n                        <span className=\"toast-icon\">{toast.type === 'success' ? 'Γ£ô' : '!'}</span>\r\n                        {toast.message}\r\n                    </div>\r\n                </motion.div>\r\n            )}\r\n\r\n            {/* Confirm Dialog */}\r\n            <ConfirmDialog\r\n                isOpen={showConfirmDialog}\r\n                title=\"Submit for All Machines?\"\r\n                message={`This will submit data for ${machineDataList.length} machines:\\n${machineDataList.map(m => m.machineName).join(', ')}`}\r\n                onConfirm={handleConfirmedSubmit}\r\n                onCancel={() => setShowConfirmDialog(false)}\r\n            />\r\n\r\n            {/* Header */}\r\n            <header className=\"capture-header-v2\">\r\n                <button className=\"back-btn-v2\" onClick={handleBack}>\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                        <path d=\"M19 12H5M12 19l-7-7 7-7\" />\r\n                    </svg>\r\n                    Back\r\n                </button>\r\n                <div className=\"capture-title-v2\">\r\n                    <h1>{parentGroup} ΓÇö Machine {machineNumbers}</h1>\r\n                    <span className=\"capture-subtitle\">Recording for {machineDataList.length} machines</span>\r\n                </div>\r\n                <div className={`shift-badge-v2 ${shift.toLowerCase()}`}>\r\n                    <span className=\"shift-icon\">{shift === 'Day' ? 'ΓùÉ' : 'Γùæ'}</span>\r\n                    {shift} Shift\r\n                </div>\r\n            </header>\r\n\r\n            <main className=\"capture-main multi-capture-main\">\r\n                {/* Left Column - Machine-Specific Data */}\r\n                <div className=\"capture-form-column\">\r\n                    <section className=\"form-section\">\r\n                        <h2 className=\"section-heading\">\r\n                            Machine Assignments\r\n                            {isSessionLocked && <span className=\"locked-badge\">≡ƒöÆ Locked</span>}\r\n                        </h2>\r\n\r\n                        <div className=\"multi-machine-grid\">\r\n                            {machineDataList.map((machineData, index) => (\r\n                                <div key={machineData.machineName} className=\"machine-card\">\r\n                                    <div className=\"machine-card-header\">\r\n                                        <span className=\"machine-number\">{index + 1}</span>\r\n                                        <span className=\"machine-card-name\">\r\n                                            {machineData.machineName.split(' - ')[1] || machineData.machineName}\r\n                                        </span>\r\n                                        <span className=\"machine-parent\">\r\n                                            {machineData.machineName.split(' - ')[0]}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    <div className=\"machine-card-fields\">\r\n                                        <div className=\"form-field\">\r\n                                            <label className=\"form-label\">Operator Number</label>\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                className=\"form-input\"\r\n                                                value={machineData.operatorName}\r\n                                                onChange={e => updateMachineData(index, 'operatorName', e.target.value)}\r\n                                                placeholder=\"Enter operator number\"\r\n                                                disabled={isSessionLocked}\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div className=\"form-field\">\r\n                                            <label className=\"form-label\">Speed (PPM)</label>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                className=\"form-input\"\r\n                                                placeholder=\"Enter speed\"\r\n                                                value={machineData.speed}\r\n                                                onChange={e => updateMachineData(index, 'speed', e.target.value ? Number(e.target.value) : '')}\r\n                                                disabled={isSessionLocked}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* Shared Order Details */}\r\n                    <section className=\"form-section\">\r\n                        <h2 className=\"section-heading\">Shared Order Details</h2>\r\n                        <div className=\"form-grid\">\r\n                            <div className=\"form-field\">\r\n                                <label className=\"form-label\">Order Number</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-input\"\r\n                                    placeholder=\"Enter order number\"\r\n                                    value={orderNumber}\r\n                                    onChange={e => setOrderNumber(e.target.value)}\r\n                                    disabled={isSessionLocked}\r\n                                />\r\n                            </div>\r\n                            <div className=\"form-field\">\r\n                                <label className=\"form-label\">Product</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-input\"\r\n                                    placeholder=\"Enter product\"\r\n                                    value={product}\r\n                                    onChange={e => setProduct(e.target.value)}\r\n                                    disabled={isSessionLocked}\r\n                                />\r\n                            </div>\r\n                            <div className=\"form-field\">\r\n                                <label className=\"form-label\">Batch Number</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-input\"\r\n                                    placeholder=\"Enter batch\"\r\n                                    value={batchNumber}\r\n                                    onChange={e => setBatchNumber(e.target.value)}\r\n                                    disabled={isSessionLocked}\r\n                                />\r\n                            </div>\r\n                            <ShiftInfo dateTime={dateTime} shift={shift} />\r\n                        </div>\r\n\r\n                        {!isSessionLocked && canLockSession && (\r\n                            <button\r\n                                className=\"lock-session-btn\"\r\n                                onClick={handleLockSession}\r\n                            >\r\n                                ≡ƒöÆ Lock All Machine Sessions\r\n                            </button>\r\n                        )}\r\n                    </section>\r\n                </div>\r\n\r\n                {/* Right Column - Recording */}\r\n                <div className=\"capture-entries-column\">\r\n                    {/* Waste Section */}\r\n                    <section className=\"form-section capture-section compact-capture waste-section\">\r\n                        <h2 className=\"section-heading\">\r\n                            <span className=\"section-icon\">≡ƒùæ∩╕Å</span>\r\n                            Record Waste (applies to all)\r\n                            {wasteEntries.length > 0 && (\r\n                                <span className=\"entry-count-badge waste-badge\">{wasteEntries.length}</span>\r\n                            )}\r\n                        </h2>\r\n                        <div className=\"capture-section-content\">\r\n                            <button\r\n                                className=\"capture-add-btn waste-btn\"\r\n                                onClick={() => setShowWasteModal(true)}\r\n                            >\r\n                                <span className=\"btn-icon\">+</span>\r\n                                Record Waste\r\n                            </button>\r\n                            {wasteEntries.length > 0 && (\r\n                                <div className=\"capture-entries-list\">\r\n                                    {wasteEntries.slice().reverse().map((entry, index) => (\r\n                                        <div key={entry.id} className={`capture-entry-item waste-entry ${index === 0 ? 'latest' : ''}`}>\r\n                                            <div className=\"entry-main\">\r\n                                                <span className=\"entry-value\">{entry.waste}</span>\r\n                                                <span className=\"entry-unit\">kg</span>\r\n                                            </div>\r\n                                            <span className=\"entry-type\">{entry.wasteType}</span>\r\n                                            <span className=\"entry-time\">\r\n                                                {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                            </span>\r\n                                            <button\r\n                                                className=\"entry-delete-btn\"\r\n                                                onClick={() => handleDeleteWasteEntry(entry.id)}\r\n                                                title=\"Delete this entry\"\r\n                                            >\r\n                                                Γ£ò\r\n                                            </button>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                            {wasteEntries.length > 0 && (\r\n                                <div className=\"section-total\">\r\n                                    <span>Total Waste:</span>\r\n                                    <strong>{totalWaste.toFixed(1)} kg</strong>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* Downtime Section */}\r\n                    <section className=\"form-section capture-section compact-capture downtime-section\">\r\n                        <h2 className=\"section-heading\">\r\n                            <span className=\"section-icon\">ΓÅ▒∩╕Å</span>\r\n                            Record Downtime (applies to all)\r\n                            {downtimeEntries.length > 0 && (\r\n                                <span className=\"entry-count-badge downtime-badge\">{downtimeEntries.length}</span>\r\n                            )}\r\n                        </h2>\r\n                        <div className=\"capture-section-content\">\r\n                            <button\r\n                                className=\"capture-add-btn downtime-btn\"\r\n                                onClick={() => setShowDowntimeModal(true)}\r\n                            >\r\n                                <span className=\"btn-icon\">+</span>\r\n                                Record Downtime\r\n                            </button>\r\n                            {downtimeEntries.length > 0 && (\r\n                                <div className=\"capture-entries-list\">\r\n                                    {downtimeEntries.slice().reverse().map((entry, index) => (\r\n                                        <div key={entry.id} className={`capture-entry-item downtime-entry ${index === 0 ? 'latest' : ''}`}>\r\n                                            <div className=\"entry-main\">\r\n                                                <span className=\"entry-value\">{entry.downtime}</span>\r\n                                                <span className=\"entry-unit\">min</span>\r\n                                            </div>\r\n                                            <span className=\"entry-reason\">{entry.downtimeReason}</span>\r\n                                            <span className=\"entry-time\">\r\n                                                {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                            </span>\r\n                                            <button\r\n                                                className=\"entry-delete-btn\"\r\n                                                onClick={() => handleDeleteDowntimeEntry(entry.id)}\r\n                                                title=\"Delete this entry\"\r\n                                            >\r\n                                                Γ£ò\r\n                                            </button>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                            {downtimeEntries.length > 0 && (\r\n                                <div className=\"section-total\">\r\n                                    <span>Total Downtime:</span>\r\n                                    <strong>{Math.floor(totalDowntime / 60)}h {totalDowntime % 60}m</strong>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* Submit Button */}\r\n                    <button\r\n                        className=\"submit-all-btn\"\r\n                        onClick={handleSubmitClick}\r\n                        disabled={!isSessionLocked || isSubmitting}\r\n                    >\r\n                        Submit for All {machineDataList.length} Machines\r\n                        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n                            <path d=\"M5 12h14M12 5l7 7-7 7\" />\r\n                        </svg>\r\n                    </button>\r\n                </div>\r\n            </main>\r\n\r\n            {/* Waste Modal */}\r\n            <AnimatePresence>\r\n                {showWasteModal && (\r\n                    <motion.div\r\n                        className=\"modal-overlay\"\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        onClick={() => setShowWasteModal(false)}\r\n                    >\r\n                        <motion.div\r\n                            className=\"modal-content\"\r\n                            initial={{ opacity: 0, scale: 0.9 }}\r\n                            animate={{ opacity: 1, scale: 1 }}\r\n                            exit={{ opacity: 0, scale: 0.9 }}\r\n                            onClick={e => e.stopPropagation()}\r\n                        >\r\n                            <h3>Record Waste</h3>\r\n                            <div className=\"modal-form\">\r\n                                <div className=\"form-field\">\r\n                                    <label className=\"form-label\">Amount (kg)</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        className=\"form-input\"\r\n                                        value={waste}\r\n                                        onChange={e => setWaste(e.target.value ? Number(e.target.value) : '')}\r\n                                        placeholder=\"Enter waste amount\"\r\n                                        autoFocus\r\n                                    />\r\n                                </div>\r\n                                <div className=\"form-field\">\r\n                                    <label className=\"form-label\">Waste Type</label>\r\n                                    <select\r\n                                        className=\"form-select\"\r\n                                        value={wasteType}\r\n                                        onChange={e => setWasteType(e.target.value)}\r\n                                    >\r\n                                        <option value=\"\">Select Type</option>\r\n                                        {WASTE_TYPES.map(t => (\r\n                                            <option key={t} value={t}>{t}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"modal-actions\">\r\n                                <button className=\"modal-cancel\" onClick={() => setShowWasteModal(false)}>Cancel</button>\r\n                                <button className=\"modal-confirm\" onClick={handleWasteSubmit} disabled={!waste || !wasteType}>\r\n                                    Add Entry\r\n                                </button>\r\n                            </div>\r\n                        </motion.div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Downtime Modal */}\r\n            <AnimatePresence>\r\n                {showDowntimeModal && (\r\n                    <motion.div\r\n                        className=\"modal-overlay\"\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        exit={{ opacity: 0 }}\r\n                        onClick={() => setShowDowntimeModal(false)}\r\n                    >\r\n                        <motion.div\r\n                            className=\"modal-content\"\r\n                            initial={{ opacity: 0, scale: 0.9 }}\r\n                            animate={{ opacity: 1, scale: 1 }}\r\n                            exit={{ opacity: 0, scale: 0.9 }}\r\n                            onClick={e => e.stopPropagation()}\r\n                        >\r\n                            <h3>Record Downtime</h3>\r\n                            <div className=\"modal-form\">\r\n                                <div className=\"form-field\">\r\n                                    <label className=\"form-label\">Duration (minutes)</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        className=\"form-input\"\r\n                                        value={downtime}\r\n                                        onChange={e => setDowntime(e.target.value ? Number(e.target.value) : '')}\r\n                                        placeholder=\"Enter duration\"\r\n                                        autoFocus\r\n                                    />\r\n                                </div>\r\n                                <div className=\"form-field\">\r\n                                    <label className=\"form-label\">Reason</label>\r\n                                    <select\r\n                                        className=\"form-select\"\r\n                                        value={downtimeReason}\r\n                                        onChange={e => setDowntimeReason(e.target.value)}\r\n                                    >\r\n                                        <option value=\"\">Select Reason</option>\r\n                                        {DOWNTIME_REASONS.map(r => (\r\n                                            <option key={r} value={r}>{r}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"modal-actions\">\r\n                                <button className=\"modal-cancel\" onClick={() => setShowDowntimeModal(false)}>Cancel</button>\r\n                                <button className=\"modal-confirm\" onClick={handleDowntimeSubmit} disabled={!downtime || !downtimeReason}>\r\n                                    Add Entry\r\n                                </button>\r\n                            </div>\r\n                        </motion.div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </motion.div>\r\n    );\r\n};\r\n\r\nexport default MultiCaptureScreen;\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\react-app-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\reportWebVitals.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\serviceWorkerRegistration.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1086,1189],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1375,1404],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":51,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":51,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1500,1530],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2071,2188],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":74,"column":15,"nodeType":"MemberExpression","messageId":"unexpected","endLine":74,"endColumn":26,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2275,2325],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":82,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":82,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[2466,2532],"text":""},"desc":"Remove the console.error()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":106,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":106,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[3193,3270],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":117,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":117,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"error"},"fix":{"range":[3506,3535],"text":""},"desc":"Remove the console.error()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Worker Registration\r\n * Provides offline support and caching for production\r\n */\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    window.location.hostname === '[::1]' ||\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n  onOffline?: () => void;\r\n  onOnline?: () => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    const publicUrl = new URL(process.env.PUBLIC_URL || '', window.location.href);\r\n\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        checkValidServiceWorker(swUrl, config);\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service worker.'\r\n          );\r\n        });\r\n      } else {\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n\r\n    // Listen for online/offline events\r\n    window.addEventListener('online', () => {\r\n      console.log('App is online');\r\n      config?.onOnline?.();\r\n    });\r\n\r\n    window.addEventListener('offline', () => {\r\n      console.log('App is offline');\r\n      config?.onOffline?.();\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              console.log(\r\n                'New content is available and will be used when all tabs are closed.'\r\n              );\r\n              config?.onUpdate?.(registration);\r\n            } else {\r\n              console.log('Content is cached for offline use.');\r\n              config?.onSuccess?.(registration);\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n\r\n// Check if app is currently offline\r\nexport function isOffline(): boolean {\r\n  return !navigator.onLine;\r\n}\r\n\r\n// Listen for connectivity changes\r\nexport function onConnectivityChange(callback: (online: boolean) => void) {\r\n  const handleOnline = () => callback(true);\r\n  const handleOffline = () => callback(false);\r\n\r\n  window.addEventListener('online', handleOnline);\r\n  window.addEventListener('offline', handleOffline);\r\n\r\n  return () => {\r\n    window.removeEventListener('online', handleOnline);\r\n    window.removeEventListener('offline', handleOffline);\r\n  };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\setupTests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]},{"filePath":"C:\\Users\\bking\\waste-and-downtime-dashboard\\src\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"dot-location","replacedBy":[]},{"ruleId":"new-parens","replacedBy":[]},{"ruleId":"no-mixed-operators","replacedBy":[]},{"ruleId":"no-new-object","replacedBy":["no-object-constructor"]},{"ruleId":"no-whitespace-before-property","replacedBy":[]},{"ruleId":"rest-spread-spacing","replacedBy":[]}]}]
ESLint found too many warnings (maximum: 0).
