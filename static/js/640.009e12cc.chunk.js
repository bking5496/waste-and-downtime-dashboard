"use strict";(self.webpackChunkwaste_and_downtime_dashboard=self.webpackChunkwaste_and_downtime_dashboard||[]).push([[640],{2640:(e,s,a)=>{a.r(s),a.d(s,{default:()=>Y});var t=a(7051),n=a(5043),i=a(8163),c=a(6446),l=a(9570),r=a(6820),o=a(3113),d=a(579);const m=e=>{let{operatorName:s,setOperatorName:a,machine:t,setMachine:n,orderNumber:i,setOrderNumber:c,product:l,setProduct:r,batchNumber:o,setBatchNumber:m,hideMachine:u=!1,disabled:h=!1}=e;return(0,d.jsxs)("div",{className:"main-form-fields",children:[(0,d.jsxs)("div",{className:"form-field",children:[(0,d.jsx)("label",{htmlFor:"operatorNumber",className:"form-label",children:"Operator Number"}),(0,d.jsx)("input",{type:"text",className:"form-input",id:"operatorNumber",value:s,onChange:e=>a(e.target.value),placeholder:"Enter operator number (e.g., 042)",disabled:h})]}),!u&&(0,d.jsxs)("div",{className:"form-field",children:[(0,d.jsx)("label",{htmlFor:"machine",className:"form-label",children:"Machine"}),(0,d.jsx)("input",{type:"text",className:"form-input",id:"machine",value:t,readOnly:!0,disabled:h})]}),(0,d.jsxs)("div",{className:"form-field",children:[(0,d.jsx)("label",{htmlFor:"orderNumber",className:"form-label",children:"Order Number"}),(0,d.jsx)("input",{type:"text",className:"form-input",id:"orderNumber",value:i,onChange:e=>c(e.target.value),placeholder:"Enter order number",disabled:h})]}),(0,d.jsxs)("div",{className:"form-field",children:[(0,d.jsx)("label",{htmlFor:"product",className:"form-label",children:"Product"}),(0,d.jsx)("input",{type:"text",className:"form-input",id:"product",value:l,onChange:e=>r(e.target.value),placeholder:"Enter product name",disabled:h})]}),(0,d.jsxs)("div",{className:"form-field",children:[(0,d.jsx)("label",{htmlFor:"batchNumber",className:"form-label",children:"Batch Number"}),(0,d.jsx)("input",{type:"text",className:"form-input",id:"batchNumber",value:o,onChange:e=>m(e.target.value),placeholder:"Enter batch number",disabled:h})]})]})};var u=a(108),h=a(2291),p=a(7734),x=a(2185),N=a(6026),j=a(6150),b=a(8643),g=a(163),v=a(4240),f=a(7869);const y=["#f87171","#fbbf24","#34d399","#60a5fa","#a78bfa","#f472b6"],w=e=>{let{message:s,icon:a}=e;return(0,d.jsxs)("div",{className:"chart-empty-state",children:[(0,d.jsx)("span",{className:"empty-icon",children:a}),(0,d.jsx)("span",{className:"empty-text",children:s})]})},S=e=>{let{wasteEntries:s,downtimeEntries:a}=e;const t=s.reduce((e,s)=>{const a=e.find(e=>e.name===s.wasteType);return a?a.value+=s.waste:e.push({name:s.wasteType,value:s.waste}),e},[]),n=a.reduce((e,s)=>{const a=e.find(e=>e.name===s.downtimeReason);return a?a.value+=s.downtime:e.push({name:s.downtimeReason,value:s.downtime}),e},[]);return(0,d.jsxs)("div",{className:"charts-grid",children:[(0,d.jsxs)("div",{className:"chart-container",children:[(0,d.jsx)("h4",{className:"chart-title",children:"Waste by Type"}),0===t.length?(0,d.jsx)(w,{message:"No waste entries yet",icon:"\ud83d\udcca"}):(0,d.jsx)("div",{className:"chart-wrapper",children:(0,d.jsx)(u.u,{width:"100%",height:180,children:(0,d.jsxs)(h.E,{data:t,margin:{top:10,right:10,left:-10,bottom:0},children:[(0,d.jsx)(p.d,{strokeDasharray:"3 3",stroke:"rgba(0,245,255,0.1)"}),(0,d.jsx)(x.W,{dataKey:"name",tick:{fill:"#00f5ff",fontSize:11},axisLine:{stroke:"rgba(0,245,255,0.2)"},tickLine:!1}),(0,d.jsx)(N.h,{tick:{fill:"#00f5ff",fontSize:11},axisLine:{stroke:"rgba(0,245,255,0.2)"},tickLine:!1}),(0,d.jsx)(j.m,{contentStyle:{background:"rgba(10,25,40,0.95)",border:"1px solid rgba(0,245,255,0.2)",borderRadius:"8px",color:"#f8fafc"}}),(0,d.jsx)(b.y,{dataKey:"value",fill:"#f87171",name:"Waste (kg)",radius:[4,4,0,0]})]})})})]}),(0,d.jsxs)("div",{className:"chart-container",children:[(0,d.jsx)("h4",{className:"chart-title",children:"Downtime by Reason"}),0===n.length?(0,d.jsx)(w,{message:"No downtime entries yet",icon:"\u23f1\ufe0f"}):(0,d.jsxs)("div",{className:"chart-wrapper",children:[(0,d.jsx)(u.u,{width:"100%",height:180,children:(0,d.jsxs)(g.r,{children:[(0,d.jsx)(v.F,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:s,percent:a}=e;return a>.1?"".concat((100*a).toFixed(0),"%"):""},outerRadius:65,innerRadius:35,fill:"#8884d8",dataKey:"value",stroke:"rgba(15,23,42,0.5)",strokeWidth:2,children:n.map((e,s)=>(0,d.jsx)(f.f,{fill:y[s%y.length]},"cell-".concat(s)))}),(0,d.jsx)(j.m,{contentStyle:{background:"rgba(10,25,40,0.95)",border:"1px solid rgba(0,245,255,0.2)",borderRadius:"8px",color:"#f8fafc"},formatter:e=>["".concat(e," min"),"Duration"]})]})}),(0,d.jsx)("div",{className:"chart-legend",children:n.map((e,s)=>(0,d.jsxs)("div",{className:"legend-item",children:[(0,d.jsx)("span",{className:"legend-dot",style:{background:y[s%y.length]}}),(0,d.jsx)("span",{className:"legend-label",children:e.name})]},e.name))})]})]})]})};var C=a(6353),_=a(9355);const k=e=>{let{isOpen:s,onClose:a,onScan:t,recentScans:i=[]}=e;const[r,o]=(0,n.useState)(null),[,m]=(0,n.useState)(!1),[u,h]=(0,n.useState)(null),[p,x]=(0,n.useState)(!1),N=(0,n.useRef)(null),j=(0,n.useRef)(null),b=(0,n.useRef)(s);(0,n.useEffect)(()=>{b.current=s},[s]),(0,n.useEffect)(()=>{if(s&&j.current){const e=setTimeout(()=>{v()},100);return()=>clearTimeout(e)}return()=>{g()}},[s]);const g=async()=>{if(N.current){try{N.current.getState()===_.Qq.SCANNING&&await N.current.stop(),N.current.clear()}catch(e){console.error("Error stopping scanner:",e)}N.current=null}m(!1)},v=async()=>{N.current&&await g();try{o(null),m(!0);const e=new _.j9("qr-reader");N.current=e,await e.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250},aspectRatio:1},e=>{f(e)},()=>{})}catch(e){console.error("QR Scanner error:",e),m(!1),e.toString().includes("NotAllowedError")?o("Camera permission denied. Please allow camera access to scan QR codes."):e.toString().includes("NotFoundError")?o("No camera found. Please ensure your device has a camera."):o("Failed to start scanner: ".concat(e.message||e))}},f=async e=>{if(u!==e){if(i.includes(e))return o('Pallet "'.concat(e,'" was already scanned this session!')),void setTimeout(()=>o(null),3e3);h(e),x(!0),navigator.vibrate&&navigator.vibrate(200),await g(),t(e),setTimeout(()=>{x(!1),h(null),s&&v()},1500)}},y=()=>{g(),a()};return s?(0,d.jsx)(l.N,{children:(0,d.jsx)(c.P.div,{className:"qr-scanner-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:y,children:(0,d.jsxs)(c.P.div,{className:"qr-scanner-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("div",{className:"qr-scanner-header",children:[(0,d.jsxs)("h3",{children:[(0,d.jsx)("span",{className:"scanner-icon",children:"\ud83d\udcf7"}),"Scan Pallet QR Code"]}),(0,d.jsx)("button",{className:"qr-close-btn",onClick:y,children:"\u2715"})]}),(0,d.jsxs)("div",{className:"qr-scanner-body",ref:j,children:[(0,d.jsx)(l.N,{children:p&&(0,d.jsxs)(c.P.div,{className:"scan-success-overlay",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:[(0,d.jsx)("div",{className:"success-checkmark",children:"\u2713"}),(0,d.jsx)("p",{children:"Pallet Scanned!"}),(0,d.jsx)("span",{className:"scanned-code",children:u})]})}),r&&(0,d.jsxs)("div",{className:"qr-error-message",children:[(0,d.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),r]}),(0,d.jsx)("div",{id:"qr-reader",className:"qr-reader-container"}),(0,d.jsxs)("div",{className:"qr-instructions",children:[(0,d.jsx)("p",{children:"Position the QR code within the frame"}),i.length>0&&(0,d.jsxs)("span",{className:"scan-count",children:[i.length," pallets scanned this shift"]})]})]}),(0,d.jsx)("div",{className:"qr-scanner-footer",children:(0,d.jsx)("button",{className:"qr-cancel-btn",onClick:y,children:"Done Scanning"})})]})})}):null};var P=a(6451),R=a(1737),E=a(8283),A=a(6316),T=a(9216),D=a(1187),O=a(6886),M=a(3986);const I=["variant","size","icon","iconPosition","loading","fullWidth","disabled","children","className"],q=e=>{let{variant:s="primary",size:a="md",icon:n,iconPosition:i="left",loading:c=!1,fullWidth:l=!1,disabled:r,children:o,className:m=""}=e,u=(0,M.A)(e,I);const h=r||c;return(0,d.jsxs)("button",(0,t.A)((0,t.A)({className:"mc-btn mc-btn--".concat(s," mc-btn--").concat(a," ").concat(l?"mc-btn--full":""," ").concat(m),disabled:h},u),{},{children:[c&&(0,d.jsxs)("span",{className:"mc-btn__loader",children:[(0,d.jsx)("span",{className:"mc-btn__loader-dot"}),(0,d.jsx)("span",{className:"mc-btn__loader-dot"}),(0,d.jsx)("span",{className:"mc-btn__loader-dot"})]}),!c&&n&&"left"===i&&(0,d.jsx)("span",{className:"mc-btn__icon",children:n}),(0,d.jsx)("span",{className:"mc-btn__text",children:o}),!c&&n&&"right"===i&&(0,d.jsx)("span",{className:"mc-btn__icon",children:n})]}))},W=e=>{let{isOpen:s,onClose:a,title:t,subtitle:i,size:r="md",children:o,footer:m,closeOnOverlay:u=!0,showCloseButton:h=!0}=e;return(0,n.useEffect)(()=>(document.body.style.overflow=s?"hidden":"",()=>{document.body.style.overflow=""}),[s]),(0,n.useEffect)(()=>{const e=e=>{"Escape"===e.key&&s&&a()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s,a]),(0,d.jsx)(l.N,{children:s&&(0,d.jsxs)(c.P.div,{className:"mc-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},onClick:u?a:void 0,children:[(0,d.jsx)("div",{className:"mc-modal-scanlines"}),(0,d.jsxs)(c.P.div,{className:"mc-modal mc-modal--".concat(r),initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:[.4,0,.2,1]},onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("div",{className:"mc-modal__corner mc-modal__corner--tl"}),(0,d.jsx)("div",{className:"mc-modal__corner mc-modal__corner--tr"}),(0,d.jsx)("div",{className:"mc-modal__corner mc-modal__corner--bl"}),(0,d.jsx)("div",{className:"mc-modal__corner mc-modal__corner--br"}),(t||h)&&(0,d.jsxs)("div",{className:"mc-modal__header",children:[(0,d.jsx)("div",{className:"mc-modal__header-content",children:t&&(0,d.jsxs)("div",{className:"mc-modal__title-group",children:[(0,d.jsx)("h2",{className:"mc-modal__title",children:t}),i&&(0,d.jsx)("p",{className:"mc-modal__subtitle",children:i})]})}),h&&(0,d.jsx)("button",{className:"mc-modal__close",onClick:a,"aria-label":"Close",children:(0,d.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,d.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),(0,d.jsx)("div",{className:"mc-modal__body",children:o}),m&&(0,d.jsx)("div",{className:"mc-modal__footer",children:m})]})]})})},L=e=>{let{label:s,id:a,type:t="text",value:n,onChange:i,placeholder:c,disabled:l=!1,readOnly:r=!1,required:o=!1,error:m,hint:u,icon:h,className:p=""}=e;return(0,d.jsxs)("div",{className:"mc-field ".concat(m?"mc-field--error":""," ").concat(l?"mc-field--disabled":""," ").concat(p),children:[(0,d.jsxs)("label",{htmlFor:a,className:"mc-field__label",children:[s,o&&(0,d.jsx)("span",{className:"mc-field__required",children:"*"})]}),(0,d.jsxs)("div",{className:"mc-field__input-wrapper",children:[h&&(0,d.jsx)("span",{className:"mc-field__icon",children:h}),(0,d.jsx)("input",{type:t,id:a,className:"mc-field__input ".concat(h?"mc-field__input--with-icon":""),value:n,onChange:e=>i(e.target.value),placeholder:c,disabled:l,readOnly:r,required:o}),(0,d.jsx)("div",{className:"mc-field__glow"})]}),m&&(0,d.jsx)("span",{className:"mc-field__error",children:m}),u&&!m&&(0,d.jsx)("span",{className:"mc-field__hint",children:u})]})};const F=e=>{let{isOpen:s,onClose:a,machineId:t,machineName:i,onOrderAdded:c}=e;const[l,r]=(0,n.useState)(""),[o,m]=(0,n.useState)(""),[u,h]=(0,n.useState)(""),[p,x]=(0,n.useState)(!1),[N,j]=(0,n.useState)(""),b=()=>{r(""),m(""),h(""),j(""),a()};return(0,d.jsx)(W,{isOpen:s,onClose:b,title:"Add New Order",subtitle:i,size:"md",footer:(0,d.jsxs)("div",{className:"mc-add-order__actions",children:[(0,d.jsx)(q,{variant:"ghost",onClick:b,disabled:p,children:"Cancel"}),(0,d.jsx)(q,{variant:"success",onClick:async()=>{if(l.trim())if(o.trim()){x(!0),j("");try{await(0,R.z8)(t,l.trim(),o.trim(),u.trim()||""),c({orderNumber:l.trim(),product:o.trim(),batchNumber:u.trim()}),r(""),m(""),h(""),a()}catch(e){console.error("Failed to add order:",e),j("Failed to add order. Please try again.")}finally{x(!1)}}else j("Product is required");else j("Order number is required")},loading:p,children:"Add Order & Start"})]}),children:(0,d.jsxs)("div",{className:"mc-add-order",children:[(0,d.jsx)("p",{className:"mc-add-order__description",children:"Create a new order for this machine. The order will be added to the queue and automatically selected."}),N&&(0,d.jsxs)("div",{className:"mc-add-order__error",children:[(0,d.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("path",{d:"M12 8v4M12 16h.01"})]}),N]}),(0,d.jsxs)("div",{className:"mc-add-order__form",children:[(0,d.jsx)(L,{label:"Order Number",id:"order-number",value:l,onChange:r,placeholder:"e.g., ORD-2024-001",required:!0,disabled:p}),(0,d.jsx)(L,{label:"Product",id:"product",value:o,onChange:m,placeholder:"e.g., Product A",required:!0,disabled:p}),(0,d.jsx)(L,{label:"Batch Number",id:"batch-number",value:u,onChange:h,placeholder:"e.g., BATCH-001 (optional)",disabled:p})]}),(0,d.jsxs)("div",{className:"mc-add-order__hint",children:[(0,d.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,d.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,d.jsx)("path",{d:"M12 16v-4M12 8h.01"})]}),(0,d.jsx)("span",{children:"Orders can also be added in bulk from the Admin Console."})]})]})})},B=(e,s,a)=>"shift_session_".concat(e,"_").concat(s,"_").concat(a),Y=()=>{const{machineId:e}=(0,i.g)(),s=(0,i.zy)(),u=(0,i.Zp)(),h=(()=>{var a;const t="capture_machine_name_".concat(e),n=null===(a=s.state)||void 0===a?void 0:a.machineName;if(n)return sessionStorage.setItem(t,n),n;const i=sessionStorage.getItem(t);return i||(e||"")})(),p=(()=>{var a;const t=null===(a=s.state)||void 0===a?void 0:a.parentMachineId;if(t)return sessionStorage.setItem("capture_parent_id_".concat(e),t),t;const n=sessionStorage.getItem("capture_parent_id_".concat(e));return n||(e&&e.includes("-sub-")?e.split("-sub-")[0]:e||"")})();(0,n.useEffect)(()=>(h&&localStorage.setItem("chat_current_machine",h),()=>{localStorage.removeItem("chat_current_machine")}),[h]);const[x,N]=(0,n.useState)(new Date),[j,b]=(0,n.useState)(""),[g,v]=(0,n.useState)(!1),[f,y]=(0,n.useState)(null),[w,_]=(0,n.useState)(!1),[M,I]=(0,n.useState)(""),[q,W]=(0,n.useState)(""),[L,Y]=(0,n.useState)(""),[z,H]=(0,n.useState)(""),[J,Q]=(0,n.useState)(!1),[K,G]=(0,n.useState)(""),[V,U]=(0,n.useState)(""),[Z,$]=(0,n.useState)(""),[X,ee]=(0,n.useState)(""),[se,ae]=(0,n.useState)([]),[te,ne]=(0,n.useState)([]),[ie,ce]=(0,n.useState)([]),[le,re]=(0,n.useState)([]),[oe,de]=(0,n.useState)([]),[me,ue]=(0,n.useState)([]),[he,pe]=(0,n.useState)(!1),[xe,Ne]=(0,n.useState)(!1),[je,be]=(0,n.useState)(!1),[ge,ve]=(0,n.useState)(!1),[fe,ye]=(0,n.useState)(!1),[we,Se]=(0,n.useState)(!1),[Ce,_e]=(0,n.useState)(""),[ke,Pe]=(0,n.useState)(""),[Re,Ee]=(0,n.useState)(""),[Ae,Te]=(0,n.useState)(""),[De,Oe]=(0,n.useState)(!1),[,Me]=(0,n.useState)(""),[Ie,qe]=(0,n.useState)([]),[We,Le]=(0,n.useState)(!1),[Fe,Be]=(0,n.useState)(!1),[Ye,ze]=(0,n.useState)(null),[He,Je]=(0,n.useState)(!1),[Qe,Ke]=(0,n.useState)(""),[Ge,Ve]=(0,n.useState)(!1),[Ue,Ze]=(0,n.useState)(null),[$e,Xe]=(0,n.useState)(null),[es,ss]=(0,n.useState)({isRunning:!1,startTime:null,pausedAt:null,totalRunTimeMs:0,lastResumedAt:null}),[as,ts]=(0,n.useState)("00:00:00"),[ns,is]=(0,n.useState)(!1),[cs,ls]=(0,n.useState)(""),rs=(e,s)=>{y({message:e,type:s}),setTimeout(()=>y(null),4e3)},[os,ds]=(0,n.useState)(null),ms=(0,n.useRef)(null),us=(0,n.useCallback)(e=>{const s=(0,T.hJ)(e);Oe(s.isInWindow),Me(s.isInWindow?"":s.timeToWindow)},[]),hs=(0,n.useCallback)(async()=>{const e=(new Date).toISOString().split("T")[0],s=(0,T.Se)(),t=B(h,s,e),{hasConflict:n,activeSession:i}=await(0,D.mU)(h,s,e);n&&i&&(ds("Machine in use by ".concat(i.operator_name," since ").concat(new Date(i.started_at).toLocaleTimeString())),(0,O.I9)("This machine is currently being used by ".concat(i.operator_name)));const c=await(0,D.Bd)(h,s,e);c&&(ss({isRunning:c.isRunning,startTime:c.startTime?new Date(c.startTime):null,pausedAt:c.pausedAt?new Date(c.pausedAt):null,totalRunTimeMs:c.totalRunTimeMs,lastResumedAt:c.lastResumedAt?new Date(c.lastResumedAt):null}),(c.isRunning||c.totalRunTimeMs>0)&&ts((0,D.cI)((0,D.Qt)(c))));const l=localStorage.getItem(t);if(l)try{const a=JSON.parse(l);if(a.locked){if(I(a.operatorName),W(a.orderNumber),Y(a.product),H(a.batchNumber),Q(!0),a.wasteEntries&&ae(a.wasteEntries),a.downtimeEntries&&ne(a.downtimeEntries),a.speedEntries&&a.speedEntries.length>0)ce(a.speedEntries);else{const a=(0,E.Yn)(h,s,e);if(a){const e={id:(0,r.A)(),speed:a.speed,timestamp:new Date(a.updatedAt)};ce([e]),console.log("\ud83d\udce1 Loaded shared speed ".concat(a.speed," PPM from ").concat(a.updatedBy))}}return a.sachetMassEntries&&re(a.sachetMassEntries),a.looseCasesEntries&&de(a.looseCasesEntries),void(a.palletScanEntries&&ue(a.palletScanEntries))}}catch(d){console.error("Failed to load session:",d)}try{const{fetchLiveSessionByMachine:n}=await Promise.resolve().then(a.bind(a,6316)),i=await n(h,s,e);if(i&&i.is_locked){I(i.operator_name),W(i.order_number),Y(i.product),H(i.batch_number),Q(!0);const a=(0,E.Yn)(h,s,e);let n=[];if(a){n=[{id:(0,r.A)(),speed:a.speed,timestamp:new Date(a.updatedAt)}],ce(n),console.log("\ud83d\udce1 Loaded shared speed ".concat(a.speed," PPM from ").concat(a.updatedBy))}const c={machineName:i.machine_name,operatorName:i.operator_name,orderNumber:i.order_number,product:i.product,batchNumber:i.batch_number,shift:i.shift,date:i.session_date,locked:!0,wasteEntries:[],downtimeEntries:[],speedEntries:n,sachetMassEntries:[],looseCasesEntries:[],palletScanEntries:[]};return localStorage.setItem(t,JSON.stringify(c)),void console.log("\ud83d\udccb Session restored from Supabase:",h)}}catch(d){console.error("Failed to restore session from Supabase:",d)}try{const{fetchActiveOrderDetails:e}=await Promise.resolve().then(a.bind(a,1737)),s=await e();if(s)return W(s.order_number),Y(s.product),void H(s.batch_number)}catch(d){console.error("Failed to load from database:",d)}const o=localStorage.getItem("admin_order_details");if(o)try{const e=JSON.parse(o);e.orderNumber&&W(e.orderNumber),e.product&&Y(e.product),e.batchNumber&&H(e.batchNumber)}catch(d){console.error("Failed to load admin order details:",d)}},[h]),ps=(0,n.useCallback)(async function(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!M||!q||!L||!z)return;const a=(new Date).toISOString().split("T")[0],t=(0,T.Se)(),n=B(h,t,a),i=await(0,D.gS)(h,M,t,a);if(!i.success)return void(0,O.Qg)(i.error||"Failed to acquire session lock");ms.current&&ms.current(),ms.current=(0,D.BO)(h,t,a,e=>{ds("Another user (".concat(e.operator_name,") is accessing this machine"))});const c={machineName:h,operatorName:M,orderNumber:q,product:L,batchNumber:z,shift:t,date:a,locked:!0,wasteEntries:se,downtimeEntries:te,speedEntries:ie,sachetMassEntries:le,looseCasesEntries:oe,palletScanEntries:me};localStorage.setItem(n,JSON.stringify(c));const l=se.reduce((e,s)=>e+s.waste,0),r=te.reduce((e,s)=>e+s.downtime,0);if((0,A.WA)({machineName:h,operatorName:M,orderNumber:q,product:L,batchNumber:z,shift:t,date:a,locked:!0,totalWaste:l,totalDowntime:r}),!J){Q(!0);const n=new Date;ss({isRunning:!0,startTime:n,pausedAt:null,totalRunTimeMs:0,lastResumedAt:n}),ts("00:00:00");const i={isRunning:!0,startTime:n.toISOString(),pausedAt:null,totalRunTimeMs:0,lastResumedAt:n.toISOString(),pauseHistory:[]};(0,D.Af)(h,t,a,i),e&&(0,R.LY)(e,"running",M,q,t),s&&rs("Session locked - Production timer started","success")}},[h,M,q,L,z,se,te,ie,le,oe,me,J,e]);(0,n.useEffect)(()=>{hs()},[hs]);const xs=(0,n.useRef)(es);(0,n.useEffect)(()=>{xs.current=es},[es]),(0,n.useEffect)(()=>{if(!es.isRunning||!J)return;const e=setInterval(()=>{var e,s,a;const t=(new Date).toISOString().split("T")[0],n=(0,T.Se)(),i={isRunning:es.isRunning,startTime:(null===(e=es.startTime)||void 0===e?void 0:e.toISOString())||null,pausedAt:(null===(s=es.pausedAt)||void 0===s?void 0:s.toISOString())||null,totalRunTimeMs:es.totalRunTimeMs,lastResumedAt:(null===(a=es.lastResumedAt)||void 0===a?void 0:a.toISOString())||null,pauseHistory:[]};(0,D.Af)(h,n,t,i)},3e4);return()=>clearInterval(e)},[es.isRunning,es.lastResumedAt,es.totalRunTimeMs,J,h]),(0,n.useEffect)(()=>()=>{const e=(new Date).toISOString().split("T")[0],s=(0,T.Se)(),a=xs.current;if(a.isRunning||a.totalRunTimeMs>0){var t,n,i;const c={isRunning:a.isRunning,startTime:(null===(t=a.startTime)||void 0===t?void 0:t.toISOString())||null,pausedAt:(null===(n=a.pausedAt)||void 0===n?void 0:n.toISOString())||null,totalRunTimeMs:a.totalRunTimeMs,lastResumedAt:(null===(i=a.lastResumedAt)||void 0===i?void 0:i.toISOString())||null,pauseHistory:[]};(0,D.Af)(h,s,e,c)}(0,D.BA)(h,s,e),ms.current&&ms.current()},[h]),(0,n.useEffect)(()=>{(async()=>{if(p)try{const e=await(0,R.Vw)(p);qe(e)}catch(e){console.error("Failed to load machine orders:",e)}})()},[p]),(0,n.useEffect)(()=>{if(J&&M&&q&&L&&z){const e=(new Date).toISOString().split("T")[0],s=(0,T.Se)(),a=B(h,s,e),t={machineName:h,operatorName:M,orderNumber:q,product:L,batchNumber:z,shift:s,date:e,locked:!0,wasteEntries:se,downtimeEntries:te,speedEntries:ie,sachetMassEntries:le,looseCasesEntries:oe,palletScanEntries:me};localStorage.setItem(a,JSON.stringify(t))}},[se,te,ie,le,oe,me,J,h,M,q,L,z]),(0,n.useEffect)(()=>{const e=setInterval(()=>{const e=new Date;N(e),us(e)},1e3),s=(0,T.Se)();return null!==Ye&&Ye!==s&&J&&Je(!0),b(s),ze(s),()=>clearInterval(e)},[x,T.hJ,Ye,J]),(0,n.useEffect)(()=>{if(!es.isRunning||!es.lastResumedAt)return;const e=setInterval(()=>{const e=Date.now()-es.lastResumedAt.getTime(),s=es.totalRunTimeMs+e,a=Math.floor(s/1e3),t=Math.floor(a/3600),n=Math.floor(a%3600/60),i=a%60;ts("".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0")))},1e3);return()=>clearInterval(e)},[es.isRunning,es.lastResumedAt,es.totalRunTimeMs]),(0,n.useEffect)(()=>{if(!J)return;const e=(new Date).toISOString().split("T")[0],s=(0,T.Se)(),a=se.reduce((e,s)=>e+s.waste,0),t=te.reduce((e,s)=>e+s.downtime,0);(0,A.WA)({machineName:h,operatorName:M,orderNumber:q,product:L,batchNumber:z,shift:s,date:e,locked:!0,totalWaste:a,totalDowntime:t}),console.log("\ud83d\udcca Synced entry totals to Supabase:",{totalWaste:a,totalDowntime:t})},[se,te,J,h,M,q,L,z]);const Ns=(0,n.useCallback)(e=>{var s,a,t;const n=(new Date).toISOString().split("T")[0],i=(0,T.Se)(),c={isRunning:e.isRunning,startTime:(null===(s=e.startTime)||void 0===s?void 0:s.toISOString())||null,pausedAt:(null===(a=e.pausedAt)||void 0===a?void 0:a.toISOString())||null,totalRunTimeMs:e.totalRunTimeMs,lastResumedAt:(null===(t=e.lastResumedAt)||void 0===t?void 0:t.toISOString())||null,pauseHistory:[]};(0,D.Af)(h,i,n,c)},[h]),js=(0,n.useCallback)(()=>{const e=new Date,s={isRunning:!0,startTime:e,pausedAt:null,totalRunTimeMs:0,lastResumedAt:e};ss(s),ts("00:00:00"),Ns(s),(0,A.dj)({type:"machine_start",machine_name:h,operator_name:M,message:"Production started",details:"Order: ".concat(q," | Product: ").concat(L)})},[Ns,h,M,q,L]),bs=(0,n.useCallback)(()=>{if(!es.isRunning)return;const e=new Date,s=es.lastResumedAt?e.getTime()-es.lastResumedAt.getTime():0,a=(0,t.A)((0,t.A)({},es),{},{isRunning:!1,pausedAt:e,totalRunTimeMs:es.totalRunTimeMs+s});ss(a),Ns(a),rs("Production paused - timer stopped","success"),(0,A.dj)({type:"machine_pause",machine_name:h,operator_name:M,message:"Production paused"})},[es,Ns,rs,h,M]),gs=(0,n.useCallback)(()=>{if(!cs)return void rs("Please select a downtime reason","error");if(!es.pausedAt)return;const e=new Date,s=e.getTime()-es.pausedAt.getTime(),a=Math.ceil(s/6e4),n={id:(0,r.A)(),downtime:a,downtimeReason:cs,notes:"Auto-recorded from production pause",timestamp:es.pausedAt};ne(e=>[...e,n]);const i=(0,t.A)((0,t.A)({},es),{},{isRunning:!0,pausedAt:null,lastResumedAt:e});ss(i),Ns(i),is(!1),ls(""),rs("Production resumed. ".concat(a," min downtime recorded."),"success"),(0,A.dj)({type:"machine_resume",machine_name:h,operator_name:M,message:"Production resumed",details:"Reason: ".concat(cs)}),(0,A.dj)({type:"downtime_recorded",machine_name:h,operator_name:M,message:"Downtime recorded: ".concat(a," min"),details:cs})},[cs,es,Ns,rs,h,M]),vs=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),fs=se.reduce((e,s)=>e+s.waste,0),ys=te.reduce((e,s)=>e+s.downtime,0);return(0,d.jsxs)(c.P.div,{className:"capture-screen-v2",initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[g&&(0,d.jsxs)("div",{className:"spinner-overlay-v2",children:[(0,d.jsx)("div",{className:"spinner-v2"}),(0,d.jsx)("p",{children:"Submitting shift data..."})]}),f&&(0,d.jsx)(c.P.div,{className:"toast-container-v2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,d.jsxs)("div",{className:"toast-message-v2 ".concat(f.type),children:[(0,d.jsx)("span",{className:"toast-icon",children:"success"===f.type?"\u2713":"!"}),f.message]})}),(0,d.jsxs)("header",{className:"capture-header-v2",children:[(0,d.jsxs)("button",{className:"back-btn-v2",onClick:()=>{(se.length>0||te.length>0||ie.length>0||le.length>0||oe.length>0||me.length>0)&&!J?window.confirm("You have entries that are not saved to a session. Are you sure you want to go back? Lock your shift details first to save entries.")&&u("/"):u("/")},children:[(0,d.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,d.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back"]}),(0,d.jsxs)("div",{className:"capture-title-v2",children:[(0,d.jsx)("h1",{children:h}),(0,d.jsx)("span",{className:"capture-subtitle",children:"Recording Waste & Downtime"})]}),(0,d.jsxs)("div",{className:"shift-badge-v2 ".concat(j.toLowerCase()),children:[(0,d.jsx)("span",{className:"shift-icon",children:"Day"===j?"\u25d0":"\u25d1"}),j," Shift"]})]}),(0,d.jsxs)("main",{className:"capture-main",children:[(0,d.jsxs)("div",{className:"capture-form-column",children:[(0,d.jsxs)("section",{className:"form-section",children:[(0,d.jsxs)("h2",{className:"section-heading",children:["Shift Details",J&&(0,d.jsx)("span",{className:"locked-badge",children:"\ud83d\udd12 Locked"})]}),!J&&(0,d.jsxs)("div",{className:"order-queue-select",children:[(0,d.jsxs)("div",{className:"order-buttons-row",children:[(0,d.jsxs)("button",{className:"select-order-btn add-new",onClick:()=>Be(!0),children:[(0,d.jsx)("span",{className:"btn-icon",children:"+"}),"Add New Order"]}),(0,d.jsxs)("button",{className:"select-order-btn existing",onClick:()=>Le(!0),disabled:0===Ie.length,children:[(0,d.jsx)("span",{className:"btn-icon",children:"\ud83d\udccb"}),"Select Existing",Ie.length>0?" (".concat(Ie.length,")"):""]})]}),q&&(0,d.jsxs)("span",{className:"current-order-badge",children:["Current: ",q]})]}),(0,d.jsxs)("div",{className:"form-grid",children:[(0,d.jsx)(m,{operatorName:M,setOperatorName:J?()=>{}:I,machine:h,setMachine:()=>{},orderNumber:q,setOrderNumber:J?()=>{}:W,product:L,setProduct:J?()=>{}:Y,batchNumber:z,setBatchNumber:J?()=>{}:H,hideMachine:!0,disabled:J}),(0,d.jsx)(o.A,{dateTime:x,shift:j})]}),(0,d.jsxs)("div",{className:"speed-setting",children:[(0,d.jsxs)("div",{className:"speed-display",children:[(0,d.jsx)("span",{className:"speed-label",children:"\u26a1 Machine Speed"}),(0,d.jsx)("span",{className:"speed-value",children:ie.length>0?"".concat(ie[ie.length-1].speed," PPM"):"Not Set"}),ie.length>1&&(0,d.jsxs)("span",{className:"speed-history-count",title:"Speed change history",children:["(",ie.length," changes)"]})]}),(0,d.jsx)("button",{className:"speed-change-btn",onClick:()=>pe(!0),children:ie.length>0?"Change":"Set Speed"})]}),!J&&M&&q&&L&&z&&(ie.length>0?(0,d.jsx)("button",{className:"lock-session-btn",onClick:()=>{ps(!0),js()},children:"\ud83d\udd12 Lock Shift Details & Start Production"}):(0,d.jsx)("button",{className:"lock-session-btn disabled",onClick:()=>pe(!0),title:"Set machine speed to continue",children:"\u26a1 Set Machine Speed to Start"}))]}),J&&(0,d.jsxs)("section",{className:"form-section machine-details-section",children:[(0,d.jsxs)("h2",{className:"section-heading",children:[(0,d.jsx)("span",{className:"section-icon",children:"\u2699\ufe0f"}),"Machine Details",(0,d.jsx)("span",{className:"production-status-badge ".concat(es.isRunning?"running":"paused"),children:es.isRunning?"\u25cf Running":"\u25c9 Paused"})]}),(0,d.jsxs)("div",{className:"machine-details-grid",children:[(0,d.jsxs)("div",{className:"detail-card",children:[(0,d.jsx)("span",{className:"detail-label",children:"Production Started"}),(0,d.jsx)("span",{className:"detail-value",children:es.startTime?es.startTime.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"})]}),(0,d.jsxs)("div",{className:"detail-card timer-card",children:[(0,d.jsx)("span",{className:"detail-label",children:"Run Time"}),(0,d.jsx)("span",{className:"detail-value timer-value",children:as})]}),(0,d.jsx)("div",{className:"detail-card action-card",children:es.isRunning?(0,d.jsxs)("button",{className:"pause-continue-btn pause",onClick:bs,children:[(0,d.jsx)("span",{className:"btn-icon",children:"\u23f8"}),"Pause Production"]}):(0,d.jsxs)("button",{className:"pause-continue-btn continue",onClick:()=>is(!0),children:[(0,d.jsx)("span",{className:"btn-icon",children:"\u25b6"}),"Continue Production"]})})]}),es.pausedAt&&(0,d.jsxs)("div",{className:"pause-duration-display",children:[(0,d.jsx)("span",{className:"pause-icon",children:"\u23f1\ufe0f"}),"Paused since ",es.pausedAt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,d.jsxs)("section",{className:"form-section capture-section compact-capture waste-section",children:[(0,d.jsxs)("h2",{className:"section-heading",children:[(0,d.jsx)("span",{className:"section-icon",children:"\ud83d\uddd1\ufe0f"}),"Record Waste",se.length>0&&(0,d.jsx)("span",{className:"entry-count-badge waste-badge",children:se.length})]}),(0,d.jsxs)("div",{className:"capture-section-content",children:[(0,d.jsxs)("button",{className:"capture-add-btn waste-btn",onClick:()=>ye(!0),children:[(0,d.jsx)("span",{className:"btn-icon",children:"+"}),"Record Waste"]}),se.length>0&&(0,d.jsx)("div",{className:"capture-entries-list",children:se.slice().reverse().map((e,s)=>(0,d.jsxs)("div",{className:"capture-entry-item waste-entry ".concat(0===s?"latest":""),children:[(0,d.jsxs)("div",{className:"entry-main",children:[(0,d.jsx)("span",{className:"entry-value",children:e.waste}),(0,d.jsx)("span",{className:"entry-unit",children:"kg"})]}),(0,d.jsx)("span",{className:"entry-type",children:e.wasteType}),(0,d.jsx)("span",{className:"entry-time",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,d.jsx)("button",{className:"entry-delete-btn",onClick:()=>{return s=e.id,ae(se.filter(e=>e.id!==s)),void rs("Entry removed","success");var s},title:"Delete this entry",children:"\u2715"})]},e.id))}),se.length>0&&(0,d.jsxs)("div",{className:"section-total",children:[(0,d.jsx)("span",{children:"Total Waste:"}),(0,d.jsxs)("strong",{children:[se.reduce((e,s)=>e+s.waste,0).toFixed(1)," kg"]})]})]})]}),(0,d.jsxs)("section",{className:"form-section capture-section compact-capture downtime-section",children:[(0,d.jsxs)("h2",{className:"section-heading",children:[(0,d.jsx)("span",{className:"section-icon",children:"\u23f1\ufe0f"}),"Record Downtime",te.length>0&&(0,d.jsx)("span",{className:"entry-count-badge downtime-badge",children:te.length})]}),(0,d.jsxs)("div",{className:"capture-section-content",children:[(0,d.jsxs)("button",{className:"capture-add-btn downtime-btn",onClick:()=>Se(!0),children:[(0,d.jsx)("span",{className:"btn-icon",children:"+"}),"Record Downtime"]}),te.length>0&&(0,d.jsx)("div",{className:"capture-entries-list",children:te.slice().reverse().map((e,s)=>(0,d.jsxs)("div",{className:"capture-entry-item downtime-entry ".concat(0===s?"latest":""),children:[(0,d.jsxs)("div",{className:"entry-main",children:[(0,d.jsx)("span",{className:"entry-value",children:e.downtime}),(0,d.jsx)("span",{className:"entry-unit",children:"min"})]}),(0,d.jsx)("span",{className:"entry-reason",children:e.downtimeReason}),(0,d.jsx)("span",{className:"entry-time",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,d.jsx)("button",{className:"entry-delete-btn",onClick:()=>{return s=e.id,ne(te.filter(e=>e.id!==s)),void rs("Entry removed","success");var s},title:"Delete this entry",children:"\u2715"})]},e.id))}),te.length>0&&(0,d.jsxs)("div",{className:"section-total",children:[(0,d.jsx)("span",{children:"Total Downtime:"}),(0,d.jsxs)("strong",{children:[Math.floor(te.reduce((e,s)=>e+s.downtime,0)/60),"h ",te.reduce((e,s)=>e+s.downtime,0)%60,"m"]})]})]})]}),(0,d.jsxs)("section",{className:"form-section capture-section compact-capture",children:[(0,d.jsxs)("h2",{className:"section-heading",children:[(0,d.jsx)("span",{className:"section-icon",children:"\u2696\ufe0f"}),"Sachet Mass"]}),(0,d.jsxs)("div",{className:"capture-section-content",children:[(0,d.jsxs)("button",{className:"capture-add-btn",onClick:()=>Ne(!0),children:[(0,d.jsx)("span",{className:"btn-icon",children:"+"}),"Record"]}),le.length>0&&(0,d.jsx)("div",{className:"capture-entries-list",children:le.map(e=>(0,d.jsxs)("div",{className:"capture-entry-item ".concat(e.ignored?"ignored":""),children:[(0,d.jsxs)("div",{className:"entry-main",children:[(0,d.jsx)("span",{className:"entry-value",children:e.mass}),(0,d.jsx)("span",{className:"entry-unit",children:"g"})]}),(0,d.jsx)("span",{className:"entry-time",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,d.jsx)("button",{className:"entry-ignore-btn ".concat(e.ignored?"ignored":""),onClick:()=>{return s=e.id,void re(le.map(e=>e.id===s?(0,t.A)((0,t.A)({},e),{},{ignored:!e.ignored}):e));var s},title:e.ignored?"Include this entry":"Ignore this entry",children:e.ignored?"\u21a9":"\u2298"})]},e.id))})]})]}),(0,d.jsxs)("section",{className:"form-section capture-section product-confirmation-section",children:[(0,d.jsxs)("h2",{className:"section-heading",children:[(0,d.jsx)("span",{className:"section-icon",children:"\ud83d\udce6"}),"Product Confirmation",(me.length>0||oe.length>0)&&(0,d.jsxs)("span",{className:"entry-count-badge",children:[me.filter(e=>!e.ignored).reduce((e,s)=>e+s.casesCount,0)+oe.filter(e=>!e.ignored).reduce((e,s)=>e+s.cases,0)," cases"]})]}),(0,d.jsxs)("div",{className:"product-action-buttons",children:[(0,d.jsxs)("button",{className:"capture-add-btn scan-btn",onClick:()=>ve(!0),children:[(0,d.jsx)("span",{className:"btn-icon",children:"\ud83d\udcf7"}),"Scan Pallet"]}),(0,d.jsxs)("button",{className:"capture-add-btn loose-cases-btn",onClick:()=>be(!0),children:[(0,d.jsx)("span",{className:"btn-icon",children:"+"}),"Add Loose Cases"]})]}),me.length>0&&(0,d.jsxs)("div",{className:"product-entries-section",children:[(0,d.jsxs)("h4",{className:"entries-subheading",children:["Scanned Pallets (",me.filter(e=>!e.ignored).length,")"]}),(0,d.jsx)("div",{className:"capture-entries-list pallet-list",children:me.slice().reverse().map((e,s)=>(0,d.jsxs)("div",{className:"capture-entry-item pallet-entry ".concat(e.ignored?"ignored":""," ").concat(0===s?"latest":""),children:[(0,d.jsxs)("div",{className:"entry-main",children:[(0,d.jsxs)("span",{className:"pallet-badge",children:["P",e.palletNumber]}),(0,d.jsxs)("div",{className:"pallet-details",children:[(0,d.jsxs)("span",{className:"pallet-batch",children:["Batch: ",e.batchNumber]}),(0,d.jsxs)("span",{className:"pallet-cases",children:[e.casesCount," cases"]})]})]}),(0,d.jsx)("span",{className:"entry-time",children:vs(e.timestamp)}),(0,d.jsx)("button",{className:"entry-ignore-btn ".concat(e.ignored?"ignored":""),onClick:()=>{return s=e.id,void ue(me.map(e=>e.id===s?(0,t.A)((0,t.A)({},e),{},{ignored:!e.ignored}):e));var s},title:e.ignored?"Include this pallet":"Ignore this pallet",children:e.ignored?"\u21a9":"\u2298"})]},e.id))})]}),oe.length>0&&(0,d.jsxs)("div",{className:"product-entries-section",children:[(0,d.jsxs)("h4",{className:"entries-subheading",children:["Loose Cases (",oe.filter(e=>!e.ignored).length,")"]}),(0,d.jsx)("div",{className:"capture-entries-list loose-cases-list",children:oe.slice().reverse().map((e,s)=>(0,d.jsxs)("div",{className:"capture-entry-item loose-entry ".concat(e.ignored?"ignored":""),children:[(0,d.jsxs)("div",{className:"entry-main",children:[(0,d.jsx)("span",{className:"loose-badge",children:"LC"}),(0,d.jsxs)("div",{className:"loose-details",children:[(0,d.jsxs)("span",{className:"loose-batch",children:["Batch: ",e.batchNumber]}),(0,d.jsxs)("span",{className:"loose-cases",children:[e.cases," cases"]})]})]}),(0,d.jsx)("span",{className:"entry-time",children:vs(e.timestamp)}),(0,d.jsx)("button",{className:"entry-ignore-btn ".concat(e.ignored?"ignored":""),onClick:()=>{return s=e.id,void de(oe.map(e=>e.id===s?(0,t.A)((0,t.A)({},e),{},{ignored:!e.ignored}):e));var s},title:e.ignored?"Include this entry":"Ignore this entry",children:e.ignored?"\u21a9":"\u2298"})]},e.id))})]}),(me.length>0||oe.length>0)&&(0,d.jsxs)("div",{className:"product-summary",children:[(0,d.jsxs)("div",{className:"summary-item",children:[(0,d.jsx)("span",{className:"summary-label",children:"Total Pallets:"}),(0,d.jsx)("span",{className:"summary-value",children:me.filter(e=>!e.ignored).length})]}),(0,d.jsxs)("div",{className:"summary-item",children:[(0,d.jsx)("span",{className:"summary-label",children:"Total Cases:"}),(0,d.jsx)("span",{className:"summary-value",children:me.filter(e=>!e.ignored).reduce((e,s)=>e+s.casesCount,0)+oe.filter(e=>!e.ignored).reduce((e,s)=>e+s.cases,0)})]})]})]})]}),(0,d.jsxs)("div",{className:"capture-summary-column",children:[(0,d.jsxs)("div",{className:"live-stats-card",children:[(0,d.jsx)("h3",{children:"Session Totals"}),(0,d.jsxs)("div",{className:"stats-grid",children:[(0,d.jsxs)("div",{className:"stat-box waste",children:[(0,d.jsx)("span",{className:"stat-number",children:fs.toFixed(1)}),(0,d.jsx)("span",{className:"stat-unit",children:"kg waste"})]}),(0,d.jsxs)("div",{className:"stat-box downtime",children:[(0,d.jsx)("span",{className:"stat-number",children:ys}),(0,d.jsx)("span",{className:"stat-unit",children:"min downtime"})]}),(0,d.jsxs)("div",{className:"stat-box cases",children:[(0,d.jsx)("span",{className:"stat-number",children:me.filter(e=>!e.ignored).reduce((e,s)=>e+s.casesCount,0)+oe.filter(e=>!e.ignored).reduce((e,s)=>e+s.cases,0)}),(0,d.jsx)("span",{className:"stat-unit",children:"cases"})]}),(0,d.jsxs)("div",{className:"stat-box pallets",children:[(0,d.jsx)("span",{className:"stat-number",children:me.filter(e=>!e.ignored).length}),(0,d.jsx)("span",{className:"stat-unit",children:"pallets"})]})]})]}),(0,d.jsxs)("div",{className:"charts-card",children:[(0,d.jsx)("h3",{children:"Visual Summary"}),(0,d.jsx)(S,{wasteEntries:se,downtimeEntries:te})]}),(se.length>0||te.length>0)&&(0,d.jsxs)(c.P.div,{className:"submission-card",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:[(0,d.jsx)("h3",{children:"Ready to Submit"}),(0,d.jsxs)("div",{className:"submission-details",children:[(0,d.jsxs)("div",{className:"detail-row",children:[(0,d.jsx)("span",{children:"Operator"}),(0,d.jsx)("strong",{children:M||"\u2014"})]}),(0,d.jsxs)("div",{className:"detail-row",children:[(0,d.jsx)("span",{children:"Machine"}),(0,d.jsx)("strong",{children:h})]}),(0,d.jsxs)("div",{className:"detail-row",children:[(0,d.jsx)("span",{children:"Order"}),(0,d.jsx)("strong",{children:q||"\u2014"})]}),(0,d.jsxs)("div",{className:"detail-row highlight waste",children:[(0,d.jsx)("span",{children:"Total Waste"}),(0,d.jsxs)("strong",{children:[fs.toFixed(1)," kg"]})]}),(0,d.jsxs)("div",{className:"detail-row highlight downtime",children:[(0,d.jsx)("span",{children:"Total Downtime"}),(0,d.jsxs)("strong",{children:[Math.floor(ys/60),"h ",ys%60,"m"]})]})]}),(0,d.jsx)("button",{className:"submit-btn-v2 ".concat(De?"":"early-submit"),onClick:e=>{e.preventDefault(),M&&q&&L&&z?0!==se.length||0!==te.length?De?_(!0):(Ze(null),Xe(null),Ve(!0)):rs("Please add at least one waste or downtime entry","error"):rs("Please fill in all shift details","error")},disabled:g||!M||!q||!L||!z,children:g?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"btn-spinner"}),"Submitting..."]}):"Finalize Submission"}),!De&&(0,d.jsx)("p",{className:"submission-window-note",children:"\u26a0\ufe0f Submitting early - you'll be asked about changeover"})]})]})]}),(0,d.jsx)(C.A,{isOpen:w,title:"Confirm Submission",message:"You are about to submit ".concat(se.length," waste entries and ").concat(te.length," downtime entries for ").concat(h,".").concat(null!==Ue?" Changeover: ".concat(Ue?"Yes":"No",". Maintenance/Cleaning: ").concat($e?"Yes":"No","."):""," This action cannot be undone."),confirmText:"Submit",cancelText:"Review",type:"success",onConfirm:async()=>{_(!1),v(!0);const s=se.reduce((e,s)=>e+s.waste,0),a=te.reduce((e,s)=>e+s.downtime,0),t={id:(0,r.A)(),operatorName:M,machine:h,orderNumber:q,product:L,batchNumber:z,shift:j,date:x.toISOString().split("T")[0],wasteEntries:se,downtimeEntries:te,speedEntries:ie,sachetMassEntries:le,looseCasesEntries:oe,palletScanEntries:me,totalWaste:s,totalDowntime:a,submittedAt:new Date},n={shiftData:{operator_name:M,machine:h,order_number:q,product:L,batch_number:z,shift:j,submission_date:x.toISOString().split("T")[0],is_early_submission:!De,will_changeover:null!==Ue&&void 0!==Ue?Ue:void 0,will_maintenance_cleaning:null!==$e&&void 0!==$e?$e:void 0},wasteEntries:se.map(e=>({waste:e.waste,wasteType:e.wasteType,timestamp:e.timestamp})),downtimeEntries:te.map(e=>({downtime:e.downtime,downtimeReason:e.downtimeReason,timestamp:e.timestamp})),speedEntries:ie.map(e=>({speed:e.speed,timestamp:e.timestamp})),sachetMassEntries:le.map(e=>({mass:e.mass,timestamp:e.timestamp})),looseCasesEntries:oe.map(e=>({batchNumber:e.batchNumber,cases:e.cases,timestamp:e.timestamp})),palletScanEntries:me.map(e=>({qrCode:e.qrCode,batchNumber:e.batchNumber,palletNumber:e.palletNumber,casesCount:e.casesCount,timestamp:e.timestamp}))};try{(0,E.IN)(t);const s=await(0,R.jw)(n.shiftData,n.wasteEntries,n.downtimeEntries,n.speedEntries,n.sachetMassEntries,n.looseCasesEntries,n.palletScanEntries);s.warnings.length>0?rs("Submitted with warnings: ".concat(s.warnings.join(", ")),"success"):rs("Shift data submitted successfully","success"),(0,A.dj)({type:"shift_submitted",machine_name:h,operator_name:M,message:"Shift submitted",details:"Order: ".concat(q," | Waste: ").concat(t.totalWaste.toFixed(1),"kg | Downtime: ").concat(t.totalDowntime,"min")}),Q(!1),e&&(0,R.LY)(e,"idle"),ae([]),ne([]),ce([]),re([]),de([]),ue([]),Ze(null),Xe(!1),sessionStorage.removeItem("session_".concat(e));const a=(new Date).toISOString().split("T")[0],i=B(h,j,a);localStorage.removeItem(i),(0,A.KW)(h,j,a),W(""),Y(""),H("")}catch(i){console.error("Submission error:",i),(0,E.nN)(n,String(i)),rs("Saved locally. Will retry sync automatically.","error"),Q(!1),e&&(0,R.LY)(e,"idle");const s=(new Date).toISOString().split("T")[0],a=B(h,j,s);localStorage.removeItem(a),(0,A.KW)(h,j,s),ae([]),ne([]),ce([]),re([]),de([]),ue([]),Ze(null),Xe(!1),W(""),Y(""),H("")}finally{v(!1)}},onCancel:()=>_(!1)}),(0,d.jsx)(l.N,{children:Ge&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,d.jsxs)(c.P.div,{className:"capture-modal changeover-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\u26a0\ufe0f"}),"Early Submission"]}),(0,d.jsx)("p",{className:"changeover-intro",children:"You are submitting before the end of shift window. Please answer the following:"}),(0,d.jsxs)("div",{className:"changeover-question",children:[(0,d.jsx)("label",{className:"question-label",children:"Will there be a changeover to a new product and order?"}),(0,d.jsxs)("div",{className:"question-options",children:[(0,d.jsx)("button",{className:"option-btn ".concat(!0===Ue?"selected yes":""),onClick:()=>Ze(!0),children:"\u2713 Yes"}),(0,d.jsx)("button",{className:"option-btn ".concat(!1===Ue?"selected no":""),onClick:()=>Ze(!1),children:"\u2717 No"})]})]}),(0,d.jsxs)("div",{className:"changeover-question",children:[(0,d.jsx)("label",{className:"question-label",children:"Will there be maintenance or cleaning before next production start?"}),(0,d.jsxs)("div",{className:"question-options",children:[(0,d.jsx)("button",{className:"option-btn ".concat(!0===$e?"selected yes":""),onClick:()=>Xe(!0),children:"\u2713 Yes"}),(0,d.jsx)("button",{className:"option-btn ".concat(!1===$e?"selected no":""),onClick:()=>Xe(!1),children:"\u2717 No"})]})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{className:"modal-btn cancel",onClick:()=>Ve(!1),children:"Cancel"}),(0,d.jsx)("button",{className:"modal-btn confirm",onClick:()=>{null!==Ue&&null!==$e?(Ve(!1),_(!0)):rs("Please answer both questions","error")},disabled:null===Ue||null===$e,children:"Continue to Submit"})]})]})})}),(0,d.jsx)(l.N,{children:He&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,d.jsxs)(c.P.div,{className:"capture-modal shift-change-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\ud83d\udd04"}),"Shift Change Detected"]}),(0,d.jsxs)("p",{className:"modal-description",children:["The shift has changed to ",(0,d.jsx)("strong",{children:j})," shift. Please enter the new operator's name or number."]}),(0,d.jsxs)("div",{className:"modal-form",children:[(0,d.jsx)("label",{className:"modal-label",children:"New Operator Name/Number"}),(0,d.jsx)("input",{type:"text",className:"modal-input",placeholder:"Enter operator name or number...",value:Qe,onChange:e=>Ke(e.target.value),autoFocus:!0})]}),(0,d.jsxs)("div",{className:"shift-change-info",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Current Order:"})," ",q]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Previous Operator:"})," ",M]})]}),(0,d.jsx)("div",{className:"modal-actions",children:(0,d.jsx)("button",{className:"modal-btn confirm",onClick:()=>{if(!Qe.trim())return void rs("Please enter the new operator name/number","error");I(Qe.trim()),Je(!1),Ke(""),e&&(0,R.LY)(e,"running",Qe.trim(),q,j);const s=(new Date).toISOString().split("T")[0],a=B(h,j,s),t={machineName:h,operatorName:Qe.trim(),orderNumber:q,product:L,batchNumber:z,shift:j,date:s,locked:!0,wasteEntries:se,downtimeEntries:te,speedEntries:ie,sachetMassEntries:le,looseCasesEntries:oe,palletScanEntries:me};localStorage.setItem(a,JSON.stringify(t)),rs("Operator changed to ".concat(Qe.trim()," for ").concat(j," shift"),"success")},disabled:!Qe.trim(),children:"Confirm Operator Change"})})]})})}),(0,d.jsx)(l.N,{children:he&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>pe(!1),children:(0,d.jsxs)(c.P.div,{className:"capture-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\u26a1"}),"Record Machine Speed"]}),(0,d.jsxs)("div",{className:"modal-form",children:[(0,d.jsx)("label",{className:"modal-label",children:"Speed (PPM - Packs Per Minute)"}),(0,d.jsx)("input",{type:"number",className:"modal-input",placeholder:"Enter speed...",value:Ce,onChange:e=>_e(e.target.value?Number(e.target.value):""),autoFocus:!0})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{className:"modal-btn cancel",onClick:()=>{pe(!1),_e("")},children:"Cancel"}),(0,d.jsx)("button",{className:"modal-btn confirm",onClick:()=>{if(Ce&&Ce>0){const e={id:(0,r.A)(),speed:Number(Ce),timestamp:new Date};ce([...ie,e]),_e(""),pe(!1),rs("Machine speed recorded","success");const s=(new Date).toISOString().split("T")[0],a=(0,T.Se)();(0,E.nt)(h,a,s,Number(Ce)),(0,A.dj)({type:"speed_recorded",machine_name:h,operator_name:M,message:"Speed recorded: ".concat(Number(Ce)," units/hr")})}},disabled:!Ce||Ce<=0,children:"Confirm"})]})]})})}),(0,d.jsx)(l.N,{children:xe&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>Ne(!1),children:(0,d.jsxs)(c.P.div,{className:"capture-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\u2696\ufe0f"}),"Record Sachet Mass"]}),(0,d.jsxs)("div",{className:"modal-form",children:[(0,d.jsx)("label",{className:"modal-label",children:"Mass (grams)"}),(0,d.jsx)("input",{type:"number",step:"0.1",className:"modal-input",placeholder:"Enter mass in grams...",value:ke,onChange:e=>Pe(e.target.value?Number(e.target.value):""),autoFocus:!0})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{className:"modal-btn cancel",onClick:()=>{Ne(!1),Pe("")},children:"Cancel"}),(0,d.jsx)("button",{className:"modal-btn confirm",onClick:()=>{if(ke&&ke>0){const e={id:(0,r.A)(),mass:Number(ke),timestamp:new Date};re([...le,e]),Pe(""),Ne(!1),rs("Sachet mass recorded","success"),(0,A.dj)({type:"sachet_mass_added",machine_name:h,operator_name:M,message:"Sachet mass recorded: ".concat(Number(ke),"g")})}},disabled:!ke||ke<=0,children:"Confirm"})]})]})})}),(0,d.jsx)(l.N,{children:fe&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>ye(!1),children:(0,d.jsxs)(c.P.div,{className:"capture-modal waste-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\ud83d\uddd1\ufe0f"}),"Record Waste"]}),(0,d.jsxs)("div",{className:"modal-form",children:[(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsx)("label",{className:"modal-label",children:"Waste Type"}),(0,d.jsxs)("select",{className:"modal-select",value:V,onChange:e=>U(e.target.value),children:[(0,d.jsx)("option",{value:"",children:"Select waste type..."}),P.rE.map(e=>(0,d.jsx)("option",{value:e,children:e},e))]})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsx)("label",{className:"modal-label",children:"Weight (kg)"}),(0,d.jsx)("input",{type:"number",step:"0.1",className:"modal-input",placeholder:"Enter weight in kg...",value:K,onChange:e=>G(e.target.value?Number(e.target.value):""),min:0})]})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{className:"modal-btn cancel",onClick:()=>{ye(!1),G(""),U("")},children:"Cancel"}),(0,d.jsx)("button",{className:"modal-btn confirm waste-confirm",onClick:()=>{if(K&&V){const e={id:(0,r.A)(),waste:Number(K),wasteType:V,timestamp:new Date};ae([...se,e]),G(""),U(""),ye(!1),rs("Waste entry added","success"),(0,A.dj)({type:"waste_recorded",machine_name:h,operator_name:M,message:"Waste recorded: ".concat(Number(K).toFixed(1)," kg"),details:V})}},disabled:!K||K<=0||!V,children:"Add Waste Entry"})]})]})})}),(0,d.jsx)(l.N,{children:we&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>Se(!1),children:(0,d.jsxs)(c.P.div,{className:"capture-modal downtime-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\u23f1\ufe0f"}),"Record Downtime"]}),(0,d.jsxs)("div",{className:"modal-form",children:[(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsx)("label",{className:"modal-label",children:"Downtime Reason"}),(0,d.jsxs)("select",{className:"modal-select",value:X,onChange:e=>ee(e.target.value),children:[(0,d.jsx)("option",{value:"",children:"Select reason..."}),P.wK.map(e=>(0,d.jsx)("option",{value:e,children:e},e))]})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsx)("label",{className:"modal-label",children:"Duration (minutes)"}),(0,d.jsx)("input",{type:"number",className:"modal-input",placeholder:"Enter minutes...",value:Z,onChange:e=>$(e.target.value?Number(e.target.value):""),min:1})]})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{className:"modal-btn cancel",onClick:()=>{Se(!1),$(""),ee("")},children:"Cancel"}),(0,d.jsx)("button",{className:"modal-btn confirm downtime-confirm",onClick:()=>{if(Z&&X){const e={id:(0,r.A)(),downtime:Number(Z),downtimeReason:X,notes:void 0,timestamp:new Date};ne([...te,e]),$(""),ee(""),Se(!1),rs("Downtime entry added","success"),(0,A.dj)({type:"downtime_recorded",machine_name:h,operator_name:M,message:"Downtime recorded: ".concat(Number(Z)," min"),details:X})}},disabled:!Z||Z<=0||!X,children:"Add Downtime Entry"})]})]})})}),(0,d.jsx)(l.N,{children:ns&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>is(!1),children:(0,d.jsxs)(c.P.div,{className:"capture-modal continue-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\u25b6"}),"Continue Production"]}),(0,d.jsxs)("div",{className:"modal-form",children:[(0,d.jsxs)("div",{className:"pause-info",children:[(0,d.jsx)("span",{className:"pause-duration-label",children:"Paused Duration:"}),(0,d.jsx)("span",{className:"pause-duration-value",children:es.pausedAt?"".concat(Math.ceil((Date.now()-es.pausedAt.getTime())/6e4)," minutes"):"0 minutes"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsx)("label",{className:"modal-label",children:"What was the reason for this downtime?"}),(0,d.jsxs)("select",{className:"modal-select",value:cs,onChange:e=>ls(e.target.value),autoFocus:!0,children:[(0,d.jsx)("option",{value:"",children:"Select reason..."}),P.wK.map(e=>(0,d.jsx)("option",{value:e,children:e},e))]})]})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{className:"modal-btn cancel",onClick:()=>{is(!1),ls("")},children:"Cancel"}),(0,d.jsx)("button",{className:"modal-btn confirm continue-confirm",onClick:gs,disabled:!cs,children:"Record & Continue"})]})]})})}),(0,d.jsx)(l.N,{children:je&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>be(!1),children:(0,d.jsxs)(c.P.div,{className:"capture-modal loose-cases-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\ud83d\udce6"}),"Add Loose Cases"]}),(0,d.jsx)("p",{className:"modal-description",children:"Enter cases that are not part of a full pallet scan"}),(0,d.jsxs)("div",{className:"modal-form",children:[(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsx)("label",{className:"modal-label",children:"Batch Number (5 digits)"}),(0,d.jsx)("input",{type:"text",className:"modal-input",placeholder:"e.g., 12345",value:Re,onChange:e=>{const s=e.target.value.replace(/\D/g,"").slice(0,5);Ee(s)},maxLength:5,autoFocus:!0})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsx)("label",{className:"modal-label",children:"Number of Cases"}),(0,d.jsx)("input",{type:"number",className:"modal-input",placeholder:"Enter quantity...",value:Ae,onChange:e=>Te(e.target.value?Number(e.target.value):""),min:1})]})]}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{className:"modal-btn cancel",onClick:()=>{be(!1),Ee(""),Te("")},children:"Cancel"}),(0,d.jsx)("button",{className:"modal-btn confirm",onClick:()=>{if(Re&&5===Re.length&&Ae&&Ae>0){const e={id:(0,r.A)(),batchNumber:Re,cases:Number(Ae),timestamp:new Date};de([...oe,e]),Ee(""),Te(""),be(!1),rs("Loose cases recorded","success"),(0,A.dj)({type:"cases_added",machine_name:h,operator_name:M,message:"Loose cases added: ".concat(Number(Ae)," cases"),details:"Batch: ".concat(Re)})}else 5!==Re.length&&rs("Batch number must be 5 digits","error")},disabled:5!==Re.length||!Ae||Ae<=0,children:"Add Cases"})]})]})})}),(0,d.jsx)(k,{isOpen:ge,onClose:()=>ve(!1),onScan:e=>{const s=(e=>{const s=e.trim();if(!/^\d{13}$/.test(s))return null;const a=parseInt(s.substring(9,13),10);return Number.isNaN(a)?null:{batchNumber:s.substring(0,5),palletNumber:s.substring(5,9),casesCount:a}})(e);if(!s)return void rs("Invalid QR code format. Expected 13 digits: BBBBBPPPPCCCC","error");if(me.some(s=>s.qrCode===e))return void rs("Pallet ".concat(s.palletNumber," has already been scanned!"),"error");const a={id:(0,r.A)(),qrCode:e,batchNumber:s.batchNumber,palletNumber:s.palletNumber,casesCount:s.casesCount,timestamp:new Date};ue([...me,a]),rs("Pallet ".concat(s.palletNumber," scanned (").concat(s.casesCount," cases)"),"success"),(0,A.dj)({type:"pallet_scanned",machine_name:h,operator_name:M,message:"Pallet scanned: ".concat(s.casesCount," cases"),details:"Pallet #".concat(s.palletNumber," | Batch: ").concat(s.batchNumber)})},recentScans:me.map(e=>e.qrCode)}),(0,d.jsx)(l.N,{children:We&&(0,d.jsx)(c.P.div,{className:"capture-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>Le(!1),children:(0,d.jsxs)(c.P.div,{className:"capture-modal order-select-modal",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:e=>e.stopPropagation(),children:[(0,d.jsxs)("h3",{className:"modal-title",children:[(0,d.jsx)("span",{className:"modal-icon",children:"\ud83d\udccb"}),"Select Order"]}),(0,d.jsx)("p",{className:"modal-description",children:"Choose an order from the queue (sorted by priority)"}),(0,d.jsx)("div",{className:"order-queue-list",children:Ie.map((e,s)=>(0,d.jsxs)("button",{className:"order-queue-item ".concat(q===e.order_number?"selected":""),onClick:()=>(e=>{W(e.order_number),Y(e.product),H(e.batch_number),Le(!1),rs("Selected order: ".concat(e.order_number),"success")})(e),children:[(0,d.jsxs)("span",{className:"order-priority",children:["#",s+1]}),(0,d.jsxs)("div",{className:"order-details",children:[(0,d.jsx)("span",{className:"order-number",children:e.order_number}),(0,d.jsx)("span",{className:"order-product",children:e.product}),(0,d.jsxs)("span",{className:"order-batch",children:["Batch: ",e.batch_number]})]}),q===e.order_number&&(0,d.jsx)("span",{className:"order-selected-badge",children:"\u2713"})]},e.id))}),(0,d.jsxs)("div",{className:"modal-actions",children:[(0,d.jsx)("button",{className:"modal-btn add-order",onClick:()=>{Le(!1),Be(!0)},children:"+ Add New Order"}),(0,d.jsx)("button",{className:"modal-btn cancel",onClick:()=>Le(!1),children:"Cancel"})]})]})})}),(0,d.jsx)(F,{isOpen:Fe,onClose:()=>Be(!1),machineId:e||"",machineName:h,onOrderAdded:e=>{W(e.orderNumber),Y(e.product),H(e.batchNumber),Le(!1),rs("Created and selected order: ".concat(e.orderNumber),"success"),(0,R.Vw)(p||"").then(e=>qe(e)).catch(console.error)}})]})}},3113:(e,s,a)=>{a.d(s,{A:()=>i});a(5043);var t=a(9908),n=a(579);const i=e=>{let{dateTime:s,shift:a}=e;return(0,n.jsxs)("div",{className:"shift-info-card",children:[(0,n.jsxs)("div",{className:"shift-info-header",children:[(0,n.jsx)("span",{className:"info-label",children:"Current Date"}),(0,n.jsx)("span",{className:"info-value date",children:(0,t.GP)(s,"EEEE,")}),(0,n.jsx)("span",{className:"info-value",children:(0,t.GP)(s,"MMM d, yyyy")})]}),(0,n.jsxs)("div",{className:"shift-info-time",children:[(0,n.jsx)("span",{className:"info-label",children:"Current Time"}),(0,n.jsx)("span",{className:"time-display",children:(0,t.GP)(s,"HH:mm:ss")})]})]})}},6353:(e,s,a)=>{a.d(s,{A:()=>c});a(5043);var t=a(9570),n=a(6446),i=a(579);const c=e=>{let{isOpen:s,title:a,message:c,confirmText:l="Confirm",cancelText:r="Cancel",onConfirm:o,onCancel:d,type:m="default"}=e;return(0,i.jsx)(t.N,{children:s&&(0,i.jsx)(n.P.div,{className:"confirm-dialog-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,children:(0,i.jsxs)(n.P.div,{className:"confirm-dialog",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("div",{className:"confirm-dialog-header",children:(0,i.jsx)("h3",{children:a})}),(0,i.jsx)("div",{className:"confirm-dialog-body",children:(0,i.jsx)("p",{children:c})}),(0,i.jsxs)("div",{className:"confirm-dialog-footer",children:[(0,i.jsx)("button",{className:"btn btn-outline-secondary",onClick:d,children:r}),(0,i.jsx)("button",{className:"btn ".concat((()=>{switch(m){case"danger":return"btn-danger";case"success":return"btn-success";default:return"btn-primary"}})()),onClick:o,children:l})]})]})})})}}}]);
//# sourceMappingURL=640.009e12cc.chunk.js.map