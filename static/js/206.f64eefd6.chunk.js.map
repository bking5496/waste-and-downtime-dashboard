{"version":3,"file":"static/js/206.f64eefd6.chunk.js","mappings":"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","sources":["pages/HistoryPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { format, subDays, startOfDay, endOfDay } from 'date-fns';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  useReactTable,\r\n  getCoreRowModel,\r\n  getSortedRowModel,\r\n  getFilteredRowModel,\r\n  getPaginationRowModel,\r\n  flexRender,\r\n  SortingState,\r\n  ColumnDef,\r\n} from '@tanstack/react-table';\r\nimport { ShiftData } from '../types';\r\nimport { getShiftHistory, exportToCSV } from '../lib/storage';\r\nimport { getRecentSubmissions } from '../lib/supabase';\r\n\r\n// Type definitions for Supabase response\r\ninterface WasteRecordResponse {\r\n  id: number;\r\n  waste_amount: number;\r\n  waste_type: string;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface DowntimeRecordResponse {\r\n  id: number;\r\n  downtime_minutes: number;\r\n  downtime_reason: string;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface SpeedRecordResponse {\r\n  id: number;\r\n  speed: number;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface SachetMassRecordResponse {\r\n  id: number;\r\n  mass: number;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface LooseCasesRecordResponse {\r\n  id: number;\r\n  batch_number: string;\r\n  cases: number;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface PalletScanRecordResponse {\r\n  id: number;\r\n  qr_code?: string;\r\n  batch_number?: string;\r\n  pallet_number?: number;\r\n  cases_count?: number;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface SubmissionResponse {\r\n  id: number;\r\n  operator_name: string;\r\n  machine: string;\r\n  order_number: string;\r\n  product: string;\r\n  batch_number: string;\r\n  shift: string;\r\n  submission_date: string;\r\n  total_waste?: number;\r\n  total_downtime?: number;\r\n  created_at: string;\r\n  waste_records?: WasteRecordResponse[];\r\n  downtime_records?: DowntimeRecordResponse[];\r\n  speed_records?: SpeedRecordResponse[];\r\n  sachet_mass_records?: SachetMassRecordResponse[];\r\n  loose_cases_records?: LooseCasesRecordResponse[];\r\n  pallet_scan_records?: PalletScanRecordResponse[];\r\n}\r\n\r\nconst HistoryPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [data, setData] = useState<ShiftData[]>([]);\r\n  const [sorting, setSorting] = useState<SortingState>([{ id: 'submittedAt', desc: true }]);\r\n  const [globalFilter, setGlobalFilter] = useState('');\r\n  const [dateRange, setDateRange] = useState<'today' | 'week' | 'month' | 'all'>('all');\r\n  const [dataSource, setDataSource] = useState<'local' | 'database'>('database');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Transform Supabase submission to ShiftData\r\n  const transformSubmission = useCallback((sub: SubmissionResponse): ShiftData => ({\r\n    id: sub.id.toString(),\r\n    operatorName: sub.operator_name,\r\n    machine: sub.machine,\r\n    orderNumber: sub.order_number,\r\n    product: sub.product,\r\n    batchNumber: sub.batch_number,\r\n    shift: sub.shift,\r\n    date: sub.submission_date,\r\n    wasteEntries: (sub.waste_records || []).map((w: WasteRecordResponse) => ({\r\n      id: w.id.toString(),\r\n      waste: w.waste_amount,\r\n      wasteType: w.waste_type,\r\n      timestamp: new Date(w.recorded_at || w.created_at || Date.now()),\r\n    })),\r\n    downtimeEntries: (sub.downtime_records || []).map((d: DowntimeRecordResponse) => ({\r\n      id: d.id.toString(),\r\n      downtime: d.downtime_minutes,\r\n      downtimeReason: d.downtime_reason,\r\n      timestamp: new Date(d.recorded_at || d.created_at || Date.now()),\r\n    })),\r\n    speedEntries: (sub.speed_records || []).map((s: SpeedRecordResponse) => ({\r\n      id: s.id.toString(),\r\n      speed: s.speed,\r\n      timestamp: new Date(s.recorded_at || s.created_at || Date.now()),\r\n    })),\r\n    sachetMassEntries: (sub.sachet_mass_records || []).map((sm: SachetMassRecordResponse) => ({\r\n      id: sm.id.toString(),\r\n      mass: sm.mass,\r\n      timestamp: new Date(sm.recorded_at || sm.created_at || Date.now()),\r\n    })),\r\n    looseCasesEntries: (sub.loose_cases_records || []).map((lc: LooseCasesRecordResponse) => ({\r\n      id: lc.id.toString(),\r\n      batchNumber: lc.batch_number,\r\n      cases: lc.cases,\r\n      timestamp: new Date(lc.recorded_at || lc.created_at || Date.now()),\r\n    })),\r\n    palletScanEntries: (sub.pallet_scan_records || []).map((ps: PalletScanRecordResponse) => ({\r\n      id: ps.id.toString(),\r\n      qrCode: ps.qr_code || '',\r\n      batchNumber: ps.batch_number || '',\r\n      palletNumber: ps.pallet_number?.toString() || '',\r\n      casesCount: ps.cases_count || 0,\r\n      timestamp: new Date(ps.recorded_at || ps.created_at || Date.now()),\r\n    })),\r\n    totalWaste: sub.total_waste || 0,\r\n    totalDowntime: sub.total_downtime || 0,\r\n    submittedAt: new Date(sub.created_at),\r\n  }), []);\r\n\r\n  const loadData = useCallback(async () => {\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      let history: ShiftData[] = [];\r\n\r\n      if (dataSource === 'database') {\r\n        // Fetch from Supabase\r\n        const submissions = await getRecentSubmissions(100) as SubmissionResponse[];\r\n        history = submissions.map(transformSubmission);\r\n      } else {\r\n        // Fetch from localStorage\r\n        history = getShiftHistory();\r\n      }\r\n\r\n      const now = new Date();\r\n      switch (dateRange) {\r\n        case 'today':\r\n          const todayStart = startOfDay(now);\r\n          const todayEnd = endOfDay(now);\r\n          history = history.filter(item => {\r\n            const itemDate = new Date(item.submittedAt);\r\n            return itemDate >= todayStart && itemDate <= todayEnd;\r\n          });\r\n          break;\r\n        case 'week':\r\n          const weekAgo = subDays(now, 7);\r\n          history = history.filter(item => new Date(item.submittedAt) >= weekAgo);\r\n          break;\r\n        case 'month':\r\n          const monthAgo = subDays(now, 30);\r\n          history = history.filter(item => new Date(item.submittedAt) >= monthAgo);\r\n          break;\r\n      }\r\n\r\n      setData(history);\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n      // Fallback to local storage if database fails\r\n      if (dataSource === 'database') {\r\n        setDataSource('local');\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [dataSource, dateRange, transformSubmission]);\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, [loadData]);\r\n\r\n  const columns = useMemo<ColumnDef<ShiftData>[]>(() => [\r\n    {\r\n      accessorKey: 'date',\r\n      header: 'Date',\r\n      cell: info => format(new Date(info.getValue() as string), 'MMM dd, yyyy'),\r\n    },\r\n    {\r\n      accessorKey: 'shift',\r\n      header: 'Shift',\r\n      cell: info => (\r\n        <span className={`shift-tag ${(info.getValue() as string).toLowerCase()}`}>\r\n          {info.getValue() as string}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      accessorKey: 'operatorName',\r\n      header: 'Operator',\r\n    },\r\n    {\r\n      accessorKey: 'machine',\r\n      header: 'Machine',\r\n    },\r\n    {\r\n      accessorKey: 'orderNumber',\r\n      header: 'Order',\r\n    },\r\n    {\r\n      accessorKey: 'totalWaste',\r\n      header: 'Waste (kg)',\r\n      cell: info => (\r\n        <span className=\"waste-value\">{(info.getValue() as number).toFixed(1)}</span>\r\n      ),\r\n    },\r\n    {\r\n      accessorKey: 'totalDowntime',\r\n      header: 'Downtime',\r\n      cell: info => {\r\n        const mins = info.getValue() as number;\r\n        const hours = Math.floor(mins / 60);\r\n        const remainingMins = mins % 60;\r\n        return (\r\n          <span className=\"downtime-value\">\r\n            {hours > 0 ? `${hours}h ` : ''}{remainingMins}m\r\n          </span>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      accessorKey: 'submittedAt',\r\n      header: 'Submitted',\r\n      cell: info => format(new Date(info.getValue() as Date), 'HH:mm'),\r\n    },\r\n  ], []);\r\n\r\n  const table = useReactTable({\r\n    data,\r\n    columns,\r\n    state: {\r\n      sorting,\r\n      globalFilter,\r\n    },\r\n    onSortingChange: setSorting,\r\n    onGlobalFilterChange: setGlobalFilter,\r\n    getCoreRowModel: getCoreRowModel(),\r\n    getSortedRowModel: getSortedRowModel(),\r\n    getFilteredRowModel: getFilteredRowModel(),\r\n    getPaginationRowModel: getPaginationRowModel(),\r\n    initialState: {\r\n      pagination: {\r\n        pageSize: 10,\r\n      },\r\n    },\r\n  });\r\n\r\n  const handleExport = () => {\r\n    const filename = `shift_history_${format(new Date(), 'yyyy-MM-dd')}`;\r\n    exportToCSV(data, filename);\r\n  };\r\n\r\n  // Calculate summary stats\r\n  const stats = useMemo(() => {\r\n    const totalWaste = data.reduce((sum, item) => sum + item.totalWaste, 0);\r\n    const totalDowntime = data.reduce((sum, item) => sum + item.totalDowntime, 0);\r\n    const avgWaste = data.length > 0 ? totalWaste / data.length : 0;\r\n    const avgDowntime = data.length > 0 ? totalDowntime / data.length : 0;\r\n    \r\n    return { totalWaste, totalDowntime, avgWaste, avgDowntime, count: data.length };\r\n  }, [data]);\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"history-page-v2\"\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n    >\r\n      {/* Header */}\r\n      <header className=\"history-header-v2\">\r\n        <div className=\"header-left-v2\">\r\n          <button className=\"back-btn-v2\" onClick={() => navigate('/')}>\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M19 12H5M12 19l-7-7 7-7\"/>\r\n            </svg>\r\n            Back\r\n          </button>\r\n          <div className=\"header-titles\">\r\n            <h1>Submission History</h1>\r\n            <span className=\"header-subtitle\">\r\n              {isLoading ? 'Loading...' : `${data.length} records from ${dataSource === 'database' ? 'Supabase' : 'Local Storage'}`}\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div className=\"header-actions-v2\">\r\n          <button \r\n            className=\"export-btn-v2\" \r\n            onClick={handleExport} \r\n            disabled={data.length === 0}\r\n          >\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3\"/>\r\n            </svg>\r\n            Export CSV\r\n          </button>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"history-main\">\r\n        {/* Filters */}\r\n        <div className=\"history-filters-v2\">\r\n          <div className=\"filter-group-v2\">\r\n            <label>Data Source</label>\r\n            <div className=\"filter-pills\">\r\n              <button\r\n                className={`filter-pill ${dataSource === 'database' ? 'active' : ''}`}\r\n                onClick={() => setDataSource('database')}\r\n              >\r\n                ‚òÅÔ∏è Database\r\n              </button>\r\n              <button\r\n                className={`filter-pill ${dataSource === 'local' ? 'active' : ''}`}\r\n                onClick={() => setDataSource('local')}\r\n              >\r\n                üíæ Local\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div className=\"filter-group-v2\">\r\n            <label>Time Period</label>\r\n            <div className=\"filter-pills\">\r\n              {(['today', 'week', 'month', 'all'] as const).map(range => (\r\n                <button\r\n                  key={range}\r\n                  className={`filter-pill ${dateRange === range ? 'active' : ''}`}\r\n                  onClick={() => setDateRange(range)}\r\n                >\r\n                  {range === 'today' ? 'Today' : range === 'week' ? '7 Days' : range === 'month' ? '30 Days' : 'All Time'}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          <div className=\"filter-group-v2 search-group\">\r\n            <label>Search</label>\r\n            <div className=\"search-input-wrapper\">\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n                <path d=\"M21 21l-4.35-4.35\"/>\r\n              </svg>\r\n              <input\r\n                type=\"text\"\r\n                className=\"search-input-v2\"\r\n                placeholder=\"Search operator, machine, order...\"\r\n                value={globalFilter}\r\n                onChange={e => setGlobalFilter(e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Summary */}\r\n        <div className=\"history-stats-v2\">\r\n          <div className=\"stat-card-v2\">\r\n            <span className=\"stat-value-v2\">{stats.count}</span>\r\n            <span className=\"stat-label-v2\">Submissions</span>\r\n          </div>\r\n          <div className=\"stat-card-v2 waste\">\r\n            <span className=\"stat-value-v2\">{stats.totalWaste.toFixed(1)}<small>kg</small></span>\r\n            <span className=\"stat-label-v2\">Total Waste</span>\r\n          </div>\r\n          <div className=\"stat-card-v2 downtime\">\r\n            <span className=\"stat-value-v2\">{Math.floor(stats.totalDowntime / 60)}h {stats.totalDowntime % 60}m</span>\r\n            <span className=\"stat-label-v2\">Total Downtime</span>\r\n          </div>\r\n          <div className=\"stat-card-v2\">\r\n            <span className=\"stat-value-v2\">{stats.avgWaste.toFixed(1)}<small>kg</small></span>\r\n            <span className=\"stat-label-v2\">Avg per Shift</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Data Table */}\r\n        <div className=\"history-table-container-v2\">\r\n          {data.length === 0 ? (\r\n            <div className=\"empty-state-v2\">\r\n              <div className=\"empty-icon\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\r\n                  <path d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"/>\r\n                </svg>\r\n              </div>\r\n              <h3>No submissions found</h3>\r\n              <p>There are no shift submissions for the selected time period.</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <div className=\"table-wrapper\">\r\n                <table className=\"history-table-v2\">\r\n                  <thead>\r\n                    {table.getHeaderGroups().map(headerGroup => (\r\n                      <tr key={headerGroup.id}>\r\n                        {headerGroup.headers.map(header => (\r\n                          <th\r\n                            key={header.id}\r\n                            onClick={header.column.getToggleSortingHandler()}\r\n                            className={header.column.getCanSort() ? 'sortable' : ''}\r\n                          >\r\n                            <div className=\"th-content\">\r\n                              {flexRender(header.column.columnDef.header, header.getContext())}\r\n                              {header.column.getIsSorted() && (\r\n                                <span className=\"sort-indicator\">\r\n                                  {header.column.getIsSorted() === 'asc' ? '‚Üë' : '‚Üì'}\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          </th>\r\n                        ))}\r\n                      </tr>\r\n                    ))}\r\n                  </thead>\r\n                  <tbody>\r\n                    <AnimatePresence>\r\n                      {table.getRowModel().rows.map(row => (\r\n                        <motion.tr\r\n                          key={row.id}\r\n                          initial={{ opacity: 0, y: -10 }}\r\n                          animate={{ opacity: 1, y: 0 }}\r\n                          exit={{ opacity: 0, y: 10 }}\r\n                        >\r\n                          {row.getVisibleCells().map(cell => (\r\n                            <td key={cell.id}>\r\n                              {flexRender(cell.column.columnDef.cell, cell.getContext())}\r\n                            </td>\r\n                          ))}\r\n                        </motion.tr>\r\n                      ))}\r\n                    </AnimatePresence>\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n\r\n              {/* Pagination */}\r\n              <div className=\"table-pagination-v2\">\r\n                <div className=\"pagination-info-v2\">\r\n                  Showing {table.getState().pagination.pageIndex * table.getState().pagination.pageSize + 1} to{' '}\r\n                  {Math.min(\r\n                    (table.getState().pagination.pageIndex + 1) * table.getState().pagination.pageSize,\r\n                    data.length\r\n                  )}{' '}\r\n                  of {data.length} entries\r\n                </div>\r\n                <div className=\"pagination-controls-v2\">\r\n                  <button\r\n                    className=\"page-btn\"\r\n                    onClick={() => table.previousPage()}\r\n                    disabled={!table.getCanPreviousPage()}\r\n                  >\r\n                    ‚Üê Previous\r\n                  </button>\r\n                  <span className=\"page-indicator-v2\">\r\n                    {table.getState().pagination.pageIndex + 1} / {table.getPageCount()}\r\n                  </span>\r\n                  <button\r\n                    className=\"page-btn\"\r\n                    onClick={() => table.nextPage()}\r\n                    disabled={!table.getCanNextPage()}\r\n                  >\r\n                    Next ‚Üí\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </main>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default HistoryPage;\r\n"],"names":["HistoryPage","navigate","useNavigate","data","setData","useState","sorting","setSorting","id","desc","globalFilter","setGlobalFilter","dateRange","setDateRange","dataSource","setDataSource","isLoading","setIsLoading","transformSubmission","useCallback","sub","toString","operatorName","operator_name","machine","orderNumber","order_number","product","batchNumber","batch_number","shift","date","submission_date","wasteEntries","waste_records","map","w","waste","waste_amount","wasteType","waste_type","timestamp","Date","recorded_at","created_at","now","downtimeEntries","downtime_records","d","downtime","downtime_minutes","downtimeReason","downtime_reason","speedEntries","speed_records","s","speed","sachetMassEntries","sachet_mass_records","sm","mass","looseCasesEntries","loose_cases_records","lc","cases","palletScanEntries","pallet_scan_records","ps","_ps$pallet_number","qrCode","qr_code","palletNumber","pallet_number","casesCount","cases_count","totalWaste","total_waste","totalDowntime","total_downtime","submittedAt","loadData","async","history","getRecentSubmissions","getShiftHistory","todayStart","startOfDay","todayEnd","endOfDay","filter","item","itemDate","weekAgo","subDays","monthAgo","error","console","useEffect","columns","useMemo","accessorKey","header","cell","info","format","getValue","_jsx","className","concat","toLowerCase","children","toFixed","mins","hours","Math","floor","remainingMins","_jsxs","table","useReactTable","state","onSortingChange","onGlobalFilterChange","getCoreRowModel","getSortedRowModel","getFilteredRowModel","getPaginationRowModel","initialState","pagination","pageSize","stats","reduce","sum","avgWaste","length","avgDowntime","count","motion","div","initial","opacity","animate","exit","onClick","viewBox","fill","stroke","strokeWidth","handleExport","filename","exportToCSV","disabled","range","cx","cy","r","type","placeholder","value","onChange","e","target","_Fragment","getHeaderGroups","headerGroup","headers","column","getToggleSortingHandler","getCanSort","flexRender","columnDef","getContext","getIsSorted","AnimatePresence","getRowModel","rows","row","tr","y","getVisibleCells","getState","pageIndex","min","previousPage","getCanPreviousPage","getPageCount","nextPage","getCanNextPage"],"ignoreList":[],"sourceRoot":""}