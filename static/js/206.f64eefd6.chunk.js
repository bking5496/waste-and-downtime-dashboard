"use strict";(self.webpackChunkwaste_and_downtime_dashboard=self.webpackChunkwaste_and_downtime_dashboard||[]).push([[206],{7206:(e,a,t)=>{t.r(a),t.d(a,{default:()=>x});var s=t(5043),i=t(8163),l=t(6691),n=t(9908),r=t(1176),o=t(5829),c=t(9570),d=t(6446),h=t(8931),m=t(7111),p=t(8283),u=t(1737),g=t(579);const x=()=>{const e=(0,i.Zp)(),[a,t]=(0,s.useState)([]),[x,v]=(0,s.useState)([{id:"submittedAt",desc:!0}]),[b,j]=(0,s.useState)(""),[w,N]=(0,s.useState)("all"),[y,_]=(0,s.useState)("database"),[S,f]=(0,s.useState)(!1),D=(0,s.useCallback)(e=>({id:e.id.toString(),operatorName:e.operator_name,machine:e.machine,orderNumber:e.order_number,product:e.product,batchNumber:e.batch_number,shift:e.shift,date:e.submission_date,wasteEntries:(e.waste_records||[]).map(e=>({id:e.id.toString(),waste:e.waste_amount,wasteType:e.waste_type,timestamp:new Date(e.recorded_at||e.created_at||Date.now())})),downtimeEntries:(e.downtime_records||[]).map(e=>({id:e.id.toString(),downtime:e.downtime_minutes,downtimeReason:e.downtime_reason,timestamp:new Date(e.recorded_at||e.created_at||Date.now())})),speedEntries:(e.speed_records||[]).map(e=>({id:e.id.toString(),speed:e.speed,timestamp:new Date(e.recorded_at||e.created_at||Date.now())})),sachetMassEntries:(e.sachet_mass_records||[]).map(e=>({id:e.id.toString(),mass:e.mass,timestamp:new Date(e.recorded_at||e.created_at||Date.now())})),looseCasesEntries:(e.loose_cases_records||[]).map(e=>({id:e.id.toString(),batchNumber:e.batch_number,cases:e.cases,timestamp:new Date(e.recorded_at||e.created_at||Date.now())})),palletScanEntries:(e.pallet_scan_records||[]).map(e=>{var a;return{id:e.id.toString(),qrCode:e.qr_code||"",batchNumber:e.batch_number||"",palletNumber:(null===(a=e.pallet_number)||void 0===a?void 0:a.toString())||"",casesCount:e.cases_count||0,timestamp:new Date(e.recorded_at||e.created_at||Date.now())}}),totalWaste:e.total_waste||0,totalDowntime:e.total_downtime||0,submittedAt:new Date(e.created_at)}),[]),k=(0,s.useCallback)(async()=>{f(!0);try{let e=[];if("database"===y){e=(await(0,u.h6)(100)).map(D)}else e=(0,p.LO)();const a=new Date;switch(w){case"today":const t=(0,r.o)(a),s=(0,l.D)(a);e=e.filter(e=>{const a=new Date(e.submittedAt);return a>=t&&a<=s});break;case"week":const i=(0,o.e)(a,7);e=e.filter(e=>new Date(e.submittedAt)>=i);break;case"month":const n=(0,o.e)(a,30);e=e.filter(e=>new Date(e.submittedAt)>=n)}t(e)}catch(e){console.error("Error loading data:",e),"database"===y&&_("local")}finally{f(!1)}},[y,w,D]);(0,s.useEffect)(()=>{k()},[k]);const C=(0,s.useMemo)(()=>[{accessorKey:"date",header:"Date",cell:e=>(0,n.GP)(new Date(e.getValue()),"MMM dd, yyyy")},{accessorKey:"shift",header:"Shift",cell:e=>(0,g.jsx)("span",{className:"shift-tag ".concat(e.getValue().toLowerCase()),children:e.getValue()})},{accessorKey:"operatorName",header:"Operator"},{accessorKey:"machine",header:"Machine"},{accessorKey:"orderNumber",header:"Order"},{accessorKey:"totalWaste",header:"Waste (kg)",cell:e=>(0,g.jsx)("span",{className:"waste-value",children:e.getValue().toFixed(1)})},{accessorKey:"totalDowntime",header:"Downtime",cell:e=>{const a=e.getValue(),t=Math.floor(a/60),s=a%60;return(0,g.jsxs)("span",{className:"downtime-value",children:[t>0?"".concat(t,"h "):"",s,"m"]})}},{accessorKey:"submittedAt",header:"Submitted",cell:e=>(0,n.GP)(new Date(e.getValue()),"HH:mm")}],[]),M=(0,h.N4)({data:a,columns:C,state:{sorting:x,globalFilter:b},onSortingChange:v,onGlobalFilterChange:j,getCoreRowModel:(0,m.HT)(),getSortedRowModel:(0,m.h5)(),getFilteredRowModel:(0,m.hM)(),getPaginationRowModel:(0,m.kW)(),initialState:{pagination:{pageSize:10}}}),P=(0,s.useMemo)(()=>{const e=a.reduce((e,a)=>e+a.totalWaste,0),t=a.reduce((e,a)=>e+a.totalDowntime,0);return{totalWaste:e,totalDowntime:t,avgWaste:a.length>0?e/a.length:0,avgDowntime:a.length>0?t/a.length:0,count:a.length}},[a]);return(0,g.jsxs)(d.P.div,{className:"history-page-v2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,g.jsxs)("header",{className:"history-header-v2",children:[(0,g.jsxs)("div",{className:"header-left-v2",children:[(0,g.jsxs)("button",{className:"back-btn-v2",onClick:()=>e("/"),children:[(0,g.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,g.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back"]}),(0,g.jsxs)("div",{className:"header-titles",children:[(0,g.jsx)("h1",{children:"Submission History"}),(0,g.jsx)("span",{className:"header-subtitle",children:S?"Loading...":"".concat(a.length," records from ").concat("database"===y?"Supabase":"Local Storage")})]})]}),(0,g.jsx)("div",{className:"header-actions-v2",children:(0,g.jsxs)("button",{className:"export-btn-v2",onClick:()=>{const e="shift_history_".concat((0,n.GP)(new Date,"yyyy-MM-dd"));(0,p.GF)(a,e)},disabled:0===a.length,children:[(0,g.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,g.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"})}),"Export CSV"]})})]}),(0,g.jsxs)("main",{className:"history-main",children:[(0,g.jsxs)("div",{className:"history-filters-v2",children:[(0,g.jsxs)("div",{className:"filter-group-v2",children:[(0,g.jsx)("label",{children:"Data Source"}),(0,g.jsxs)("div",{className:"filter-pills",children:[(0,g.jsx)("button",{className:"filter-pill ".concat("database"===y?"active":""),onClick:()=>_("database"),children:"\u2601\ufe0f Database"}),(0,g.jsx)("button",{className:"filter-pill ".concat("local"===y?"active":""),onClick:()=>_("local"),children:"\ud83d\udcbe Local"})]})]}),(0,g.jsxs)("div",{className:"filter-group-v2",children:[(0,g.jsx)("label",{children:"Time Period"}),(0,g.jsx)("div",{className:"filter-pills",children:["today","week","month","all"].map(e=>(0,g.jsx)("button",{className:"filter-pill ".concat(w===e?"active":""),onClick:()=>N(e),children:"today"===e?"Today":"week"===e?"7 Days":"month"===e?"30 Days":"All Time"},e))})]}),(0,g.jsxs)("div",{className:"filter-group-v2 search-group",children:[(0,g.jsx)("label",{children:"Search"}),(0,g.jsxs)("div",{className:"search-input-wrapper",children:[(0,g.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,g.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,g.jsx)("path",{d:"M21 21l-4.35-4.35"})]}),(0,g.jsx)("input",{type:"text",className:"search-input-v2",placeholder:"Search operator, machine, order...",value:b,onChange:e=>j(e.target.value)})]})]})]}),(0,g.jsxs)("div",{className:"history-stats-v2",children:[(0,g.jsxs)("div",{className:"stat-card-v2",children:[(0,g.jsx)("span",{className:"stat-value-v2",children:P.count}),(0,g.jsx)("span",{className:"stat-label-v2",children:"Submissions"})]}),(0,g.jsxs)("div",{className:"stat-card-v2 waste",children:[(0,g.jsxs)("span",{className:"stat-value-v2",children:[P.totalWaste.toFixed(1),(0,g.jsx)("small",{children:"kg"})]}),(0,g.jsx)("span",{className:"stat-label-v2",children:"Total Waste"})]}),(0,g.jsxs)("div",{className:"stat-card-v2 downtime",children:[(0,g.jsxs)("span",{className:"stat-value-v2",children:[Math.floor(P.totalDowntime/60),"h ",P.totalDowntime%60,"m"]}),(0,g.jsx)("span",{className:"stat-label-v2",children:"Total Downtime"})]}),(0,g.jsxs)("div",{className:"stat-card-v2",children:[(0,g.jsxs)("span",{className:"stat-value-v2",children:[P.avgWaste.toFixed(1),(0,g.jsx)("small",{children:"kg"})]}),(0,g.jsx)("span",{className:"stat-label-v2",children:"Avg per Shift"})]})]}),(0,g.jsx)("div",{className:"history-table-container-v2",children:0===a.length?(0,g.jsxs)("div",{className:"empty-state-v2",children:[(0,g.jsx)("div",{className:"empty-icon",children:(0,g.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:(0,g.jsx)("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,g.jsx)("h3",{children:"No submissions found"}),(0,g.jsx)("p",{children:"There are no shift submissions for the selected time period."})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"table-wrapper",children:(0,g.jsxs)("table",{className:"history-table-v2",children:[(0,g.jsx)("thead",{children:M.getHeaderGroups().map(e=>(0,g.jsx)("tr",{children:e.headers.map(e=>(0,g.jsx)("th",{onClick:e.column.getToggleSortingHandler(),className:e.column.getCanSort()?"sortable":"",children:(0,g.jsxs)("div",{className:"th-content",children:[(0,h.Kv)(e.column.columnDef.header,e.getContext()),e.column.getIsSorted()&&(0,g.jsx)("span",{className:"sort-indicator",children:"asc"===e.column.getIsSorted()?"\u2191":"\u2193"})]})},e.id))},e.id))}),(0,g.jsx)("tbody",{children:(0,g.jsx)(c.N,{children:M.getRowModel().rows.map(e=>(0,g.jsx)(d.P.tr,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:e.getVisibleCells().map(e=>(0,g.jsx)("td",{children:(0,h.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})})]})}),(0,g.jsxs)("div",{className:"table-pagination-v2",children:[(0,g.jsxs)("div",{className:"pagination-info-v2",children:["Showing ",M.getState().pagination.pageIndex*M.getState().pagination.pageSize+1," to"," ",Math.min((M.getState().pagination.pageIndex+1)*M.getState().pagination.pageSize,a.length)," ","of ",a.length," entries"]}),(0,g.jsxs)("div",{className:"pagination-controls-v2",children:[(0,g.jsx)("button",{className:"page-btn",onClick:()=>M.previousPage(),disabled:!M.getCanPreviousPage(),children:"\u2190 Previous"}),(0,g.jsxs)("span",{className:"page-indicator-v2",children:[M.getState().pagination.pageIndex+1," / ",M.getPageCount()]}),(0,g.jsx)("button",{className:"page-btn",onClick:()=>M.nextPage(),disabled:!M.getCanNextPage(),children:"Next \u2192"})]})]})]})})]})]})}}}]);
//# sourceMappingURL=206.f64eefd6.chunk.js.map