{"version":3,"file":"static/js/82.4183a8d3.chunk.js","mappings":"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","sources":["components/MachineSettingsModal.tsx","components/SubMachineModal.tsx","pages/Dashboard.tsx","lib/liveSession.ts","../node_modules/uuid/dist/native.js","../node_modules/uuid/dist/rng.js","../node_modules/uuid/dist/stringify.js","../node_modules/uuid/dist/v4.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { Machine } from '../types';\r\nimport { getMachinesData, updateMachine, addMachine, deleteMachine } from '../lib/storage';\r\n\r\ninterface MachineSettingsModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onMachinesUpdated: () => void;\r\n}\r\n\r\nconst MachineSettingsModal: React.FC<MachineSettingsModalProps> = ({ \r\n  isOpen, \r\n  onClose,\r\n  onMachinesUpdated \r\n}) => {\r\n  const [machines, setMachines] = useState<Machine[]>([]);\r\n  const [editingMachine, setEditingMachine] = useState<Machine | null>(null);\r\n  const [, setIsAddingNew] = useState(false); // Used in setIsAddingNew(false) after add\r\n  const [newMachineName, setNewMachineName] = useState('');\r\n  const [newMachineStatus, setNewMachineStatus] = useState<Machine['status']>('idle');\r\n  const [newMachineSubCount, setNewMachineSubCount] = useState<number>(0);\r\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\r\n  const [activeTab, setActiveTab] = useState<'machines' | 'add'>('machines');\r\n  const [, setIsSaving] = useState(false); // Used for loading state\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      loadMachines();\r\n      setActiveTab('machines');\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const loadMachines = () => {\r\n    const data = getMachinesData();\r\n    setMachines(data);\r\n  };\r\n\r\n  const showToast = (message: string, type: 'success' | 'error') => {\r\n    setToast({ message, type });\r\n    setTimeout(() => setToast(null), 3000);\r\n  };\r\n\r\n  const handleUpdateMachine = async (machine: Machine) => {\r\n    setIsSaving(true);\r\n    try {\r\n      await updateMachine(machine.id, machine);\r\n      loadMachines();\r\n      setEditingMachine(null);\r\n      onMachinesUpdated();\r\n      showToast(`${machine.name} updated successfully`, 'success');\r\n    } catch (error) {\r\n      showToast('Failed to update machine', 'error');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleAddMachine = async () => {\r\n    if (!newMachineName.trim()) {\r\n      showToast('Please enter a machine name', 'error');\r\n      return;\r\n    }\r\n\r\n    setIsSaving(true);\r\n    try {\r\n      const newMachine: Machine = {\r\n        id: `machine-${uuidv4().slice(0, 8)}`,\r\n        name: newMachineName.trim(),\r\n        status: newMachineStatus,\r\n        subMachineCount: newMachineSubCount > 0 ? newMachineSubCount : undefined,\r\n      };\r\n\r\n      await addMachine(newMachine);\r\n      loadMachines();\r\n      setIsAddingNew(false);\r\n      setNewMachineName('');\r\n      setNewMachineStatus('idle');\r\n      setNewMachineSubCount(0);\r\n      setActiveTab('machines');\r\n      onMachinesUpdated();\r\n      showToast(`${newMachine.name} added successfully`, 'success');\r\n    } catch (error) {\r\n      showToast('Failed to add machine', 'error');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteMachine = async (machine: Machine) => {\r\n    if (window.confirm(`Are you sure you want to delete \"${machine.name}\"? This cannot be undone.`)) {\r\n      setIsSaving(true);\r\n      try {\r\n        await deleteMachine(machine.id);\r\n        loadMachines();\r\n        onMachinesUpdated();\r\n        showToast(`${machine.name} deleted`, 'success');\r\n      } catch (error) {\r\n        showToast('Failed to delete machine', 'error');\r\n      } finally {\r\n        setIsSaving(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = async (machineId: string, newStatus: Machine['status']) => {\r\n    const machine = machines.find(m => m.id === machineId);\r\n    if (machine) {\r\n      try {\r\n        await updateMachine(machineId, { status: newStatus });\r\n        loadMachines();\r\n        onMachinesUpdated();\r\n      } catch (error) {\r\n        showToast('Failed to update status', 'error');\r\n      }\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: Machine['status']) => {\r\n    switch (status) {\r\n      case 'running': return '#00ff88';\r\n      case 'idle': return '#00f5ff';\r\n      case 'maintenance': return '#ff4757';\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status: Machine['status']) => {\r\n    switch (status) {\r\n      case 'running': return '▶';\r\n      case 'idle': return '◼';\r\n      case 'maintenance': return '⚠';\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        className=\"settings-modal-overlay\"\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        exit={{ opacity: 0 }}\r\n        onClick={onClose}\r\n      >\r\n        <motion.div\r\n          className=\"settings-modal-container\"\r\n          initial={{ opacity: 0, scale: 0.9, y: 20 }}\r\n          animate={{ opacity: 1, scale: 1, y: 0 }}\r\n          exit={{ opacity: 0, scale: 0.9, y: 20 }}\r\n          onClick={e => e.stopPropagation()}\r\n        >\r\n          {/* Header */}\r\n          <div className=\"settings-modal-header\">\r\n            <div className=\"settings-header-content\">\r\n              <div className=\"settings-icon-wrapper\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                  <circle cx=\"12\" cy=\"12\" r=\"3\"/>\r\n                  <path d=\"M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83\"/>\r\n                </svg>\r\n              </div>\r\n              <div className=\"settings-title-group\">\r\n                <h2>Machine Settings</h2>\r\n                <span className=\"settings-subtitle\">{machines.length} machines configured</span>\r\n              </div>\r\n            </div>\r\n            <button className=\"settings-close-btn\" onClick={onClose}>\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <path d=\"M18 6L6 18M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Tabs */}\r\n          <div className=\"settings-tabs\">\r\n            <button \r\n              className={`settings-tab ${activeTab === 'machines' ? 'active' : ''}`}\r\n              onClick={() => setActiveTab('machines')}\r\n            >\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n                <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\r\n                <path d=\"M8 21h8M12 17v4\"/>\r\n              </svg>\r\n              <span>Machines</span>\r\n            </button>\r\n            <button \r\n              className={`settings-tab ${activeTab === 'add' ? 'active' : ''}`}\r\n              onClick={() => setActiveTab('add')}\r\n            >\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                <path d=\"M12 8v8M8 12h8\"/>\r\n              </svg>\r\n              <span>Add New</span>\r\n            </button>\r\n          </div>\r\n\r\n          {/* Toast */}\r\n          <AnimatePresence>\r\n            {toast && (\r\n              <motion.div \r\n                className={`settings-toast-v2 ${toast.type}`}\r\n                initial={{ opacity: 0, y: -20 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -20 }}\r\n              >\r\n                <span className=\"toast-icon\">\r\n                  {toast.type === 'success' ? '✓' : '✕'}\r\n                </span>\r\n                {toast.message}\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {/* Content Area */}\r\n          <div className=\"settings-content\">\r\n            {activeTab === 'machines' ? (\r\n              /* Machine List */\r\n              <div className=\"machine-list-v2\">\r\n                {machines.length === 0 ? (\r\n                  <div className=\"empty-machines\">\r\n                    <div className=\"empty-icon\">\r\n                      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\r\n                        <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\r\n                        <path d=\"M8 21h8M12 17v4\"/>\r\n                      </svg>\r\n                    </div>\r\n                    <p>No machines configured</p>\r\n                    <button className=\"empty-add-btn\" onClick={() => setActiveTab('add')}>\r\n                      Add your first machine\r\n                    </button>\r\n                  </div>\r\n                ) : (\r\n                  machines.map((machine, index) => (\r\n                    <motion.div\r\n                      key={machine.id}\r\n                      className={`machine-card ${editingMachine?.id === machine.id ? 'editing' : ''}`}\r\n                      initial={{ opacity: 0, y: 10 }}\r\n                      animate={{ opacity: 1, y: 0 }}\r\n                      transition={{ delay: index * 0.03 }}\r\n                    >\r\n                      {editingMachine?.id === machine.id ? (\r\n                        /* Edit Mode */\r\n                        <div className=\"machine-edit-mode\">\r\n                          <div className=\"edit-section\">\r\n                            <label className=\"edit-label\">Machine Name</label>\r\n                            <input\r\n                              type=\"text\"\r\n                              className=\"edit-input\"\r\n                              value={editingMachine.name}\r\n                              onChange={e => setEditingMachine({ ...editingMachine, name: e.target.value })}\r\n                              autoFocus\r\n                            />\r\n                          </div>\r\n                          \r\n                          <div className=\"edit-row\">\r\n                            <div className=\"edit-section\">\r\n                              <label className=\"edit-label\">Status</label>\r\n                              <div className=\"status-select-group\">\r\n                                {(['running', 'idle', 'maintenance'] as const).map(status => (\r\n                                  <button\r\n                                    key={status}\r\n                                    className={`status-select-btn ${status} ${editingMachine.status === status ? 'selected' : ''}`}\r\n                                    onClick={() => setEditingMachine({ ...editingMachine, status })}\r\n                                  >\r\n                                    <span className=\"status-select-icon\">{getStatusIcon(status)}</span>\r\n                                    <span className=\"status-select-text\">\r\n                                      {status.charAt(0).toUpperCase() + status.slice(1)}\r\n                                    </span>\r\n                                  </button>\r\n                                ))}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"edit-section\">\r\n                            <label className=\"edit-label\">Sub-machines (for machine groups)</label>\r\n                            <select\r\n                              className=\"edit-select\"\r\n                              value={editingMachine.subMachineCount || 0}\r\n                              onChange={e => setEditingMachine({ \r\n                                ...editingMachine, \r\n                                subMachineCount: parseInt(e.target.value) || undefined \r\n                              })}\r\n                            >\r\n                              <option value=\"0\">None - Single machine</option>\r\n                              <option value=\"2\">2 sub-machines</option>\r\n                              <option value=\"3\">3 sub-machines</option>\r\n                              <option value=\"4\">4 sub-machines</option>\r\n                              <option value=\"5\">5 sub-machines</option>\r\n                              <option value=\"6\">6 sub-machines</option>\r\n                              <option value=\"8\">8 sub-machines</option>\r\n                              <option value=\"10\">10 sub-machines</option>\r\n                            </select>\r\n                          </div>\r\n\r\n                          <div className=\"edit-actions\">\r\n                            <button className=\"edit-save-btn\" onClick={() => handleUpdateMachine(editingMachine)}>\r\n                              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"16\" height=\"16\">\r\n                                <path d=\"M20 6L9 17l-5-5\"/>\r\n                              </svg>\r\n                              Save Changes\r\n                            </button>\r\n                            <button className=\"edit-cancel-btn\" onClick={() => setEditingMachine(null)}>\r\n                              Cancel\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      ) : (\r\n                        /* View Mode */\r\n                        <>\r\n                          <div className=\"machine-card-header\">\r\n                            <div className=\"machine-identity\">\r\n                              <div \r\n                                className=\"machine-status-dot\"\r\n                                style={{ backgroundColor: getStatusColor(machine.status) }}\r\n                              >\r\n                                <span className=\"status-pulse\"></span>\r\n                              </div>\r\n                              <div className=\"machine-name-info\">\r\n                                <span className=\"machine-card-name\">{machine.name}</span>\r\n                                {machine.subMachineCount && machine.subMachineCount > 0 && (\r\n                                  <span className=\"machine-group-badge\">\r\n                                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"12\" height=\"12\">\r\n                                      <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\"/>\r\n                                      <path d=\"M8 21h8M12 17v4\"/>\r\n                                    </svg>\r\n                                    {machine.subMachineCount} machines\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"machine-card-actions\">\r\n                              <button \r\n                                className=\"card-action-btn edit\"\r\n                                onClick={() => setEditingMachine(machine)}\r\n                                title=\"Edit machine\"\r\n                              >\r\n                                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                  <path d=\"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7\" />\r\n                                  <path d=\"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z\" />\r\n                                </svg>\r\n                              </button>\r\n                              <button \r\n                                className=\"card-action-btn delete\"\r\n                                onClick={() => handleDeleteMachine(machine)}\r\n                                title=\"Delete machine\"\r\n                              >\r\n                                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                  <path d=\"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\" />\r\n                                </svg>\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          <div className=\"machine-quick-status\">\r\n                            <span className=\"quick-status-label\">Quick Status:</span>\r\n                            <div className=\"quick-status-buttons\">\r\n                              <button \r\n                                className={`quick-btn running ${machine.status === 'running' ? 'active' : ''}`}\r\n                                onClick={() => handleStatusChange(machine.id, 'running')}\r\n                              >\r\n                                ▶ Run\r\n                              </button>\r\n                              <button \r\n                                className={`quick-btn idle ${machine.status === 'idle' ? 'active' : ''}`}\r\n                                onClick={() => handleStatusChange(machine.id, 'idle')}\r\n                              >\r\n                                ◼ Idle\r\n                              </button>\r\n                              <button \r\n                                className={`quick-btn maintenance ${machine.status === 'maintenance' ? 'active' : ''}`}\r\n                                onClick={() => handleStatusChange(machine.id, 'maintenance')}\r\n                              >\r\n                                ⚠ Maint\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                    </motion.div>\r\n                  ))\r\n                )}\r\n              </div>\r\n            ) : (\r\n              /* Add New Machine Form */\r\n              <div className=\"add-machine-form-v2\">\r\n                <div className=\"form-section\">\r\n                  <label className=\"form-label\">\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"16\" height=\"16\">\r\n                      <path d=\"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2\"/>\r\n                      <circle cx=\"12\" cy=\"7\" r=\"4\"/>\r\n                    </svg>\r\n                    Machine Name\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className=\"form-input\"\r\n                    placeholder=\"e.g., Universal 2, CNC Mill 1...\"\r\n                    value={newMachineName}\r\n                    onChange={e => setNewMachineName(e.target.value)}\r\n                    autoFocus\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"form-section\">\r\n                  <label className=\"form-label\">\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"16\" height=\"16\">\r\n                      <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                      <path d=\"M12 6v6l4 2\"/>\r\n                    </svg>\r\n                    Initial Status\r\n                  </label>\r\n                  <div className=\"status-picker\">\r\n                    {(['running', 'idle', 'maintenance'] as const).map(status => (\r\n                      <button\r\n                        key={status}\r\n                        className={`status-picker-btn ${status} ${newMachineStatus === status ? 'selected' : ''}`}\r\n                        onClick={() => setNewMachineStatus(status)}\r\n                      >\r\n                        <span className=\"picker-icon\">{getStatusIcon(status)}</span>\r\n                        <span className=\"picker-label\">{status.charAt(0).toUpperCase() + status.slice(1)}</span>\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"form-section\">\r\n                  <label className=\"form-label\">\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"16\" height=\"16\">\r\n                      <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\r\n                      <path d=\"M8 21h8M12 17v4\"/>\r\n                    </svg>\r\n                    Sub-machines (Optional)\r\n                  </label>\r\n                  <p className=\"form-hint\">If this is a group name for multiple machines, select how many.</p>\r\n                  <select\r\n                    className=\"form-select\"\r\n                    value={newMachineSubCount}\r\n                    onChange={e => setNewMachineSubCount(parseInt(e.target.value))}\r\n                  >\r\n                    <option value=\"0\">None - This is a single machine</option>\r\n                    <option value=\"2\">2 sub-machines</option>\r\n                    <option value=\"3\">3 sub-machines</option>\r\n                    <option value=\"4\">4 sub-machines</option>\r\n                    <option value=\"5\">5 sub-machines</option>\r\n                    <option value=\"6\">6 sub-machines</option>\r\n                    <option value=\"8\">8 sub-machines</option>\r\n                    <option value=\"10\">10 sub-machines</option>\r\n                  </select>\r\n                </div>\r\n\r\n                <div className=\"form-actions\">\r\n                  <button className=\"form-submit-btn\" onClick={handleAddMachine}>\r\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n                      <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                      <path d=\"M12 8v8M8 12h8\"/>\r\n                    </svg>\r\n                    Add Machine\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"settings-modal-footer\">\r\n            <button className=\"settings-done-btn\" onClick={onClose}>\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n                <path d=\"M20 6L9 17l-5-5\"/>\r\n              </svg>\r\n              Done\r\n            </button>\r\n          </div>\r\n        </motion.div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default MachineSettingsModal;\r\n","import React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Machine } from '../types';\r\n\r\ninterface SubMachineModalProps {\r\n  isOpen: boolean;\r\n  machine: Machine | null;\r\n  onClose: () => void;\r\n  onSelectSubMachine: (machine: Machine, subMachineNumber: number, isActive: boolean) => void;\r\n  activeSubMachines?: Set<number>; // Optional set of active sub-machine numbers\r\n}\r\n\r\nconst SubMachineModal: React.FC<SubMachineModalProps> = ({\r\n  isOpen,\r\n  machine,\r\n  onClose,\r\n  onSelectSubMachine,\r\n  activeSubMachines = new Set(),\r\n}) => {\r\n  if (!isOpen || !machine || !machine.subMachineCount) return null;\r\n\r\n  const subMachines = Array.from({ length: machine.subMachineCount }, (_, i) => i + 1);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <motion.div\r\n          className=\"sub-machine-overlay\"\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          onClick={onClose}\r\n        >\r\n          <motion.div\r\n            className=\"sub-machine-modal\"\r\n            initial={{ opacity: 0, scale: 0.9, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.9, y: 20 }}\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"sub-machine-header\">\r\n              <div className=\"sub-machine-title\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"24\" height=\"24\">\r\n                  <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\" />\r\n                  <line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\" />\r\n                  <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\" />\r\n                </svg>\r\n                <div>\r\n                  <h2>{machine.name}</h2>\r\n                  <span className=\"sub-machine-subtitle\">Select a machine</span>\r\n                </div>\r\n              </div>\r\n              <button className=\"sub-machine-close\" onClick={onClose}>\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n                  <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" />\r\n                  <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"sub-machine-grid\">\r\n              {subMachines.map((num) => {\r\n                const isActive = activeSubMachines.has(num);\r\n                return (\r\n                  <motion.button\r\n                    key={num}\r\n                    className={`sub-machine-btn ${isActive ? 'busy' : ''}`}\r\n                    onClick={() => onSelectSubMachine(machine, num, isActive)}\r\n                    whileHover={{ scale: 1.02 }}\r\n                    whileTap={{ scale: 0.98 }}\r\n                    title={isActive ? 'In Use - Click to continue' : 'Available'}\r\n                  >\r\n                    <div className=\"sub-machine-icon\">\r\n                      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\" width=\"32\" height=\"32\">\r\n                        <rect x=\"3\" y=\"4\" width=\"18\" height=\"12\" rx=\"2\" />\r\n                        <path d=\"M7 20h10\" />\r\n                        <path d=\"M9 16v4\" />\r\n                        <path d=\"M15 16v4\" />\r\n                        <circle cx=\"12\" cy=\"10\" r=\"2\" />\r\n                      </svg>\r\n                    </div>\r\n                    <div className=\"sub-machine-info\">\r\n                      <span className=\"sub-machine-name\">Machine {num}</span>\r\n                      <span className=\"sub-machine-label\">{machine.name}</span>\r\n                    </div>\r\n                    <div className=\"sub-machine-arrow\">\r\n                      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n                        <path d=\"M5 12h14M12 5l7 7-7 7\" />\r\n                      </svg>\r\n                    </div>\r\n                  </motion.button>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            <div className=\"sub-machine-footer\">\r\n              <button className=\"sub-machine-cancel\" onClick={onClose}>\r\n                Cancel\r\n              </button>\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default SubMachineModal;\r\n","import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { format } from 'date-fns';\r\nimport { getMachinesData, getTodayStats, getShiftHistory, initializeMachines, subscribeToMachineUpdates, maybeRunCleanup, retryFailedSubmissions, getFailedSubmissions } from '../lib/storage';\r\nimport { fetchActiveSessions, subscribeToSessionChanges, LiveSession, subscribeToActivityFeed, ActivityEvent } from '../lib/liveSession';\r\nimport { isSupabaseConfigured, getRecentSubmissions } from '../lib/supabase';\r\nimport { Machine, ShiftData } from '../types';\r\nimport MachineSettingsModal from '../components/MachineSettingsModal';\r\nimport SubMachineModal from '../components/SubMachineModal';\r\n\r\n// Type for recent submissions from Supabase\r\ninterface RecentSubmission {\r\n  id: number;\r\n  order_number: string;\r\n  machine: string;\r\n  sub_machine?: string;\r\n  product: string;\r\n  batch_number: string;\r\n  total_waste: number;\r\n  total_downtime: number;\r\n  created_at: string;\r\n  waste_records?: { recorded_at: string }[];\r\n  downtime_records?: { recorded_at: string }[];\r\n}\r\n\r\n// Animated number component\r\nconst AnimatedNumber: React.FC<{ value: number; decimals?: number; suffix?: string }> = ({\r\n  value, decimals = 0, suffix = ''\r\n}) => {\r\n  const [displayValue, setDisplayValue] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const duration = 1000;\r\n    const steps = 30;\r\n    const increment = value / steps;\r\n    let current = 0;\r\n\r\n    const timer = setInterval(() => {\r\n      current += increment;\r\n      if (current >= value) {\r\n        setDisplayValue(value);\r\n        clearInterval(timer);\r\n      } else {\r\n        setDisplayValue(current);\r\n      }\r\n    }, duration / steps);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [value]);\r\n\r\n  return <>{displayValue.toFixed(decimals)}{suffix}</>;\r\n};\r\n\r\n// Pulse animation for live indicator\r\nconst PulseIndicator: React.FC<{ color: string }> = ({ color }) => (\r\n  <span className=\"pulse-indicator\">\r\n    <span className=\"pulse-dot\" style={{ backgroundColor: color }}></span>\r\n    <span className=\"pulse-ring\" style={{ borderColor: color }}></span>\r\n  </span>\r\n);\r\n\r\nconst Dashboard: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n  const [shift, setShift] = useState('');\r\n  const [machines, setMachines] = useState<Machine[]>([]);\r\n  const [todayStats, setTodayStats] = useState({ totalWaste: 0, totalDowntime: 0, submissionCount: 0 });\r\n  const [recentHistory, setRecentHistory] = useState<ShiftData[]>([]);\r\n  const [selectedView, setSelectedView] = useState<'grid' | 'list'>('grid');\r\n  const [showSettings, setShowSettings] = useState(false);\r\n  const [selectedMachineForSub, setSelectedMachineForSub] = useState<Machine | null>(null);\r\n  const [, setIsLoading] = useState(true); // Used only for setting, UI shows content after load\r\n  const [multiSelectMode, setMultiSelectMode] = useState(false);\r\n  const [selectedMachines, setSelectedMachines] = useState<string[]>([]);\r\n  const [activeSessions, setActiveSessions] = useState<LiveSession[]>([]);\r\n  const [recentSubmissions, setRecentSubmissions] = useState<RecentSubmission[]>([]);\r\n  const [activityEvents, setActivityEvents] = useState<ActivityEvent[]>([]);\r\n  const longPressTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n  const LONG_PRESS_DURATION = 500; // ms\r\n\r\n  // Cleanup long-press timer on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (longPressTimerRef.current) {\r\n        clearTimeout(longPressTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Helper function to detect active sub-machine sessions\r\n  // live_sessions is the source of truth for cross-browser sync\r\n  // localStorage is only used as offline fallback\r\n  const getActiveSubMachines = useCallback((machineName: string, subMachineCount: number, _machineId?: string): Set<number> => {\r\n    const activeSet = new Set<number>();\r\n\r\n    // Check Supabase live_sessions - this is the source of truth\r\n    for (let i = 1; i <= subMachineCount; i++) {\r\n      const fullName = `${machineName} - Machine ${i}`;\r\n      const isActive = activeSessions.some(s => s.machine_name === fullName && s.is_locked);\r\n      if (isActive) {\r\n        activeSet.add(i);\r\n      }\r\n    }\r\n\r\n    // If no Supabase data, fallback to localStorage (offline mode only)\r\n    if (activeSet.size === 0 && !isSupabaseConfigured) {\r\n      const today = new Date().toISOString().split('T')[0];\r\n      const hours = new Date().getUTCHours() + 2;\r\n      const currentShift = hours >= 6 && hours < 18 ? 'Day' : 'Night';\r\n\r\n      for (let i = 1; i <= subMachineCount; i++) {\r\n        const fullName = `${machineName} - Machine ${i}`;\r\n        const sessionKey = `shift_session_${fullName}_${currentShift}_${today}`;\r\n        const session = localStorage.getItem(sessionKey);\r\n        if (session) {\r\n          try {\r\n            const parsed = JSON.parse(session);\r\n            if (parsed.locked) activeSet.add(i);\r\n          } catch (e) {\r\n            console.warn(`Invalid session data for ${fullName}:`, e);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return activeSet;\r\n  }, [activeSessions]);\r\n\r\n  const loadData = useCallback(() => {\r\n    const machineData = getMachinesData();\r\n    setMachines(machineData);\r\n\r\n    const stats = getTodayStats();\r\n    setTodayStats(stats);\r\n\r\n    const history = getShiftHistory().slice(0, 7);\r\n    setRecentHistory(history);\r\n  }, []);\r\n\r\n  // Initialize machines from Supabase on mount\r\n  useEffect(() => {\r\n    const init = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        // Run daily cleanup if needed\r\n        maybeRunCleanup();\r\n\r\n        const machineData = await initializeMachines();\r\n        setMachines(machineData);\r\n\r\n        const stats = getTodayStats();\r\n        setTodayStats(stats);\r\n\r\n        const history = getShiftHistory().slice(0, 7);\r\n        setRecentHistory(history);\r\n\r\n        // Fetch active sessions from Supabase for cross-browser sync\r\n        const sessions = await fetchActiveSessions();\r\n        setActiveSessions(sessions);\r\n\r\n        // Fetch recent submissions from Supabase for the activity feed\r\n        if (isSupabaseConfigured) {\r\n          try {\r\n            const submissions = await getRecentSubmissions(10);\r\n            setRecentSubmissions(submissions || []);\r\n          } catch (err) {\r\n            console.warn('Failed to fetch recent submissions:', err);\r\n          }\r\n        }\r\n\r\n        // Retry any failed submissions in background\r\n        const failedCount = getFailedSubmissions().length;\r\n        if (failedCount > 0) {\r\n          console.log(`Retrying ${failedCount} failed submissions...`);\r\n          retryFailedSubmissions().then(result => {\r\n            if (result.succeeded > 0) {\r\n              console.log(`Successfully synced ${result.succeeded} previously failed submissions`);\r\n            }\r\n            if (result.remaining > 0) {\r\n              console.warn(`${result.remaining} submissions still pending retry`);\r\n            }\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to initialize:', error);\r\n        loadData(); // Fallback to localStorage\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    init();\r\n\r\n    // Subscribe to real-time machine updates\r\n    const unsubscribeMachines = subscribeToMachineUpdates((updatedMachines) => {\r\n      console.log('Real-time update received:', updatedMachines.length, 'machines');\r\n      setMachines(updatedMachines);\r\n    });\r\n\r\n    // Subscribe to real-time session updates for cross-browser sync\r\n    const unsubscribeSessions = subscribeToSessionChanges((sessions) => {\r\n      console.log('🔄 Session update received:', sessions.length, 'active sessions', sessions.map(s => s.machine_name));\r\n      setActiveSessions(sessions);\r\n    });\r\n\r\n    // Subscribe to activity feed for real-time machine events\r\n    const unsubscribeActivity = subscribeToActivityFeed((events) => {\r\n      setActivityEvents(events);\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeMachines();\r\n      unsubscribeSessions();\r\n      unsubscribeActivity();\r\n    };\r\n  }, [loadData]);\r\n\r\n  // Update time every second - no dependencies to avoid infinite recreation\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      const now = new Date();\r\n      setCurrentTime(now);\r\n      // Update shift based on current time\r\n      const hours = now.getUTCHours() + 2;\r\n      setShift(hours >= 6 && hours < 18 ? 'Day' : 'Night');\r\n    }, 1000);\r\n\r\n    // Set initial shift\r\n    const initialHours = new Date().getUTCHours() + 2;\r\n    setShift(initialHours >= 6 && initialHours < 18 ? 'Day' : 'Night');\r\n\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  const handleMachineClick = (machine: Machine) => {\r\n    if (machine.status === 'maintenance') return;\r\n\r\n    // If machine has sub-machines, show the selection modal\r\n    if (machine.subMachineCount && machine.subMachineCount > 0) {\r\n      setSelectedMachineForSub(machine);\r\n    } else {\r\n      navigate(`/capture/${machine.id}`, { state: { machineName: machine.name } });\r\n    }\r\n  };\r\n\r\n  const handleSubMachineSelect = (machine: Machine, subMachineNumber: number, isActive: boolean) => {\r\n    const fullName = `${machine.name} - Machine ${subMachineNumber}`;\r\n\r\n    // Note: isActive is for visual display only - machine is still clickable to continue session\r\n\r\n    if (multiSelectMode) {\r\n      // Only allow selection from the same parent group\r\n      if (selectedMachines.length > 0) {\r\n        const firstSelectedParent = selectedMachines[0].split(' - ')[0];\r\n        if (machine.name !== firstSelectedParent) {\r\n          // Different group - don't allow\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Toggle selection\r\n      setSelectedMachines(prev =>\r\n        prev.includes(fullName)\r\n          ? prev.filter(m => m !== fullName)\r\n          : [...prev, fullName]\r\n      );\r\n    } else {\r\n      // Direct navigation - use submachine ID for proper status tracking\r\n      const subMachineId = `${machine.id}-sub-${subMachineNumber}`;\r\n      navigate(`/capture/${subMachineId}`, {\r\n        state: {\r\n          machineName: fullName,\r\n          parentMachine: machine.name,\r\n          parentMachineId: machine.id,\r\n          subMachineNumber: subMachineNumber,\r\n          subMachineId: subMachineId\r\n        }\r\n      });\r\n    }\r\n    setSelectedMachineForSub(null);\r\n  };\r\n\r\n  const handleStartMultiCapture = () => {\r\n    if (selectedMachines.length === 0) return;\r\n\r\n    // Extract parent group from first selected machine\r\n    const parentGroup = selectedMachines[0].split(' - ')[0];\r\n\r\n    navigate(`/capture/multi`, {\r\n      state: {\r\n        machineNames: selectedMachines,\r\n        parentGroup: parentGroup,\r\n        isMultiMachine: true\r\n      }\r\n    });\r\n  };\r\n\r\n  // Long-press handlers for entering multi-select mode\r\n  const handleLongPressStart = (machine: Machine, subMachineNumber: number, isActive: boolean) => {\r\n    // isActive is kept for future use but doesn't block interaction\r\n    const fullName = `${machine.name} - Machine ${subMachineNumber}`;\r\n\r\n    longPressTimerRef.current = setTimeout(() => {\r\n      // Enter multi-select mode and select this machine\r\n      setMultiSelectMode(true);\r\n      setSelectedMachines([fullName]);\r\n    }, LONG_PRESS_DURATION);\r\n  };\r\n\r\n  const handleLongPressEnd = () => {\r\n    if (longPressTimerRef.current) {\r\n      clearTimeout(longPressTimerRef.current);\r\n      longPressTimerRef.current = null;\r\n    }\r\n  };\r\n\r\n  const cancelMultiSelect = () => {\r\n    setMultiSelectMode(false);\r\n    setSelectedMachines([]);\r\n  };\r\n\r\n  // Get the parent group of currently selected machines (for highlighting)\r\n  const selectedParentGroup = selectedMachines.length > 0\r\n    ? selectedMachines[0].split(' - ')[0]\r\n    : null;\r\n\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'running': return 'var(--neon-green)';\r\n      case 'idle': return 'var(--neon-cyan)';\r\n      case 'maintenance': return 'var(--neon-red)';\r\n      default: return 'var(--neon-cyan)';\r\n    }\r\n  };\r\n\r\n  const getStatusGradient = (status: string) => {\r\n    switch (status) {\r\n      case 'running': return 'var(--gradient-running)';\r\n      case 'idle': return 'var(--gradient-idle)';\r\n      case 'maintenance': return 'var(--gradient-maintenance)';\r\n      default: return 'var(--gradient-idle)';\r\n    }\r\n  };\r\n\r\n  // Calculate efficiency (running / total * 100) - considering group machines with active sub-machines\r\n  const efficiency = useMemo(() => {\r\n    let running = 0;\r\n    let total = 0;\r\n\r\n    machines.forEach(machine => {\r\n      if (machine.status !== 'maintenance') {\r\n        total++;\r\n        // Check if group machine has any active sub-machines\r\n        const hasActiveSubMachines = machine.subMachineCount && machine.subMachineCount > 0\r\n          ? getActiveSubMachines(machine.name, machine.subMachineCount, machine.id).size > 0\r\n          : false;\r\n\r\n        if (machine.status === 'running' || hasActiveSubMachines) {\r\n          running++;\r\n        }\r\n      }\r\n    });\r\n\r\n    return total > 0 ? Math.round((running / total) * 100) : 0;\r\n  }, [machines, getActiveSubMachines]);\r\n\r\n  // Calculate running/idle counts considering group machines with active sub-machines\r\n  const machineStatusCounts = useMemo(() => {\r\n    let running = 0;\r\n    let idle = 0;\r\n    let maintenance = 0;\r\n\r\n    machines.forEach(machine => {\r\n      if (machine.status === 'maintenance') {\r\n        maintenance++;\r\n      } else {\r\n        // Check if group machine has any active sub-machines\r\n        const hasActiveSubMachines = machine.subMachineCount && machine.subMachineCount > 0\r\n          ? getActiveSubMachines(machine.name, machine.subMachineCount, machine.id).size > 0\r\n          : false;\r\n\r\n        if (machine.status === 'running' || hasActiveSubMachines) {\r\n          running++;\r\n        } else {\r\n          idle++;\r\n        }\r\n      }\r\n    });\r\n\r\n    return { running, idle, maintenance };\r\n  }, [machines, getActiveSubMachines]);\r\n\r\n  const runningCount = machineStatusCounts.running;\r\n  const idleCount = machineStatusCounts.idle;\r\n  const maintenanceCount = machineStatusCounts.maintenance;\r\n\r\n  // State for activity drawer\r\n  const [activityDrawerOpen, setActivityDrawerOpen] = useState(false);\r\n  const [activeDrawerTab, setActiveDrawerTab] = useState<'submissions' | 'activity'>('activity');\r\n\r\n  return (\r\n    <div className=\"dashboard-v2 layout-grid-only\">\r\n      {/* Top Navigation Bar with Integrated Stats */}\r\n      <header className=\"top-nav compact\">\r\n        <div className=\"nav-brand\">\r\n          <div className=\"brand-icon\">\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\" />\r\n            </svg>\r\n          </div>\r\n          <div className=\"brand-text\">\r\n            <span className=\"brand-name\">Production Control</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Integrated Stats Bar */}\r\n        <div className=\"nav-stats\">\r\n          <div className=\"nav-stat efficiency\">\r\n            <svg viewBox=\"0 0 36 36\" className=\"efficiency-mini-ring\">\r\n              <circle cx=\"18\" cy=\"18\" r=\"15\" className=\"ring-bg-mini\" />\r\n              <circle\r\n                cx=\"18\" cy=\"18\" r=\"15\"\r\n                className=\"ring-progress-mini\"\r\n                strokeDasharray={`${efficiency * 0.94} 94`}\r\n                style={{ stroke: efficiency > 70 ? 'var(--neon-green)' : efficiency > 40 ? 'var(--neon-amber)' : 'var(--neon-red)' }}\r\n              />\r\n            </svg>\r\n            <span className=\"stat-value-inline\">{efficiency}%</span>\r\n          </div>\r\n          <div className=\"nav-stat running\">\r\n            <span className=\"stat-dot\"></span>\r\n            <span className=\"stat-value-inline\">{runningCount}</span>\r\n            <span className=\"stat-label-inline\">Running</span>\r\n          </div>\r\n          <div className=\"nav-stat idle\">\r\n            <span className=\"stat-dot\"></span>\r\n            <span className=\"stat-value-inline\">{idleCount}</span>\r\n            <span className=\"stat-label-inline\">Idle</span>\r\n          </div>\r\n          {maintenanceCount > 0 && (\r\n            <div className=\"nav-stat maintenance\">\r\n              <span className=\"stat-dot\"></span>\r\n              <span className=\"stat-value-inline\">{maintenanceCount}</span>\r\n              <span className=\"stat-label-inline\">Maintenance</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"nav-center\">\r\n          <div className=\"live-clock\" role=\"status\" aria-live=\"polite\" aria-label=\"Current time\">\r\n            <PulseIndicator color=\"var(--neon-green)\" />\r\n            <span className=\"clock-time\">{format(currentTime, 'HH:mm:ss')}</span>\r\n            <span className=\"clock-date\">{format(currentTime, 'dd MMM yyyy')}</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"nav-actions\">\r\n          <div className={`shift-indicator ${shift.toLowerCase()}`}>\r\n            <span className=\"shift-icon\" aria-hidden=\"true\">{shift === 'Day' ? '◐' : '◑'}</span>\r\n            <span className=\"shift-text\">{shift} Shift</span>\r\n          </div>\r\n          <button className=\"nav-btn admin-btn\" onClick={() => navigate('/admin')} aria-label=\"Open admin panel\">\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\" aria-hidden=\"true\">\r\n              <path d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n            </svg>\r\n            Admin\r\n          </button>\r\n          <button className=\"nav-btn\" onClick={() => navigate('/history')} aria-label=\"View submission history\">\r\n            History\r\n          </button>\r\n          <button className=\"nav-btn settings-btn\" onClick={() => setShowSettings(true)} aria-label=\"Open machine settings\">\r\n            <svg className=\"settings-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\" aria-hidden=\"true\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"3\" />\r\n              <path d=\"M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Machine Settings Modal */}\r\n      <MachineSettingsModal\r\n        isOpen={showSettings}\r\n        onClose={() => setShowSettings(false)}\r\n        onMachinesUpdated={loadData}\r\n      />\r\n\r\n      {/* Sub-Machine Selection Modal */}\r\n      <SubMachineModal\r\n        isOpen={!!selectedMachineForSub}\r\n        machine={selectedMachineForSub}\r\n        onClose={() => setSelectedMachineForSub(null)}\r\n        onSelectSubMachine={handleSubMachineSelect}\r\n        activeSubMachines={selectedMachineForSub ? getActiveSubMachines(selectedMachineForSub.name, selectedMachineForSub.subMachineCount || 0, selectedMachineForSub.id) : new Set()}\r\n      />\r\n\r\n      <main className=\"dashboard-main full-width\">\r\n        {/* Main Content - Machine Grid */}\r\n        <section className={`machines-section ${multiSelectMode ? 'multi-select-mode' : ''}`}>\r\n          <div className=\"section-header\">\r\n            <h2>\r\n              Production Lines\r\n              {multiSelectMode && <span className=\"multi-select-hint\"> — Hold to select machines</span>}\r\n            </h2>\r\n            <div className=\"header-actions\">\r\n              {multiSelectMode && (\r\n                <button\r\n                  className=\"cancel-select-btn\"\r\n                  onClick={cancelMultiSelect}\r\n                >\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"18\" height=\"18\">\r\n                    <path d=\"M18 6L6 18M6 6l12 12\" />\r\n                  </svg>\r\n                  Cancel\r\n                </button>\r\n              )}\r\n              <div className=\"view-toggle\" role=\"group\" aria-label=\"View options\">\r\n                <button\r\n                  className={selectedView === 'grid' ? 'active' : ''}\r\n                  onClick={() => setSelectedView('grid')}\r\n                  aria-label=\"Grid view\"\r\n                  aria-pressed={selectedView === 'grid'}\r\n                >\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"18\" height=\"18\" aria-hidden=\"true\">\r\n                    <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                    <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                    <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                    <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" rx=\"1\" />\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  className={selectedView === 'list' ? 'active' : ''}\r\n                  onClick={() => setSelectedView('list')}\r\n                  aria-label=\"List view\"\r\n                  aria-pressed={selectedView === 'list'}\r\n                >\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"18\" height=\"18\" aria-hidden=\"true\">\r\n                    <rect x=\"3\" y=\"4\" width=\"18\" height=\"4\" rx=\"1\" />\r\n                    <rect x=\"3\" y=\"10\" width=\"18\" height=\"4\" rx=\"1\" />\r\n                    <rect x=\"3\" y=\"16\" width=\"18\" height=\"4\" rx=\"1\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <AnimatePresence mode=\"wait\">\r\n            {selectedView === 'grid' ? (\r\n              <motion.div\r\n                key=\"grid\"\r\n                className=\"machines-grid-v2\"\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n              >\r\n                {machines.map((machine, index) => {\r\n                  // Get active sub-machines first (needed for status calculation)\r\n                  const activeSubMachines = machine.subMachineCount && machine.subMachineCount > 0\r\n                    ? getActiveSubMachines(machine.name, machine.subMachineCount, machine.id)\r\n                    : new Set<number>();\r\n\r\n                  // Machine is running if:\r\n                  // - status is 'running' OR has a current order\r\n                  // - OR for group machines: any sub-machine is active\r\n                  const hasActiveSubMachines = activeSubMachines.size > 0;\r\n                  const isRunning = machine.status === 'running' || !!machine.currentOrder || hasActiveSubMachines;\r\n                  const isBlocked = isRunning || machine.status === 'maintenance';\r\n                  const displayStatus = isRunning ? 'running' : machine.status;\r\n\r\n                  const handleTileClick = () => {\r\n                    if (machine.subMachineCount && machine.subMachineCount > 0) return;\r\n                    // Allow access to running machines (to continue session)\r\n                    handleMachineClick(machine);\r\n                  };\r\n\r\n                  return (\r\n                    <motion.div\r\n                      key={machine.id}\r\n                      className={`machine-tile ${displayStatus} ${isBlocked ? 'disabled' : ''} ${machine.subMachineCount && machine.subMachineCount > 0 ? 'has-sub-machines' : ''}`}\r\n                      initial={{ opacity: 0, scale: 0.9 }}\r\n                      animate={{ opacity: 1, scale: 1 }}\r\n                      transition={{ delay: index * 0.05 }}\r\n                      onClick={handleTileClick}\r\n                      whileHover={!isBlocked && !(machine.subMachineCount && machine.subMachineCount > 0) ? { scale: 1.02, y: -4 } : {}}\r\n                      whileTap={!isBlocked && !(machine.subMachineCount && machine.subMachineCount > 0) ? { scale: 0.98 } : {}}\r\n                    >\r\n                      <div\r\n                        className=\"tile-glow\"\r\n                        style={{ background: getStatusGradient(displayStatus) }}\r\n                      />\r\n                      <div className=\"tile-content\">\r\n                        <div className=\"tile-header\">\r\n                          <span className=\"tile-name\">{machine.name}</span>\r\n                          <div className=\"tile-status\">\r\n                            <PulseIndicator color={getStatusColor(displayStatus)} />\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"tile-status-text\">\r\n                          {isRunning ? 'Running' : machine.status.charAt(0).toUpperCase() + machine.status.slice(1)}\r\n                          {machine.subMachineCount && machine.subMachineCount > 0 && (\r\n                            <span className=\"sub-count-badge\">\r\n                              {activeSubMachines.size > 0\r\n                                ? `${activeSubMachines.size}/${machine.subMachineCount} active`\r\n                                : `${machine.subMachineCount} units`}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* For group machines: show info for each active member */}\r\n                        {machine.subMachineCount && machine.subMachineCount > 0 && activeSubMachines.size > 0 ? (\r\n                          <div className=\"active-members-info\">\r\n                            {Array.from(activeSubMachines).sort((a, b) => a - b).map(num => {\r\n                              const memberName = `${machine.name} - Machine ${num}`;\r\n                              const memberSession = activeSessions.find(s => s.machine_name === memberName);\r\n                              return (\r\n                                <div key={num} className=\"member-info\">\r\n                                  <span className=\"member-label\">M{num}:</span>\r\n                                  {memberSession ? (\r\n                                    <>\r\n                                      <span className=\"member-order\">{memberSession.order_number}</span>\r\n                                      <span className=\"member-operator\">({memberSession.operator_name})</span>\r\n                                    </>\r\n                                  ) : (\r\n                                    <span className=\"member-order\">Active</span>\r\n                                  )}\r\n                                </div>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                        ) : (\r\n                          <>\r\n                            {/* Show current order if running (single machine) */}\r\n                            {isRunning && machine.currentOrder && (\r\n                              <div className=\"tile-order\">Order: {machine.currentOrder}</div>\r\n                            )}\r\n                            {machine.currentOperator && (\r\n                              <div className=\"tile-operator\">{machine.currentOperator}</div>\r\n                            )}\r\n                          </>\r\n                        )}\r\n\r\n                        {/* Today's Stats - Waste & Downtime */}\r\n                        {machine.subMachineCount && machine.subMachineCount > 0 && activeSubMachines.size > 0 ? (\r\n                          <div className=\"members-stats\">\r\n                            {Array.from(activeSubMachines).sort((a, b) => a - b).map(num => {\r\n                              const memberName = `${machine.name} - Machine ${num}`;\r\n                              const memberSession = activeSessions.find(s => s.machine_name === memberName);\r\n                              const memberWaste = memberSession?.total_waste || 0;\r\n                              const memberDowntime = memberSession?.total_downtime || 0;\r\n                              return (\r\n                                <div key={num} className=\"member-stats-row\">\r\n                                  <span className=\"member-label\">M{num}:</span>\r\n                                  <div className=\"tile-stat waste\">\r\n                                    <span className=\"stat-icon\">🗑️</span>\r\n                                    <span className=\"stat-value\">{memberWaste.toFixed(1)}</span>\r\n                                    <span className=\"stat-unit\">kg</span>\r\n                                  </div>\r\n                                  <div className=\"tile-stat downtime\">\r\n                                    <span className=\"stat-icon\">⏱️</span>\r\n                                    <span className=\"stat-value\">{memberDowntime}</span>\r\n                                    <span className=\"stat-unit\">min</span>\r\n                                  </div>\r\n                                </div>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"tile-stats\">\r\n                            <div className=\"tile-stat waste\">\r\n                              <span className=\"stat-icon\">🗑️</span>\r\n                              <span className=\"stat-value\">{machine.todayWaste?.toFixed(1) || '0.0'}</span>\r\n                              <span className=\"stat-unit\">kg</span>\r\n                            </div>\r\n                            <div className=\"tile-stat downtime\">\r\n                              <span className=\"stat-icon\">⏱️</span>\r\n                              <span className=\"stat-value\">{machine.todayDowntime || 0}</span>\r\n                              <span className=\"stat-unit\">min</span>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n\r\n                        {/* Inline sub-machine selection */}\r\n                        {machine.subMachineCount && machine.subMachineCount > 0 && machine.status !== 'maintenance' ? (\r\n                          <div className=\"sub-machine-inline-grid\">\r\n                            {Array.from({ length: machine.subMachineCount }, (_, i) => i + 1).map(num => {\r\n                              const fullName = `${machine.name} - Machine ${num}`;\r\n                              const isActive = activeSubMachines.has(num);\r\n                              const isSelected = selectedMachines.includes(fullName);\r\n                              const isOtherGroup = Boolean(multiSelectMode && selectedParentGroup && selectedParentGroup !== machine.name);\r\n                              // Only disable for other-group, NOT for isActive (reserved machines are still clickable)\r\n                              const isDisabled = isOtherGroup;\r\n\r\n                              return (\r\n                                <motion.button\r\n                                  key={num}\r\n                                  className={`sub-machine-inline-btn ${isActive ? 'busy' : ''} ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}`}\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    handleSubMachineSelect(machine, num, isActive);\r\n                                  }}\r\n                                  onMouseDown={() => handleLongPressStart(machine, num, isActive)}\r\n                                  onMouseUp={handleLongPressEnd}\r\n                                  onMouseLeave={handleLongPressEnd}\r\n                                  onTouchStart={() => handleLongPressStart(machine, num, isActive)}\r\n                                  onTouchEnd={handleLongPressEnd}\r\n                                  whileHover={!isDisabled ? { scale: 1.1 } : {}}\r\n                                  whileTap={!isDisabled ? { scale: 0.95 } : {}}\r\n                                  title={isActive ? 'In Use - Click to continue' : (isOtherGroup ? 'Different group' : (multiSelectMode ? 'Tap to select' : 'Hold to multi-select'))}\r\n                                  disabled={isDisabled}\r\n                                >\r\n                                  {num}\r\n                                  {isActive && <span className=\"status-dot busy\" />}\r\n                                  {isSelected && <span className=\"check-mark\">✓</span>}\r\n                                </motion.button>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"tile-footer\">\r\n                            <span className=\"tile-time\">{machine.lastSubmission || 'No entries'}</span>\r\n                            {machine.status !== 'maintenance' && (\r\n                              <span className=\"tile-action\">Record →</span>\r\n                            )}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </motion.div>\r\n                  );\r\n                })}\r\n              </motion.div>\r\n            ) : (\r\n              <motion.div\r\n                key=\"list\"\r\n                className=\"machines-list\"\r\n                initial={{ opacity: 0 }}\r\n                animate={{ opacity: 1 }}\r\n                exit={{ opacity: 0 }}\r\n              >\r\n                {machines.map((machine, index) => {\r\n                  // Calculate actual status considering active sub-machines\r\n                  const activeSubMachines = machine.subMachineCount && machine.subMachineCount > 0\r\n                    ? getActiveSubMachines(machine.name, machine.subMachineCount, machine.id)\r\n                    : new Set<number>();\r\n                  const hasActiveSubMachines = activeSubMachines.size > 0;\r\n                  const isRunning = machine.status === 'running' || hasActiveSubMachines;\r\n                  const displayStatus = isRunning ? 'running' : machine.status;\r\n\r\n                  return (\r\n                    <motion.div\r\n                      key={machine.id}\r\n                      className={`machine-row ${displayStatus} ${machine.status === 'maintenance' ? 'disabled' : ''}`}\r\n                      initial={{ opacity: 0, x: -20 }}\r\n                      animate={{ opacity: 1, x: 0 }}\r\n                      transition={{ delay: index * 0.03 }}\r\n                      onClick={() => handleMachineClick(machine)}\r\n                    >\r\n                      <div className=\"row-indicator\" style={{ background: getStatusGradient(displayStatus) }} />\r\n                      <div className=\"row-name\">{machine.name}</div>\r\n                      <div className=\"row-status\">\r\n                        <PulseIndicator color={getStatusColor(displayStatus)} />\r\n                        <span>{displayStatus.charAt(0).toUpperCase() + displayStatus.slice(1)}</span>\r\n                      </div>\r\n                      <div className=\"row-operator\">{machine.currentOperator || '—'}</div>\r\n                      <div className=\"row-time\">{machine.lastSubmission || 'No entries'}</div>\r\n                      {machine.status !== 'maintenance' && (\r\n                        <button className=\"row-action\">Record</button>\r\n                      )}\r\n                    </motion.div>\r\n                  );\r\n                })}\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {/* Multi-Select Floating Action Bar */}\r\n          <AnimatePresence>\r\n            {multiSelectMode && selectedMachines.length > 0 && (\r\n              <motion.div\r\n                className=\"multi-select-bar\"\r\n                initial={{ opacity: 0, y: 50 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: 50 }}\r\n              >\r\n                <div className=\"selection-info\">\r\n                  <span className=\"selection-parent-group\">{selectedParentGroup}</span>\r\n                  <span className=\"selection-divider\">—</span>\r\n                  <span className=\"selection-machines\">\r\n                    {selectedMachines.map(m => m.split(' - Machine ')[1]).join(', ')}\r\n                  </span>\r\n                </div>\r\n                <button\r\n                  className=\"start-capture-btn\"\r\n                  onClick={handleStartMultiCapture}\r\n                >\r\n                  Start Recording ({selectedMachines.length})\r\n                  <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n                    <path d=\"M5 12h14M12 5l7 7-7 7\" />\r\n                  </svg>\r\n                </button>\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n        </section>\r\n\r\n      </main>\r\n\r\n      {/* Activity Drawer Toggle Button */}\r\n      <motion.button\r\n        className={`activity-drawer-toggle ${activityDrawerOpen ? 'open' : ''} ${activityEvents.length > 0 ? 'has-activity' : ''}`}\r\n        onClick={() => setActivityDrawerOpen(!activityDrawerOpen)}\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n      >\r\n        {activityDrawerOpen ? (\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n            <path d=\"M18 6L6 18M6 6l12 12\" />\r\n          </svg>\r\n        ) : (\r\n          <>\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n              <path d=\"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z\" />\r\n            </svg>\r\n            {activityEvents.length > 0 && <span className=\"activity-count\">{activityEvents.length}</span>}\r\n          </>\r\n        )}\r\n      </motion.button>\r\n\r\n      {/* Activity Drawer */}\r\n      <AnimatePresence>\r\n        {activityDrawerOpen && (\r\n          <motion.aside\r\n            className=\"activity-drawer\"\r\n            initial={{ x: '100%' }}\r\n            animate={{ x: 0 }}\r\n            exit={{ x: '100%' }}\r\n            transition={{ type: 'spring', damping: 25, stiffness: 200 }}\r\n          >\r\n            <div className=\"drawer-header\">\r\n              <div className=\"drawer-tabs\">\r\n                <button\r\n                  className={`drawer-tab ${activeDrawerTab === 'activity' ? 'active' : ''}`}\r\n                  onClick={() => setActiveDrawerTab('activity')}\r\n                >\r\n                  <span className=\"live-dot\"></span>\r\n                  Live Activity\r\n                </button>\r\n                <button\r\n                  className={`drawer-tab ${activeDrawerTab === 'submissions' ? 'active' : ''}`}\r\n                  onClick={() => setActiveDrawerTab('submissions')}\r\n                >\r\n                  Submissions\r\n                </button>\r\n              </div>\r\n              <button\r\n                className=\"drawer-close\"\r\n                onClick={() => setActivityDrawerOpen(false)}\r\n                aria-label=\"Close drawer\"\r\n              >\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" width=\"20\" height=\"20\">\r\n                  <path d=\"M18 6L6 18M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"drawer-content\">\r\n              {activeDrawerTab === 'activity' ? (\r\n                <div className=\"feed-list\">\r\n                  {activityEvents.length > 0 ? (\r\n                    activityEvents.slice(0, 20).map((event, index) => {\r\n                      const getEventIcon = (type: string) => {\r\n                        switch (type) {\r\n                          case 'machine_start': return '🚀';\r\n                          case 'machine_pause': return '⏸️';\r\n                          case 'machine_resume': return '▶️';\r\n                          case 'waste_recorded': return '🗑️';\r\n                          case 'downtime_recorded': return '⏱️';\r\n                          case 'pallet_scanned': return '📦';\r\n                          case 'cases_added': return '📋';\r\n                          case 'sachet_mass_added': return '⚖️';\r\n                          case 'shift_submitted': return '✅';\r\n                          case 'speed_recorded': return '⚡';\r\n                          default: return '📌';\r\n                        }\r\n                      };\r\n\r\n                      const getEventColor = (type: string) => {\r\n                        switch (type) {\r\n                          case 'machine_start': return 'event-start';\r\n                          case 'machine_pause': return 'event-pause';\r\n                          case 'machine_resume': return 'event-resume';\r\n                          case 'waste_recorded': return 'event-waste';\r\n                          case 'downtime_recorded': return 'event-downtime';\r\n                          case 'pallet_scanned': return 'event-pallet';\r\n                          case 'cases_added': return 'event-cases';\r\n                          case 'sachet_mass_added': return 'event-sachet';\r\n                          case 'shift_submitted': return 'event-submit';\r\n                          case 'speed_recorded': return 'event-speed';\r\n                          default: return '';\r\n                        }\r\n                      };\r\n\r\n                      return (\r\n                        <motion.div\r\n                          key={event.id}\r\n                          className={`feed-item ${getEventColor(event.type)}`}\r\n                          initial={{ opacity: 0, x: 20 }}\r\n                          animate={{ opacity: 1, x: 0 }}\r\n                          transition={{ delay: index * 0.03 }}\r\n                        >\r\n                          <span className=\"feed-icon\">{getEventIcon(event.type)}</span>\r\n                          <div className=\"feed-content\">\r\n                            <span className=\"feed-machine\">{event.machine_name}</span>\r\n                            <span className=\"feed-message\">{event.message}</span>\r\n                            {event.details && (\r\n                              <span className=\"feed-details\">{event.details}</span>\r\n                            )}\r\n                          </div>\r\n                          <span className=\"feed-time\">\r\n                            {format(new Date(event.timestamp), 'HH:mm:ss')}\r\n                          </span>\r\n                        </motion.div>\r\n                      );\r\n                    })\r\n                  ) : (\r\n                    <div className=\"feed-empty\">\r\n                      <span className=\"feed-empty-icon\">📡</span>\r\n                      <span>Waiting for activity...</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ) : (\r\n                <div className=\"activity-list\">\r\n                  {recentSubmissions.length > 0 ? (\r\n                    recentSubmissions.slice(0, 10).map((item, index) => {\r\n                      const allTimestamps = [\r\n                        ...(item.waste_records || []).map(r => r.recorded_at),\r\n                        ...(item.downtime_records || []).map(r => r.recorded_at),\r\n                      ].filter(Boolean).map(t => new Date(t).getTime());\r\n                      const startTime = allTimestamps.length > 0\r\n                        ? new Date(Math.min(...allTimestamps))\r\n                        : null;\r\n                      const finishTime = new Date(item.created_at);\r\n                      const machineName = item.sub_machine || item.machine;\r\n\r\n                      const runtimeMinutes = startTime\r\n                        ? Math.round((finishTime.getTime() - startTime.getTime()) / 60000)\r\n                        : null;\r\n                      const runtimeHours = runtimeMinutes ? Math.floor(runtimeMinutes / 60) : 0;\r\n                      const runtimeMins = runtimeMinutes ? runtimeMinutes % 60 : 0;\r\n                      const runtimeDisplay = runtimeMinutes\r\n                        ? (runtimeHours > 0 ? `${runtimeHours}h ${runtimeMins}m` : `${runtimeMins}m`)\r\n                        : '—';\r\n\r\n                      return (\r\n                        <motion.div\r\n                          key={item.id}\r\n                          className=\"activity-item enhanced\"\r\n                          initial={{ opacity: 0, y: 10 }}\r\n                          animate={{ opacity: 1, y: 0 }}\r\n                          transition={{ delay: index * 0.05 }}\r\n                        >\r\n                          <div className=\"activity-header\">\r\n                            <span className=\"activity-order\">#{item.order_number}</span>\r\n                            <span className=\"activity-machine-name\">{machineName}</span>\r\n                          </div>\r\n                          <div className=\"activity-product-info\">\r\n                            <span className=\"product-name\">{item.product}</span>\r\n                            <span className=\"batch-number\">Batch: {item.batch_number}</span>\r\n                          </div>\r\n                          <div className=\"activity-stats\">\r\n                            <span className=\"activity-stat waste\">\r\n                              <span className=\"stat-icon\">🗑️</span>\r\n                              {(item.total_waste || 0).toFixed(1)}kg\r\n                            </span>\r\n                            <span className=\"activity-stat downtime\">\r\n                              <span className=\"stat-icon\">⏱️</span>\r\n                              {item.total_downtime || 0}m\r\n                            </span>\r\n                            <span className=\"activity-stat runtime\">\r\n                              <span className=\"stat-icon\">⏲️</span>\r\n                              {runtimeDisplay}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"activity-times\">\r\n                            <span className=\"time-label\">Start:</span>\r\n                            <span className=\"time-value\">{startTime ? format(startTime, 'HH:mm') : '—'}</span>\r\n                            <span className=\"time-label\">End:</span>\r\n                            <span className=\"time-value\">{format(finishTime, 'HH:mm')}</span>\r\n                          </div>\r\n                        </motion.div>\r\n                      );\r\n                    })\r\n                  ) : recentHistory.length > 0 ? (\r\n                    recentHistory.slice(0, 10).map((item, index) => (\r\n                      <motion.div\r\n                        key={item.id || index}\r\n                        className=\"activity-item\"\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ delay: index * 0.05 }}\r\n                      >\r\n                        <div className=\"activity-icon\">\r\n                          <span className=\"icon-dot\"></span>\r\n                        </div>\r\n                        <div className=\"activity-details\">\r\n                          <span className=\"activity-machine\">{item.machine}</span>\r\n                          <span className=\"activity-meta\">\r\n                            {item.totalWaste.toFixed(1)}kg waste · {item.totalDowntime}m downtime\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"activity-time\">\r\n                          {format(new Date(item.submittedAt), 'HH:mm')}\r\n                        </div>\r\n                      </motion.div>\r\n                    ))\r\n                  ) : (\r\n                    <div className=\"activity-empty\">No recent submissions</div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </motion.aside>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n","import { supabase, isSupabaseConfigured } from './supabase';\r\n\r\n// ==========================================\r\n// LIVE SESSIONS - Cross-device sync with offline fallback\r\n// ==========================================\r\n\r\nexport interface LiveSession {\r\n    id: string; // Format: \"machineName_shift_date\"\r\n    machine_name: string;\r\n    operator_name: string;\r\n    order_number: string;\r\n    product: string;\r\n    batch_number: string;\r\n    shift: string;\r\n    session_date: string;\r\n    is_locked: boolean;\r\n    total_waste?: number;\r\n    total_downtime?: number;\r\n    // JSON-encoded entries for cross-device sync\r\n    entries_json?: string;\r\n    created_at?: string;\r\n    updated_at?: string;\r\n}\r\n\r\n// Entry types for cross-device sync\r\nexport interface SyncedWasteEntry {\r\n    id: string;\r\n    waste: number;\r\n    wasteType: string;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedDowntimeEntry {\r\n    id: string;\r\n    downtime: number;\r\n    downtimeReason: string;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedSpeedEntry {\r\n    id: string;\r\n    speed: number;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedSachetMassEntry {\r\n    id: string;\r\n    mass: number;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedLooseCasesEntry {\r\n    id: string;\r\n    batchNumber: string;\r\n    cases: number;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedPalletScanEntry {\r\n    id: string;\r\n    qrCode: string;\r\n    batchNumber: string;\r\n    palletNumber: string;\r\n    casesCount: number;\r\n    timestamp: string;\r\n    ignored?: boolean;\r\n}\r\n\r\nexport interface SyncedEntries {\r\n    wasteEntries: SyncedWasteEntry[];\r\n    downtimeEntries: SyncedDowntimeEntry[];\r\n    speedEntries: SyncedSpeedEntry[];\r\n    sachetMassEntries: SyncedSachetMassEntry[];\r\n    looseCasesEntries: SyncedLooseCasesEntry[];\r\n    palletScanEntries: SyncedPalletScanEntry[];\r\n}\r\n\r\n// Generate session ID from components\r\nexport const getLiveSessionId = (machineName: string, shift: string, date: string): string => {\r\n    return `${machineName}_${shift}_${date}`;\r\n};\r\n\r\n// Cache for active sessions (used when offline or for quick lookups)\r\nlet sessionsCache: Map<string, LiveSession> = new Map();\r\nlet lastFetchTime: number = 0;\r\nconst CACHE_TTL_MS = 30000; // 30 seconds cache\r\n\r\n// ==========================================\r\n// UPSERT SESSION (Save/Update)\r\n// ==========================================\r\nexport const upsertLiveSession = async (session: {\r\n    machineName: string;\r\n    operatorName: string;\r\n    orderNumber: string;\r\n    product: string;\r\n    batchNumber: string;\r\n    shift: string;\r\n    date: string;\r\n    locked: boolean;\r\n    totalWaste?: number;\r\n    totalDowntime?: number;\r\n}): Promise<boolean> => {\r\n    const sessionId = getLiveSessionId(session.machineName, session.shift, session.date);\r\n\r\n    const liveSession: LiveSession = {\r\n        id: sessionId,\r\n        machine_name: session.machineName,\r\n        operator_name: session.operatorName,\r\n        order_number: session.orderNumber,\r\n        product: session.product,\r\n        batch_number: session.batchNumber,\r\n        shift: session.shift,\r\n        session_date: session.date,\r\n        is_locked: session.locked,\r\n        total_waste: session.totalWaste || 0,\r\n        total_downtime: session.totalDowntime || 0,\r\n        updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    // Always update local cache first\r\n    sessionsCache.set(sessionId, liveSession);\r\n\r\n    // Try to sync to Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('live_sessions')\r\n                .upsert({\r\n                    id: sessionId,\r\n                    machine_name: session.machineName,\r\n                    operator_name: session.operatorName,\r\n                    order_number: session.orderNumber,\r\n                    product: session.product,\r\n                    batch_number: session.batchNumber,\r\n                    shift: session.shift,\r\n                    session_date: session.date,\r\n                    is_locked: session.locked,\r\n                    total_waste: session.totalWaste || 0,\r\n                    total_downtime: session.totalDowntime || 0,\r\n                    updated_at: new Date().toISOString(),\r\n                }, { onConflict: 'id' });\r\n\r\n            if (error) {\r\n                console.error('Failed to upsert live session:', error.message);\r\n                return false;\r\n            }\r\n            console.log('✅ Live session synced to Supabase:', sessionId);\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Failed to upsert live session:', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // Offline - cached locally, will sync later\r\n    return true;\r\n};\r\n\r\n// ==========================================\r\n// DELETE SESSION (When submitted or cleared)\r\n// ==========================================\r\nexport const deleteLiveSession = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string\r\n): Promise<boolean> => {\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    // Remove from local cache\r\n    sessionsCache.delete(sessionId);\r\n\r\n    // Try to delete from Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('live_sessions')\r\n                .delete()\r\n                .eq('id', sessionId);\r\n\r\n            if (error) {\r\n                console.error('Failed to delete live session:', error.message);\r\n                return false;\r\n            }\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Failed to delete live session:', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n// ==========================================\r\n// FETCH ACTIVE SESSIONS (For Dashboard)\r\n// ==========================================\r\nexport const fetchActiveSessions = async (): Promise<LiveSession[]> => {\r\n    const now = Date.now();\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    // Return cache if fresh and online fetch fails\r\n    const shouldUseCache = now - lastFetchTime < CACHE_TTL_MS;\r\n\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('live_sessions')\r\n                .select('*')\r\n                .eq('session_date', today)\r\n                .eq('is_locked', true);\r\n\r\n            if (error) {\r\n                console.error('Failed to fetch live sessions:', error.message);\r\n                // Fall back to cache\r\n                return Array.from(sessionsCache.values()).filter(\r\n                    s => s.session_date === today && s.is_locked\r\n                );\r\n            }\r\n\r\n            // Update cache with fetched data\r\n            sessionsCache.clear();\r\n            (data || []).forEach(session => {\r\n                sessionsCache.set(session.id, session);\r\n            });\r\n            lastFetchTime = now;\r\n\r\n            console.log('📋 Fetched active sessions from Supabase:', (data || []).length, data?.map(s => s.machine_name));\r\n            return data || [];\r\n        } catch (e) {\r\n            console.error('Failed to fetch live sessions:', e);\r\n            // Fall back to cache\r\n            return Array.from(sessionsCache.values()).filter(\r\n                s => s.session_date === today && s.is_locked\r\n            );\r\n        }\r\n    }\r\n\r\n    // Offline - return cached sessions\r\n    if (shouldUseCache) {\r\n        return Array.from(sessionsCache.values()).filter(\r\n            s => s.session_date === today && s.is_locked\r\n        );\r\n    }\r\n\r\n    return [];\r\n};\r\n\r\n// ==========================================\r\n// FETCH SESSION BY MACHINE NAME\r\n// ==========================================\r\nexport const fetchLiveSessionByMachine = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string\r\n): Promise<LiveSession | null> => {\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    // Check cache first\r\n    if (sessionsCache.has(sessionId)) {\r\n        return sessionsCache.get(sessionId) || null;\r\n    }\r\n\r\n    if (!isSupabaseConfigured) {\r\n        return null;\r\n    }\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('live_sessions')\r\n            .select('*')\r\n            .eq('id', sessionId)\r\n            .eq('is_locked', true)\r\n            .maybeSingle();\r\n\r\n        if (error) {\r\n            console.error('Failed to fetch session:', error.message);\r\n            return null;\r\n        }\r\n\r\n        if (data) {\r\n            // Update cache\r\n            sessionsCache.set(sessionId, data);\r\n            console.log('📋 Restored session from Supabase:', machineName);\r\n        }\r\n\r\n        return data;\r\n    } catch (e) {\r\n        console.error('Failed to fetch session by machine:', e);\r\n        return null;\r\n    }\r\n};\r\n\r\n// ==========================================\r\n// GET ACTIVE SUB-MACHINES (Replacement for localStorage check)\r\n// ==========================================\r\nexport const getActiveSubMachinesFromSupabase = async (\r\n    parentMachineName: string,\r\n    subMachineCount: number\r\n): Promise<Set<number>> => {\r\n    const activeSet = new Set<number>();\r\n    const sessions = await fetchActiveSessions();\r\n\r\n    for (let i = 1; i <= subMachineCount; i++) {\r\n        const fullName = `${parentMachineName} - Machine ${i}`;\r\n        const isActive = sessions.some(s => s.machine_name === fullName && s.is_locked);\r\n        if (isActive) {\r\n            activeSet.add(i);\r\n        }\r\n    }\r\n\r\n    return activeSet;\r\n};\r\n\r\n// ==========================================\r\n// SUBSCRIBE TO SESSION CHANGES (Real-time)\r\n// ==========================================\r\nexport const subscribeToSessionChanges = (\r\n    onUpdate: (sessions: LiveSession[]) => void\r\n) => {\r\n    if (!isSupabaseConfigured) {\r\n        return () => { }; // No-op unsubscribe\r\n    }\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    const channel = supabase\r\n        .channel('live-sessions-changes')\r\n        .on(\r\n            'postgres_changes',\r\n            { event: '*', schema: 'public', table: 'live_sessions' },\r\n            async (payload) => {\r\n                console.log('🔄 Real-time session update received:', payload.eventType);\r\n                // Refetch all sessions on any change\r\n                const sessions = await fetchActiveSessions();\r\n                onUpdate(sessions);\r\n            }\r\n        )\r\n        .subscribe((status) => {\r\n            console.log('📡 Session subscription status:', status);\r\n        });\r\n\r\n    return () => {\r\n        supabase.removeChannel(channel);\r\n    };\r\n};\r\n\r\n// ==========================================\r\n// SYNC PENDING SESSIONS (On reconnection)\r\n// ==========================================\r\nexport const syncPendingSessions = async (): Promise<void> => {\r\n    if (!isSupabaseConfigured) return;\r\n\r\n    // Any sessions in cache that might not be synced yet\r\n    for (const session of Array.from(sessionsCache.values())) {\r\n        try {\r\n            await supabase\r\n                .from('live_sessions')\r\n                .upsert({\r\n                    id: session.id,\r\n                    machine_name: session.machine_name,\r\n                    operator_name: session.operator_name,\r\n                    order_number: session.order_number,\r\n                    product: session.product,\r\n                    batch_number: session.batch_number,\r\n                    shift: session.shift,\r\n                    session_date: session.session_date,\r\n                    is_locked: session.is_locked,\r\n                    updated_at: new Date().toISOString(),\r\n                }, { onConflict: 'id' });\r\n        } catch (e) {\r\n            console.error('Failed to sync session:', session.id, e);\r\n        }\r\n    }\r\n};\r\n\r\n// ==========================================\r\n// ACTIVITY FEED - Real-time machine events\r\n// ==========================================\r\n\r\nexport type ActivityEventType =\r\n    | 'machine_start'\r\n    | 'machine_pause'\r\n    | 'machine_resume'\r\n    | 'waste_recorded'\r\n    | 'downtime_recorded'\r\n    | 'pallet_scanned'\r\n    | 'cases_added'\r\n    | 'sachet_mass_added'\r\n    | 'shift_submitted'\r\n    | 'speed_recorded';\r\n\r\nexport interface ActivityEvent {\r\n    id: string;\r\n    type: ActivityEventType;\r\n    machine_name: string;\r\n    operator_name?: string;\r\n    message: string;\r\n    details?: string;\r\n    timestamp: Date;\r\n}\r\n\r\n// In-memory activity log (most recent first)\r\nlet activityLog: ActivityEvent[] = [];\r\nconst MAX_ACTIVITY_ITEMS = 50;\r\nlet activityListeners: ((events: ActivityEvent[]) => void)[] = [];\r\n\r\n// Add an activity event\r\nexport const addActivityEvent = (event: Omit<ActivityEvent, 'id' | 'timestamp'>) => {\r\n    const newEvent: ActivityEvent = {\r\n        ...event,\r\n        id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n        timestamp: new Date(),\r\n    };\r\n\r\n    activityLog = [newEvent, ...activityLog].slice(0, MAX_ACTIVITY_ITEMS);\r\n\r\n    // Notify listeners\r\n    activityListeners.forEach(listener => listener([...activityLog]));\r\n\r\n    // Also broadcast to Supabase for cross-device sync\r\n    if (isSupabaseConfigured) {\r\n        broadcastActivityEvent(newEvent);\r\n    }\r\n};\r\n\r\n// Broadcast activity to other clients via Supabase Realtime\r\nconst broadcastActivityEvent = async (event: ActivityEvent) => {\r\n    try {\r\n        const channel = supabase.channel('activity-broadcast');\r\n        await channel.send({\r\n            type: 'broadcast',\r\n            event: 'activity',\r\n            payload: {\r\n                ...event,\r\n                timestamp: event.timestamp.toISOString(),\r\n            },\r\n        });\r\n    } catch (e) {\r\n        // Silently fail - activity feed is non-critical\r\n    }\r\n};\r\n\r\n// Subscribe to activity events\r\nexport const subscribeToActivityFeed = (\r\n    onUpdate: (events: ActivityEvent[]) => void\r\n) => {\r\n    // Add listener\r\n    activityListeners.push(onUpdate);\r\n\r\n    // Send current log immediately\r\n    onUpdate([...activityLog]);\r\n\r\n    // Subscribe to Supabase broadcast for cross-device events\r\n    let channel: ReturnType<typeof supabase.channel> | null = null;\r\n\r\n    if (isSupabaseConfigured) {\r\n        channel = supabase\r\n            .channel('activity-broadcast')\r\n            .on('broadcast', { event: 'activity' }, (payload) => {\r\n                const eventData = payload.payload as ActivityEvent & { timestamp: string };\r\n                const event: ActivityEvent = {\r\n                    ...eventData,\r\n                    timestamp: new Date(eventData.timestamp),\r\n                };\r\n\r\n                // Avoid duplicates\r\n                if (!activityLog.some(e => e.id === event.id)) {\r\n                    activityLog = [event, ...activityLog].slice(0, MAX_ACTIVITY_ITEMS);\r\n                    activityListeners.forEach(listener => listener([...activityLog]));\r\n                }\r\n            })\r\n            .subscribe();\r\n    }\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n        activityListeners = activityListeners.filter(l => l !== onUpdate);\r\n        if (channel) {\r\n            supabase.removeChannel(channel);\r\n        }\r\n    };\r\n};\r\n\r\n// Get current activity log\r\nexport const getActivityLog = (): ActivityEvent[] => [...activityLog];\r\n\r\n// Clear activity log\r\nexport const clearActivityLog = () => {\r\n    activityLog = [];\r\n    activityListeners.forEach(listener => listener([]));\r\n};\r\n\r\n// ==========================================\r\n// ENTRY SYNC - Real-time cross-device sync\r\n// ==========================================\r\n\r\n// Sync all entries to Supabase for cross-device access\r\n// Note: Requires entries_json column in live_sessions table\r\nexport const syncEntriesToSupabase = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string,\r\n    entries: SyncedEntries\r\n): Promise<boolean> => {\r\n    if (!isSupabaseConfigured) return false;\r\n\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n    const entriesJson = JSON.stringify(entries);\r\n\r\n    try {\r\n        const { error } = await supabase\r\n            .from('live_sessions')\r\n            .update({\r\n                entries_json: entriesJson,\r\n                updated_at: new Date().toISOString(),\r\n            })\r\n            .eq('id', sessionId);\r\n\r\n        if (error) {\r\n            // Silently fail if entries_json column doesn't exist yet\r\n            if (error.message.includes('entries_json') || error.message.includes('column')) {\r\n                // Column doesn't exist - sync feature not available yet\r\n                return false;\r\n            }\r\n            console.error('Failed to sync entries:', error.message);\r\n            return false;\r\n        }\r\n\r\n        console.log('📦 Entries synced to Supabase:', sessionId);\r\n        return true;\r\n    } catch (e) {\r\n        // Silently fail - sync feature may not be available\r\n        return false;\r\n    }\r\n};\r\n\r\n// Fetch entries from Supabase for a session\r\n// Note: Requires entries_json column in live_sessions table\r\nexport const fetchEntriesFromSupabase = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string\r\n): Promise<SyncedEntries | null> => {\r\n    if (!isSupabaseConfigured) return null;\r\n\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('live_sessions')\r\n            .select('entries_json')\r\n            .eq('id', sessionId)\r\n            .maybeSingle();\r\n\r\n        if (error) {\r\n            // Silently fail if entries_json column doesn't exist yet\r\n            if (error.message.includes('entries_json') || error.message.includes('column')) {\r\n                return null;\r\n            }\r\n            console.error('Failed to fetch entries:', error.message);\r\n            return null;\r\n        }\r\n\r\n        if (data?.entries_json) {\r\n            const entries = JSON.parse(data.entries_json) as SyncedEntries;\r\n            console.log('📦 Entries restored from Supabase:', sessionId);\r\n            return entries;\r\n        }\r\n\r\n        return null;\r\n    } catch (e) {\r\n        // Silently fail - sync feature may not be available\r\n        return null;\r\n    }\r\n};\r\n\r\n// Subscribe to entry changes for real-time sync\r\nexport const subscribeToEntryChanges = (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string,\r\n    onEntriesUpdate: (entries: SyncedEntries) => void\r\n) => {\r\n    if (!isSupabaseConfigured) {\r\n        return () => { }; // No-op unsubscribe\r\n    }\r\n\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    const channel = supabase\r\n        .channel(`entries-${sessionId}`)\r\n        .on(\r\n            'postgres_changes',\r\n            {\r\n                event: 'UPDATE',\r\n                schema: 'public',\r\n                table: 'live_sessions',\r\n                filter: `id=eq.${sessionId}`\r\n            },\r\n            (payload) => {\r\n                const newData = payload.new as { entries_json?: string };\r\n                if (newData.entries_json) {\r\n                    try {\r\n                        const entries = JSON.parse(newData.entries_json) as SyncedEntries;\r\n                        console.log('🔄 Real-time entries update received:', sessionId);\r\n                        onEntriesUpdate(entries);\r\n                    } catch (e) {\r\n                        console.error('Failed to parse entries update:', e);\r\n                    }\r\n                }\r\n            }\r\n        )\r\n        .subscribe((status) => {\r\n            console.log('📡 Entry sync subscription status:', status, sessionId);\r\n        });\r\n\r\n    return () => {\r\n        supabase.removeChannel(channel);\r\n    };\r\n};\r\n\r\n// Helper to safely convert timestamp to ISO string\r\nconst toISOString = (timestamp: Date | string): string => {\r\n    if (typeof timestamp === 'string') return timestamp;\r\n    if (timestamp instanceof Date) return timestamp.toISOString();\r\n    return new Date(timestamp).toISOString();\r\n};\r\n\r\n// Helper to convert local entries to synced format\r\nexport const convertToSyncedEntries = (\r\n    wasteEntries: { id: string; waste: number; wasteType: string; timestamp: Date | string }[],\r\n    downtimeEntries: { id: string; downtime: number; downtimeReason: string; timestamp: Date | string }[],\r\n    speedEntries: { id: string; speed: number; timestamp: Date | string }[],\r\n    sachetMassEntries: { id: string; mass: number; timestamp: Date | string }[],\r\n    looseCasesEntries: { id: string; batchNumber: string; cases: number; timestamp: Date | string }[],\r\n    palletScanEntries: { id: string; qrCode: string; batchNumber: string; palletNumber: string; casesCount: number; timestamp: Date | string; ignored?: boolean }[]\r\n): SyncedEntries => {\r\n    return {\r\n        wasteEntries: wasteEntries.map(e => ({\r\n            id: e.id,\r\n            waste: e.waste,\r\n            wasteType: e.wasteType,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        downtimeEntries: downtimeEntries.map(e => ({\r\n            id: e.id,\r\n            downtime: e.downtime,\r\n            downtimeReason: e.downtimeReason,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        speedEntries: speedEntries.map(e => ({\r\n            id: e.id,\r\n            speed: e.speed,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        sachetMassEntries: sachetMassEntries.map(e => ({\r\n            id: e.id,\r\n            mass: e.mass,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        looseCasesEntries: looseCasesEntries.map(e => ({\r\n            id: e.id,\r\n            batchNumber: e.batchNumber,\r\n            cases: e.cases,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        palletScanEntries: palletScanEntries.map(e => ({\r\n            id: e.id,\r\n            qrCode: e.qrCode,\r\n            batchNumber: e.batchNumber,\r\n            palletNumber: e.palletNumber,\r\n            casesCount: e.casesCount,\r\n            timestamp: toISOString(e.timestamp),\r\n            ignored: e.ignored,\r\n        })),\r\n    };\r\n};\r\n\r\n// Helper to convert synced entries back to local format\r\nexport const convertFromSyncedEntries = (synced: SyncedEntries) => {\r\n    return {\r\n        wasteEntries: synced.wasteEntries.map(e => ({\r\n            id: e.id,\r\n            waste: e.waste,\r\n            wasteType: e.wasteType,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        downtimeEntries: synced.downtimeEntries.map(e => ({\r\n            id: e.id,\r\n            downtime: e.downtime,\r\n            downtimeReason: e.downtimeReason,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        speedEntries: synced.speedEntries.map(e => ({\r\n            id: e.id,\r\n            speed: e.speed,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        sachetMassEntries: synced.sachetMassEntries.map(e => ({\r\n            id: e.id,\r\n            mass: e.mass,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        looseCasesEntries: synced.looseCasesEntries.map(e => ({\r\n            id: e.id,\r\n            batchNumber: e.batchNumber,\r\n            cases: e.cases,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        palletScanEntries: synced.palletScanEntries.map(e => ({\r\n            id: e.id,\r\n            qrCode: e.qrCode,\r\n            batchNumber: e.batchNumber,\r\n            palletNumber: e.palletNumber,\r\n            casesCount: e.casesCount,\r\n            timestamp: new Date(e.timestamp),\r\n            ignored: e.ignored,\r\n        })),\r\n    };\r\n};\r\n\r\n// ==========================================\r\n// CURRENT MACHINE ORDER - Persists across shifts\r\n// ==========================================\r\n\r\nexport interface CurrentMachineOrder {\r\n    machine_name: string;\r\n    order_number: string;\r\n    product: string;\r\n    batch_number: string;\r\n    updated_at: string;\r\n}\r\n\r\n// Save the current order for a machine (persists across shifts)\r\nexport const saveCurrentMachineOrder = async (\r\n    machineName: string,\r\n    orderNumber: string,\r\n    product: string,\r\n    batchNumber: string\r\n): Promise<boolean> => {\r\n    // Save to localStorage as fallback\r\n    const key = `current_machine_order_${machineName}`;\r\n    const order: CurrentMachineOrder = {\r\n        machine_name: machineName,\r\n        order_number: orderNumber,\r\n        product: product,\r\n        batch_number: batchNumber,\r\n        updated_at: new Date().toISOString(),\r\n    };\r\n    localStorage.setItem(key, JSON.stringify(order));\r\n\r\n    // Try to sync to Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('current_machine_orders')\r\n                .upsert({\r\n                    machine_name: machineName,\r\n                    order_number: orderNumber,\r\n                    product: product,\r\n                    batch_number: batchNumber,\r\n                    updated_at: new Date().toISOString(),\r\n                }, { onConflict: 'machine_name' });\r\n\r\n            if (error) {\r\n                // Table might not exist - that's ok, localStorage is the fallback\r\n                console.log('Current order saved to localStorage (Supabase table may not exist)');\r\n                return true;\r\n            }\r\n            console.log('✅ Current machine order synced to Supabase:', machineName);\r\n        } catch (e) {\r\n            // Silently continue - localStorage has the data\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n// Fetch the current order for a machine\r\nexport const fetchCurrentMachineOrder = async (\r\n    machineName: string\r\n): Promise<CurrentMachineOrder | null> => {\r\n    // Try Supabase first\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('current_machine_orders')\r\n                .select('*')\r\n                .eq('machine_name', machineName)\r\n                .maybeSingle();\r\n\r\n            if (!error && data) {\r\n                console.log('📋 Current machine order loaded from Supabase:', machineName);\r\n                return data;\r\n            }\r\n        } catch (e) {\r\n            // Fall through to localStorage\r\n        }\r\n    }\r\n\r\n    // Fallback to localStorage\r\n    const key = `current_machine_order_${machineName}`;\r\n    const saved = localStorage.getItem(key);\r\n    if (saved) {\r\n        try {\r\n            const order = JSON.parse(saved) as CurrentMachineOrder;\r\n            console.log('📋 Current machine order loaded from localStorage:', machineName);\r\n            return order;\r\n        } catch (e) {\r\n            // Invalid data\r\n        }\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\n// Clear the current order for a machine (on changeover)\r\nexport const clearCurrentMachineOrder = async (machineName: string): Promise<void> => {\r\n    // Clear localStorage\r\n    const key = `current_machine_order_${machineName}`;\r\n    localStorage.removeItem(key);\r\n\r\n    // Try to clear from Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            await supabase\r\n                .from('current_machine_orders')\r\n                .delete()\r\n                .eq('machine_name', machineName);\r\n        } catch (e) {\r\n            // Silently continue\r\n        }\r\n    }\r\n};\r\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n","let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction _v4(options, buf, offset) {\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    return _v4(options, buf, offset);\n}\nexport default v4;\n"],"names":["_ref","isOpen","onClose","onMachinesUpdated","machines","setMachines","useState","editingMachine","setEditingMachine","setIsAddingNew","newMachineName","setNewMachineName","newMachineStatus","setNewMachineStatus","newMachineSubCount","setNewMachineSubCount","toast","setToast","activeTab","setActiveTab","setIsSaving","useEffect","loadMachines","data","getMachinesData","showToast","message","type","setTimeout","handleStatusChange","async","machineId","newStatus","find","m","id","updateMachine","status","error","getStatusColor","getStatusIcon","_jsx","AnimatePresence","children","motion","div","className","initial","opacity","animate","exit","onClick","_jsxs","scale","y","e","stopPropagation","viewBox","fill","stroke","strokeWidth","cx","cy","r","d","length","concat","width","height","x","rx","ry","map","machine","index","transition","delay","value","name","onChange","_objectSpread","target","autoFocus","charAt","toUpperCase","slice","subMachineCount","parseInt","undefined","handleUpdateMachine","_Fragment","style","backgroundColor","title","window","confirm","deleteMachine","handleDeleteMachine","placeholder","trim","newMachine","uuidv4","addMachine","onSelectSubMachine","activeSubMachines","Set","subMachines","Array","from","_","i","x1","y1","x2","y2","num","isActive","has","button","whileHover","whileTap","PulseIndicator","_ref2","color","borderColor","Dashboard","navigate","useNavigate","currentTime","setCurrentTime","Date","shift","setShift","todayStats","setTodayStats","totalWaste","totalDowntime","submissionCount","recentHistory","setRecentHistory","selectedView","setSelectedView","showSettings","setShowSettings","selectedMachineForSub","setSelectedMachineForSub","setIsLoading","multiSelectMode","setMultiSelectMode","selectedMachines","setSelectedMachines","activeSessions","setActiveSessions","recentSubmissions","setRecentSubmissions","activityEvents","setActivityEvents","longPressTimerRef","React","current","clearTimeout","getActiveSubMachines","useCallback","machineName","_machineId","activeSet","fullName","some","s","machine_name","is_locked","add","size","isSupabaseConfigured","today","toISOString","split","hours","getUTCHours","currentShift","sessionKey","session","localStorage","getItem","JSON","parse","locked","console","warn","loadData","machineData","stats","getTodayStats","history","getShiftHistory","maybeRunCleanup","initializeMachines","sessions","fetchActiveSessions","submissions","getRecentSubmissions","err","failedCount","getFailedSubmissions","log","retryFailedSubmissions","then","result","succeeded","remaining","init","unsubscribeMachines","subscribeToMachineUpdates","updatedMachines","unsubscribeSessions","subscribeToSessionChanges","unsubscribeActivity","subscribeToActivityFeed","events","timer","setInterval","now","initialHours","clearInterval","handleMachineClick","state","handleSubMachineSelect","subMachineNumber","firstSelectedParent","prev","includes","filter","subMachineId","parentMachine","parentMachineId","handleLongPressStart","handleLongPressEnd","selectedParentGroup","getStatusGradient","efficiency","useMemo","running","total","forEach","hasActiveSubMachines","Math","round","machineStatusCounts","idle","maintenance","runningCount","idleCount","maintenanceCount","activityDrawerOpen","setActivityDrawerOpen","activeDrawerTab","setActiveDrawerTab","strokeDasharray","role","format","toLowerCase","MachineSettingsModal","SubMachineModal","cancelMultiSelect","mode","_machine$todayWaste","isRunning","currentOrder","isBlocked","displayStatus","handleTileClick","background","sort","a","b","memberName","memberSession","order_number","operator_name","currentOperator","memberWaste","total_waste","memberDowntime","total_downtime","toFixed","todayWaste","todayDowntime","isSelected","isOtherGroup","Boolean","isDisabled","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","onTouchEnd","disabled","lastSubmission","join","handleStartMultiCapture","parentGroup","machineNames","isMultiMachine","aside","damping","stiffness","event","getEventColor","getEventIcon","details","timestamp","item","allTimestamps","waste_records","recorded_at","downtime_records","t","getTime","startTime","min","finishTime","created_at","sub_machine","runtimeMinutes","runtimeHours","floor","runtimeMins","runtimeDisplay","product","batch_number","submittedAt","getLiveSessionId","date","sessionsCache","Map","lastFetchTime","upsertLiveSession","sessionId","liveSession","operatorName","orderNumber","batchNumber","session_date","updated_at","set","supabase","upsert","onConflict","deleteLiveSession","delete","eq","shouldUseCache","select","values","clear","fetchLiveSessionByMachine","get","maybeSingle","onUpdate","channel","on","schema","table","payload","eventType","subscribe","removeChannel","activityLog","activityListeners","push","eventData","listener","l","syncEntriesToSupabase","entries","entriesJson","stringify","update","entries_json","fetchEntriesFromSupabase","subscribeToEntryChanges","onEntriesUpdate","newData","new","convertToSyncedEntries","wasteEntries","downtimeEntries","speedEntries","sachetMassEntries","looseCasesEntries","palletScanEntries","waste","wasteType","downtime","downtimeReason","speed","mass","cases","qrCode","palletNumber","casesCount","ignored","convertFromSyncedEntries","synced","saveCurrentMachineOrder","key","order","setItem","fetchCurrentMachineOrder","saved","clearCurrentMachineOrder","removeItem","randomUUID","crypto","bind","getRandomValues","rnds8","Uint8Array","byteToHex","toString","unsafeStringify","arr","offset","arguments","_v4","options","buf","_options$random","_options$rng","_options","rnds","random","rng","call","Error","RangeError","native"],"ignoreList":[],"sourceRoot":""}