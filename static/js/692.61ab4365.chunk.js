"use strict";(self.webpackChunkwaste_and_downtime_dashboard=self.webpackChunkwaste_and_downtime_dashboard||[]).push([[692],{1692:(e,a,s)=>{s.r(a),s.d(a,{default:()=>x});var t=s(7051),n=s(5043),i=s(8163),c=s(9570),l=s(6446),r=s(6820),o=s(3113),d=s(6353),m=s(6451),h=s(1737),u=s(8283),p=s(579);const N=(e,a,s)=>"shift_session_".concat(e,"_").concat(a,"_").concat(s),x=()=>{var e,a;const s=(0,i.zy)(),x=(0,i.Zp)(),j=(0,n.useMemo)(()=>{var e;return(null===(e=s.state)||void 0===e?void 0:e.machineNames)||[]},[s.state]),f=(null===(e=s.state)||void 0===e?void 0:e.parentGroup)||"",v=(null===(a=s.state)||void 0===a?void 0:a.isMultiMachine)||!1,b=(0,n.useMemo)(()=>j.map(e=>e.split(" - Machine ")[1]||"?").join(", "),[j]);(0,n.useEffect)(()=>{v&&0!==j.length||x("/")},[v,j,x]),(0,n.useEffect)(()=>(f&&b&&localStorage.setItem("chat_current_machine","".concat(f," - Machine ").concat(b)),()=>{localStorage.removeItem("chat_current_machine")}),[f,b]);const[y,g]=(0,n.useState)(new Date),[w,S]=(0,n.useState)(""),[C,k]=(0,n.useState)(!1),[D,E]=(0,n.useState)(null),[T,A]=(0,n.useState)(!1),[M,P]=(0,n.useState)(j.map(e=>({machineName:e,operatorName:"",speed:""}))),[_,R]=(0,n.useState)(""),[I,U]=(0,n.useState)(""),[O,W]=(0,n.useState)(""),[H,L]=(0,n.useState)(!1),[B,G]=(0,n.useState)([]),[F,V]=(0,n.useState)([]),[q,z]=(0,n.useState)(!1),[J,K]=(0,n.useState)(!1),[Z,Q]=(0,n.useState)(""),[X,Y]=(0,n.useState)(""),[$,ee]=(0,n.useState)(""),[ae,se]=(0,n.useState)(""),te=(e,a)=>{E({message:e,type:a}),setTimeout(()=>E(null),4e3)};(0,n.useEffect)(()=>{const e=setInterval(()=>{const e=new Date;g(e)},1e3),a=y.getUTCHours()+2;return S(a>=6&&a<18?"Day":"Night"),()=>clearInterval(e)},[y]);const ne=(e,a,s)=>{P(n=>{const i=[...n];return i[e]=(0,t.A)((0,t.A)({},i[e]),{},{[a]:s}),i})},ie=M.every(e=>""!==e.operatorName)&&_&&I&&O,ce=B.reduce((e,a)=>e+a.waste,0),le=F.reduce((e,a)=>e+a.downtime,0);return(0,p.jsxs)(l.P.div,{className:"capture-screen-v2 multi-capture",initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[C&&(0,p.jsxs)("div",{className:"spinner-overlay-v2",children:[(0,p.jsx)("div",{className:"spinner-v2"}),(0,p.jsxs)("p",{children:["Submitting for ",M.length," machines..."]})]}),D&&(0,p.jsx)(l.P.div,{className:"toast-container-v2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,p.jsxs)("div",{className:"toast-message-v2 ".concat(D.type),children:[(0,p.jsx)("span",{className:"toast-icon",children:"success"===D.type?"\u2713":"!"}),D.message]})}),(0,p.jsx)(d.A,{isOpen:T,title:"Submit for All Machines?",message:"This will submit data for ".concat(M.length," machines:\n").concat(M.map(e=>e.machineName).join(", ")),onConfirm:async()=>{A(!1),k(!0);const e=B.reduce((e,a)=>e+a.waste,0),a=F.reduce((e,a)=>e+a.downtime,0);try{for(const i of M){const s={id:(0,r.A)(),operatorName:i.operatorName,machine:i.machineName,orderNumber:_,product:I,batchNumber:O,shift:w,date:y.toISOString().split("T")[0],wasteEntries:B,downtimeEntries:F,speedEntries:i.speed?[{id:(0,r.A)(),speed:Number(i.speed),timestamp:new Date}]:[],totalWaste:e,totalDowntime:a,submittedAt:new Date};(0,u.IN)(s),await(0,h.jw)({operator_name:i.operatorName,machine:i.machineName,order_number:_,product:I,batch_number:O,shift:w,submission_date:y.toISOString().split("T")[0],is_early_submission:!1},B.map(e=>({waste:e.waste,wasteType:e.wasteType,timestamp:e.timestamp})),F.map(e=>({downtime:e.downtime,downtimeReason:e.downtimeReason,timestamp:e.timestamp})),i.speed?[{speed:Number(i.speed),timestamp:new Date}]:[],[],[],[])}te("Submitted for ".concat(M.length," machines"),"success");const s=(new Date).toISOString().split("T")[0],t=(new Date).getUTCHours()+2,n=t>=6&&t<18?"Day":"Night";M.forEach(e=>{localStorage.removeItem(N(e.machineName,n,s))}),setTimeout(()=>x("/"),2e3)}catch(s){console.error("Submission error:",s),te("Saved locally. Database sync failed.","error"),setTimeout(()=>x("/"),2e3)}finally{k(!1)}},onCancel:()=>A(!1)}),(0,p.jsxs)("header",{className:"capture-header-v2",children:[(0,p.jsxs)("button",{className:"back-btn-v2",onClick:()=>{x("/")},children:[(0,p.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,p.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back"]}),(0,p.jsxs)("div",{className:"capture-title-v2",children:[(0,p.jsxs)("h1",{children:[f," \u2014 Machine ",b]}),(0,p.jsxs)("span",{className:"capture-subtitle",children:["Recording for ",M.length," machines"]})]}),(0,p.jsxs)("div",{className:"shift-badge-v2 ".concat(w.toLowerCase()),children:[(0,p.jsx)("span",{className:"shift-icon",children:"Day"===w?"\u25d0":"\u25d1"}),w," Shift"]})]}),(0,p.jsxs)("main",{className:"capture-main multi-capture-main",children:[(0,p.jsxs)("div",{className:"capture-form-column",children:[(0,p.jsxs)("section",{className:"form-section",children:[(0,p.jsxs)("h2",{className:"section-heading",children:["Machine Assignments",H&&(0,p.jsx)("span",{className:"locked-badge",children:"\ud83d\udd12 Locked"})]}),(0,p.jsx)("div",{className:"multi-machine-grid",children:M.map((e,a)=>(0,p.jsxs)("div",{className:"machine-card",children:[(0,p.jsxs)("div",{className:"machine-card-header",children:[(0,p.jsx)("span",{className:"machine-number",children:a+1}),(0,p.jsx)("span",{className:"machine-card-name",children:e.machineName.split(" - ")[1]||e.machineName}),(0,p.jsx)("span",{className:"machine-parent",children:e.machineName.split(" - ")[0]})]}),(0,p.jsxs)("div",{className:"machine-card-fields",children:[(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Operator Number"}),(0,p.jsx)("input",{type:"text",className:"form-input",value:e.operatorName,onChange:e=>ne(a,"operatorName",e.target.value),placeholder:"Enter operator number",disabled:H})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Speed (PPM)"}),(0,p.jsx)("input",{type:"number",className:"form-input",placeholder:"Enter speed",value:e.speed,onChange:e=>ne(a,"speed",e.target.value?Number(e.target.value):""),disabled:H})]})]})]},e.machineName))})]}),(0,p.jsxs)("section",{className:"form-section",children:[(0,p.jsx)("h2",{className:"section-heading",children:"Shared Order Details"}),(0,p.jsxs)("div",{className:"form-grid",children:[(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Order Number"}),(0,p.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter order number",value:_,onChange:e=>R(e.target.value),disabled:H})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Product"}),(0,p.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter product",value:I,onChange:e=>U(e.target.value),disabled:H})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Batch Number"}),(0,p.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter batch",value:O,onChange:e=>W(e.target.value),disabled:H})]}),(0,p.jsx)(o.A,{dateTime:y,shift:w})]}),!H&&ie&&(0,p.jsx)("button",{className:"lock-session-btn",onClick:()=>{if(!ie)return void te("Please fill in all required fields","error");const e=(new Date).toISOString().split("T")[0],a=(new Date).getUTCHours()+2,s=a>=6&&a<18?"Day":"Night";M.forEach(a=>{const t=N(a.machineName,s,e),n={machineName:a.machineName,operatorName:a.operatorName,orderNumber:_,product:I,batchNumber:O,shift:s,date:e,locked:!0,wasteEntries:B,downtimeEntries:F,speedEntries:a.speed?[{id:(0,r.A)(),speed:Number(a.speed),timestamp:new Date}]:[]};localStorage.setItem(t,JSON.stringify(n))}),L(!0),te("Sessions locked for all machines","success")},children:"\ud83d\udd12 Lock All Machine Sessions"})]})]}),(0,p.jsxs)("div",{className:"capture-entries-column",children:[(0,p.jsxs)("section",{className:"form-section capture-section compact-capture waste-section",children:[(0,p.jsxs)("h2",{className:"section-heading",children:[(0,p.jsx)("span",{className:"section-icon",children:"\ud83d\uddd1\ufe0f"}),"Record Waste (applies to all)",B.length>0&&(0,p.jsx)("span",{className:"entry-count-badge waste-badge",children:B.length})]}),(0,p.jsxs)("div",{className:"capture-section-content",children:[(0,p.jsxs)("button",{className:"capture-add-btn waste-btn",onClick:()=>z(!0),children:[(0,p.jsx)("span",{className:"btn-icon",children:"+"}),"Record Waste"]}),B.length>0&&(0,p.jsx)("div",{className:"capture-entries-list",children:B.slice().reverse().map((e,a)=>(0,p.jsxs)("div",{className:"capture-entry-item waste-entry ".concat(0===a?"latest":""),children:[(0,p.jsxs)("div",{className:"entry-main",children:[(0,p.jsx)("span",{className:"entry-value",children:e.waste}),(0,p.jsx)("span",{className:"entry-unit",children:"kg"})]}),(0,p.jsx)("span",{className:"entry-type",children:e.wasteType}),(0,p.jsx)("span",{className:"entry-time",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,p.jsx)("button",{className:"entry-delete-btn",onClick:()=>{return a=e.id,G(B.filter(e=>e.id!==a)),void te("Entry removed","success");var a},title:"Delete this entry",children:"\u2715"})]},e.id))}),B.length>0&&(0,p.jsxs)("div",{className:"section-total",children:[(0,p.jsx)("span",{children:"Total Waste:"}),(0,p.jsxs)("strong",{children:[ce.toFixed(1)," kg"]})]})]})]}),(0,p.jsxs)("section",{className:"form-section capture-section compact-capture downtime-section",children:[(0,p.jsxs)("h2",{className:"section-heading",children:[(0,p.jsx)("span",{className:"section-icon",children:"\u23f1\ufe0f"}),"Record Downtime (applies to all)",F.length>0&&(0,p.jsx)("span",{className:"entry-count-badge downtime-badge",children:F.length})]}),(0,p.jsxs)("div",{className:"capture-section-content",children:[(0,p.jsxs)("button",{className:"capture-add-btn downtime-btn",onClick:()=>K(!0),children:[(0,p.jsx)("span",{className:"btn-icon",children:"+"}),"Record Downtime"]}),F.length>0&&(0,p.jsx)("div",{className:"capture-entries-list",children:F.slice().reverse().map((e,a)=>(0,p.jsxs)("div",{className:"capture-entry-item downtime-entry ".concat(0===a?"latest":""),children:[(0,p.jsxs)("div",{className:"entry-main",children:[(0,p.jsx)("span",{className:"entry-value",children:e.downtime}),(0,p.jsx)("span",{className:"entry-unit",children:"min"})]}),(0,p.jsx)("span",{className:"entry-reason",children:e.downtimeReason}),(0,p.jsx)("span",{className:"entry-time",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,p.jsx)("button",{className:"entry-delete-btn",onClick:()=>{return a=e.id,V(F.filter(e=>e.id!==a)),void te("Entry removed","success");var a},title:"Delete this entry",children:"\u2715"})]},e.id))}),F.length>0&&(0,p.jsxs)("div",{className:"section-total",children:[(0,p.jsx)("span",{children:"Total Downtime:"}),(0,p.jsxs)("strong",{children:[Math.floor(le/60),"h ",le%60,"m"]})]})]})]}),(0,p.jsxs)("button",{className:"submit-all-btn",onClick:()=>{H?0!==B.length||0!==F.length?A(!0):te("Please add at least one waste or downtime entry","error"):te("Please lock session details first","error")},disabled:!H||C,children:["Submit for All ",M.length," Machines",(0,p.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,p.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7"})})]})]})]}),(0,p.jsx)(c.N,{children:q&&(0,p.jsx)(l.P.div,{className:"modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>z(!1),children:(0,p.jsxs)(l.P.div,{className:"modal-content",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:e=>e.stopPropagation(),children:[(0,p.jsx)("h3",{children:"Record Waste"}),(0,p.jsxs)("div",{className:"modal-form",children:[(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Amount (kg)"}),(0,p.jsx)("input",{type:"number",className:"form-input",value:Z,onChange:e=>Q(e.target.value?Number(e.target.value):""),placeholder:"Enter waste amount",autoFocus:!0})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Waste Type"}),(0,p.jsxs)("select",{className:"form-select",value:X,onChange:e=>Y(e.target.value),children:[(0,p.jsx)("option",{value:"",children:"Select Type"}),m.rE.map(e=>(0,p.jsx)("option",{value:e,children:e},e))]})]})]}),(0,p.jsxs)("div",{className:"modal-actions",children:[(0,p.jsx)("button",{className:"modal-cancel",onClick:()=>z(!1),children:"Cancel"}),(0,p.jsx)("button",{className:"modal-confirm",onClick:()=>{if(Z&&X){const e={id:(0,r.A)(),waste:Number(Z),wasteType:X,timestamp:new Date};G([...B,e]),Q(""),Y(""),z(!1),te("Waste entry added","success")}},disabled:!Z||!X,children:"Add Entry"})]})]})})}),(0,p.jsx)(c.N,{children:J&&(0,p.jsx)(l.P.div,{className:"modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>K(!1),children:(0,p.jsxs)(l.P.div,{className:"modal-content",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:e=>e.stopPropagation(),children:[(0,p.jsx)("h3",{children:"Record Downtime"}),(0,p.jsxs)("div",{className:"modal-form",children:[(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Duration (minutes)"}),(0,p.jsx)("input",{type:"number",className:"form-input",value:$,onChange:e=>ee(e.target.value?Number(e.target.value):""),placeholder:"Enter duration",autoFocus:!0})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Reason"}),(0,p.jsxs)("select",{className:"form-select",value:ae,onChange:e=>se(e.target.value),children:[(0,p.jsx)("option",{value:"",children:"Select Reason"}),m.wK.map(e=>(0,p.jsx)("option",{value:e,children:e},e))]})]})]}),(0,p.jsxs)("div",{className:"modal-actions",children:[(0,p.jsx)("button",{className:"modal-cancel",onClick:()=>K(!1),children:"Cancel"}),(0,p.jsx)("button",{className:"modal-confirm",onClick:()=>{if($&&ae){const e={id:(0,r.A)(),downtime:Number($),downtimeReason:ae,timestamp:new Date};V([...F,e]),ee(""),se(""),K(!1),te("Downtime entry added","success")}},disabled:!$||!ae,children:"Add Entry"})]})]})})})]})}},3113:(e,a,s)=>{s.d(a,{A:()=>i});s(5043);var t=s(9908),n=s(579);const i=e=>{let{dateTime:a,shift:s}=e;return(0,n.jsxs)("div",{className:"shift-info-card",children:[(0,n.jsxs)("div",{className:"shift-info-header",children:[(0,n.jsx)("span",{className:"info-label",children:"Current Date"}),(0,n.jsx)("span",{className:"info-value date",children:(0,t.GP)(a,"EEEE,")}),(0,n.jsx)("span",{className:"info-value",children:(0,t.GP)(a,"MMM d, yyyy")})]}),(0,n.jsxs)("div",{className:"shift-info-time",children:[(0,n.jsx)("span",{className:"info-label",children:"Current Time"}),(0,n.jsx)("span",{className:"time-display",children:(0,t.GP)(a,"HH:mm:ss")})]})]})}},6353:(e,a,s)=>{s.d(a,{A:()=>c});s(5043);var t=s(9570),n=s(6446),i=s(579);const c=e=>{let{isOpen:a,title:s,message:c,confirmText:l="Confirm",cancelText:r="Cancel",onConfirm:o,onCancel:d,type:m="default"}=e;return(0,i.jsx)(t.N,{children:a&&(0,i.jsx)(n.P.div,{className:"confirm-dialog-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,children:(0,i.jsxs)(n.P.div,{className:"confirm-dialog",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("div",{className:"confirm-dialog-header",children:(0,i.jsx)("h3",{children:s})}),(0,i.jsx)("div",{className:"confirm-dialog-body",children:(0,i.jsx)("p",{children:c})}),(0,i.jsxs)("div",{className:"confirm-dialog-footer",children:[(0,i.jsx)("button",{className:"btn btn-outline-secondary",onClick:d,children:r}),(0,i.jsx)("button",{className:"btn ".concat((()=>{switch(m){case"danger":return"btn-danger";case"success":return"btn-success";default:return"btn-primary"}})()),onClick:o,children:l})]})]})})})}},6820:(e,a,s)=>{s.d(a,{A:()=>o});const t={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const i=new Uint8Array(16);const c=[];for(let d=0;d<256;++d)c.push((d+256).toString(16).slice(1));function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(c[e[a+0]]+c[e[a+1]]+c[e[a+2]]+c[e[a+3]]+"-"+c[e[a+4]]+c[e[a+5]]+"-"+c[e[a+6]]+c[e[a+7]]+"-"+c[e[a+8]]+c[e[a+9]]+"-"+c[e[a+10]]+c[e[a+11]]+c[e[a+12]]+c[e[a+13]]+c[e[a+14]]+c[e[a+15]]).toLowerCase()}function r(e,a,s){var t,c,r,o;const d=null!==(t=null!==(c=(e=e||{}).random)&&void 0!==c?c:null===(r=(o=e).rng)||void 0===r?void 0:r.call(o))&&void 0!==t?t:function(){if(!n){if("undefined"===typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(i)}();if(d.length<16)throw new Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,a){if((s=s||0)<0||s+16>a.length)throw new RangeError("UUID byte range ".concat(s,":").concat(s+15," is out of buffer bounds"));for(let e=0;e<16;++e)a[s+e]=d[e];return a}return l(d)}const o=function(e,a,s){return!t.randomUUID||a||e?r(e,a,s):t.randomUUID()}}}]);
//# sourceMappingURL=692.61ab4365.chunk.js.map