"use strict";(self.webpackChunkwaste_and_downtime_dashboard=self.webpackChunkwaste_and_downtime_dashboard||[]).push([[82],{1082:(e,s,a)=>{a.r(s),a.d(s,{default:()=>j});var t=a(5043),n=a(8163),i=a(9570),c=a(6446),r=a(9908),l=a(8283),o=a(6316),d=a(1737),h=a(7051),m=a(6820),u=a(579);const x=e=>{let{isOpen:s,onClose:a,onMachinesUpdated:n}=e;const[r,o]=(0,t.useState)([]),[d,x]=(0,t.useState)(null),[,p]=(0,t.useState)(!1),[v,j]=(0,t.useState)(""),[b,N]=(0,t.useState)("idle"),[g,y]=(0,t.useState)(0),[w,f]=(0,t.useState)(null),[C,M]=(0,t.useState)("machines"),[,k]=(0,t.useState)(!1);(0,t.useEffect)(()=>{s&&(_(),M("machines"))},[s]);const _=()=>{const e=(0,l.Rg)();o(e)},S=(e,s)=>{f({message:e,type:s}),setTimeout(()=>f(null),3e3)},D=async(e,s)=>{if(r.find(s=>s.id===e))try{await(0,l.te)(e,{status:s}),_(),n()}catch(a){S("Failed to update status","error")}},E=e=>{switch(e){case"running":return"#00ff88";case"idle":return"#00f5ff";case"maintenance":return"#ff4757"}},B=e=>{switch(e){case"running":return"\u25b6";case"idle":return"\u25fc";case"maintenance":return"\u26a0"}};return s?(0,u.jsx)(i.N,{children:(0,u.jsx)(c.P.div,{className:"settings-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,children:(0,u.jsxs)(c.P.div,{className:"settings-modal-container",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),children:[(0,u.jsxs)("div",{className:"settings-modal-header",children:[(0,u.jsxs)("div",{className:"settings-header-content",children:[(0,u.jsx)("div",{className:"settings-icon-wrapper",children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,u.jsx)("path",{d:"M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"})]})}),(0,u.jsxs)("div",{className:"settings-title-group",children:[(0,u.jsx)("h2",{children:"Machine Settings"}),(0,u.jsxs)("span",{className:"settings-subtitle",children:[r.length," machines configured"]})]})]}),(0,u.jsx)("button",{className:"settings-close-btn",onClick:a,children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,u.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),(0,u.jsxs)("div",{className:"settings-tabs",children:[(0,u.jsxs)("button",{className:"settings-tab ".concat("machines"===C?"active":""),onClick:()=>M("machines"),children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,u.jsx)("path",{d:"M8 21h8M12 17v4"})]}),(0,u.jsx)("span",{children:"Machines"})]}),(0,u.jsxs)("button",{className:"settings-tab ".concat("add"===C?"active":""),onClick:()=>M("add"),children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,u.jsx)("path",{d:"M12 8v8M8 12h8"})]}),(0,u.jsx)("span",{children:"Add New"})]})]}),(0,u.jsx)(i.N,{children:w&&(0,u.jsxs)(c.P.div,{className:"settings-toast-v2 ".concat(w.type),initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[(0,u.jsx)("span",{className:"toast-icon",children:"success"===w.type?"\u2713":"\u2715"}),w.message]})}),(0,u.jsx)("div",{className:"settings-content",children:"machines"===C?(0,u.jsx)("div",{className:"machine-list-v2",children:0===r.length?(0,u.jsxs)("div",{className:"empty-machines",children:[(0,u.jsx)("div",{className:"empty-icon",children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,u.jsx)("path",{d:"M8 21h8M12 17v4"})]})}),(0,u.jsx)("p",{children:"No machines configured"}),(0,u.jsx)("button",{className:"empty-add-btn",onClick:()=>M("add"),children:"Add your first machine"})]}):r.map((e,s)=>(0,u.jsx)(c.P.div,{className:"machine-card ".concat((null===d||void 0===d?void 0:d.id)===e.id?"editing":""),initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.03*s},children:(null===d||void 0===d?void 0:d.id)===e.id?(0,u.jsxs)("div",{className:"machine-edit-mode",children:[(0,u.jsxs)("div",{className:"edit-section",children:[(0,u.jsx)("label",{className:"edit-label",children:"Machine Name"}),(0,u.jsx)("input",{type:"text",className:"edit-input",value:d.name,onChange:e=>x((0,h.A)((0,h.A)({},d),{},{name:e.target.value})),autoFocus:!0})]}),(0,u.jsx)("div",{className:"edit-row",children:(0,u.jsxs)("div",{className:"edit-section",children:[(0,u.jsx)("label",{className:"edit-label",children:"Status"}),(0,u.jsx)("div",{className:"status-select-group",children:["running","idle","maintenance"].map(e=>(0,u.jsxs)("button",{className:"status-select-btn ".concat(e," ").concat(d.status===e?"selected":""),onClick:()=>x((0,h.A)((0,h.A)({},d),{},{status:e})),children:[(0,u.jsx)("span",{className:"status-select-icon",children:B(e)}),(0,u.jsx)("span",{className:"status-select-text",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]})}),(0,u.jsxs)("div",{className:"edit-section",children:[(0,u.jsx)("label",{className:"edit-label",children:"Sub-machines (for machine groups)"}),(0,u.jsxs)("select",{className:"edit-select",value:d.subMachineCount||0,onChange:e=>x((0,h.A)((0,h.A)({},d),{},{subMachineCount:parseInt(e.target.value)||void 0})),children:[(0,u.jsx)("option",{value:"0",children:"None - Single machine"}),(0,u.jsx)("option",{value:"2",children:"2 sub-machines"}),(0,u.jsx)("option",{value:"3",children:"3 sub-machines"}),(0,u.jsx)("option",{value:"4",children:"4 sub-machines"}),(0,u.jsx)("option",{value:"5",children:"5 sub-machines"}),(0,u.jsx)("option",{value:"6",children:"6 sub-machines"}),(0,u.jsx)("option",{value:"8",children:"8 sub-machines"}),(0,u.jsx)("option",{value:"10",children:"10 sub-machines"})]})]}),(0,u.jsxs)("div",{className:"edit-actions",children:[(0,u.jsxs)("button",{className:"edit-save-btn",onClick:()=>(async e=>{k(!0);try{await(0,l.te)(e.id,e),_(),x(null),n(),S("".concat(e.name," updated successfully"),"success")}catch(s){S("Failed to update machine","error")}finally{k(!1)}})(d),children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:(0,u.jsx)("path",{d:"M20 6L9 17l-5-5"})}),"Save Changes"]}),(0,u.jsx)("button",{className:"edit-cancel-btn",onClick:()=>x(null),children:"Cancel"})]})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"machine-card-header",children:[(0,u.jsxs)("div",{className:"machine-identity",children:[(0,u.jsx)("div",{className:"machine-status-dot",style:{backgroundColor:E(e.status)},children:(0,u.jsx)("span",{className:"status-pulse"})}),(0,u.jsxs)("div",{className:"machine-name-info",children:[(0,u.jsx)("span",{className:"machine-card-name",children:e.name}),e.subMachineCount&&e.subMachineCount>0&&(0,u.jsxs)("span",{className:"machine-group-badge",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"12",height:"12",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),(0,u.jsx)("path",{d:"M8 21h8M12 17v4"})]}),e.subMachineCount," machines"]})]})]}),(0,u.jsxs)("div",{className:"machine-card-actions",children:[(0,u.jsx)("button",{className:"card-action-btn edit",onClick:()=>x(e),title:"Edit machine",children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,u.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),(0,u.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,u.jsx)("button",{className:"card-action-btn delete",onClick:()=>(async e=>{if(window.confirm('Are you sure you want to delete "'.concat(e.name,'"? This cannot be undone.'))){k(!0);try{await(0,l.Rn)(e.id),_(),n(),S("".concat(e.name," deleted"),"success")}catch(s){S("Failed to delete machine","error")}finally{k(!1)}}})(e),title:"Delete machine",children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,u.jsx)("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]})]}),(0,u.jsxs)("div",{className:"machine-quick-status",children:[(0,u.jsx)("span",{className:"quick-status-label",children:"Quick Status:"}),(0,u.jsxs)("div",{className:"quick-status-buttons",children:[(0,u.jsx)("button",{className:"quick-btn running ".concat("running"===e.status?"active":""),onClick:()=>D(e.id,"running"),children:"\u25b6 Run"}),(0,u.jsx)("button",{className:"quick-btn idle ".concat("idle"===e.status?"active":""),onClick:()=>D(e.id,"idle"),children:"\u25fc Idle"}),(0,u.jsx)("button",{className:"quick-btn maintenance ".concat("maintenance"===e.status?"active":""),onClick:()=>D(e.id,"maintenance"),children:"\u26a0 Maint"})]})]})]})},e.id))}):(0,u.jsxs)("div",{className:"add-machine-form-v2",children:[(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsxs)("label",{className:"form-label",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[(0,u.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"}),(0,u.jsx)("circle",{cx:"12",cy:"7",r:"4"})]}),"Machine Name"]}),(0,u.jsx)("input",{type:"text",className:"form-input",placeholder:"e.g., Universal 2, CNC Mill 1...",value:v,onChange:e=>j(e.target.value),autoFocus:!0})]}),(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsxs)("label",{className:"form-label",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,u.jsx)("path",{d:"M12 6v6l4 2"})]}),"Initial Status"]}),(0,u.jsx)("div",{className:"status-picker",children:["running","idle","maintenance"].map(e=>(0,u.jsxs)("button",{className:"status-picker-btn ".concat(e," ").concat(b===e?"selected":""),onClick:()=>N(e),children:[(0,u.jsx)("span",{className:"picker-icon",children:B(e)}),(0,u.jsx)("span",{className:"picker-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]}),(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsxs)("label",{className:"form-label",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,u.jsx)("path",{d:"M8 21h8M12 17v4"})]}),"Sub-machines (Optional)"]}),(0,u.jsx)("p",{className:"form-hint",children:"If this is a group name for multiple machines, select how many."}),(0,u.jsxs)("select",{className:"form-select",value:g,onChange:e=>y(parseInt(e.target.value)),children:[(0,u.jsx)("option",{value:"0",children:"None - This is a single machine"}),(0,u.jsx)("option",{value:"2",children:"2 sub-machines"}),(0,u.jsx)("option",{value:"3",children:"3 sub-machines"}),(0,u.jsx)("option",{value:"4",children:"4 sub-machines"}),(0,u.jsx)("option",{value:"5",children:"5 sub-machines"}),(0,u.jsx)("option",{value:"6",children:"6 sub-machines"}),(0,u.jsx)("option",{value:"8",children:"8 sub-machines"}),(0,u.jsx)("option",{value:"10",children:"10 sub-machines"})]})]}),(0,u.jsx)("div",{className:"form-actions",children:(0,u.jsxs)("button",{className:"form-submit-btn",onClick:async()=>{if(v.trim()){k(!0);try{const e={id:"machine-".concat((0,m.A)().slice(0,8)),name:v.trim(),status:b,subMachineCount:g>0?g:void 0};await(0,l.zl)(e),_(),p(!1),j(""),N("idle"),y(0),M("machines"),n(),S("".concat(e.name," added successfully"),"success")}catch(e){S("Failed to add machine","error")}finally{k(!1)}}else S("Please enter a machine name","error")},children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,u.jsx)("path",{d:"M12 8v8M8 12h8"})]}),"Add Machine"]})})]})}),(0,u.jsx)("div",{className:"settings-modal-footer",children:(0,u.jsxs)("button",{className:"settings-done-btn",onClick:a,children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:(0,u.jsx)("path",{d:"M20 6L9 17l-5-5"})}),"Done"]})})]})})}):null},p=e=>{let{isOpen:s,machine:a,onClose:t,onSelectSubMachine:n,activeSubMachines:r=new Set}=e;if(!s||!a||!a.subMachineCount)return null;const l=Array.from({length:a.subMachineCount},(e,s)=>s+1);return(0,u.jsx)(i.N,{children:s&&(0,u.jsx)(c.P.div,{className:"sub-machine-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,children:(0,u.jsxs)(c.P.div,{className:"sub-machine-modal",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),children:[(0,u.jsxs)("div",{className:"sub-machine-header",children:[(0,u.jsxs)("div",{className:"sub-machine-title",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"24",height:"24",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,u.jsx)("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),(0,u.jsx)("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("h2",{children:a.name}),(0,u.jsx)("span",{className:"sub-machine-subtitle",children:"Select a machine"})]})]}),(0,u.jsx)("button",{className:"sub-machine-close",onClick:t,children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:[(0,u.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,u.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,u.jsx)("div",{className:"sub-machine-grid",children:l.map(e=>{const s=r.has(e);return(0,u.jsxs)(c.P.button,{className:"sub-machine-btn ".concat(s?"busy":""),onClick:()=>n(a,e,s),whileHover:{scale:1.02},whileTap:{scale:.98},title:s?"In Use - Click to continue":"Available",children:[(0,u.jsx)("div",{className:"sub-machine-icon",children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",width:"32",height:"32",children:[(0,u.jsx)("rect",{x:"3",y:"4",width:"18",height:"12",rx:"2"}),(0,u.jsx)("path",{d:"M7 20h10"}),(0,u.jsx)("path",{d:"M9 16v4"}),(0,u.jsx)("path",{d:"M15 16v4"}),(0,u.jsx)("circle",{cx:"12",cy:"10",r:"2"})]})}),(0,u.jsxs)("div",{className:"sub-machine-info",children:[(0,u.jsxs)("span",{className:"sub-machine-name",children:["Machine ",e]}),(0,u.jsx)("span",{className:"sub-machine-label",children:a.name})]}),(0,u.jsx)("div",{className:"sub-machine-arrow",children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,u.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7"})})})]},e)})}),(0,u.jsx)("div",{className:"sub-machine-footer",children:(0,u.jsx)("button",{className:"sub-machine-cancel",onClick:t,children:"Cancel"})})]})})})},v=e=>{let{color:s}=e;return(0,u.jsxs)("span",{className:"pulse-indicator",children:[(0,u.jsx)("span",{className:"pulse-dot",style:{backgroundColor:s}}),(0,u.jsx)("span",{className:"pulse-ring",style:{borderColor:s}})]})},j=()=>{const e=(0,n.Zp)(),[s,a]=(0,t.useState)(new Date),[h,m]=(0,t.useState)(""),[j,b]=(0,t.useState)([]),[N,g]=(0,t.useState)({totalWaste:0,totalDowntime:0,submissionCount:0}),[y,w]=(0,t.useState)([]),[f,C]=(0,t.useState)("grid"),[M,k]=(0,t.useState)(!1),[_,S]=(0,t.useState)(null),[,D]=(0,t.useState)(!0),[E,B]=(0,t.useState)(!1),[W,A]=(0,t.useState)([]),[I,O]=(0,t.useState)([]),[P,F]=(0,t.useState)([]),[T,U]=(0,t.useState)([]),H=t.useRef(null);(0,t.useEffect)(()=>()=>{H.current&&clearTimeout(H.current)},[]);const R=(0,t.useCallback)((e,s,a)=>{const t=new Set;for(let i=1;i<=s;i++){const s="".concat(e," - Machine ").concat(i);I.some(e=>e.machine_name===s&&e.is_locked)&&t.add(i)}if(0===t.size&&!d.$G){const a=(new Date).toISOString().split("T")[0],i=(new Date).getUTCHours()+2,c=i>=6&&i<18?"Day":"Night";for(let r=1;r<=s;r++){const s="".concat(e," - Machine ").concat(r),i="shift_session_".concat(s,"_").concat(c,"_").concat(a),l=localStorage.getItem(i);if(l)try{JSON.parse(l).locked&&t.add(r)}catch(n){console.warn("Invalid session data for ".concat(s,":"),n)}}}return t},[I]),G=(0,t.useCallback)(()=>{const e=(0,l.Rg)();b(e);const s=(0,l.F$)();g(s);const a=(0,l.LO)().slice(0,7);w(a)},[]);(0,t.useEffect)(()=>{(async()=>{D(!0);try{(0,l.mg)();const s=await(0,l.bR)();b(s);const a=(0,l.F$)();g(a);const t=(0,l.LO)().slice(0,7);w(t);const n=await(0,o.yw)();if(O(n),d.$G)try{const e=await(0,d.h6)(10);F(e||[])}catch(e){console.warn("Failed to fetch recent submissions:",e)}const i=(0,l.Bh)().length;i>0&&(console.log("Retrying ".concat(i," failed submissions...")),(0,l.D$)().then(e=>{e.succeeded>0&&console.log("Successfully synced ".concat(e.succeeded," previously failed submissions")),e.remaining>0&&console.warn("".concat(e.remaining," submissions still pending retry"))}))}catch(s){console.error("Failed to initialize:",s),G()}finally{D(!1)}})();const e=(0,l.Hc)(e=>{console.log("Real-time update received:",e.length,"machines"),b(e)}),s=(0,o.b6)(e=>{console.log("\ud83d\udd04 Session update received:",e.length,"active sessions",e.map(e=>e.machine_name)),O(e)}),a=(0,o.$C)(e=>{U(e)});return()=>{e(),s(),a()}},[G]),(0,t.useEffect)(()=>{const e=setInterval(()=>{const e=new Date;a(e);const s=e.getUTCHours()+2;m(s>=6&&s<18?"Day":"Night")},1e3),s=(new Date).getUTCHours()+2;return m(s>=6&&s<18?"Day":"Night"),()=>clearInterval(e)},[]);const q=s=>{"maintenance"!==s.status&&(s.subMachineCount&&s.subMachineCount>0?S(s):e("/capture/".concat(s.id),{state:{machineName:s.name}}))},$=(s,a,t)=>{const n="".concat(s.name," - Machine ").concat(a);if(E){if(W.length>0){const e=W[0].split(" - ")[0];if(s.name!==e)return}A(e=>e.includes(n)?e.filter(e=>e!==n):[...e,n])}else{const t="".concat(s.id,"-sub-").concat(a);e("/capture/".concat(t),{state:{machineName:n,parentMachine:s.name,parentMachineId:s.id,subMachineNumber:a,subMachineId:t}})}S(null)},L=(e,s,a)=>{const t="".concat(e.name," - Machine ").concat(s);H.current=setTimeout(()=>{B(!0),A([t])},500)},z=()=>{H.current&&(clearTimeout(H.current),H.current=null)},V=W.length>0?W[0].split(" - ")[0]:null,J=e=>{switch(e){case"running":return"var(--neon-green)";case"idle":default:return"var(--neon-cyan)";case"maintenance":return"var(--neon-red)"}},X=e=>{switch(e){case"running":return"var(--gradient-running)";case"idle":default:return"var(--gradient-idle)";case"maintenance":return"var(--gradient-maintenance)"}},Z=(0,t.useMemo)(()=>{let e=0,s=0;return j.forEach(a=>{if("maintenance"!==a.status){s++;const t=!!(a.subMachineCount&&a.subMachineCount>0)&&R(a.name,a.subMachineCount,a.id).size>0;("running"===a.status||t)&&e++}}),s>0?Math.round(e/s*100):0},[j,R]),K=(0,t.useMemo)(()=>{let e=0,s=0,a=0;return j.forEach(t=>{if("maintenance"===t.status)a++;else{const a=!!(t.subMachineCount&&t.subMachineCount>0)&&R(t.name,t.subMachineCount,t.id).size>0;"running"===t.status||a?e++:s++}}),{running:e,idle:s,maintenance:a}},[j,R]),Q=K.running,Y=K.idle,ee=K.maintenance,[se,ae]=(0,t.useState)(!1),[te,ne]=(0,t.useState)("activity");return(0,u.jsxs)("div",{className:"dashboard-v2 layout-grid-only",children:[(0,u.jsxs)("header",{className:"top-nav compact",children:[(0,u.jsxs)("div",{className:"nav-brand",children:[(0,u.jsx)("div",{className:"brand-icon",children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,u.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})})}),(0,u.jsx)("div",{className:"brand-text",children:(0,u.jsx)("span",{className:"brand-name",children:"Production Control"})})]}),(0,u.jsxs)("div",{className:"nav-stats",children:[(0,u.jsxs)("div",{className:"nav-stat efficiency",children:[(0,u.jsxs)("svg",{viewBox:"0 0 36 36",className:"efficiency-mini-ring",children:[(0,u.jsx)("circle",{cx:"18",cy:"18",r:"15",className:"ring-bg-mini"}),(0,u.jsx)("circle",{cx:"18",cy:"18",r:"15",className:"ring-progress-mini",strokeDasharray:"".concat(.94*Z," 94"),style:{stroke:Z>70?"var(--neon-green)":Z>40?"var(--neon-amber)":"var(--neon-red)"}})]}),(0,u.jsxs)("span",{className:"stat-value-inline",children:[Z,"%"]})]}),(0,u.jsxs)("div",{className:"nav-stat running",children:[(0,u.jsx)("span",{className:"stat-dot"}),(0,u.jsx)("span",{className:"stat-value-inline",children:Q}),(0,u.jsx)("span",{className:"stat-label-inline",children:"Running"})]}),(0,u.jsxs)("div",{className:"nav-stat idle",children:[(0,u.jsx)("span",{className:"stat-dot"}),(0,u.jsx)("span",{className:"stat-value-inline",children:Y}),(0,u.jsx)("span",{className:"stat-label-inline",children:"Idle"})]}),ee>0&&(0,u.jsxs)("div",{className:"nav-stat maintenance",children:[(0,u.jsx)("span",{className:"stat-dot"}),(0,u.jsx)("span",{className:"stat-value-inline",children:ee}),(0,u.jsx)("span",{className:"stat-label-inline",children:"Maintenance"})]})]}),(0,u.jsx)("div",{className:"nav-center",children:(0,u.jsxs)("div",{className:"live-clock",role:"status","aria-live":"polite","aria-label":"Current time",children:[(0,u.jsx)(v,{color:"var(--neon-green)"}),(0,u.jsx)("span",{className:"clock-time",children:(0,r.GP)(s,"HH:mm:ss")}),(0,u.jsx)("span",{className:"clock-date",children:(0,r.GP)(s,"dd MMM yyyy")})]})}),(0,u.jsxs)("div",{className:"nav-actions",children:[(0,u.jsxs)("div",{className:"shift-indicator ".concat(h.toLowerCase()),children:[(0,u.jsx)("span",{className:"shift-icon","aria-hidden":"true",children:"Day"===h?"\u25d0":"\u25d1"}),(0,u.jsxs)("span",{className:"shift-text",children:[h," Shift"]})]}),(0,u.jsxs)("button",{className:"nav-btn admin-btn",onClick:()=>e("/admin"),"aria-label":"Open admin panel",children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18","aria-hidden":"true",children:(0,u.jsx)("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Admin"]}),(0,u.jsx)("button",{className:"nav-btn",onClick:()=>e("/history"),"aria-label":"View submission history",children:"History"}),(0,u.jsx)("button",{className:"nav-btn settings-btn",onClick:()=>k(!0),"aria-label":"Open machine settings",children:(0,u.jsxs)("svg",{className:"settings-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20","aria-hidden":"true",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,u.jsx)("path",{d:"M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"})]})})]})]}),(0,u.jsx)(x,{isOpen:M,onClose:()=>k(!1),onMachinesUpdated:G}),(0,u.jsx)(p,{isOpen:!!_,machine:_,onClose:()=>S(null),onSelectSubMachine:$,activeSubMachines:_?R(_.name,_.subMachineCount||0,_.id):new Set}),(0,u.jsx)("main",{className:"dashboard-main full-width",children:(0,u.jsxs)("section",{className:"machines-section ".concat(E?"multi-select-mode":""),children:[(0,u.jsxs)("div",{className:"section-header",children:[(0,u.jsxs)("h2",{children:["Production Lines",E&&(0,u.jsx)("span",{className:"multi-select-hint",children:" \u2014 Hold to select machines"})]}),(0,u.jsxs)("div",{className:"header-actions",children:[E&&(0,u.jsxs)("button",{className:"cancel-select-btn",onClick:()=>{B(!1),A([])},children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:(0,u.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})}),"Cancel"]}),(0,u.jsxs)("div",{className:"view-toggle",role:"group","aria-label":"View options",children:[(0,u.jsx)("button",{className:"grid"===f?"active":"",onClick:()=>C("grid"),"aria-label":"Grid view","aria-pressed":"grid"===f,children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18","aria-hidden":"true",children:[(0,u.jsx)("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),(0,u.jsx)("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),(0,u.jsx)("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"}),(0,u.jsx)("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"})]})}),(0,u.jsx)("button",{className:"list"===f?"active":"",onClick:()=>C("list"),"aria-label":"List view","aria-pressed":"list"===f,children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18","aria-hidden":"true",children:[(0,u.jsx)("rect",{x:"3",y:"4",width:"18",height:"4",rx:"1"}),(0,u.jsx)("rect",{x:"3",y:"10",width:"18",height:"4",rx:"1"}),(0,u.jsx)("rect",{x:"3",y:"16",width:"18",height:"4",rx:"1"})]})})]})]})]}),(0,u.jsx)(i.N,{mode:"wait",children:"grid"===f?(0,u.jsx)(c.P.div,{className:"machines-grid-v2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:j.map((e,s)=>{var a;const t=e.subMachineCount&&e.subMachineCount>0?R(e.name,e.subMachineCount,e.id):new Set,n=t.size>0,i="running"===e.status||!!e.currentOrder||n,r=i||"maintenance"===e.status,l=i?"running":e.status;return(0,u.jsxs)(c.P.div,{className:"machine-tile ".concat(l," ").concat(r?"disabled":""," ").concat(e.subMachineCount&&e.subMachineCount>0?"has-sub-machines":""),initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.05*s},onClick:()=>{e.subMachineCount&&e.subMachineCount>0||q(e)},whileHover:r||e.subMachineCount&&e.subMachineCount>0?{}:{scale:1.02,y:-4},whileTap:r||e.subMachineCount&&e.subMachineCount>0?{}:{scale:.98},children:[(0,u.jsx)("div",{className:"tile-glow",style:{background:X(l)}}),(0,u.jsxs)("div",{className:"tile-content",children:[(0,u.jsxs)("div",{className:"tile-header",children:[(0,u.jsx)("span",{className:"tile-name",children:e.name}),(0,u.jsx)("div",{className:"tile-status",children:(0,u.jsx)(v,{color:J(l)})})]}),(0,u.jsxs)("div",{className:"tile-status-text",children:[i?"Running":e.status.charAt(0).toUpperCase()+e.status.slice(1),e.subMachineCount&&e.subMachineCount>0&&(0,u.jsx)("span",{className:"sub-count-badge",children:t.size>0?"".concat(t.size,"/").concat(e.subMachineCount," active"):"".concat(e.subMachineCount," units")})]}),e.subMachineCount&&e.subMachineCount>0&&t.size>0?(0,u.jsx)("div",{className:"active-members-info",children:Array.from(t).sort((e,s)=>e-s).map(s=>{const a="".concat(e.name," - Machine ").concat(s),t=I.find(e=>e.machine_name===a);return(0,u.jsxs)("div",{className:"member-info",children:[(0,u.jsxs)("span",{className:"member-label",children:["M",s,":"]}),t?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"member-order",children:t.order_number}),(0,u.jsxs)("span",{className:"member-operator",children:["(",t.operator_name,")"]})]}):(0,u.jsx)("span",{className:"member-order",children:"Active"})]},s)})}):(0,u.jsxs)(u.Fragment,{children:[i&&e.currentOrder&&(0,u.jsxs)("div",{className:"tile-order",children:["Order: ",e.currentOrder]}),e.currentOperator&&(0,u.jsx)("div",{className:"tile-operator",children:e.currentOperator})]}),e.subMachineCount&&e.subMachineCount>0&&t.size>0?(0,u.jsx)("div",{className:"members-stats",children:Array.from(t).sort((e,s)=>e-s).map(s=>{const a="".concat(e.name," - Machine ").concat(s),t=I.find(e=>e.machine_name===a),n=(null===t||void 0===t?void 0:t.total_waste)||0,i=(null===t||void 0===t?void 0:t.total_downtime)||0;return(0,u.jsxs)("div",{className:"member-stats-row",children:[(0,u.jsxs)("span",{className:"member-label",children:["M",s,":"]}),(0,u.jsxs)("div",{className:"tile-stat waste",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\ud83d\uddd1\ufe0f"}),(0,u.jsx)("span",{className:"stat-value",children:n.toFixed(1)}),(0,u.jsx)("span",{className:"stat-unit",children:"kg"})]}),(0,u.jsxs)("div",{className:"tile-stat downtime",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\u23f1\ufe0f"}),(0,u.jsx)("span",{className:"stat-value",children:i}),(0,u.jsx)("span",{className:"stat-unit",children:"min"})]})]},s)})}):(0,u.jsxs)("div",{className:"tile-stats",children:[(0,u.jsxs)("div",{className:"tile-stat waste",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\ud83d\uddd1\ufe0f"}),(0,u.jsx)("span",{className:"stat-value",children:(null===(a=e.todayWaste)||void 0===a?void 0:a.toFixed(1))||"0.0"}),(0,u.jsx)("span",{className:"stat-unit",children:"kg"})]}),(0,u.jsxs)("div",{className:"tile-stat downtime",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\u23f1\ufe0f"}),(0,u.jsx)("span",{className:"stat-value",children:e.todayDowntime||0}),(0,u.jsx)("span",{className:"stat-unit",children:"min"})]})]}),e.subMachineCount&&e.subMachineCount>0&&"maintenance"!==e.status?(0,u.jsx)("div",{className:"sub-machine-inline-grid",children:Array.from({length:e.subMachineCount},(e,s)=>s+1).map(s=>{const a="".concat(e.name," - Machine ").concat(s),n=t.has(s),i=W.includes(a),r=Boolean(E&&V&&V!==e.name),l=r;return(0,u.jsxs)(c.P.button,{className:"sub-machine-inline-btn ".concat(n?"busy":""," ").concat(i?"selected":""," ").concat(l?"disabled":""),onClick:a=>{a.stopPropagation(),$(e,s)},onMouseDown:()=>L(e,s),onMouseUp:z,onMouseLeave:z,onTouchStart:()=>L(e,s),onTouchEnd:z,whileHover:l?{}:{scale:1.1},whileTap:l?{}:{scale:.95},title:n?"In Use - Click to continue":r?"Different group":E?"Tap to select":"Hold to multi-select",disabled:l,children:[s,n&&(0,u.jsx)("span",{className:"status-dot busy"}),i&&(0,u.jsx)("span",{className:"check-mark",children:"\u2713"})]},s)})}):(0,u.jsxs)("div",{className:"tile-footer",children:[(0,u.jsx)("span",{className:"tile-time",children:e.lastSubmission||"No entries"}),"maintenance"!==e.status&&(0,u.jsx)("span",{className:"tile-action",children:"Record \u2192"})]})]})]},e.id)})},"grid"):(0,u.jsx)(c.P.div,{className:"machines-list",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:j.map((e,s)=>{const a=(e.subMachineCount&&e.subMachineCount>0?R(e.name,e.subMachineCount,e.id):new Set).size>0,t="running"===e.status||a?"running":e.status;return(0,u.jsxs)(c.P.div,{className:"machine-row ".concat(t," ").concat("maintenance"===e.status?"disabled":""),initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.03*s},onClick:()=>q(e),children:[(0,u.jsx)("div",{className:"row-indicator",style:{background:X(t)}}),(0,u.jsx)("div",{className:"row-name",children:e.name}),(0,u.jsxs)("div",{className:"row-status",children:[(0,u.jsx)(v,{color:J(t)}),(0,u.jsx)("span",{children:t.charAt(0).toUpperCase()+t.slice(1)})]}),(0,u.jsx)("div",{className:"row-operator",children:e.currentOperator||"\u2014"}),(0,u.jsx)("div",{className:"row-time",children:e.lastSubmission||"No entries"}),"maintenance"!==e.status&&(0,u.jsx)("button",{className:"row-action",children:"Record"})]},e.id)})},"list")}),(0,u.jsx)(i.N,{children:E&&W.length>0&&(0,u.jsxs)(c.P.div,{className:"multi-select-bar",initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},children:[(0,u.jsxs)("div",{className:"selection-info",children:[(0,u.jsx)("span",{className:"selection-parent-group",children:V}),(0,u.jsx)("span",{className:"selection-divider",children:"\u2014"}),(0,u.jsx)("span",{className:"selection-machines",children:W.map(e=>e.split(" - Machine ")[1]).join(", ")})]}),(0,u.jsxs)("button",{className:"start-capture-btn",onClick:()=>{if(0===W.length)return;const s=W[0].split(" - ")[0];e("/capture/multi",{state:{machineNames:W,parentGroup:s,isMultiMachine:!0}})},children:["Start Recording (",W.length,")",(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,u.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7"})})]})]})})]})}),(0,u.jsx)(c.P.button,{className:"activity-drawer-toggle ".concat(se?"open":""," ").concat(T.length>0?"has-activity":""),onClick:()=>ae(!se),whileHover:{scale:1.05},whileTap:{scale:.95},children:se?(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,u.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,u.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})}),T.length>0&&(0,u.jsx)("span",{className:"activity-count",children:T.length})]})}),(0,u.jsx)(i.N,{children:se&&(0,u.jsxs)(c.P.aside,{className:"activity-drawer",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},children:[(0,u.jsxs)("div",{className:"drawer-header",children:[(0,u.jsxs)("div",{className:"drawer-tabs",children:[(0,u.jsxs)("button",{className:"drawer-tab ".concat("activity"===te?"active":""),onClick:()=>ne("activity"),children:[(0,u.jsx)("span",{className:"live-dot"}),"Live Activity"]}),(0,u.jsx)("button",{className:"drawer-tab ".concat("submissions"===te?"active":""),onClick:()=>ne("submissions"),children:"Submissions"})]}),(0,u.jsx)("button",{className:"drawer-close",onClick:()=>ae(!1),"aria-label":"Close drawer",children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,u.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),(0,u.jsx)("div",{className:"drawer-content",children:"activity"===te?(0,u.jsx)("div",{className:"feed-list",children:T.length>0?T.slice(0,20).map((e,s)=>(0,u.jsxs)(c.P.div,{className:"feed-item ".concat((e=>{switch(e){case"machine_start":return"event-start";case"machine_pause":return"event-pause";case"machine_resume":return"event-resume";case"waste_recorded":return"event-waste";case"downtime_recorded":return"event-downtime";case"pallet_scanned":return"event-pallet";case"cases_added":return"event-cases";case"sachet_mass_added":return"event-sachet";case"shift_submitted":return"event-submit";case"speed_recorded":return"event-speed";default:return""}})(e.type)),initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.03*s},children:[(0,u.jsx)("span",{className:"feed-icon",children:(e=>{switch(e){case"machine_start":return"\ud83d\ude80";case"machine_pause":return"\u23f8\ufe0f";case"machine_resume":return"\u25b6\ufe0f";case"waste_recorded":return"\ud83d\uddd1\ufe0f";case"downtime_recorded":return"\u23f1\ufe0f";case"pallet_scanned":return"\ud83d\udce6";case"cases_added":return"\ud83d\udccb";case"sachet_mass_added":return"\u2696\ufe0f";case"shift_submitted":return"\u2705";case"speed_recorded":return"\u26a1";default:return"\ud83d\udccc"}})(e.type)}),(0,u.jsxs)("div",{className:"feed-content",children:[(0,u.jsx)("span",{className:"feed-machine",children:e.machine_name}),(0,u.jsx)("span",{className:"feed-message",children:e.message}),e.details&&(0,u.jsx)("span",{className:"feed-details",children:e.details})]}),(0,u.jsx)("span",{className:"feed-time",children:(0,r.GP)(new Date(e.timestamp),"HH:mm:ss")})]},e.id)):(0,u.jsxs)("div",{className:"feed-empty",children:[(0,u.jsx)("span",{className:"feed-empty-icon",children:"\ud83d\udce1"}),(0,u.jsx)("span",{children:"Waiting for activity..."})]})}):(0,u.jsx)("div",{className:"activity-list",children:P.length>0?P.slice(0,10).map((e,s)=>{const a=[...(e.waste_records||[]).map(e=>e.recorded_at),...(e.downtime_records||[]).map(e=>e.recorded_at)].filter(Boolean).map(e=>new Date(e).getTime()),t=a.length>0?new Date(Math.min(...a)):null,n=new Date(e.created_at),i=e.sub_machine||e.machine,l=t?Math.round((n.getTime()-t.getTime())/6e4):null,o=l?Math.floor(l/60):0,d=l?l%60:0,h=l?o>0?"".concat(o,"h ").concat(d,"m"):"".concat(d,"m"):"\u2014";return(0,u.jsxs)(c.P.div,{className:"activity-item enhanced",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*s},children:[(0,u.jsxs)("div",{className:"activity-header",children:[(0,u.jsxs)("span",{className:"activity-order",children:["#",e.order_number]}),(0,u.jsx)("span",{className:"activity-machine-name",children:i})]}),(0,u.jsxs)("div",{className:"activity-product-info",children:[(0,u.jsx)("span",{className:"product-name",children:e.product}),(0,u.jsxs)("span",{className:"batch-number",children:["Batch: ",e.batch_number]})]}),(0,u.jsxs)("div",{className:"activity-stats",children:[(0,u.jsxs)("span",{className:"activity-stat waste",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\ud83d\uddd1\ufe0f"}),(e.total_waste||0).toFixed(1),"kg"]}),(0,u.jsxs)("span",{className:"activity-stat downtime",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\u23f1\ufe0f"}),e.total_downtime||0,"m"]}),(0,u.jsxs)("span",{className:"activity-stat runtime",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\u23f2\ufe0f"}),h]})]}),(0,u.jsxs)("div",{className:"activity-times",children:[(0,u.jsx)("span",{className:"time-label",children:"Start:"}),(0,u.jsx)("span",{className:"time-value",children:t?(0,r.GP)(t,"HH:mm"):"\u2014"}),(0,u.jsx)("span",{className:"time-label",children:"End:"}),(0,u.jsx)("span",{className:"time-value",children:(0,r.GP)(n,"HH:mm")})]})]},e.id)}):y.length>0?y.slice(0,10).map((e,s)=>(0,u.jsxs)(c.P.div,{className:"activity-item",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*s},children:[(0,u.jsx)("div",{className:"activity-icon",children:(0,u.jsx)("span",{className:"icon-dot"})}),(0,u.jsxs)("div",{className:"activity-details",children:[(0,u.jsx)("span",{className:"activity-machine",children:e.machine}),(0,u.jsxs)("span",{className:"activity-meta",children:[e.totalWaste.toFixed(1),"kg waste \xb7 ",e.totalDowntime,"m downtime"]})]}),(0,u.jsx)("div",{className:"activity-time",children:(0,r.GP)(new Date(e.submittedAt),"HH:mm")})]},e.id||s)):(0,u.jsx)("div",{className:"activity-empty",children:"No recent submissions"})})})]})})]})}},6316:(e,s,a)=>{a.d(s,{$C:()=>p,CJ:()=>y,Cf:()=>w,Fd:()=>j,KW:()=>o,PX:()=>v,RU:()=>g,WA:()=>l,ZX:()=>b,b6:()=>m,fetchLiveSessionByMachine:()=>h,ii:()=>C,rC:()=>f,yw:()=>d});var t=a(7051),n=a(1737);const i=(e,s,a)=>"".concat(e,"_").concat(s,"_").concat(a);let c=new Map,r=0;const l=async e=>{const s=i(e.machineName,e.shift,e.date),a={id:s,machine_name:e.machineName,operator_name:e.operatorName,order_number:e.orderNumber,product:e.product,batch_number:e.batchNumber,shift:e.shift,session_date:e.date,is_locked:e.locked,total_waste:e.totalWaste||0,total_downtime:e.totalDowntime||0,updated_at:(new Date).toISOString()};if(c.set(s,a),n.$G)try{const{error:a}=await n.ND.from("live_sessions").upsert({id:s,machine_name:e.machineName,operator_name:e.operatorName,order_number:e.orderNumber,product:e.product,batch_number:e.batchNumber,shift:e.shift,session_date:e.date,is_locked:e.locked,total_waste:e.totalWaste||0,total_downtime:e.totalDowntime||0,updated_at:(new Date).toISOString()},{onConflict:"id"});return a?(console.error("Failed to upsert live session:",a.message),!1):(console.log("\u2705 Live session synced to Supabase:",s),!0)}catch(t){return console.error("Failed to upsert live session:",t),!1}return!0},o=async(e,s,a)=>{const t=i(e,s,a);if(c.delete(t),n.$G)try{const{error:e}=await n.ND.from("live_sessions").delete().eq("id",t);return!e||(console.error("Failed to delete live session:",e.message),!1)}catch(r){return console.error("Failed to delete live session:",r),!1}return!0},d=async()=>{const e=Date.now(),s=(new Date).toISOString().split("T")[0],a=e-r<3e4;if(n.$G)try{const{data:a,error:t}=await n.ND.from("live_sessions").select("*").eq("session_date",s).eq("is_locked",!0);return t?(console.error("Failed to fetch live sessions:",t.message),Array.from(c.values()).filter(e=>e.session_date===s&&e.is_locked)):(c.clear(),(a||[]).forEach(e=>{c.set(e.id,e)}),r=e,console.log("\ud83d\udccb Fetched active sessions from Supabase:",(a||[]).length,null===a||void 0===a?void 0:a.map(e=>e.machine_name)),a||[])}catch(t){return console.error("Failed to fetch live sessions:",t),Array.from(c.values()).filter(e=>e.session_date===s&&e.is_locked)}return a?Array.from(c.values()).filter(e=>e.session_date===s&&e.is_locked):[]},h=async(e,s,a)=>{const t=i(e,s,a);if(c.has(t))return c.get(t)||null;if(!n.$G)return null;try{const{data:s,error:a}=await n.ND.from("live_sessions").select("*").eq("id",t).eq("is_locked",!0).maybeSingle();return a?(console.error("Failed to fetch session:",a.message),null):(s&&(c.set(t,s),console.log("\ud83d\udccb Restored session from Supabase:",e)),s)}catch(r){return console.error("Failed to fetch session by machine:",r),null}},m=e=>{if(!n.$G)return()=>{};(new Date).toISOString().split("T")[0];const s=n.ND.channel("live-sessions-changes").on("postgres_changes",{event:"*",schema:"public",table:"live_sessions"},async s=>{console.log("\ud83d\udd04 Real-time session update received:",s.eventType);const a=await d();e(a)}).subscribe(e=>{console.log("\ud83d\udce1 Session subscription status:",e)});return()=>{n.ND.removeChannel(s)}};let u=[];let x=[];const p=e=>{x.push(e),e([...u]);let s=null;return n.$G&&(s=n.ND.channel("activity-broadcast").on("broadcast",{event:"activity"},e=>{const s=e.payload,a=(0,t.A)((0,t.A)({},s),{},{timestamp:new Date(s.timestamp)});u.some(e=>e.id===a.id)||(u=[a,...u].slice(0,50),x.forEach(e=>e([...u])))}).subscribe()),()=>{x=x.filter(s=>s!==e),s&&n.ND.removeChannel(s)}},v=async(e,s,a,t)=>{if(!n.$G)return!1;const c=i(e,s,a),r=JSON.stringify(t);try{const{error:e}=await n.ND.from("live_sessions").update({entries_json:r,updated_at:(new Date).toISOString()}).eq("id",c);return e?(e.message.includes("entries_json")||e.message.includes("column")||console.error("Failed to sync entries:",e.message),!1):(console.log("\ud83d\udce6 Entries synced to Supabase:",c),!0)}catch(l){return!1}},j=async(e,s,a)=>{if(!n.$G)return null;const t=i(e,s,a);try{const{data:e,error:s}=await n.ND.from("live_sessions").select("entries_json").eq("id",t).maybeSingle();if(s)return s.message.includes("entries_json")||s.message.includes("column")||console.error("Failed to fetch entries:",s.message),null;if(null!==e&&void 0!==e&&e.entries_json){const s=JSON.parse(e.entries_json);return console.log("\ud83d\udce6 Entries restored from Supabase:",t),s}return null}catch(c){return null}},b=(e,s,a,t)=>{if(!n.$G)return()=>{};const c=i(e,s,a),r=n.ND.channel("entries-".concat(c)).on("postgres_changes",{event:"UPDATE",schema:"public",table:"live_sessions",filter:"id=eq.".concat(c)},e=>{const s=e.new;if(s.entries_json)try{const e=JSON.parse(s.entries_json);console.log("\ud83d\udd04 Real-time entries update received:",c),t(e)}catch(a){console.error("Failed to parse entries update:",a)}}).subscribe(e=>{console.log("\ud83d\udce1 Entry sync subscription status:",e,c)});return()=>{n.ND.removeChannel(r)}},N=e=>"string"===typeof e?e:e instanceof Date?e.toISOString():new Date(e).toISOString(),g=(e,s,a,t,n,i)=>({wasteEntries:e.map(e=>({id:e.id,waste:e.waste,wasteType:e.wasteType,timestamp:N(e.timestamp)})),downtimeEntries:s.map(e=>({id:e.id,downtime:e.downtime,downtimeReason:e.downtimeReason,timestamp:N(e.timestamp)})),speedEntries:a.map(e=>({id:e.id,speed:e.speed,timestamp:N(e.timestamp)})),sachetMassEntries:t.map(e=>({id:e.id,mass:e.mass,timestamp:N(e.timestamp)})),looseCasesEntries:n.map(e=>({id:e.id,batchNumber:e.batchNumber,cases:e.cases,timestamp:N(e.timestamp)})),palletScanEntries:i.map(e=>({id:e.id,qrCode:e.qrCode,batchNumber:e.batchNumber,palletNumber:e.palletNumber,casesCount:e.casesCount,timestamp:N(e.timestamp),ignored:e.ignored}))}),y=e=>({wasteEntries:e.wasteEntries.map(e=>({id:e.id,waste:e.waste,wasteType:e.wasteType,timestamp:new Date(e.timestamp)})),downtimeEntries:e.downtimeEntries.map(e=>({id:e.id,downtime:e.downtime,downtimeReason:e.downtimeReason,timestamp:new Date(e.timestamp)})),speedEntries:e.speedEntries.map(e=>({id:e.id,speed:e.speed,timestamp:new Date(e.timestamp)})),sachetMassEntries:e.sachetMassEntries.map(e=>({id:e.id,mass:e.mass,timestamp:new Date(e.timestamp)})),looseCasesEntries:e.looseCasesEntries.map(e=>({id:e.id,batchNumber:e.batchNumber,cases:e.cases,timestamp:new Date(e.timestamp)})),palletScanEntries:e.palletScanEntries.map(e=>({id:e.id,qrCode:e.qrCode,batchNumber:e.batchNumber,palletNumber:e.palletNumber,casesCount:e.casesCount,timestamp:new Date(e.timestamp),ignored:e.ignored}))}),w=async(e,s,a,t)=>{const i="current_machine_order_".concat(e),c={machine_name:e,order_number:s,product:a,batch_number:t,updated_at:(new Date).toISOString()};if(localStorage.setItem(i,JSON.stringify(c)),n.$G)try{const{error:i}=await n.ND.from("current_machine_orders").upsert({machine_name:e,order_number:s,product:a,batch_number:t,updated_at:(new Date).toISOString()},{onConflict:"machine_name"});if(i)return console.log("Current order saved to localStorage (Supabase table may not exist)"),!0;console.log("\u2705 Current machine order synced to Supabase:",e)}catch(r){}return!0},f=async e=>{if(n.$G)try{const{data:s,error:a}=await n.ND.from("current_machine_orders").select("*").eq("machine_name",e).maybeSingle();if(!a&&s)return console.log("\ud83d\udccb Current machine order loaded from Supabase:",e),s}catch(t){}const s="current_machine_order_".concat(e),a=localStorage.getItem(s);if(a)try{const s=JSON.parse(a);return console.log("\ud83d\udccb Current machine order loaded from localStorage:",e),s}catch(t){}return null},C=async e=>{const s="current_machine_order_".concat(e);if(localStorage.removeItem(s),n.$G)try{await n.ND.from("current_machine_orders").delete().eq("machine_name",e)}catch(a){}}},6820:(e,s,a)=>{a.d(s,{A:()=>o});const t={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const i=new Uint8Array(16);const c=[];for(let d=0;d<256;++d)c.push((d+256).toString(16).slice(1));function r(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(c[e[s+0]]+c[e[s+1]]+c[e[s+2]]+c[e[s+3]]+"-"+c[e[s+4]]+c[e[s+5]]+"-"+c[e[s+6]]+c[e[s+7]]+"-"+c[e[s+8]]+c[e[s+9]]+"-"+c[e[s+10]]+c[e[s+11]]+c[e[s+12]]+c[e[s+13]]+c[e[s+14]]+c[e[s+15]]).toLowerCase()}function l(e,s,a){var t,c,l,o;const d=null!==(t=null!==(c=(e=e||{}).random)&&void 0!==c?c:null===(l=(o=e).rng)||void 0===l?void 0:l.call(o))&&void 0!==t?t:function(){if(!n){if("undefined"===typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(i)}();if(d.length<16)throw new Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,s){if((a=a||0)<0||a+16>s.length)throw new RangeError("UUID byte range ".concat(a,":").concat(a+15," is out of buffer bounds"));for(let e=0;e<16;++e)s[a+e]=d[e];return s}return r(d)}const o=function(e,s,a){return!t.randomUUID||s||e?l(e,s,a):t.randomUUID()}}}]);
//# sourceMappingURL=82.4183a8d3.chunk.js.map