"use strict";(self.webpackChunkwaste_and_downtime_dashboard=self.webpackChunkwaste_and_downtime_dashboard||[]).push([[692],{1692:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var s=a(7051),n=a(5043),i=a(8163),r=a(9570),c=a(6446),o=a(6820),l=a(3113),d=a(6353),m=a(6451),u=a(1737),h=a(8283),p=a(579);const g=(e,t,a)=>"shift_session_".concat(e,"_").concat(t,"_").concat(a),f=()=>{var e,t;const a=(0,i.zy)(),f=(0,i.Zp)(),N=(0,n.useMemo)(()=>{var e;return(null===(e=a.state)||void 0===e?void 0:e.machineNames)||[]},[a.state]),y=(null===(e=a.state)||void 0===e?void 0:e.parentGroup)||"",x=(null===(t=a.state)||void 0===t?void 0:t.isMultiMachine)||!1,b=(0,n.useMemo)(()=>N.map(e=>e.split(" - Machine ")[1]||"?").join(", "),[N]);(0,n.useEffect)(()=>{x&&0!==N.length||f("/")},[x,N,f]),(0,n.useEffect)(()=>(y&&b&&localStorage.setItem("chat_current_machine","".concat(y," - Machine ").concat(b)),()=>{localStorage.removeItem("chat_current_machine")}),[y,b]);const[j,v]=(0,n.useState)(new Date),[w,S]=(0,n.useState)(""),[D,C]=(0,n.useState)(!1),[E,_]=(0,n.useState)(null),[I,k]=(0,n.useState)(!1),[O,A]=(0,n.useState)(N.map(e=>({machineName:e,operatorName:"",speed:""}))),[T,M]=(0,n.useState)(""),[P,R]=(0,n.useState)(""),[U,W]=(0,n.useState)(""),[J,L]=(0,n.useState)(!1),[F,B]=(0,n.useState)([]),[Y,H]=(0,n.useState)([]),[G,z]=(0,n.useState)(!1),[V,$]=(0,n.useState)(!1),[q,K]=(0,n.useState)(""),[Z,Q]=(0,n.useState)(""),[X,ee]=(0,n.useState)(""),[te,ae]=(0,n.useState)(""),se=(e,t)=>{_({message:e,type:t}),setTimeout(()=>_(null),4e3)};(0,n.useEffect)(()=>{const e=setInterval(()=>{const e=new Date;v(e)},1e3),t=j.getUTCHours()+2;return S(t>=6&&t<18?"Day":"Night"),()=>clearInterval(e)},[j]);const ne=(e,t,a)=>{A(n=>{const i=[...n];return i[e]=(0,s.A)((0,s.A)({},i[e]),{},{[t]:a}),i})},ie=O.every(e=>""!==e.operatorName)&&T&&P&&U,re=F.reduce((e,t)=>e+t.waste,0),ce=Y.reduce((e,t)=>e+t.downtime,0);return(0,p.jsxs)(c.P.div,{className:"capture-screen-v2 multi-capture",initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[D&&(0,p.jsxs)("div",{className:"spinner-overlay-v2",children:[(0,p.jsx)("div",{className:"spinner-v2"}),(0,p.jsxs)("p",{children:["Submitting for ",O.length," machines..."]})]}),E&&(0,p.jsx)(c.P.div,{className:"toast-container-v2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,p.jsxs)("div",{className:"toast-message-v2 ".concat(E.type),children:[(0,p.jsx)("span",{className:"toast-icon",children:"success"===E.type?"\u2713":"!"}),E.message]})}),(0,p.jsx)(d.A,{isOpen:I,title:"Submit for All Machines?",message:"This will submit data for ".concat(O.length," machines:\n").concat(O.map(e=>e.machineName).join(", ")),onConfirm:async()=>{k(!1),C(!0);const e=F.reduce((e,t)=>e+t.waste,0),t=Y.reduce((e,t)=>e+t.downtime,0);try{for(const i of O){const a={id:(0,o.A)(),operatorName:i.operatorName,machine:i.machineName,orderNumber:T,product:P,batchNumber:U,shift:w,date:j.toISOString().split("T")[0],wasteEntries:F,downtimeEntries:Y,speedEntries:i.speed?[{id:(0,o.A)(),speed:Number(i.speed),timestamp:new Date}]:[],totalWaste:e,totalDowntime:t,submittedAt:new Date};(0,h.IN)(a),await(0,u.jw)({operator_name:i.operatorName,machine:i.machineName,order_number:T,product:P,batch_number:U,shift:w,submission_date:j.toISOString().split("T")[0],is_early_submission:!1},F.map(e=>({waste:e.waste,wasteType:e.wasteType,timestamp:e.timestamp})),Y.map(e=>({downtime:e.downtime,downtimeReason:e.downtimeReason,timestamp:e.timestamp})),i.speed?[{speed:Number(i.speed),timestamp:new Date}]:[],[],[],[])}se("Submitted for ".concat(O.length," machines"),"success");const a=(new Date).toISOString().split("T")[0],s=(new Date).getUTCHours()+2,n=s>=6&&s<18?"Day":"Night";O.forEach(e=>{localStorage.removeItem(g(e.machineName,n,a))}),setTimeout(()=>f("/"),2e3)}catch(a){console.error("Submission error:",a),se("Saved locally. Database sync failed.","error"),setTimeout(()=>f("/"),2e3)}finally{C(!1)}},onCancel:()=>k(!1)}),(0,p.jsxs)("header",{className:"capture-header-v2",children:[(0,p.jsxs)("button",{className:"back-btn-v2",onClick:()=>{f("/")},children:[(0,p.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,p.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back"]}),(0,p.jsxs)("div",{className:"capture-title-v2",children:[(0,p.jsxs)("h1",{children:[y," \u2014 Machine ",b]}),(0,p.jsxs)("span",{className:"capture-subtitle",children:["Recording for ",O.length," machines"]})]}),(0,p.jsxs)("div",{className:"shift-badge-v2 ".concat(w.toLowerCase()),children:[(0,p.jsx)("span",{className:"shift-icon",children:"Day"===w?"\u25d0":"\u25d1"}),w," Shift"]})]}),(0,p.jsxs)("main",{className:"capture-main multi-capture-main",children:[(0,p.jsxs)("div",{className:"capture-form-column",children:[(0,p.jsxs)("section",{className:"form-section",children:[(0,p.jsxs)("h2",{className:"section-heading",children:["Machine Assignments",J&&(0,p.jsx)("span",{className:"locked-badge",children:"\ud83d\udd12 Locked"})]}),(0,p.jsx)("div",{className:"multi-machine-grid",children:O.map((e,t)=>(0,p.jsxs)("div",{className:"machine-card",children:[(0,p.jsxs)("div",{className:"machine-card-header",children:[(0,p.jsx)("span",{className:"machine-number",children:t+1}),(0,p.jsx)("span",{className:"machine-card-name",children:e.machineName.split(" - ")[1]||e.machineName}),(0,p.jsx)("span",{className:"machine-parent",children:e.machineName.split(" - ")[0]})]}),(0,p.jsxs)("div",{className:"machine-card-fields",children:[(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Operator Number"}),(0,p.jsx)("input",{type:"text",className:"form-input",value:e.operatorName,onChange:e=>ne(t,"operatorName",e.target.value),placeholder:"Enter operator number",disabled:J})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Speed (PPM)"}),(0,p.jsx)("input",{type:"number",className:"form-input",placeholder:"Enter speed",value:e.speed,onChange:e=>ne(t,"speed",e.target.value?Number(e.target.value):""),disabled:J})]})]})]},e.machineName))})]}),(0,p.jsxs)("section",{className:"form-section",children:[(0,p.jsx)("h2",{className:"section-heading",children:"Shared Order Details"}),(0,p.jsxs)("div",{className:"form-grid",children:[(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Order Number"}),(0,p.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter order number",value:T,onChange:e=>M(e.target.value),disabled:J})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Product"}),(0,p.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter product",value:P,onChange:e=>R(e.target.value),disabled:J})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Batch Number"}),(0,p.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter batch",value:U,onChange:e=>W(e.target.value),disabled:J})]}),(0,p.jsx)(l.A,{dateTime:j,shift:w})]}),!J&&ie&&(0,p.jsx)("button",{className:"lock-session-btn",onClick:()=>{if(!ie)return void se("Please fill in all required fields","error");const e=(new Date).toISOString().split("T")[0],t=(new Date).getUTCHours()+2,a=t>=6&&t<18?"Day":"Night";O.forEach(t=>{const s=g(t.machineName,a,e),n={machineName:t.machineName,operatorName:t.operatorName,orderNumber:T,product:P,batchNumber:U,shift:a,date:e,locked:!0,wasteEntries:F,downtimeEntries:Y,speedEntries:t.speed?[{id:(0,o.A)(),speed:Number(t.speed),timestamp:new Date}]:[]};localStorage.setItem(s,JSON.stringify(n))}),L(!0),se("Sessions locked for all machines","success")},children:"\ud83d\udd12 Lock All Machine Sessions"})]})]}),(0,p.jsxs)("div",{className:"capture-entries-column",children:[(0,p.jsxs)("section",{className:"form-section capture-section compact-capture waste-section",children:[(0,p.jsxs)("h2",{className:"section-heading",children:[(0,p.jsx)("span",{className:"section-icon",children:"\ud83d\uddd1\ufe0f"}),"Record Waste (applies to all)",F.length>0&&(0,p.jsx)("span",{className:"entry-count-badge waste-badge",children:F.length})]}),(0,p.jsxs)("div",{className:"capture-section-content",children:[(0,p.jsxs)("button",{className:"capture-add-btn waste-btn",onClick:()=>z(!0),children:[(0,p.jsx)("span",{className:"btn-icon",children:"+"}),"Record Waste"]}),F.length>0&&(0,p.jsx)("div",{className:"capture-entries-list",children:F.slice().reverse().map((e,t)=>(0,p.jsxs)("div",{className:"capture-entry-item waste-entry ".concat(0===t?"latest":""),children:[(0,p.jsxs)("div",{className:"entry-main",children:[(0,p.jsx)("span",{className:"entry-value",children:e.waste}),(0,p.jsx)("span",{className:"entry-unit",children:"kg"})]}),(0,p.jsx)("span",{className:"entry-type",children:e.wasteType}),(0,p.jsx)("span",{className:"entry-time",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,p.jsx)("button",{className:"entry-delete-btn",onClick:()=>{return t=e.id,B(F.filter(e=>e.id!==t)),void se("Entry removed","success");var t},title:"Delete this entry",children:"\u2715"})]},e.id))}),F.length>0&&(0,p.jsxs)("div",{className:"section-total",children:[(0,p.jsx)("span",{children:"Total Waste:"}),(0,p.jsxs)("strong",{children:[re.toFixed(1)," kg"]})]})]})]}),(0,p.jsxs)("section",{className:"form-section capture-section compact-capture downtime-section",children:[(0,p.jsxs)("h2",{className:"section-heading",children:[(0,p.jsx)("span",{className:"section-icon",children:"\u23f1\ufe0f"}),"Record Downtime (applies to all)",Y.length>0&&(0,p.jsx)("span",{className:"entry-count-badge downtime-badge",children:Y.length})]}),(0,p.jsxs)("div",{className:"capture-section-content",children:[(0,p.jsxs)("button",{className:"capture-add-btn downtime-btn",onClick:()=>$(!0),children:[(0,p.jsx)("span",{className:"btn-icon",children:"+"}),"Record Downtime"]}),Y.length>0&&(0,p.jsx)("div",{className:"capture-entries-list",children:Y.slice().reverse().map((e,t)=>(0,p.jsxs)("div",{className:"capture-entry-item downtime-entry ".concat(0===t?"latest":""),children:[(0,p.jsxs)("div",{className:"entry-main",children:[(0,p.jsx)("span",{className:"entry-value",children:e.downtime}),(0,p.jsx)("span",{className:"entry-unit",children:"min"})]}),(0,p.jsx)("span",{className:"entry-reason",children:e.downtimeReason}),(0,p.jsx)("span",{className:"entry-time",children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,p.jsx)("button",{className:"entry-delete-btn",onClick:()=>{return t=e.id,H(Y.filter(e=>e.id!==t)),void se("Entry removed","success");var t},title:"Delete this entry",children:"\u2715"})]},e.id))}),Y.length>0&&(0,p.jsxs)("div",{className:"section-total",children:[(0,p.jsx)("span",{children:"Total Downtime:"}),(0,p.jsxs)("strong",{children:[Math.floor(ce/60),"h ",ce%60,"m"]})]})]})]}),(0,p.jsxs)("button",{className:"submit-all-btn",onClick:()=>{J?0!==F.length||0!==Y.length?k(!0):se("Please add at least one waste or downtime entry","error"):se("Please lock session details first","error")},disabled:!J||D,children:["Submit for All ",O.length," Machines",(0,p.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,p.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7"})})]})]})]}),(0,p.jsx)(r.N,{children:G&&(0,p.jsx)(c.P.div,{className:"modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>z(!1),children:(0,p.jsxs)(c.P.div,{className:"modal-content",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:e=>e.stopPropagation(),children:[(0,p.jsx)("h3",{children:"Record Waste"}),(0,p.jsxs)("div",{className:"modal-form",children:[(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Amount (kg)"}),(0,p.jsx)("input",{type:"number",className:"form-input",value:q,onChange:e=>K(e.target.value?Number(e.target.value):""),placeholder:"Enter waste amount",autoFocus:!0})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Waste Type"}),(0,p.jsxs)("select",{className:"form-select",value:Z,onChange:e=>Q(e.target.value),children:[(0,p.jsx)("option",{value:"",children:"Select Type"}),m.rE.map(e=>(0,p.jsx)("option",{value:e,children:e},e))]})]})]}),(0,p.jsxs)("div",{className:"modal-actions",children:[(0,p.jsx)("button",{className:"modal-cancel",onClick:()=>z(!1),children:"Cancel"}),(0,p.jsx)("button",{className:"modal-confirm",onClick:()=>{if(q&&Z){const e={id:(0,o.A)(),waste:Number(q),wasteType:Z,timestamp:new Date};B([...F,e]),K(""),Q(""),z(!1),se("Waste entry added","success")}},disabled:!q||!Z,children:"Add Entry"})]})]})})}),(0,p.jsx)(r.N,{children:V&&(0,p.jsx)(c.P.div,{className:"modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>$(!1),children:(0,p.jsxs)(c.P.div,{className:"modal-content",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},onClick:e=>e.stopPropagation(),children:[(0,p.jsx)("h3",{children:"Record Downtime"}),(0,p.jsxs)("div",{className:"modal-form",children:[(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Duration (minutes)"}),(0,p.jsx)("input",{type:"number",className:"form-input",value:X,onChange:e=>ee(e.target.value?Number(e.target.value):""),placeholder:"Enter duration",autoFocus:!0})]}),(0,p.jsxs)("div",{className:"form-field",children:[(0,p.jsx)("label",{className:"form-label",children:"Reason"}),(0,p.jsxs)("select",{className:"form-select",value:te,onChange:e=>ae(e.target.value),children:[(0,p.jsx)("option",{value:"",children:"Select Reason"}),m.wK.map(e=>(0,p.jsx)("option",{value:e,children:e},e))]})]})]}),(0,p.jsxs)("div",{className:"modal-actions",children:[(0,p.jsx)("button",{className:"modal-cancel",onClick:()=>$(!1),children:"Cancel"}),(0,p.jsx)("button",{className:"modal-confirm",onClick:()=>{if(X&&te){const e={id:(0,o.A)(),downtime:Number(X),downtimeReason:te,timestamp:new Date};H([...Y,e]),ee(""),ae(""),$(!1),se("Downtime entry added","success")}},disabled:!X||!te,children:"Add Entry"})]})]})})})]})}},3113:(e,t,a)=>{a.d(t,{A:()=>i});a(5043);var s=a(9908),n=a(579);const i=e=>{let{dateTime:t,shift:a}=e;return(0,n.jsxs)("div",{className:"shift-info-card",children:[(0,n.jsxs)("div",{className:"shift-info-header",children:[(0,n.jsx)("span",{className:"info-label",children:"Current Date"}),(0,n.jsx)("span",{className:"info-value date",children:(0,s.GP)(t,"EEEE,")}),(0,n.jsx)("span",{className:"info-value",children:(0,s.GP)(t,"MMM d, yyyy")})]}),(0,n.jsxs)("div",{className:"shift-info-time",children:[(0,n.jsx)("span",{className:"info-label",children:"Current Time"}),(0,n.jsx)("span",{className:"time-display",children:(0,s.GP)(t,"HH:mm:ss")})]})]})}},6353:(e,t,a)=>{a.d(t,{A:()=>r});a(5043);var s=a(9570),n=a(6446),i=a(579);const r=e=>{let{isOpen:t,title:a,message:r,confirmText:c="Confirm",cancelText:o="Cancel",onConfirm:l,onCancel:d,type:m="default"}=e;return(0,i.jsx)(s.N,{children:t&&(0,i.jsx)(n.P.div,{className:"confirm-dialog-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,children:(0,i.jsxs)(n.P.div,{className:"confirm-dialog",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("div",{className:"confirm-dialog-header",children:(0,i.jsx)("h3",{children:a})}),(0,i.jsx)("div",{className:"confirm-dialog-body",children:(0,i.jsx)("p",{children:r})}),(0,i.jsxs)("div",{className:"confirm-dialog-footer",children:[(0,i.jsx)("button",{className:"btn btn-outline-secondary",onClick:d,children:o}),(0,i.jsx)("button",{className:"btn ".concat((()=>{switch(m){case"danger":return"btn-danger";case"success":return"btn-success";default:return"btn-primary"}})()),onClick:l,children:c})]})]})})})}},6451:(e,t,a)=>{a.d(t,{PY:()=>s,rE:()=>n,wK:()=>i});const s=[],n=["Start-up Waste","Changeover Waste","Defective Product","Material Spillage"],i=["Machine Breakdown","Scheduled Maintenance","Changeover","Material Shortage"]},6820:(e,t,a)=>{a.d(t,{A:()=>l});const s={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let n;const i=new Uint8Array(16);const r=[];for(let d=0;d<256;++d)r.push((d+256).toString(16).slice(1));function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}function o(e,t,a){var s,r,o,l;const d=null!==(s=null!==(r=(e=e||{}).random)&&void 0!==r?r:null===(o=(l=e).rng)||void 0===o?void 0:o.call(l))&&void 0!==s?s:function(){if(!n){if("undefined"===typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(i)}();if(d.length<16)throw new Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,t){if((a=a||0)<0||a+16>t.length)throw new RangeError("UUID byte range ".concat(a,":").concat(a+15," is out of buffer bounds"));for(let e=0;e<16;++e)t[a+e]=d[e];return t}return c(d)}const l=function(e,t,a){return!s.randomUUID||t||e?o(e,t,a):s.randomUUID()}},8283:(e,t,a)=>{a.d(t,{Bh:()=>l,D$:()=>u,F$:()=>S,GF:()=>O,Hc:()=>b,IN:()=>v,LO:()=>w,Rg:()=>C,Rn:()=>I,bR:()=>x,mg:()=>h,nN:()=>d,te:()=>E,zl:()=>_});var s=a(7051),n=a(6451),i=a(1737);const r="waste_downtime_history",c="machines_data",o="failed_submissions_queue",l=()=>{const e=localStorage.getItem(o);if(!e)return[];try{return JSON.parse(e)}catch(t){return[]}},d=(e,t)=>{const a=l(),s={id:"failed_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),timestamp:(new Date).toISOString(),retryCount:0,maxRetries:3,data:e,error:t};a.push(s),localStorage.setItem(o,JSON.stringify(a))},m=e=>{const t=l().filter(t=>t.id!==e);localStorage.setItem(o,JSON.stringify(t))},u=async()=>{if(!i.$G)return{succeeded:0,failed:0,remaining:l().length};const e=l();let t=0,a=0;for(const r of e)if(r.retryCount>=r.maxRetries)a++;else try{await(0,i.jw)(r.data.shiftData,r.data.wasteEntries,r.data.downtimeEntries,r.data.speedEntries,r.data.sachetMassEntries,r.data.looseCasesEntries,r.data.palletScanEntries),m(r.id),t++}catch(n){const e=l().map(e=>e.id===r.id?(0,s.A)((0,s.A)({},e),{},{retryCount:e.retryCount+1,error:String(n)}):e);localStorage.setItem(o,JSON.stringify(e)),a++}return{succeeded:t,failed:a,remaining:l().length}},h=()=>{const e="last_storage_cleanup",t=localStorage.getItem(e),a=new Date;if(t){const e=new Date(t);if((a.getTime()-e.getTime())/36e5<24)return}const s=(()=>{const e=w(),t=new Date,a=new Date(t.getTime()-7776e6);let s=e.filter(e=>new Date(e.date)>=a);s.length>1e3&&(s=s.slice(0,1e3));const n=e.length-s.length;return n>0&&(localStorage.setItem(r,JSON.stringify(s)),console.log("Cleaned up ".concat(n," old history entries"))),{removed:n,remaining:s.length}})();localStorage.setItem(e,a.toISOString()),s.removed>0&&console.log("Storage cleanup: removed ".concat(s.removed," entries, ").concat(s.remaining," remaining"))};let p=!0,g=null,f=[];const N=e=>({id:e.id,name:e.name,status:e.status,currentOperator:e.current_operator,currentOrder:e.current_order,currentShift:e.current_shift,lastSubmission:e.last_submission,todayWaste:e.today_waste,todayDowntime:e.today_downtime,subMachineCount:e.sub_machine_count}),y=e=>({id:e.id,name:e.name,status:e.status,current_operator:e.currentOperator,current_order:e.currentOrder,current_shift:e.currentShift,last_submission:e.lastSubmission,today_waste:e.todayWaste,today_downtime:e.todayDowntime,sub_machine_count:e.subMachineCount}),x=async()=>{try{const e=await(0,i.Dn)();if(e.length>0)return g=e.map(N),localStorage.setItem(c,JSON.stringify(g)),localStorage.setItem("machines_last_sync",(new Date).toISOString()),g;{console.log("No machines in Supabase, syncing defaults...");const e=n.PY.map(y);return await(0,i.ri)(e),g=n.PY,localStorage.setItem(c,JSON.stringify(n.PY)),n.PY}}catch(e){return console.error("Failed to initialize from Supabase, using localStorage:",e),p=!1,j()}},b=e=>{f.push(e);const t=(0,i.RS)(e=>{g=e.map(N),localStorage.setItem(c,JSON.stringify(g)),f.forEach(e=>e(g))},()=>(g||j()).map(y));return()=>{f=f.filter(t=>t!==e),0===f.length&&t()}},j=()=>{const e=localStorage.getItem(c);if(!e)return localStorage.setItem(c,JSON.stringify(n.PY)),n.PY;try{return JSON.parse(e)}catch(t){return n.PY}},v=e=>{const t=w();t.unshift(e),localStorage.setItem(r,JSON.stringify(t)),D(e.machine,e.submittedAt.toISOString())},w=()=>{const e=localStorage.getItem(r);if(!e)return[];try{return JSON.parse(e).map(e=>(0,s.A)((0,s.A)({},e),{},{submittedAt:new Date(e.submittedAt),wasteEntries:e.wasteEntries.map(e=>(0,s.A)((0,s.A)({},e),{},{timestamp:new Date(e.timestamp)})),downtimeEntries:e.downtimeEntries.map(e=>(0,s.A)((0,s.A)({},e),{},{timestamp:new Date(e.timestamp)}))}))}catch(t){return[]}},S=()=>{const e=(new Date).toISOString().split("T")[0],t=w().filter(t=>t.date===e);return{totalWaste:t.reduce((e,t)=>e+t.totalWaste,0),totalDowntime:t.reduce((e,t)=>e+t.totalDowntime,0),submissionCount:t.length}},D=(e,t)=>{const a=C(),s=a.findIndex(t=>t.name===e);-1!==s&&(a[s].lastSubmission=k(new Date(t))),localStorage.setItem(c,JSON.stringify(a))},C=()=>g||j(),E=async(e,t)=>{const a=C(),n=a.findIndex(t=>t.id===e);if(-1!==n&&(a[n]=(0,s.A)((0,s.A)({},a[n]),t),g=a,localStorage.setItem(c,JSON.stringify(a)),p))try{await(0,i.hx)(y(a[n]))}catch(r){console.error("Failed to sync machine update to Supabase:",r)}},_=async e=>{const t=C();if(t.push(e),g=t,localStorage.setItem(c,JSON.stringify(t)),p)try{await(0,i.hx)(y(e))}catch(a){console.error("Failed to sync new machine to Supabase:",a)}},I=async e=>{const t=C().filter(t=>t.id!==e);if(g=t,localStorage.setItem(c,JSON.stringify(t)),p)try{await(0,i._T)(e)}catch(a){console.error("Failed to delete machine from Supabase:",a)}},k=e=>{const t=(new Date).getTime()-e.getTime(),a=Math.floor(t/6e4),s=Math.floor(a/60),n=Math.floor(s/24);return a<1?"Just now":a<60?"".concat(a," min ago"):s<24?"".concat(s," hour").concat(s>1?"s":""," ago"):"".concat(n," day").concat(n>1?"s":""," ago")},O=(e,t)=>{const a=[];e.forEach(e=>{const t=[e.date,e.shift,e.operatorName,e.machine,e.orderNumber,e.product,e.batchNumber],s=new Date(e.submittedAt).toLocaleString();e.wasteEntries&&e.wasteEntries.length>0&&e.wasteEntries.forEach(e=>{a.push([...t,"Waste",e.wasteType,e.waste.toFixed(2),"","",s])}),e.downtimeEntries&&e.downtimeEntries.length>0&&e.downtimeEntries.forEach(e=>{a.push([...t,"Downtime","","",e.downtimeReason,e.downtime.toString(),s])}),e.wasteEntries&&0!==e.wasteEntries.length||e.downtimeEntries&&0!==e.downtimeEntries.length||a.push([...t,"Summary","",e.totalWaste.toFixed(2),"",e.totalDowntime.toString(),s])});const s=[["Date","Shift","Operator","Machine","Order Number","Product","Batch Number","Entry Type","Waste Type","Waste (kg)","Downtime Reason","Downtime (min)","Submitted At"].join(","),...a.map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n"),n=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),r=URL.createObjectURL(n);i.setAttribute("href",r),i.setAttribute("download","".concat(t,".csv")),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}}}]);
//# sourceMappingURL=692.7e129e2b.chunk.js.map