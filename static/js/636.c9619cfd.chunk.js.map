{"version":3,"file":"static/js/636.c9619cfd.chunk.js","mappings":"0MAeA,MA+FA,EAxF0DA,IAAuC,IAAtC,MAAEC,EAAQ,SAAQ,WAAEC,GAAYF,EACzF,MAAOG,EAAQC,IAAaC,EAAAA,EAAAA,UAAmC,OACxDC,EAAOC,IAAYF,EAAAA,EAAAA,WAAS,IAEnCG,EAAAA,EAAAA,WAAU,KACR,IAAIC,GAAY,EAEHC,WACX,GAAKC,EAAAA,GACL,IAAK,IAADC,EACF,MAAMC,QAAaC,EAAAA,EAAAA,IAAwB,GAC3C,IAAKL,EAAW,OAChBL,EAAiB,QAARQ,EAACC,EAAK,UAAE,IAAAD,EAAAA,EAAI,KACvB,CAAE,MAAAG,GACA,GAIJC,GAEA,MAAMC,EAAcN,EAAAA,IAChBO,EAAAA,EAAAA,IAAuBC,IACvBf,EAAUe,GAEVZ,GAAS,GACTa,WAAW,IAAMb,GAAS,GAAQ,OAElC,OAEEc,EAAeC,IACnB,MAAMC,EAAKD,EACL,OAAFC,QAAE,IAAFA,GAAAA,EAAIC,SACNpB,EAAUmB,EAAGC,QACbjB,GAAS,GACTa,WAAW,IAAMb,GAAS,GAAQ,OAMtC,OAFAkB,OAAOC,iBAAiB,oBAAqBL,GAEtC,KACLZ,GAAY,EACZQ,IACAQ,OAAOE,oBAAoB,oBAAqBN,KAEjD,IAEH,MAAMO,GAAOC,EAAAA,EAAAA,SAAQ,KACnB,IAAK1B,EAAQ,MAAO,kBACpB,MAAM2B,EAxDUC,KAClB,IAAKA,EAAK,MAAO,GACjB,MAAMC,EAAI,IAAIC,KAAKF,GACnB,OAAIG,OAAOC,MAAMH,EAAEI,WAAmB,GAC/BJ,EAAEK,mBAAmB,GAAI,CAAEC,KAAM,UAAWC,OAAQ,aAoD/CC,CAAWrC,EAAOsC,YAC5B,MAAM,GAANC,OAAUvC,EAAOwC,WAASD,OAAGZ,EAAC,KAAAY,OAAQZ,EAAC,KAAM,GAAE,MAAAY,OAAKvC,EAAOyC,UAC1D,CAACzC,IAEE0C,EAAcA,KACd3C,GACFA,KAWJ,OACE4C,EAAAA,EAAAA,MAAA,OACEC,UAAS,sBAAAL,OAAwBpC,EAAQ,QAAU,IACnD0C,KAAK,SACL,aAAW,sBACXC,QAASJ,EACTK,UAbmB5B,IACP,UAAVA,EAAE6B,KAA6B,MAAV7B,EAAE6B,MACzB7B,EAAE8B,iBACFP,MAWAQ,SAAUnD,EAAa,GAAK,EAC5BoD,MAAO,CAAEC,OAAQrD,EAAa,UAAY,WAAYsD,SAAA,EAEtDC,EAAAA,EAAAA,KAAA,OAAKV,UAAU,sBAAqBS,SAAC,kBACrCV,EAAAA,EAAAA,MAAA,OAAKC,UAAU,uBAAsBS,SAAA,CAAEvD,EAAM,QAC7CwD,EAAAA,EAAAA,KAAA,OAAKV,UAAU,sBAAsBW,MAAO9B,EAAK4B,SAC9C5B,IAEF1B,IACCuD,EAAAA,EAAAA,KAAA,OAAKV,UAAU,wBAAuBS,SAAC,wB","sources":["components/LatestMessageBar.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  ChatMessageRecord,\r\n  fetchRecentChatMessages,\r\n  isSupabaseConfigured,\r\n  subscribeChatMessages,\r\n} from '../lib/supabase';\r\n\r\ntype ChatMessageSentEvent = CustomEvent<ChatMessageRecord>;\r\n\r\ntype LatestMessageBarProps = {\r\n  label?: string;\r\n  onBarClick?: () => void;\r\n};\r\n\r\nconst formatTime = (iso?: string) => {\r\n  if (!iso) return '';\r\n  const d = new Date(iso);\r\n  if (Number.isNaN(d.getTime())) return '';\r\n  return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n};\r\n\r\nconst LatestMessageBar: React.FC<LatestMessageBarProps> = ({ label = 'Latest', onBarClick }) => {\r\n  const [latest, setLatest] = useState<ChatMessageRecord | null>(null);\r\n  const [isNew, setIsNew] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n\r\n    const load = async () => {\r\n      if (!isSupabaseConfigured) return;\r\n      try {\r\n        const msgs = await fetchRecentChatMessages(1);\r\n        if (!isMounted) return;\r\n        setLatest(msgs[0] ?? null);\r\n      } catch {\r\n        // Ignore; chat widget will show any errors.\r\n      }\r\n    };\r\n\r\n    load();\r\n\r\n    const unsubscribe = isSupabaseConfigured\r\n      ? subscribeChatMessages((message) => {\r\n        setLatest(message);\r\n        // Trigger animation for new message\r\n        setIsNew(true);\r\n        setTimeout(() => setIsNew(false), 500);\r\n      })\r\n      : () => { };\r\n\r\n    const onLocalSend = (e: Event) => {\r\n      const ev = e as ChatMessageSentEvent;\r\n      if (ev?.detail) {\r\n        setLatest(ev.detail);\r\n        setIsNew(true);\r\n        setTimeout(() => setIsNew(false), 500);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('chat_message_sent', onLocalSend);\r\n\r\n    return () => {\r\n      isMounted = false;\r\n      unsubscribe();\r\n      window.removeEventListener('chat_message_sent', onLocalSend);\r\n    };\r\n  }, []);\r\n\r\n  const text = useMemo(() => {\r\n    if (!latest) return 'No messages yet';\r\n    const t = formatTime(latest.created_at);\r\n    return `${latest.user_name}${t ? ` (${t})` : ''}: ${latest.content}`;\r\n  }, [latest]);\r\n\r\n  const handleClick = () => {\r\n    if (onBarClick) {\r\n      onBarClick();\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' || e.key === ' ') {\r\n      e.preventDefault();\r\n      handleClick();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={`latest-message-bar ${isNew ? 'pulse' : ''}`}\r\n      role=\"status\"\r\n      aria-label=\"Latest chat message\"\r\n      onClick={handleClick}\r\n      onKeyDown={handleKeyDown}\r\n      tabIndex={onBarClick ? 0 : -1}\r\n      style={{ cursor: onBarClick ? 'pointer' : 'default' }}\r\n    >\r\n      <div className=\"latest-message-icon\">ðŸ’¬</div>\r\n      <div className=\"latest-message-label\">{label}:</div>\r\n      <div className=\"latest-message-text\" title={text}>\r\n        {text}\r\n      </div>\r\n      {onBarClick && (\r\n        <div className=\"latest-message-action\">Open Chat â†’</div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LatestMessageBar;\r\n"],"names":["_ref","label","onBarClick","latest","setLatest","useState","isNew","setIsNew","useEffect","isMounted","async","isSupabaseConfigured","_msgs$","msgs","fetchRecentChatMessages","_unused","load","unsubscribe","subscribeChatMessages","message","setTimeout","onLocalSend","e","ev","detail","window","addEventListener","removeEventListener","text","useMemo","t","iso","d","Date","Number","isNaN","getTime","toLocaleTimeString","hour","minute","formatTime","created_at","concat","user_name","content","handleClick","_jsxs","className","role","onClick","onKeyDown","key","preventDefault","tabIndex","style","cursor","children","_jsx","title"],"ignoreList":[],"sourceRoot":""}