"use strict";(self.webpackChunkwaste_and_downtime_dashboard=self.webpackChunkwaste_and_downtime_dashboard||[]).push([[455],{1455:(e,s,n)=>{n.r(s),n.d(s,{default:()=>u});var i=n(7051),a=n(5043),r=n(8163),t=n(9570),l=n(6446),c=n(1737),o=n(8283),d=n(9216),h=n(6886),m=n(579);const u=()=>{const e=(0,r.Zp)(),[s,n]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[x,g]=(0,a.useState)(""),[v,j]=(0,a.useState)(""),[f,b]=(0,a.useState)(""),[N,w]=(0,a.useState)([]),[y,k]=(0,a.useState)(!1),[C,S]=(0,a.useState)("bulk"),[A,M]=(0,a.useState)([]),[E,q]=(0,a.useState)({}),[O,B]=(0,a.useState)(!0),[P,I]=(0,a.useState)(!1),[L,z]=(0,a.useState)(null),[T,F]=(0,a.useState)((0,d.PM)()),[W,_]=(0,a.useState)(!1),D=(e,s)=>{z({message:e,type:s}),setTimeout(()=>z(null),4e3)},R=(0,a.useCallback)(async()=>{B(!0);try{const e=(0,o.Rg)();if(M(e),e.length>0&&!s&&n(e[0].id),c.$G){const s=await(0,c._D)(),n={};e.forEach(e=>{n[e.id]=s.filter(s=>s.machine_id===e.id)}),q(n)}}catch(e){console.error("Error loading data:",e),D("Failed to load data","error")}finally{B(!1)}},[s]);(0,a.useEffect)(()=>{R()},[R]);const H=(0,a.useCallback)(e=>{const s=e.trim().toLowerCase();return A.find(e=>e.name.toLowerCase()===s||e.name.toLowerCase().includes(s)||s.includes(e.name.toLowerCase()))},[A]),Q=(0,a.useCallback)(e=>{if(!e.trim())return[];const s=e.split("\n").filter(e=>e.trim()),n=[];for(const i of s){let e=i.split("\t");if(e.length<4&&(e=i.split(",")),e=e.map(e=>e.trim()),e.length>=4){const[s,i,a,r]=e,t=H(s);n.push({machineName:s,machineId:(null===t||void 0===t?void 0:t.id)||"",orderNumber:i,product:a,batchNumber:r,valid:!!t&&!!i&&!!a&&!!r,error:t?i?a?r?void 0:"Missing batch":"Missing product":"Missing order number":'Machine "'.concat(s,'" not found')})}else e.length>0&&e[0]&&n.push({machineName:e[0]||"Unknown",machineId:"",orderNumber:e[1]||"",product:e[2]||"",batchNumber:e[3]||"",valid:!1,error:"Invalid format. Expected: Machine, Order, Product, Batch"})}return n},[H]),U=async(e,s,n)=>{const a=E[e]||[],r=a.findIndex(e=>e.id===s);if(-1===r)return;const t="up"===n?r-1:r+1;if(t<0||t>=a.length)return;const l=[...a];[l[r],l[t]]=[l[t],l[r]],q(s=>(0,i.A)((0,i.A)({},s),{},{[e]:l}));try{const s=l.map(e=>e.id);await(0,c.tj)(e,s)}catch(o){console.error("Error updating order priorities:",o),await R(),D("Failed to reorder","error")}},G=N.filter(e=>e.valid).length,V=N.filter(e=>!e.valid).length;return O?(0,m.jsxs)("div",{className:"admin-console loading",children:[(0,m.jsx)("div",{className:"spinner-v2"}),(0,m.jsx)("p",{children:"Loading order queues..."})]}):(0,m.jsxs)(l.P.div,{className:"admin-console",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[(0,m.jsx)(t.N,{children:L&&(0,m.jsx)(l.P.div,{className:"toast-container-v2",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,m.jsxs)("div",{className:"toast-message-v2 ".concat(L.type),children:[(0,m.jsx)("span",{className:"toast-icon",children:"success"===L.type?"\u2713":"!"}),L.message]})})}),(0,m.jsxs)("header",{className:"admin-header",children:[(0,m.jsxs)("button",{className:"back-btn-v2",onClick:()=>e("/"),children:[(0,m.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,m.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back"]}),(0,m.jsxs)("div",{className:"admin-title",children:[(0,m.jsx)("h1",{children:"Admin Console"}),(0,m.jsx)("span",{className:"admin-subtitle",children:"Machine Order Queues"})]})]}),(0,m.jsxs)("main",{className:"admin-main",children:[(0,m.jsxs)("section",{className:"admin-form-section",children:[(0,m.jsxs)("div",{className:"admin-tabs",children:[(0,m.jsxs)("button",{className:"admin-tab ".concat("bulk"===C?"active":""),onClick:()=>S("bulk"),children:[(0,m.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:(0,m.jsx)("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Bulk Import"]}),(0,m.jsxs)("button",{className:"admin-tab ".concat("single"===C?"active":""),onClick:()=>S("single"),children:[(0,m.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:(0,m.jsx)("path",{d:"M12 5v14M5 12h14"})}),"Single Order"]})]}),"bulk"===C?(0,m.jsxs)("div",{className:"admin-form bulk-form",children:[(0,m.jsxs)("div",{className:"form-field",children:[(0,m.jsxs)("label",{className:"form-label",children:["Paste Orders (one per line)",(0,m.jsx)("span",{className:"form-hint",children:"Format: Machine, Order Number, Product, Batch Number"})]}),(0,m.jsx)("textarea",{className:"form-textarea",placeholder:"Example:\nCanline, ORD-001, Product A, BATCH001\nSachet Line, ORD-002, Product B, BATCH002\nCanline, ORD-003, Product C, BATCH003",value:f,onChange:e=>(e=>{b(e);const s=Q(e);w(s),k(s.length>0)})(e.target.value),rows:8})]}),y&&(0,m.jsxs)("div",{className:"bulk-preview",children:[(0,m.jsx)("div",{className:"preview-header",children:(0,m.jsxs)("h3",{children:["Preview (",G," valid, ",V," invalid)"]})}),(0,m.jsx)("div",{className:"preview-list",children:N.map((e,s)=>(0,m.jsxs)("div",{className:"preview-item ".concat(e.valid?"valid":"invalid"),children:[(0,m.jsx)("span",{className:"preview-priority",children:s+1}),(0,m.jsxs)("div",{className:"preview-details",children:[(0,m.jsx)("span",{className:"preview-machine",children:e.machineName}),(0,m.jsx)("span",{className:"preview-order",children:e.orderNumber}),(0,m.jsx)("span",{className:"preview-product",children:e.product}),(0,m.jsx)("span",{className:"preview-batch",children:e.batchNumber})]}),!e.valid&&(0,m.jsx)("span",{className:"preview-error",children:e.error})]},s))})]}),(0,m.jsxs)("div",{className:"admin-actions",children:[(0,m.jsx)("button",{className:"admin-save-btn",onClick:async()=>{const e=N.filter(e=>e.valid);if(0!==e.length){I(!0);try{const s={};e.forEach(e=>{s[e.machineId]||(s[e.machineId]=[]),s[e.machineId].push(e)});for(const e of Object.keys(s)){const n=s[e];for(const e of n)await(0,c.z8)(e.machineId,e.orderNumber,e.product,e.batchNumber)}await R(),D("Successfully imported ".concat(e.length," orders"),"success"),b(""),w([]),k(!1)}catch(s){console.error("Error importing orders:",s),D("Failed to import orders","error")}finally{I(!1)}}else D("No valid orders to import","error")},disabled:P||0===G,children:P?"Importing...":"Import ".concat(G," Orders")}),f&&(0,m.jsx)("button",{className:"admin-clear-btn",onClick:()=>{b(""),w([]),k(!1)},children:"Clear"})]})]}):(0,m.jsxs)("div",{className:"admin-form",children:[(0,m.jsxs)("div",{className:"form-field",children:[(0,m.jsx)("label",{className:"form-label",children:"Machine"}),(0,m.jsxs)("select",{className:"form-input",value:s,onChange:e=>n(e.target.value),children:[(0,m.jsx)("option",{value:"",children:"Select a machine..."}),A.map(e=>(0,m.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,m.jsxs)("div",{className:"form-field",children:[(0,m.jsx)("label",{className:"form-label",children:"Order Number"}),(0,m.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter order number",value:u,onChange:e=>p(e.target.value)})]}),(0,m.jsxs)("div",{className:"form-field",children:[(0,m.jsx)("label",{className:"form-label",children:"Product"}),(0,m.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter product name",value:x,onChange:e=>g(e.target.value)})]}),(0,m.jsxs)("div",{className:"form-field",children:[(0,m.jsx)("label",{className:"form-label",children:"Batch Number"}),(0,m.jsx)("input",{type:"text",className:"form-input",placeholder:"Enter batch number",value:v,onChange:e=>j(e.target.value)})]}),(0,m.jsx)("div",{className:"admin-actions",children:(0,m.jsx)("button",{className:"admin-save-btn",onClick:async()=>{if(s)if(u.trim()&&x.trim()&&v.trim()){I(!0);try{c.$G?(await(0,c.z8)(s,u,x,v),await R(),D("Order added successfully","success"),p(""),g(""),j("")):D("Supabase not configured","error")}catch(e){console.error("Error adding order:",e),D("Failed to add order","error")}finally{I(!1)}}else D("Please fill in all fields","error");else D("Please select a machine","error")},disabled:P,children:P?"Adding...":"Add to Queue"})})]})]}),(0,m.jsxs)("section",{className:"admin-queues-section",children:[(0,m.jsxs)("h2",{className:"section-heading",children:[(0,m.jsx)("span",{className:"section-icon",children:"#"}),"Order Queues by Machine"]}),0===A.length?(0,m.jsxs)("div",{className:"info-card",children:[(0,m.jsx)("span",{className:"info-icon",children:"!"}),(0,m.jsx)("p",{children:"No machines configured. Add machines in Machine Settings first."})]}):(0,m.jsx)("div",{className:"machine-queues-grid",children:A.map(e=>{const s=E[e.id]||[];return(0,m.jsxs)("div",{className:"machine-queue-card",children:[(0,m.jsxs)("div",{className:"machine-queue-header",children:[(0,m.jsx)("h3",{children:e.name}),(0,m.jsxs)("span",{className:"queue-count",children:[s.length," orders"]}),s.length>0&&(0,m.jsx)("button",{className:"clear-queue-btn",onClick:()=>(async e=>{const s=A.find(s=>s.id===e);if(window.confirm("Clear all orders for ".concat((null===s||void 0===s?void 0:s.name)||e,"?")))try{await(0,c.Yc)(e),await R(),D("Orders cleared","success")}catch(n){console.error("Error clearing orders:",n),D("Failed to clear orders","error")}})(e.id),title:"Clear all orders",children:"Clear"})]}),0===s.length?(0,m.jsx)("div",{className:"empty-queue",children:(0,m.jsx)("p",{children:"No orders in queue"})}):(0,m.jsx)("div",{className:"queue-list",children:s.map((n,i)=>(0,m.jsxs)(l.P.div,{className:"queue-item",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*i},children:[(0,m.jsx)("div",{className:"queue-item-priority",children:i+1}),(0,m.jsxs)("div",{className:"queue-item-details",children:[(0,m.jsx)("div",{className:"queue-order-number",children:n.order_number}),(0,m.jsx)("div",{className:"queue-product",children:n.product}),(0,m.jsxs)("div",{className:"queue-batch",children:["Batch: ",n.batch_number]})]}),(0,m.jsxs)("div",{className:"queue-item-actions",children:[(0,m.jsx)("button",{className:"queue-move-btn",onClick:()=>U(e.id,n.id,"up"),disabled:0===i,title:"Move up",children:(0,m.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:(0,m.jsx)("path",{d:"M18 15l-6-6-6 6"})})}),(0,m.jsx)("button",{className:"queue-move-btn",onClick:()=>U(e.id,n.id,"down"),disabled:i===s.length-1,title:"Move down",children:(0,m.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:(0,m.jsx)("path",{d:"M6 9l6 6 6-6"})})}),(0,m.jsx)("button",{className:"queue-remove-btn",onClick:()=>(async e=>{if(window.confirm("Remove this order from the queue?"))try{await(0,c.mv)(e),await R(),D("Order removed","success")}catch(s){console.error("Error removing order:",s),D("Failed to remove order","error")}})(n.id),title:"Remove order",children:(0,m.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:(0,m.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]})]},n.id))})]},e.id)})})]}),(0,m.jsx)("section",{className:"admin-info-section",children:(0,m.jsxs)("div",{className:"info-card",children:[(0,m.jsx)("span",{className:"info-icon",children:"i"}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Bulk Import:"})," Paste from Excel or CSV. Each line: Machine, Order, Product, Batch. Top to bottom = priority order (1st line = highest priority)."]})]})}),(0,m.jsxs)("section",{className:"admin-settings-section",children:[(0,m.jsxs)("div",{className:"settings-header",onClick:()=>_(!W),children:[(0,m.jsxs)("h2",{className:"section-heading",children:[(0,m.jsx)("span",{className:"section-icon",children:"\u2699"}),"Facility Settings"]}),(0,m.jsx)("span",{className:"expand-icon ".concat(W?"expanded":""),children:W?"\u2212":"+"})]}),(0,m.jsx)(t.N,{children:W&&(0,m.jsxs)(l.P.div,{className:"settings-panel",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:[(0,m.jsxs)("div",{className:"settings-grid",children:[(0,m.jsxs)("div",{className:"settings-group",children:[(0,m.jsx)("h3",{children:"Shift Times"}),(0,m.jsxs)("div",{className:"settings-row",children:[(0,m.jsx)("label",{children:"Day Shift Start"}),(0,m.jsx)("select",{value:T.dayShiftStart,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{dayShiftStart:parseInt(e.target.value)})),children:Array.from({length:24},(e,s)=>(0,m.jsxs)("option",{value:s,children:[s.toString().padStart(2,"0"),":00"]},s))})]}),(0,m.jsxs)("div",{className:"settings-row",children:[(0,m.jsx)("label",{children:"Day Shift End"}),(0,m.jsx)("select",{value:T.dayShiftEnd,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{dayShiftEnd:parseInt(e.target.value)})),children:Array.from({length:24},(e,s)=>(0,m.jsxs)("option",{value:s,children:[s.toString().padStart(2,"0"),":00"]},s))})]}),(0,m.jsxs)("div",{className:"settings-preview",children:["Current: Day ",(0,d.sX)().day,", Night ",(0,d.sX)().night]})]}),(0,m.jsxs)("div",{className:"settings-group",children:[(0,m.jsx)("h3",{children:"Timezone"}),(0,m.jsxs)("div",{className:"settings-row",children:[(0,m.jsx)("label",{children:"UTC Offset"}),(0,m.jsx)("select",{value:T.timezoneOffset,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{timezoneOffset:parseInt(e.target.value)})),children:Array.from({length:25},(e,s)=>s-12).map(e=>(0,m.jsxs)("option",{value:e,children:["UTC",e>=0?"+":"",e]},e))})]})]}),(0,m.jsxs)("div",{className:"settings-group",children:[(0,m.jsx)("h3",{children:"Submission Window"}),(0,m.jsxs)("div",{className:"settings-row",children:[(0,m.jsx)("label",{children:"Window Size (minutes)"}),(0,m.jsx)("input",{type:"number",min:"5",max:"60",value:T.submissionWindowMinutes,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{submissionWindowMinutes:parseInt(e.target.value)||15}))})]}),(0,m.jsx)("div",{className:"settings-hint",children:"Time before/after shift end when submissions are allowed"})]}),(0,m.jsxs)("div",{className:"settings-group",children:[(0,m.jsx)("h3",{children:"Session Locking"}),(0,m.jsx)("div",{className:"settings-row checkbox-row",children:(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{type:"checkbox",checked:T.sessionLockingEnabled,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{sessionLockingEnabled:e.target.checked}))}),"Enable session locking"]})}),(0,m.jsx)("div",{className:"settings-hint",children:"Prevents multiple users from editing the same shift"})]}),(0,m.jsxs)("div",{className:"settings-group",children:[(0,m.jsx)("h3",{children:"Facility Info"}),(0,m.jsxs)("div",{className:"settings-row",children:[(0,m.jsx)("label",{children:"Name"}),(0,m.jsx)("input",{type:"text",value:T.facilityName,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{facilityName:e.target.value}))})]}),(0,m.jsxs)("div",{className:"settings-row",children:[(0,m.jsx)("label",{children:"Location"}),(0,m.jsx)("input",{type:"text",value:T.facilityLocation,onChange:e=>F(s=>(0,i.A)((0,i.A)({},s),{},{facilityLocation:e.target.value}))})]})]})]}),(0,m.jsxs)("div",{className:"settings-actions",children:[(0,m.jsx)("button",{className:"admin-save-btn",onClick:()=>{try{const e=(0,d.W8)(T);F(e),(0,h.Te)("Facility settings saved"),_(!1)}catch(e){(0,h.Qg)("Failed to save settings")}},children:"Save Settings"}),(0,m.jsx)("button",{className:"admin-clear-btn",onClick:()=>{if(window.confirm("Reset all facility settings to defaults?")){const e=(0,d.K6)();F(e),(0,h.Te)("Settings reset to defaults")}},children:"Reset to Defaults"})]})]})})]})]}),(0,m.jsx)("style",{children:'\n                .admin-settings-section {\n                    margin-top: 2rem;\n                    background: #1a1a2e;\n                    border-radius: 12px;\n                    border: 1px solid rgba(255, 255, 255, 0.1);\n                    overflow: hidden;\n                }\n\n                .settings-header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    padding: 1rem 1.5rem;\n                    cursor: pointer;\n                    transition: background 0.2s;\n                }\n\n                .settings-header:hover {\n                    background: rgba(255, 255, 255, 0.05);\n                }\n\n                .settings-header .section-heading {\n                    margin: 0;\n                    font-size: 1.1rem;\n                }\n\n                .expand-icon {\n                    font-size: 1.5rem;\n                    color: #20C997;\n                    transition: transform 0.2s;\n                }\n\n                .expand-icon.expanded {\n                    transform: rotate(180deg);\n                }\n\n                .settings-panel {\n                    border-top: 1px solid rgba(255, 255, 255, 0.1);\n                    padding: 1.5rem;\n                    overflow: hidden;\n                }\n\n                .settings-grid {\n                    display: grid;\n                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n                    gap: 1.5rem;\n                }\n\n                .settings-group {\n                    background: rgba(0, 0, 0, 0.2);\n                    padding: 1rem;\n                    border-radius: 8px;\n                }\n\n                .settings-group h3 {\n                    margin: 0 0 1rem 0;\n                    font-size: 0.9rem;\n                    color: #20C997;\n                    text-transform: uppercase;\n                    letter-spacing: 0.05em;\n                }\n\n                .settings-row {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-bottom: 0.75rem;\n                }\n\n                .settings-row label {\n                    color: rgba(255, 255, 255, 0.8);\n                    font-size: 0.9rem;\n                }\n\n                .settings-row select,\n                .settings-row input[type="number"],\n                .settings-row input[type="text"] {\n                    background: #16213e;\n                    border: 1px solid rgba(255, 255, 255, 0.2);\n                    border-radius: 4px;\n                    padding: 0.5rem;\n                    color: #fff;\n                    min-width: 100px;\n                }\n\n                .settings-row select:focus,\n                .settings-row input:focus {\n                    outline: none;\n                    border-color: #20C997;\n                }\n\n                .checkbox-row label {\n                    display: flex;\n                    align-items: center;\n                    gap: 0.5rem;\n                    cursor: pointer;\n                }\n\n                .checkbox-row input[type="checkbox"] {\n                    width: 18px;\n                    height: 18px;\n                    accent-color: #20C997;\n                }\n\n                .settings-preview {\n                    font-size: 0.8rem;\n                    color: rgba(255, 255, 255, 0.5);\n                    margin-top: 0.5rem;\n                }\n\n                .settings-hint {\n                    font-size: 0.75rem;\n                    color: rgba(255, 255, 255, 0.4);\n                    margin-top: 0.25rem;\n                }\n\n                .settings-actions {\n                    display: flex;\n                    gap: 1rem;\n                    margin-top: 1.5rem;\n                    padding-top: 1rem;\n                    border-top: 1px solid rgba(255, 255, 255, 0.1);\n                }\n            '})]})}}}]);
//# sourceMappingURL=455.752205ee.chunk.js.map