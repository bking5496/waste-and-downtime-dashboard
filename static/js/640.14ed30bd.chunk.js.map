{"version":3,"file":"static/js/640.14ed30bd.chunk.js","mappings":"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","sources":["components/MainForm.tsx","components/DashboardCharts.tsx","components/QRScanner.tsx","components/ui/Button.tsx","components/ui/Modal.tsx","components/ui/FormField.tsx","components/ui/DataGrid.tsx","components/ui/AddOrderModal.tsx","pages/CaptureScreen.tsx","components/ShiftInfo.tsx","lib/liveSession.ts","components/ConfirmDialog.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ninterface MainFormProps {\r\n  operatorName: string;\r\n  setOperatorName: (value: string) => void;\r\n  machine: string;\r\n  setMachine: (value: string) => void;\r\n  orderNumber: string;\r\n  setOrderNumber: (value: string) => void;\r\n  product: string;\r\n  setProduct: (value: string) => void;\r\n  batchNumber: string;\r\n  setBatchNumber: (value: string) => void;\r\n  hideMachine?: boolean;\r\n  disabled?: boolean;\r\n}\r\n\r\nconst MainForm: React.FC<MainFormProps> = ({\r\n  operatorName,\r\n  setOperatorName,\r\n  machine,\r\n  setMachine,\r\n  orderNumber,\r\n  setOrderNumber,\r\n  product,\r\n  setProduct,\r\n  batchNumber,\r\n  setBatchNumber,\r\n  hideMachine = false,\r\n  disabled = false,\r\n}) => {\r\n  return (\r\n    <div className=\"main-form-fields\">\r\n      {/* Operator Number - Text Input */}\r\n      <div className=\"form-field\">\r\n        <label htmlFor=\"operatorNumber\" className=\"form-label\">Operator Number</label>\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-input\"\r\n          id=\"operatorNumber\"\r\n          value={operatorName}\r\n          onChange={e => setOperatorName(e.target.value)}\r\n          placeholder=\"Enter operator number (e.g., 042)\"\r\n          disabled={disabled}\r\n        />\r\n      </div>\r\n\r\n      {!hideMachine && (\r\n        <div className=\"form-field\">\r\n          <label htmlFor=\"machine\" className=\"form-label\">Machine</label>\r\n          <input\r\n            type=\"text\"\r\n            className=\"form-input\"\r\n            id=\"machine\"\r\n            value={machine}\r\n            readOnly\r\n            disabled={disabled}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* Order Number - Text Input (read from admin or manual entry) */}\r\n      <div className=\"form-field\">\r\n        <label htmlFor=\"orderNumber\" className=\"form-label\">Order Number</label>\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-input\"\r\n          id=\"orderNumber\"\r\n          value={orderNumber}\r\n          onChange={e => setOrderNumber(e.target.value)}\r\n          placeholder=\"Enter order number\"\r\n          disabled={disabled}\r\n        />\r\n      </div>\r\n\r\n      {/* Product - Text Input */}\r\n      <div className=\"form-field\">\r\n        <label htmlFor=\"product\" className=\"form-label\">Product</label>\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-input\"\r\n          id=\"product\"\r\n          value={product}\r\n          onChange={e => setProduct(e.target.value)}\r\n          placeholder=\"Enter product name\"\r\n          disabled={disabled}\r\n        />\r\n      </div>\r\n\r\n      {/* Batch Number - Text Input */}\r\n      <div className=\"form-field\">\r\n        <label htmlFor=\"batchNumber\" className=\"form-label\">Batch Number</label>\r\n        <input\r\n          type=\"text\"\r\n          className=\"form-input\"\r\n          id=\"batchNumber\"\r\n          value={batchNumber}\r\n          onChange={e => setBatchNumber(e.target.value)}\r\n          placeholder=\"Enter batch number\"\r\n          disabled={disabled}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MainForm;\r\n","import React from 'react';\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from 'recharts';\r\nimport { WasteEntry, DowntimeEntry } from '../types';\r\n\r\ninterface DashboardChartsProps {\r\n  wasteEntries: WasteEntry[];\r\n  downtimeEntries: DowntimeEntry[];\r\n}\r\n\r\nconst COLORS = ['#f87171', '#fbbf24', '#34d399', '#60a5fa', '#a78bfa', '#f472b6'];\r\n\r\n// Empty state component\r\nconst EmptyChart: React.FC<{ message: string; icon: string }> = ({ message, icon }) => (\r\n  <div className=\"chart-empty-state\">\r\n    <span className=\"empty-icon\">{icon}</span>\r\n    <span className=\"empty-text\">{message}</span>\r\n  </div>\r\n);\r\n\r\nconst DashboardCharts: React.FC<DashboardChartsProps> = ({ wasteEntries, downtimeEntries }) => {\r\n  // Aggregate waste by type\r\n  const wasteData = wasteEntries.reduce((acc: any[], entry) => {\r\n    const existing = acc.find(item => item.name === entry.wasteType);\r\n    if (existing) {\r\n      existing.value += entry.waste;\r\n    } else {\r\n      acc.push({ name: entry.wasteType, value: entry.waste });\r\n    }\r\n    return acc;\r\n  }, []);\r\n\r\n  // Aggregate downtime by reason\r\n  const downtimeData = downtimeEntries.reduce((acc: any[], entry) => {\r\n    const existing = acc.find(item => item.name === entry.downtimeReason);\r\n    if (existing) {\r\n      existing.value += entry.downtime;\r\n    } else {\r\n      acc.push({ name: entry.downtimeReason, value: entry.downtime });\r\n    }\r\n    return acc;\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"charts-grid\">\r\n      <div className=\"chart-container\">\r\n        <h4 className=\"chart-title\">Waste by Type</h4>\r\n        {wasteData.length === 0 ? (\r\n          <EmptyChart message=\"No waste entries yet\" icon=\"\" />\r\n        ) : (\r\n          <div className=\"chart-wrapper\">\r\n            <ResponsiveContainer width=\"100%\" height={180}>\r\n              <BarChart data={wasteData} margin={{ top: 10, right: 10, left: -10, bottom: 0 }}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(0,245,255,0.1)\" />\r\n                <XAxis\r\n                  dataKey=\"name\"\r\n                  tick={{ fill: '#00f5ff', fontSize: 11 }}\r\n                  axisLine={{ stroke: 'rgba(0,245,255,0.2)' }}\r\n                  tickLine={false}\r\n                />\r\n                <YAxis\r\n                  tick={{ fill: '#00f5ff', fontSize: 11 }}\r\n                  axisLine={{ stroke: 'rgba(0,245,255,0.2)' }}\r\n                  tickLine={false}\r\n                />\r\n                <Tooltip\r\n                  contentStyle={{\r\n                    background: 'rgba(10,25,40,0.95)',\r\n                    border: '1px solid rgba(0,245,255,0.2)',\r\n                    borderRadius: '8px',\r\n                    color: '#f8fafc'\r\n                  }}\r\n                />\r\n                <Bar dataKey=\"value\" fill=\"#f87171\" name=\"Waste (kg)\" radius={[4, 4, 0, 0]} />\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"chart-container\">\r\n        <h4 className=\"chart-title\">Downtime by Reason</h4>\r\n        {downtimeData.length === 0 ? (\r\n          <EmptyChart message=\"No downtime entries yet\" icon=\"\" />\r\n        ) : (\r\n          <div className=\"chart-wrapper\">\r\n            <ResponsiveContainer width=\"100%\" height={180}>\r\n              <PieChart>\r\n                <Pie\r\n                  data={downtimeData}\r\n                  cx=\"50%\"\r\n                  cy=\"50%\"\r\n                  labelLine={false}\r\n                  label={({ name, percent }: { name: string; percent: number }) => \r\n                    percent > 0.1 ? `${(percent * 100).toFixed(0)}%` : ''\r\n                  }\r\n                  outerRadius={65}\r\n                  innerRadius={35}\r\n                  fill=\"#8884d8\"\r\n                  dataKey=\"value\"\r\n                  stroke=\"rgba(15,23,42,0.5)\"\r\n                  strokeWidth={2}\r\n                >\r\n                  {downtimeData.map((entry: any, index: number) => (\r\n                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                  ))}\r\n                </Pie>\r\n                <Tooltip\r\n                  contentStyle={{\r\n                    background: 'rgba(10,25,40,0.95)',\r\n                    border: '1px solid rgba(0,245,255,0.2)',\r\n                    borderRadius: '8px',\r\n                    color: '#f8fafc'\r\n                  }}\r\n                  formatter={(value: number) => [`${value} min`, 'Duration']}\r\n                />\r\n              </PieChart>\r\n            </ResponsiveContainer>\r\n            <div className=\"chart-legend\">\r\n              {downtimeData.map((entry: any, index: number) => (\r\n                <div key={entry.name} className=\"legend-item\">\r\n                  <span className=\"legend-dot\" style={{ background: COLORS[index % COLORS.length] }} />\r\n                  <span className=\"legend-label\">{entry.name}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DashboardCharts;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Html5Qrcode, Html5QrcodeScannerState } from 'html5-qrcode';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface QRScannerProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onScan: (qrData: string) => void;\r\n  recentScans?: string[]; // To prevent duplicate scans\r\n}\r\n\r\nconst QRScanner: React.FC<QRScannerProps> = ({ isOpen, onClose, onScan, recentScans = [] }) => {\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [, setIsScanning] = useState(false); // Tracks scanning state for future UI enhancements\r\n  const [lastScanned, setLastScanned] = useState<string | null>(null);\r\n  const [showSuccess, setShowSuccess] = useState(false);\r\n  const scannerRef = useRef<Html5Qrcode | null>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const isOpenRef = useRef(isOpen);\r\n\r\n  // Keep ref in sync with prop\r\n  useEffect(() => {\r\n    isOpenRef.current = isOpen;\r\n  }, [isOpen]);\r\n\r\n  // Initialize scanner when modal opens\r\n  useEffect(() => {\r\n    if (isOpen && containerRef.current) {\r\n      // Delay to ensure DOM is ready\r\n      const timeoutId = setTimeout(() => {\r\n        startScannerInternal();\r\n      }, 100);\r\n      return () => clearTimeout(timeoutId);\r\n    }\r\n    return () => {\r\n      stopScannerInternal();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [isOpen]);\r\n\r\n  const stopScannerInternal = async () => {\r\n    if (scannerRef.current) {\r\n      try {\r\n        const state = scannerRef.current.getState();\r\n        if (state === Html5QrcodeScannerState.SCANNING) {\r\n          await scannerRef.current.stop();\r\n        }\r\n        scannerRef.current.clear();\r\n      } catch (err) {\r\n        console.error('Error stopping scanner:', err);\r\n      }\r\n      scannerRef.current = null;\r\n    }\r\n    setIsScanning(false);\r\n  };\r\n\r\n  const startScannerInternal = async () => {\r\n    if (scannerRef.current) {\r\n      await stopScannerInternal();\r\n    }\r\n\r\n    try {\r\n      setError(null);\r\n      setIsScanning(true);\r\n      \r\n      const scanner = new Html5Qrcode('qr-reader');\r\n      scannerRef.current = scanner;\r\n\r\n      await scanner.start(\r\n        { facingMode: 'environment' }, // Use back camera\r\n        {\r\n          fps: 10,\r\n          qrbox: { width: 250, height: 250 },\r\n          aspectRatio: 1.0,\r\n        },\r\n        (decodedText) => {\r\n          handleSuccessfulScan(decodedText);\r\n        },\r\n        () => {\r\n          // QR code not found - this is normal, just keep scanning\r\n        }\r\n      );\r\n    } catch (err: any) {\r\n      console.error('QR Scanner error:', err);\r\n      setIsScanning(false);\r\n      \r\n      if (err.toString().includes('NotAllowedError')) {\r\n        setError('Camera permission denied. Please allow camera access to scan QR codes.');\r\n      } else if (err.toString().includes('NotFoundError')) {\r\n        setError('No camera found. Please ensure your device has a camera.');\r\n      } else {\r\n        setError(`Failed to start scanner: ${err.message || err}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSuccessfulScan = async (qrData: string) => {\r\n    // Prevent duplicate scans (same QR within 3 seconds)\r\n    if (lastScanned === qrData) {\r\n      return;\r\n    }\r\n\r\n    // Check if this pallet was already scanned this session\r\n    if (recentScans.includes(qrData)) {\r\n      setError(`Pallet \"${qrData}\" was already scanned this session!`);\r\n      setTimeout(() => setError(null), 3000);\r\n      return;\r\n    }\r\n\r\n    setLastScanned(qrData);\r\n    setShowSuccess(true);\r\n    \r\n    // Vibrate on successful scan (if supported)\r\n    if (navigator.vibrate) {\r\n      navigator.vibrate(200);\r\n    }\r\n\r\n    // Stop scanning briefly to show success\r\n    await stopScannerInternal();\r\n    \r\n    // Call the parent callback\r\n    onScan(qrData);\r\n\r\n    // Show success for 1.5 seconds then continue scanning\r\n    setTimeout(() => {\r\n      setShowSuccess(false);\r\n      setLastScanned(null);\r\n      if (isOpen) {\r\n        startScannerInternal();\r\n      }\r\n    }, 1500);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    stopScannerInternal();\r\n    onClose();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div \r\n        className=\"qr-scanner-overlay\"\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        exit={{ opacity: 0 }}\r\n        onClick={handleClose}\r\n      >\r\n        <motion.div \r\n          className=\"qr-scanner-modal\"\r\n          initial={{ scale: 0.9, opacity: 0 }}\r\n          animate={{ scale: 1, opacity: 1 }}\r\n          exit={{ scale: 0.9, opacity: 0 }}\r\n          onClick={e => e.stopPropagation()}\r\n        >\r\n          <div className=\"qr-scanner-header\">\r\n            <h3>\r\n              <span className=\"scanner-icon\"></span>\r\n              Scan Pallet QR Code\r\n            </h3>\r\n            <button className=\"qr-close-btn\" onClick={handleClose}></button>\r\n          </div>\r\n\r\n          <div className=\"qr-scanner-body\" ref={containerRef}>\r\n            {/* Success overlay */}\r\n            <AnimatePresence>\r\n              {showSuccess && (\r\n                <motion.div \r\n                  className=\"scan-success-overlay\"\r\n                  initial={{ opacity: 0, scale: 0.8 }}\r\n                  animate={{ opacity: 1, scale: 1 }}\r\n                  exit={{ opacity: 0, scale: 0.8 }}\r\n                >\r\n                  <div className=\"success-checkmark\"></div>\r\n                  <p>Pallet Scanned!</p>\r\n                  <span className=\"scanned-code\">{lastScanned}</span>\r\n                </motion.div>\r\n              )}\r\n            </AnimatePresence>\r\n\r\n            {/* Error message */}\r\n            {error && (\r\n              <div className=\"qr-error-message\">\r\n                <span className=\"error-icon\"></span>\r\n                {error}\r\n              </div>\r\n            )}\r\n\r\n            {/* QR Reader container */}\r\n            <div id=\"qr-reader\" className=\"qr-reader-container\"></div>\r\n\r\n            {/* Instructions */}\r\n            <div className=\"qr-instructions\">\r\n              <p>Position the QR code within the frame</p>\r\n              {recentScans.length > 0 && (\r\n                <span className=\"scan-count\">{recentScans.length} pallets scanned this shift</span>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"qr-scanner-footer\">\r\n            <button className=\"qr-cancel-btn\" onClick={handleClose}>\r\n              Done Scanning\r\n            </button>\r\n          </div>\r\n        </motion.div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default QRScanner;\r\n","import React from 'react';\nimport './Button.css';\n\nexport type ButtonVariant =\n  | 'primary'    // Cyan - main actions\n  | 'success'    // Green - positive/running\n  | 'warning'    // Amber - caution/pause\n  | 'danger'     // Red - destructive/stop\n  | 'ghost'      // Transparent with border\n  | 'secondary'; // Muted gray\n\nexport type ButtonSize = 'sm' | 'md' | 'lg';\n\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: ButtonVariant;\n  size?: ButtonSize;\n  icon?: React.ReactNode;\n  iconPosition?: 'left' | 'right';\n  loading?: boolean;\n  fullWidth?: boolean;\n  children: React.ReactNode;\n}\n\nexport const Button: React.FC<ButtonProps> = ({\n  variant = 'primary',\n  size = 'md',\n  icon,\n  iconPosition = 'left',\n  loading = false,\n  fullWidth = false,\n  disabled,\n  children,\n  className = '',\n  ...props\n}) => {\n  const isDisabled = disabled || loading;\n\n  return (\n    <button\n      className={`mc-btn mc-btn--${variant} mc-btn--${size} ${fullWidth ? 'mc-btn--full' : ''} ${className}`}\n      disabled={isDisabled}\n      {...props}\n    >\n      {loading && (\n        <span className=\"mc-btn__loader\">\n          <span className=\"mc-btn__loader-dot\"></span>\n          <span className=\"mc-btn__loader-dot\"></span>\n          <span className=\"mc-btn__loader-dot\"></span>\n        </span>\n      )}\n      {!loading && icon && iconPosition === 'left' && (\n        <span className=\"mc-btn__icon\">{icon}</span>\n      )}\n      <span className=\"mc-btn__text\">{children}</span>\n      {!loading && icon && iconPosition === 'right' && (\n        <span className=\"mc-btn__icon\">{icon}</span>\n      )}\n    </button>\n  );\n};\n","import React, { useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Button } from './Button';\nimport './Modal.css';\n\ninterface ModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  title?: string;\n  subtitle?: string;\n  size?: 'sm' | 'md' | 'lg' | 'full';\n  children: React.ReactNode;\n  footer?: React.ReactNode;\n  closeOnOverlay?: boolean;\n  showCloseButton?: boolean;\n}\n\nexport const Modal: React.FC<ModalProps> = ({\n  isOpen,\n  onClose,\n  title,\n  subtitle,\n  size = 'md',\n  children,\n  footer,\n  closeOnOverlay = true,\n  showCloseButton = true,\n}) => {\n  // Lock body scroll when modal is open\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = 'hidden';\n    } else {\n      document.body.style.overflow = '';\n    }\n    return () => {\n      document.body.style.overflow = '';\n    };\n  }, [isOpen]);\n\n  // Close on Escape key\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape' && isOpen) {\n        onClose();\n      }\n    };\n    document.addEventListener('keydown', handleEscape);\n    return () => document.removeEventListener('keydown', handleEscape);\n  }, [isOpen, onClose]);\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          className=\"mc-modal-overlay\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          transition={{ duration: 0.2 }}\n          onClick={closeOnOverlay ? onClose : undefined}\n        >\n          {/* Scanline effect overlay */}\n          <div className=\"mc-modal-scanlines\" />\n\n          <motion.div\n            className={`mc-modal mc-modal--${size}`}\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ duration: 0.2, ease: [0.4, 0, 0.2, 1] }}\n            onClick={(e) => e.stopPropagation()}\n          >\n            {/* Corner accents */}\n            <div className=\"mc-modal__corner mc-modal__corner--tl\" />\n            <div className=\"mc-modal__corner mc-modal__corner--tr\" />\n            <div className=\"mc-modal__corner mc-modal__corner--bl\" />\n            <div className=\"mc-modal__corner mc-modal__corner--br\" />\n\n            {/* Header */}\n            {(title || showCloseButton) && (\n              <div className=\"mc-modal__header\">\n                <div className=\"mc-modal__header-content\">\n                  {title && (\n                    <div className=\"mc-modal__title-group\">\n                      <h2 className=\"mc-modal__title\">{title}</h2>\n                      {subtitle && <p className=\"mc-modal__subtitle\">{subtitle}</p>}\n                    </div>\n                  )}\n                </div>\n                {showCloseButton && (\n                  <button className=\"mc-modal__close\" onClick={onClose} aria-label=\"Close\">\n                    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <path d=\"M18 6L6 18M6 6l12 12\" />\n                    </svg>\n                  </button>\n                )}\n              </div>\n            )}\n\n            {/* Body */}\n            <div className=\"mc-modal__body\">\n              {children}\n            </div>\n\n            {/* Footer */}\n            {footer && (\n              <div className=\"mc-modal__footer\">\n                {footer}\n              </div>\n            )}\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n};\n\n// Convenience component for confirm dialogs\ninterface ConfirmModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  variant?: 'danger' | 'warning' | 'primary';\n  loading?: boolean;\n}\n\nexport const ConfirmModal: React.FC<ConfirmModalProps> = ({\n  isOpen,\n  onClose,\n  onConfirm,\n  title,\n  message,\n  confirmText = 'Confirm',\n  cancelText = 'Cancel',\n  variant = 'primary',\n  loading = false,\n}) => {\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={onClose}\n      title={title}\n      size=\"sm\"\n      footer={\n        <div className=\"mc-modal__actions\">\n          <Button variant=\"ghost\" onClick={onClose} disabled={loading}>\n            {cancelText}\n          </Button>\n          <Button variant={variant} onClick={onConfirm} loading={loading}>\n            {confirmText}\n          </Button>\n        </div>\n      }\n    >\n      <p className=\"mc-modal__message\">{message}</p>\n    </Modal>\n  );\n};\n","import React from 'react';\nimport './FormField.css';\n\ninterface FormFieldProps {\n  label: string;\n  id: string;\n  type?: 'text' | 'number' | 'email' | 'password' | 'tel' | 'search';\n  value: string | number;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  readOnly?: boolean;\n  required?: boolean;\n  error?: string;\n  hint?: string;\n  icon?: React.ReactNode;\n  className?: string;\n}\n\nexport const FormField: React.FC<FormFieldProps> = ({\n  label,\n  id,\n  type = 'text',\n  value,\n  onChange,\n  placeholder,\n  disabled = false,\n  readOnly = false,\n  required = false,\n  error,\n  hint,\n  icon,\n  className = '',\n}) => {\n  return (\n    <div className={`mc-field ${error ? 'mc-field--error' : ''} ${disabled ? 'mc-field--disabled' : ''} ${className}`}>\n      <label htmlFor={id} className=\"mc-field__label\">\n        {label}\n        {required && <span className=\"mc-field__required\">*</span>}\n      </label>\n      <div className=\"mc-field__input-wrapper\">\n        {icon && <span className=\"mc-field__icon\">{icon}</span>}\n        <input\n          type={type}\n          id={id}\n          className={`mc-field__input ${icon ? 'mc-field__input--with-icon' : ''}`}\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={placeholder}\n          disabled={disabled}\n          readOnly={readOnly}\n          required={required}\n        />\n        <div className=\"mc-field__glow\" />\n      </div>\n      {error && <span className=\"mc-field__error\">{error}</span>}\n      {hint && !error && <span className=\"mc-field__hint\">{hint}</span>}\n    </div>\n  );\n};\n\ninterface SelectFieldProps {\n  label: string;\n  id: string;\n  value: string;\n  onChange: (value: string) => void;\n  options: Array<{ value: string; label: string }>;\n  placeholder?: string;\n  disabled?: boolean;\n  required?: boolean;\n  error?: string;\n  hint?: string;\n  className?: string;\n}\n\nexport const SelectField: React.FC<SelectFieldProps> = ({\n  label,\n  id,\n  value,\n  onChange,\n  options,\n  placeholder,\n  disabled = false,\n  required = false,\n  error,\n  hint,\n  className = '',\n}) => {\n  return (\n    <div className={`mc-field ${error ? 'mc-field--error' : ''} ${disabled ? 'mc-field--disabled' : ''} ${className}`}>\n      <label htmlFor={id} className=\"mc-field__label\">\n        {label}\n        {required && <span className=\"mc-field__required\">*</span>}\n      </label>\n      <div className=\"mc-field__input-wrapper\">\n        <select\n          id={id}\n          className=\"mc-field__select\"\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          disabled={disabled}\n          required={required}\n        >\n          {placeholder && (\n            <option value=\"\" disabled>\n              {placeholder}\n            </option>\n          )}\n          {options.map((opt) => (\n            <option key={opt.value} value={opt.value}>\n              {opt.label}\n            </option>\n          ))}\n        </select>\n        <div className=\"mc-field__select-arrow\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n            <path d=\"M6 9l6 6 6-6\" />\n          </svg>\n        </div>\n        <div className=\"mc-field__glow\" />\n      </div>\n      {error && <span className=\"mc-field__error\">{error}</span>}\n      {hint && !error && <span className=\"mc-field__hint\">{hint}</span>}\n    </div>\n  );\n};\n\ninterface TextAreaFieldProps {\n  label: string;\n  id: string;\n  value: string;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  readOnly?: boolean;\n  required?: boolean;\n  error?: string;\n  hint?: string;\n  rows?: number;\n  className?: string;\n}\n\nexport const TextAreaField: React.FC<TextAreaFieldProps> = ({\n  label,\n  id,\n  value,\n  onChange,\n  placeholder,\n  disabled = false,\n  readOnly = false,\n  required = false,\n  error,\n  hint,\n  rows = 4,\n  className = '',\n}) => {\n  return (\n    <div className={`mc-field ${error ? 'mc-field--error' : ''} ${disabled ? 'mc-field--disabled' : ''} ${className}`}>\n      <label htmlFor={id} className=\"mc-field__label\">\n        {label}\n        {required && <span className=\"mc-field__required\">*</span>}\n      </label>\n      <div className=\"mc-field__input-wrapper\">\n        <textarea\n          id={id}\n          className=\"mc-field__textarea\"\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={placeholder}\n          disabled={disabled}\n          readOnly={readOnly}\n          required={required}\n          rows={rows}\n        />\n        <div className=\"mc-field__glow\" />\n      </div>\n      {error && <span className=\"mc-field__error\">{error}</span>}\n      {hint && !error && <span className=\"mc-field__hint\">{hint}</span>}\n    </div>\n  );\n};\n","import React from 'react';\nimport { motion } from 'framer-motion';\nimport './DataGrid.css';\n\ninterface Column<T> {\n  key: keyof T | string;\n  header: string;\n  width?: string;\n  align?: 'left' | 'center' | 'right';\n  render?: (row: T, index: number) => React.ReactNode;\n  sortable?: boolean;\n}\n\ninterface DataGridProps<T> {\n  columns: Column<T>[];\n  data: T[];\n  keyField: keyof T;\n  onRowClick?: (row: T) => void;\n  sortColumn?: string;\n  sortDirection?: 'asc' | 'desc';\n  onSort?: (column: string) => void;\n  emptyMessage?: string;\n  loading?: boolean;\n  className?: string;\n}\n\nexport function DataGrid<T extends Record<string, unknown>>({\n  columns,\n  data,\n  keyField,\n  onRowClick,\n  sortColumn,\n  sortDirection,\n  onSort,\n  emptyMessage = 'No data available',\n  loading = false,\n  className = '',\n}: DataGridProps<T>) {\n  const renderCell = (row: T, column: Column<T>, index: number) => {\n    if (column.render) {\n      return column.render(row, index);\n    }\n    const value = row[column.key as keyof T];\n    return value !== undefined && value !== null ? String(value) : '-';\n  };\n\n  return (\n    <div className={`mc-grid-container ${className}`}>\n      <div className=\"mc-grid-wrapper\">\n        <table className=\"mc-grid\">\n          <thead className=\"mc-grid__head\">\n            <tr>\n              {columns.map((column) => (\n                <th\n                  key={String(column.key)}\n                  className={`mc-grid__th ${column.sortable ? 'mc-grid__th--sortable' : ''} mc-grid__th--${column.align || 'left'}`}\n                  style={{ width: column.width }}\n                  onClick={() => column.sortable && onSort?.(String(column.key))}\n                >\n                  <div className=\"mc-grid__th-content\">\n                    <span>{column.header}</span>\n                    {column.sortable && sortColumn === column.key && (\n                      <span className=\"mc-grid__sort-icon\">\n                        {sortDirection === 'asc' ? '' : ''}\n                      </span>\n                    )}\n                  </div>\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody className=\"mc-grid__body\">\n            {loading ? (\n              <tr>\n                <td colSpan={columns.length} className=\"mc-grid__loading\">\n                  <div className=\"mc-grid__loader\">\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                  </div>\n                </td>\n              </tr>\n            ) : data.length === 0 ? (\n              <tr>\n                <td colSpan={columns.length} className=\"mc-grid__empty\">\n                  {emptyMessage}\n                </td>\n              </tr>\n            ) : (\n              data.map((row, index) => (\n                <motion.tr\n                  key={String(row[keyField])}\n                  className={`mc-grid__row ${onRowClick ? 'mc-grid__row--clickable' : ''}`}\n                  onClick={() => onRowClick?.(row)}\n                  initial={{ opacity: 0, y: -5 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ delay: index * 0.03 }}\n                >\n                  {columns.map((column) => (\n                    <td\n                      key={String(column.key)}\n                      className={`mc-grid__td mc-grid__td--${column.align || 'left'}`}\n                    >\n                      {renderCell(row, column, index)}\n                    </td>\n                  ))}\n                </motion.tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n\n// Pagination component\ninterface PaginationProps {\n  currentPage: number;\n  totalPages: number;\n  totalItems: number;\n  itemsPerPage: number;\n  onPageChange: (page: number) => void;\n}\n\nexport const Pagination: React.FC<PaginationProps> = ({\n  currentPage,\n  totalPages,\n  totalItems,\n  itemsPerPage,\n  onPageChange,\n}) => {\n  const startItem = (currentPage - 1) * itemsPerPage + 1;\n  const endItem = Math.min(currentPage * itemsPerPage, totalItems);\n\n  return (\n    <div className=\"mc-pagination\">\n      <div className=\"mc-pagination__info\">\n        Showing {startItem} to {endItem} of {totalItems} entries\n      </div>\n      <div className=\"mc-pagination__controls\">\n        <button\n          className=\"mc-pagination__btn\"\n          disabled={currentPage === 1}\n          onClick={() => onPageChange(currentPage - 1)}\n        >\n           Previous\n        </button>\n        <span className=\"mc-pagination__page\">\n          {currentPage} / {totalPages}\n        </span>\n        <button\n          className=\"mc-pagination__btn\"\n          disabled={currentPage === totalPages}\n          onClick={() => onPageChange(currentPage + 1)}\n        >\n          Next \n        </button>\n      </div>\n    </div>\n  );\n};\n","import React, { useState } from 'react';\nimport { Modal } from './Modal';\nimport { Button } from './Button';\nimport { FormField } from './FormField';\nimport { addMachineOrder } from '../../lib/supabase';\nimport './AddOrderModal.css';\n\ninterface AddOrderModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  machineId: string;\n  machineName: string;\n  onOrderAdded: (order: { orderNumber: string; product: string; batchNumber: string }) => void;\n}\n\nexport const AddOrderModal: React.FC<AddOrderModalProps> = ({\n  isOpen,\n  onClose,\n  machineId,\n  machineName,\n  onOrderAdded,\n}) => {\n  const [orderNumber, setOrderNumber] = useState('');\n  const [product, setProduct] = useState('');\n  const [batchNumber, setBatchNumber] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleSubmit = async () => {\n    // Validation\n    if (!orderNumber.trim()) {\n      setError('Order number is required');\n      return;\n    }\n    if (!product.trim()) {\n      setError('Product is required');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    try {\n      // Add to machine order queue\n      await addMachineOrder(\n        machineId,\n        orderNumber.trim(),\n        product.trim(),\n        batchNumber.trim() || ''\n      );\n\n      // Notify parent and close\n      onOrderAdded({\n        orderNumber: orderNumber.trim(),\n        product: product.trim(),\n        batchNumber: batchNumber.trim(),\n      });\n\n      // Reset form\n      setOrderNumber('');\n      setProduct('');\n      setBatchNumber('');\n      onClose();\n    } catch (err) {\n      console.error('Failed to add order:', err);\n      setError('Failed to add order. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleClose = () => {\n    setOrderNumber('');\n    setProduct('');\n    setBatchNumber('');\n    setError('');\n    onClose();\n  };\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={handleClose}\n      title=\"Add New Order\"\n      subtitle={machineName}\n      size=\"md\"\n      footer={\n        <div className=\"mc-add-order__actions\">\n          <Button variant=\"ghost\" onClick={handleClose} disabled={loading}>\n            Cancel\n          </Button>\n          <Button variant=\"success\" onClick={handleSubmit} loading={loading}>\n            Add Order & Start\n          </Button>\n        </div>\n      }\n    >\n      <div className=\"mc-add-order\">\n        <p className=\"mc-add-order__description\">\n          Create a new order for this machine. The order will be added to the queue and automatically selected.\n        </p>\n\n        {error && (\n          <div className=\"mc-add-order__error\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\" />\n              <path d=\"M12 8v4M12 16h.01\" />\n            </svg>\n            {error}\n          </div>\n        )}\n\n        <div className=\"mc-add-order__form\">\n          <FormField\n            label=\"Order Number\"\n            id=\"order-number\"\n            value={orderNumber}\n            onChange={setOrderNumber}\n            placeholder=\"e.g., ORD-2024-001\"\n            required\n            disabled={loading}\n          />\n\n          <FormField\n            label=\"Product\"\n            id=\"product\"\n            value={product}\n            onChange={setProduct}\n            placeholder=\"e.g., Product A\"\n            required\n            disabled={loading}\n          />\n\n          <FormField\n            label=\"Batch Number\"\n            id=\"batch-number\"\n            value={batchNumber}\n            onChange={setBatchNumber}\n            placeholder=\"e.g., BATCH-001 (optional)\"\n            disabled={loading}\n          />\n        </div>\n\n        <div className=\"mc-add-order__hint\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\" />\n            <path d=\"M12 16v-4M12 8h.01\" />\n          </svg>\n          <span>Orders can also be added in bulk from the Admin Console.</span>\n        </div>\n      </div>\n    </Modal>\n  );\n};\n","import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useParams, useLocation, useNavigate } from 'react-router-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport ShiftInfo from '../components/ShiftInfo';\r\nimport MainForm from '../components/MainForm';\r\nimport DashboardCharts from '../components/DashboardCharts';\r\nimport ConfirmDialog from '../components/ConfirmDialog';\r\nimport QRScanner from '../components/QRScanner';\r\nimport { WasteEntry, DowntimeEntry, ShiftData, SpeedEntry, SachetMassEntry, LooseCasesEntry, PalletScanEntry, ShiftSession, ProductionState, WASTE_TYPES, DOWNTIME_REASONS } from '../types';\r\nimport {\r\n  submitShiftData,\r\n  fetchMachineOrders,\r\n  MachineOrderQueueRecord,\r\n  updateMachineStatus,\r\n  createLiveSubmission,\r\n  findLiveSubmission,\r\n  addLiveWasteEntry,\r\n  addLiveDowntimeEntry,\r\n  addLiveSpeedEntry,\r\n  addLiveSachetMassEntry,\r\n  addLiveLooseCasesEntry,\r\n  addLivePalletScanEntry,\r\n  finalizeLiveSubmission\r\n} from '../lib/supabase';\r\nimport { saveShiftData, addFailedSubmission, saveLineSpeed, getLineSpeed, runAllCleanup } from '../lib/storage';\r\nimport {\r\n  upsertLiveSession,\r\n  deleteLiveSession,\r\n  syncEntriesToSupabase,\r\n  fetchEntriesFromSupabase,\r\n  subscribeToEntryChanges,\r\n  convertToSyncedEntries,\r\n  convertFromSyncedEntries,\r\n  saveCurrentMachineOrder,\r\n  fetchCurrentMachineOrder,\r\n  clearCurrentMachineOrder\r\n} from '../lib/liveSession';\r\nimport { getCurrentShift, checkSubmissionWindow, getLocalHours } from '../lib/facilitySettings';\r\nimport {\r\n  checkForActiveSession,\r\n  acquireSessionLock,\r\n  releaseSessionLock,\r\n  subscribeToSessionConflicts,\r\n  saveProductionTimer,\r\n  loadProductionTimer,\r\n  clearProductionTimer,\r\n  calculateCurrentRunTime,\r\n  formatRunTime,\r\n  ProductionTimerState\r\n} from '../lib/sessionManager';\r\nimport { logError, showWarning, showSuccess, showError } from '../lib/errorMonitoring';\r\nimport { AddOrderModal } from '../components/ui';\r\n\r\n// Storage key for shift session\r\nconst getSessionKey = (machineName: string, shift: string, date: string) =>\r\n  `shift_session_${machineName}_${shift}_${date}`;\r\n\r\nconst CaptureScreen: React.FC = () => {\r\n  const { machineId } = useParams<{ machineId: string }>();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n\r\n  // Get machine name from state, or restore from sessionStorage for sub-machines\r\n  // This ensures sub-machines keep their unique names even after page refresh\r\n  const getMachineName = (): string => {\r\n    const stateKey = `capture_machine_name_${machineId}`;\r\n    const fromState = (location.state as { machineName?: string })?.machineName;\r\n\r\n    if (fromState) {\r\n      // Save to sessionStorage for persistence across refreshes\r\n      sessionStorage.setItem(stateKey, fromState);\r\n      return fromState;\r\n    }\r\n\r\n    // Try to restore from sessionStorage\r\n    const restored = sessionStorage.getItem(stateKey);\r\n    if (restored) {\r\n      return restored;\r\n    }\r\n\r\n    // Fallback to machineId\r\n    return machineId || '';\r\n  };\r\n\r\n  const machineName = getMachineName();\r\n\r\n  // Get parent machine ID for sub-machines (orders are stored against parent)\r\n  const getParentMachineId = (): string => {\r\n    // Check location state first\r\n    const fromState = (location.state as { parentMachineId?: string })?.parentMachineId;\r\n    if (fromState) {\r\n      sessionStorage.setItem(`capture_parent_id_${machineId}`, fromState);\r\n      return fromState;\r\n    }\r\n\r\n    // Try to restore from sessionStorage\r\n    const restored = sessionStorage.getItem(`capture_parent_id_${machineId}`);\r\n    if (restored) {\r\n      return restored;\r\n    }\r\n\r\n    // Parse from machineId if it's a sub-machine (e.g., machine-xxx-sub-1 -> machine-xxx)\r\n    if (machineId && machineId.includes('-sub-')) {\r\n      return machineId.split('-sub-')[0];\r\n    }\r\n\r\n    // Return machineId as-is for non-sub-machines\r\n    return machineId || '';\r\n  };\r\n\r\n  const parentMachineId = getParentMachineId();\r\n\r\n  // Track current machine for chat widget location context\r\n  useEffect(() => {\r\n    if (machineName) {\r\n      localStorage.setItem('chat_current_machine', machineName);\r\n    }\r\n    return () => {\r\n      localStorage.removeItem('chat_current_machine');\r\n    };\r\n  }, [machineName]);\r\n\r\n  // Clean up stale localStorage data on mount\r\n  useEffect(() => {\r\n    runAllCleanup();\r\n  }, []);\r\n\r\n  const [dateTime, setDateTime] = useState(new Date());\r\n  const [shift, setShift] = useState('');\r\n\r\n  // Loading and feedback states\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\r\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\r\n\r\n  // State for the main form\r\n  const [operatorName, setOperatorName] = useState('');\r\n  const [orderNumber, setOrderNumber] = useState('');\r\n  const [product, setProduct] = useState('');\r\n  const [batchNumber, setBatchNumber] = useState('');\r\n  const [isSessionLocked, setIsSessionLocked] = useState(false);\r\n  const [liveSubmissionId, setLiveSubmissionId] = useState<number | null>(null);\r\n\r\n  // State for waste and downtime inputs\r\n  const [waste, setWaste] = useState<number | ''>('');\r\n  const [wasteType, setWasteType] = useState('');\r\n  const [downtime, setDowntime] = useState<number | ''>('');\r\n  const [downtimeReason, setDowntimeReason] = useState('');\r\n\r\n  // State for storing submitted entries\r\n  const [wasteEntries, setWasteEntries] = useState<WasteEntry[]>([]);\r\n  const [downtimeEntries, setDowntimeEntries] = useState<DowntimeEntry[]>([]);\r\n\r\n  // New states for Machine Speed, Sachet Mass, Loose Cases, Pallet Scans\r\n  const [speedEntries, setSpeedEntries] = useState<SpeedEntry[]>([]);\r\n  const [sachetMassEntries, setSachetMassEntries] = useState<SachetMassEntry[]>([]);\r\n  const [looseCasesEntries, setLooseCasesEntries] = useState<LooseCasesEntry[]>([]);\r\n  const [palletScanEntries, setPalletScanEntries] = useState<PalletScanEntry[]>([]);\r\n\r\n  // Modal states for new entries\r\n  const [showSpeedModal, setShowSpeedModal] = useState(false);\r\n  const [showSachetModal, setShowSachetModal] = useState(false);\r\n  const [showLooseCasesModal, setShowLooseCasesModal] = useState(false);\r\n  const [showQRScanner, setShowQRScanner] = useState(false);\r\n  const [showWasteModal, setShowWasteModal] = useState(false);\r\n  const [showDowntimeModal, setShowDowntimeModal] = useState(false);\r\n  const [speedInput, setSpeedInput] = useState<number | ''>('');\r\n  const [sachetMassInput, setSachetMassInput] = useState<number | ''>('');\r\n  const [looseCasesBatchInput, setLooseCasesBatchInput] = useState('');\r\n  const [looseCasesQuantityInput, setLooseCasesQuantityInput] = useState<number | ''>('');\r\n\r\n  // Submission window state\r\n  const [isInSubmissionWindow, setIsInSubmissionWindow] = useState(false);\r\n  const [, setTimeToWindow] = useState(''); // Time display for submission window\r\n\r\n  // Order queue state\r\n  const [availableOrders, setAvailableOrders] = useState<MachineOrderQueueRecord[]>([]);\r\n  const [showOrderSelect, setShowOrderSelect] = useState(false);\r\n  const [showAddOrderModal, setShowAddOrderModal] = useState(false);\r\n\r\n  // Shift change detection\r\n  const [lastKnownShift, setLastKnownShift] = useState<string | null>(null);\r\n  const [showShiftChangeModal, setShowShiftChangeModal] = useState(false);\r\n  const [newOperatorName, setNewOperatorName] = useState('');\r\n\r\n  // Changeover dialog state\r\n  const [showChangeoverDialog, setShowChangeoverDialog] = useState(false);\r\n  const [willChangeover, setWillChangeover] = useState<boolean | null>(null);\r\n  const [willMaintenance, setWillMaintenance] = useState<boolean | null>(null);\r\n\r\n  // Changeover mode - waiting for new order selection and production start\r\n  const [isInChangeoverMode, setIsInChangeoverMode] = useState(false);\r\n  const [changeoverStartTime, setChangeoverStartTime] = useState<Date | null>(null);\r\n  const [changeoverElapsed, setChangeoverElapsed] = useState<string>('00:00');\r\n\r\n  // Production Timer state\r\n  const [productionState, setProductionState] = useState<ProductionState>({\r\n    isRunning: false,\r\n    startTime: null,\r\n    pausedAt: null,\r\n    totalRunTimeMs: 0,\r\n    lastResumedAt: null,\r\n  });\r\n  const [displayRunTime, setDisplayRunTime] = useState<string>('00:00:00');\r\n  const [showContinueModal, setShowContinueModal] = useState(false);\r\n  const [pauseDowntimeReason, setPauseDowntimeReason] = useState('');\r\n\r\n  // Show toast notification\r\n  const showToast = (message: string, type: 'success' | 'error') => {\r\n    setToast({ message, type });\r\n    setTimeout(() => setToast(null), 4000);\r\n  };\r\n\r\n  // Handle order selection from queue\r\n  const handleOrderSelect = (order: MachineOrderQueueRecord) => {\r\n    setOrderNumber(order.order_number);\r\n    setProduct(order.product);\r\n    setBatchNumber(order.batch_number);\r\n    setShowOrderSelect(false);\r\n    showToast(`Selected order: ${order.order_number}`, 'success');\r\n  };\r\n\r\n  // Handle new order added from AddOrderModal\r\n  const handleOrderAdded = (order: { orderNumber: string; product: string; batchNumber: string }) => {\r\n    setOrderNumber(order.orderNumber);\r\n    setProduct(order.product);\r\n    setBatchNumber(order.batchNumber);\r\n    setShowOrderSelect(false);\r\n    showToast(`Created and selected order: ${order.orderNumber}`, 'success');\r\n    // Refresh the order queue (use parent machine ID for sub-machines)\r\n    fetchMachineOrders(parentMachineId || '').then(orders => setAvailableOrders(orders)).catch(console.error);\r\n  };\r\n\r\n  // Session conflict state\r\n  const [sessionConflict, setSessionConflict] = useState<string | null>(null);\r\n  const unsubscribeConflictRef = useRef<(() => void) | null>(null);\r\n\r\n  // Entry sync subscription ref\r\n  const unsubscribeEntrySyncRef = useRef<(() => void) | null>(null);\r\n\r\n  // Check if within submission window using facility settings\r\n  const checkSubmissionWindowCallback = useCallback((currentDateTime: Date) => {\r\n    const result = checkSubmissionWindow(currentDateTime);\r\n    setIsInSubmissionWindow(result.isInWindow);\r\n    setTimeToWindow(result.isInWindow ? '' : result.timeToWindow);\r\n  }, []);\r\n\r\n  // Load saved session data and production timer\r\n  const loadSession = useCallback(async () => {\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const currentShift = getCurrentShift();\r\n    const sessionKey = getSessionKey(machineName, currentShift, currentDate);\r\n\r\n    // Check for session conflicts before loading\r\n    const { hasConflict, activeSession } = await checkForActiveSession(machineName, currentShift, currentDate);\r\n    if (hasConflict && activeSession) {\r\n      setSessionConflict(`Machine in use by ${activeSession.operator_name} since ${new Date(activeSession.started_at).toLocaleTimeString()}`);\r\n      showWarning(`This machine is currently being used by ${activeSession.operator_name}`);\r\n    }\r\n\r\n    // Load production timer state\r\n    const timerState = await loadProductionTimer(machineName, currentShift, currentDate);\r\n    if (timerState) {\r\n      setProductionState({\r\n        isRunning: timerState.isRunning,\r\n        startTime: timerState.startTime ? new Date(timerState.startTime) : null,\r\n        pausedAt: timerState.pausedAt ? new Date(timerState.pausedAt) : null,\r\n        totalRunTimeMs: timerState.totalRunTimeMs,\r\n        lastResumedAt: timerState.lastResumedAt ? new Date(timerState.lastResumedAt) : null,\r\n      });\r\n      if (timerState.isRunning || timerState.totalRunTimeMs > 0) {\r\n        setDisplayRunTime(formatRunTime(calculateCurrentRunTime(timerState)));\r\n      }\r\n    }\r\n\r\n    const savedSession = localStorage.getItem(sessionKey);\r\n    if (savedSession) {\r\n      try {\r\n        const session: ShiftSession = JSON.parse(savedSession);\r\n        if (session.locked) {\r\n          setOperatorName(session.operatorName);\r\n          setOrderNumber(session.orderNumber);\r\n          setProduct(session.product);\r\n          setBatchNumber(session.batchNumber);\r\n          setIsSessionLocked(true);\r\n\r\n          // Restore entry arrays\r\n          if (session.wasteEntries) setWasteEntries(session.wasteEntries);\r\n          if (session.downtimeEntries) setDowntimeEntries(session.downtimeEntries);\r\n          if (session.speedEntries && session.speedEntries.length > 0) {\r\n            setSpeedEntries(session.speedEntries);\r\n          } else {\r\n            // Check for shared line speed from sibling machines\r\n            const sharedSpeed = getLineSpeed(machineName, currentShift, currentDate);\r\n            if (sharedSpeed) {\r\n              const sharedSpeedEntry: SpeedEntry = {\r\n                id: uuidv4(),\r\n                speed: sharedSpeed.speed,\r\n                timestamp: new Date(sharedSpeed.updatedAt)\r\n              };\r\n              setSpeedEntries([sharedSpeedEntry]);\r\n              console.log(` Loaded shared speed ${sharedSpeed.speed} PPM from ${sharedSpeed.updatedBy}`);\r\n            }\r\n          }\r\n          if (session.sachetMassEntries) setSachetMassEntries(session.sachetMassEntries);\r\n          if (session.looseCasesEntries) setLooseCasesEntries(session.looseCasesEntries);\r\n          if (session.palletScanEntries) setPalletScanEntries(session.palletScanEntries);\r\n          return; // Session loaded from localStorage\r\n        }\r\n      } catch (e) {\r\n        console.error('Failed to load session:', e);\r\n      }\r\n    }\r\n\r\n    // No localStorage session - try to restore from Supabase live_sessions\r\n    try {\r\n      const { fetchLiveSessionByMachine } = await import('../lib/liveSession');\r\n      const liveSession = await fetchLiveSessionByMachine(machineName, currentShift, currentDate);\r\n      if (liveSession && liveSession.is_locked) {\r\n        // Restore session from Supabase\r\n        setOperatorName(liveSession.operator_name);\r\n        setOrderNumber(liveSession.order_number);\r\n        setProduct(liveSession.product);\r\n        setBatchNumber(liveSession.batch_number);\r\n        setIsSessionLocked(true);\r\n\r\n        // Fetch entries from Supabase for cross-device sync\r\n        let restoredWasteEntries: WasteEntry[] = [];\r\n        let restoredDowntimeEntries: DowntimeEntry[] = [];\r\n        let restoredSpeedEntries: SpeedEntry[] = [];\r\n        let restoredSachetMassEntries: SachetMassEntry[] = [];\r\n        let restoredLooseCasesEntries: LooseCasesEntry[] = [];\r\n        let restoredPalletScanEntries: PalletScanEntry[] = [];\r\n\r\n        const syncedEntries = await fetchEntriesFromSupabase(machineName, currentShift, currentDate);\r\n        if (syncedEntries) {\r\n          const restored = convertFromSyncedEntries(syncedEntries);\r\n          restoredWasteEntries = restored.wasteEntries;\r\n          restoredDowntimeEntries = restored.downtimeEntries;\r\n          restoredSpeedEntries = restored.speedEntries;\r\n          restoredSachetMassEntries = restored.sachetMassEntries;\r\n          restoredLooseCasesEntries = restored.looseCasesEntries;\r\n          restoredPalletScanEntries = restored.palletScanEntries;\r\n\r\n          // Set entries in state\r\n          if (restoredWasteEntries.length > 0) setWasteEntries(restoredWasteEntries);\r\n          if (restoredDowntimeEntries.length > 0) setDowntimeEntries(restoredDowntimeEntries);\r\n          if (restoredSpeedEntries.length > 0) setSpeedEntries(restoredSpeedEntries);\r\n          if (restoredSachetMassEntries.length > 0) setSachetMassEntries(restoredSachetMassEntries);\r\n          if (restoredLooseCasesEntries.length > 0) setLooseCasesEntries(restoredLooseCasesEntries);\r\n          if (restoredPalletScanEntries.length > 0) setPalletScanEntries(restoredPalletScanEntries);\r\n\r\n          console.log(' Entries restored from Supabase:', {\r\n            waste: restoredWasteEntries.length,\r\n            downtime: restoredDowntimeEntries.length,\r\n            speed: restoredSpeedEntries.length,\r\n            sachet: restoredSachetMassEntries.length,\r\n            loose: restoredLooseCasesEntries.length,\r\n            pallets: restoredPalletScanEntries.length,\r\n          });\r\n        }\r\n\r\n        // Check for shared line speed from sibling machines (if no speed entries restored)\r\n        if (restoredSpeedEntries.length === 0) {\r\n          const sharedSpeed = getLineSpeed(machineName, currentShift, currentDate);\r\n          if (sharedSpeed) {\r\n            const sharedSpeedEntry: SpeedEntry = {\r\n              id: uuidv4(),\r\n              speed: sharedSpeed.speed,\r\n              timestamp: new Date(sharedSpeed.updatedAt)\r\n            };\r\n            restoredSpeedEntries = [sharedSpeedEntry];\r\n            setSpeedEntries(restoredSpeedEntries);\r\n            console.log(` Loaded shared speed ${sharedSpeed.speed} PPM from ${sharedSpeed.updatedBy}`);\r\n          }\r\n        }\r\n\r\n        // Save to localStorage for faster future loads\r\n        const localSession: ShiftSession = {\r\n          machineName: liveSession.machine_name,\r\n          operatorName: liveSession.operator_name,\r\n          orderNumber: liveSession.order_number,\r\n          product: liveSession.product,\r\n          batchNumber: liveSession.batch_number,\r\n          shift: liveSession.shift,\r\n          date: liveSession.session_date,\r\n          locked: true,\r\n          wasteEntries: restoredWasteEntries,\r\n          downtimeEntries: restoredDowntimeEntries,\r\n          speedEntries: restoredSpeedEntries,\r\n          sachetMassEntries: restoredSachetMassEntries,\r\n          looseCasesEntries: restoredLooseCasesEntries,\r\n          palletScanEntries: restoredPalletScanEntries,\r\n        };\r\n        localStorage.setItem(sessionKey, JSON.stringify(localSession));\r\n        console.log(' Session restored from Supabase:', machineName);\r\n        return;\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to restore session from Supabase:', e);\r\n    }\r\n\r\n    // Try to load admin order details from database\r\n    try {\r\n      const { fetchActiveOrderDetails } = await import('../lib/supabase');\r\n      const activeOrder = await fetchActiveOrderDetails();\r\n      if (activeOrder) {\r\n        setOrderNumber(activeOrder.order_number);\r\n        setProduct(activeOrder.product);\r\n        setBatchNumber(activeOrder.batch_number);\r\n        return;\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load from database:', e);\r\n    }\r\n\r\n    // Fall back to localStorage admin details\r\n    const adminOrderDetails = localStorage.getItem('admin_order_details');\r\n    if (adminOrderDetails) {\r\n      try {\r\n        const details = JSON.parse(adminOrderDetails);\r\n        if (details.orderNumber) setOrderNumber(details.orderNumber);\r\n        if (details.product) setProduct(details.product);\r\n        if (details.batchNumber) setBatchNumber(details.batchNumber);\r\n      } catch (e) {\r\n        console.error('Failed to load admin order details:', e);\r\n      }\r\n    }\r\n  }, [machineName]);\r\n\r\n  // Save session data with session locking\r\n  const saveSession = useCallback(async (showMessage = true) => {\r\n    if (!operatorName || !orderNumber || !product || !batchNumber) return;\r\n\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const currentShift = getCurrentShift();\r\n    const sessionKey = getSessionKey(machineName, currentShift, currentDate);\r\n\r\n    // Acquire session lock\r\n    const lockResult = await acquireSessionLock(machineName, operatorName, currentShift, currentDate);\r\n    if (!lockResult.success) {\r\n      showError(lockResult.error || 'Failed to acquire session lock');\r\n      return;\r\n    }\r\n\r\n    // Subscribe to session conflicts for real-time notifications\r\n    if (unsubscribeConflictRef.current) {\r\n      unsubscribeConflictRef.current();\r\n    }\r\n    unsubscribeConflictRef.current = subscribeToSessionConflicts(\r\n      machineName,\r\n      currentShift,\r\n      currentDate,\r\n      (conflictSession) => {\r\n        setSessionConflict(`Another user (${conflictSession.operator_name}) is accessing this machine`);\r\n      }\r\n    );\r\n\r\n    const session: ShiftSession = {\r\n      machineName,\r\n      operatorName,\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift: currentShift,\r\n      date: currentDate,\r\n      locked: true,\r\n      // Persist entry arrays\r\n      wasteEntries,\r\n      downtimeEntries,\r\n      speedEntries,\r\n      sachetMassEntries,\r\n      looseCasesEntries,\r\n      palletScanEntries,\r\n    };\r\n\r\n    localStorage.setItem(sessionKey, JSON.stringify(session));\r\n\r\n    // Calculate totals for cross-browser sync\r\n    const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n    const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n    // Sync to Supabase for cross-browser visibility\r\n    upsertLiveSession({\r\n      machineName,\r\n      operatorName,\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift: currentShift,\r\n      date: currentDate,\r\n      locked: true,\r\n      totalWaste,\r\n      totalDowntime,\r\n    });\r\n\r\n    if (!isSessionLocked) {\r\n      setIsSessionLocked(true);\r\n\r\n      // Create a live submission in the database\r\n      let submissionId = await findLiveSubmission(machineName, currentShift, currentDate);\r\n      if (!submissionId) {\r\n        submissionId = await createLiveSubmission(\r\n          operatorName,\r\n          machineName,\r\n          orderNumber,\r\n          product,\r\n          batchNumber,\r\n          currentShift,\r\n          currentDate\r\n        );\r\n      }\r\n      if (submissionId) {\r\n        setLiveSubmissionId(submissionId);\r\n        console.log(' Live submission created/found:', submissionId);\r\n      }\r\n\r\n      // Auto-start production timer when session is first locked\r\n      const now = new Date();\r\n      const newTimerState: ProductionState = {\r\n        isRunning: true,\r\n        startTime: now,\r\n        pausedAt: null,\r\n        totalRunTimeMs: 0,\r\n        lastResumedAt: now,\r\n      };\r\n      setProductionState(newTimerState);\r\n      setDisplayRunTime('00:00:00');\r\n\r\n      // Save the timer state\r\n      const timerStateToSave: ProductionTimerState = {\r\n        isRunning: true,\r\n        startTime: now.toISOString(),\r\n        pausedAt: null,\r\n        totalRunTimeMs: 0,\r\n        lastResumedAt: now.toISOString(),\r\n        pauseHistory: [],\r\n      };\r\n      saveProductionTimer(machineName, currentShift, currentDate, timerStateToSave);\r\n\r\n      // Update machine status to 'running' in Supabase\r\n      if (machineId) {\r\n        updateMachineStatus(machineId, 'running', operatorName, orderNumber, currentShift);\r\n      }\r\n      if (showMessage) showToast('Session locked - Production started', 'success');\r\n    }\r\n  }, [machineName, operatorName, orderNumber, product, batchNumber, wasteEntries, downtimeEntries, speedEntries, sachetMassEntries, looseCasesEntries, palletScanEntries, isSessionLocked, machineId]);\r\n\r\n  useEffect(() => {\r\n    loadSession();\r\n  }, [loadSession]);\r\n\r\n  // Ref to hold current production state for cleanup (to avoid stale closure)\r\n  const productionStateRef = useRef(productionState);\r\n  useEffect(() => {\r\n    productionStateRef.current = productionState;\r\n  }, [productionState]);\r\n\r\n  // Auto-save timer state every 30 seconds while running\r\n  useEffect(() => {\r\n    if (!productionState.isRunning || !isSessionLocked) return;\r\n\r\n    const autoSaveInterval = setInterval(() => {\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const currentShift = getCurrentShift();\r\n      const timerState: ProductionTimerState = {\r\n        isRunning: productionState.isRunning,\r\n        startTime: productionState.startTime?.toISOString() || null,\r\n        pausedAt: productionState.pausedAt?.toISOString() || null,\r\n        totalRunTimeMs: productionState.totalRunTimeMs,\r\n        lastResumedAt: productionState.lastResumedAt?.toISOString() || null,\r\n        pauseHistory: [],\r\n      };\r\n      saveProductionTimer(machineName, currentShift, currentDate, timerState);\r\n    }, 30000); // Every 30 seconds\r\n\r\n    return () => clearInterval(autoSaveInterval);\r\n  }, [productionState.isRunning, productionState.lastResumedAt, productionState.totalRunTimeMs, isSessionLocked, machineName]);\r\n\r\n  // Cleanup session lock and save timer on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const currentShift = getCurrentShift();\r\n\r\n      // Save timer state before leaving (use ref to get current state)\r\n      const state = productionStateRef.current;\r\n      if (state.isRunning || state.totalRunTimeMs > 0) {\r\n        const timerState: ProductionTimerState = {\r\n          isRunning: state.isRunning,\r\n          startTime: state.startTime?.toISOString() || null,\r\n          pausedAt: state.pausedAt?.toISOString() || null,\r\n          totalRunTimeMs: state.totalRunTimeMs,\r\n          lastResumedAt: state.lastResumedAt?.toISOString() || null,\r\n          pauseHistory: [],\r\n        };\r\n        saveProductionTimer(machineName, currentShift, currentDate, timerState);\r\n      }\r\n\r\n      // Release session lock when leaving the page\r\n      releaseSessionLock(machineName, currentShift, currentDate);\r\n\r\n      // Unsubscribe from conflict notifications\r\n      if (unsubscribeConflictRef.current) {\r\n        unsubscribeConflictRef.current();\r\n      }\r\n    };\r\n  }, [machineName]);\r\n\r\n  // Load available orders from machine queue\r\n  useEffect(() => {\r\n    const loadMachineOrders = async () => {\r\n      if (!parentMachineId) return;\r\n      try {\r\n        // Use parentMachineId for sub-machines (orders are stored against parent machine group)\r\n        const orders = await fetchMachineOrders(parentMachineId);\r\n        setAvailableOrders(orders);\r\n      } catch (e) {\r\n        console.error('Failed to load machine orders:', e);\r\n      }\r\n    };\r\n    loadMachineOrders();\r\n  }, [parentMachineId]);\r\n\r\n  // Auto-save entries when they change (if session is locked)\r\n  useEffect(() => {\r\n    if (isSessionLocked && operatorName && orderNumber && product && batchNumber) {\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const currentShift = getCurrentShift();\r\n      const sessionKey = getSessionKey(machineName, currentShift, currentDate);\r\n\r\n      const session: ShiftSession = {\r\n        machineName,\r\n        operatorName,\r\n        orderNumber,\r\n        product,\r\n        batchNumber,\r\n        shift: currentShift,\r\n        date: currentDate,\r\n        locked: true,\r\n        wasteEntries,\r\n        downtimeEntries,\r\n        speedEntries,\r\n        sachetMassEntries,\r\n        looseCasesEntries,\r\n        palletScanEntries,\r\n      };\r\n\r\n      localStorage.setItem(sessionKey, JSON.stringify(session));\r\n\r\n      // Sync entries to Supabase for cross-device access (debounced)\r\n      const syncTimeout = setTimeout(() => {\r\n        const syncedEntries = convertToSyncedEntries(\r\n          wasteEntries,\r\n          downtimeEntries,\r\n          speedEntries,\r\n          sachetMassEntries,\r\n          looseCasesEntries,\r\n          palletScanEntries\r\n        );\r\n        syncEntriesToSupabase(machineName, currentShift, currentDate, syncedEntries);\r\n      }, 500); // Debounce 500ms to avoid too many updates\r\n\r\n      return () => clearTimeout(syncTimeout);\r\n    }\r\n  }, [wasteEntries, downtimeEntries, speedEntries, sachetMassEntries, looseCasesEntries, palletScanEntries, isSessionLocked, machineName, operatorName, orderNumber, product, batchNumber]);\r\n\r\n  // Subscribe to real-time entry changes from other devices\r\n  useEffect(() => {\r\n    if (!isSessionLocked) {\r\n      // Cleanup existing subscription when session unlocks\r\n      if (unsubscribeEntrySyncRef.current) {\r\n        unsubscribeEntrySyncRef.current();\r\n        unsubscribeEntrySyncRef.current = null;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const currentShift = getCurrentShift();\r\n\r\n    // Subscribe to entry changes\r\n    const unsubscribe = subscribeToEntryChanges(\r\n      machineName,\r\n      currentShift,\r\n      currentDate,\r\n      (syncedEntries) => {\r\n        // Update local state with entries from other devices\r\n        const restored = convertFromSyncedEntries(syncedEntries);\r\n\r\n        // Only update if entries are different (to avoid loops)\r\n        setWasteEntries(prev => {\r\n          if (JSON.stringify(prev.map(e => e.id)) !== JSON.stringify(restored.wasteEntries.map(e => e.id))) {\r\n            return restored.wasteEntries;\r\n          }\r\n          return prev;\r\n        });\r\n        setDowntimeEntries(prev => {\r\n          if (JSON.stringify(prev.map(e => e.id)) !== JSON.stringify(restored.downtimeEntries.map(e => e.id))) {\r\n            return restored.downtimeEntries;\r\n          }\r\n          return prev;\r\n        });\r\n        setSpeedEntries(prev => {\r\n          if (JSON.stringify(prev.map(e => e.id)) !== JSON.stringify(restored.speedEntries.map(e => e.id))) {\r\n            return restored.speedEntries;\r\n          }\r\n          return prev;\r\n        });\r\n        setSachetMassEntries(prev => {\r\n          if (JSON.stringify(prev.map(e => e.id)) !== JSON.stringify(restored.sachetMassEntries.map(e => e.id))) {\r\n            return restored.sachetMassEntries;\r\n          }\r\n          return prev;\r\n        });\r\n        setLooseCasesEntries(prev => {\r\n          if (JSON.stringify(prev.map(e => e.id)) !== JSON.stringify(restored.looseCasesEntries.map(e => e.id))) {\r\n            return restored.looseCasesEntries;\r\n          }\r\n          return prev;\r\n        });\r\n        setPalletScanEntries(prev => {\r\n          if (JSON.stringify(prev.map(e => e.id)) !== JSON.stringify(restored.palletScanEntries.map(e => e.id))) {\r\n            return restored.palletScanEntries;\r\n          }\r\n          return prev;\r\n        });\r\n      }\r\n    );\r\n\r\n    unsubscribeEntrySyncRef.current = unsubscribe;\r\n\r\n    return () => {\r\n      if (unsubscribeEntrySyncRef.current) {\r\n        unsubscribeEntrySyncRef.current();\r\n        unsubscribeEntrySyncRef.current = null;\r\n      }\r\n    };\r\n  }, [isSessionLocked, machineName]);\r\n\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      const now = new Date();\r\n      setDateTime(now);\r\n      checkSubmissionWindowCallback(now);\r\n    }, 1000);\r\n\r\n    // Set the shift using facility settings\r\n    const newShift = getCurrentShift();\r\n\r\n    // Detect shift change\r\n    if (lastKnownShift !== null && lastKnownShift !== newShift && isSessionLocked) {\r\n      // Shift has changed while session is active - prompt for new operator\r\n      setShowShiftChangeModal(true);\r\n    }\r\n\r\n    setShift(newShift);\r\n    setLastKnownShift(newShift);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [dateTime, checkSubmissionWindow, lastKnownShift, isSessionLocked]);\r\n\r\n  // Changeover Timer - Track elapsed time during changeover\r\n  useEffect(() => {\r\n    if (!isInChangeoverMode || !changeoverStartTime) {\r\n      setChangeoverElapsed('00:00');\r\n      return;\r\n    }\r\n\r\n    const updateElapsed = () => {\r\n      const now = new Date();\r\n      const elapsedMs = now.getTime() - changeoverStartTime.getTime();\r\n      const minutes = Math.floor(elapsedMs / 60000);\r\n      const seconds = Math.floor((elapsedMs % 60000) / 1000);\r\n      setChangeoverElapsed(`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);\r\n    };\r\n\r\n    updateElapsed(); // Initial update\r\n    const interval = setInterval(updateElapsed, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [isInChangeoverMode, changeoverStartTime]);\r\n\r\n  // Production Timer - Update display every second when running\r\n  useEffect(() => {\r\n    if (!productionState.isRunning || !productionState.lastResumedAt) return;\r\n\r\n    const timerInterval = setInterval(() => {\r\n      const now = Date.now();\r\n      const currentSessionMs = now - productionState.lastResumedAt!.getTime();\r\n      const totalMs = productionState.totalRunTimeMs + currentSessionMs;\r\n\r\n      // Format as HH:MM:SS\r\n      const totalSeconds = Math.floor(totalMs / 1000);\r\n      const hours = Math.floor(totalSeconds / 3600);\r\n      const minutes = Math.floor((totalSeconds % 3600) / 60);\r\n      const seconds = totalSeconds % 60;\r\n      setDisplayRunTime(\r\n        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`\r\n      );\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timerInterval);\r\n  }, [productionState.isRunning, productionState.lastResumedAt, productionState.totalRunTimeMs]);\r\n\r\n  // Sync entry totals to Supabase when waste or downtime entries change\r\n  useEffect(() => {\r\n    if (!isSessionLocked) return;\r\n\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const currentShift = getCurrentShift();\r\n\r\n    // Calculate totals\r\n    const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n    const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n    // Sync to Supabase\r\n    upsertLiveSession({\r\n      machineName,\r\n      operatorName,\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift: currentShift,\r\n      date: currentDate,\r\n      locked: true,\r\n      totalWaste,\r\n      totalDowntime,\r\n    });\r\n\r\n    console.log(' Synced entry totals to Supabase:', { totalWaste, totalDowntime });\r\n  }, [wasteEntries, downtimeEntries, isSessionLocked, machineName, operatorName, orderNumber, product, batchNumber]);\r\n\r\n  // Helper to persist timer state\r\n  const persistTimerState = useCallback((state: ProductionState) => {\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const currentShift = getCurrentShift();\r\n    const timerState: ProductionTimerState = {\r\n      isRunning: state.isRunning,\r\n      startTime: state.startTime?.toISOString() || null,\r\n      pausedAt: state.pausedAt?.toISOString() || null,\r\n      totalRunTimeMs: state.totalRunTimeMs,\r\n      lastResumedAt: state.lastResumedAt?.toISOString() || null,\r\n      pauseHistory: [],\r\n    };\r\n    saveProductionTimer(machineName, currentShift, currentDate, timerState);\r\n  }, [machineName]);\r\n\r\n  // Start production timer (called when session is locked)\r\n  const handleStartProduction = useCallback(() => {\r\n    const now = new Date();\r\n    const newState: ProductionState = {\r\n      isRunning: true,\r\n      startTime: now,\r\n      pausedAt: null,\r\n      totalRunTimeMs: 0,\r\n      lastResumedAt: now,\r\n    };\r\n    setProductionState(newState);\r\n    setDisplayRunTime('00:00:00');\r\n    persistTimerState(newState);\r\n  }, [persistTimerState]);\r\n\r\n  // Pause production - record pause start time\r\n  const handlePauseProduction = useCallback(() => {\r\n    if (!productionState.isRunning) return;\r\n\r\n    const now = new Date();\r\n    // Calculate run time accumulated so far\r\n    const currentSessionMs = productionState.lastResumedAt\r\n      ? now.getTime() - productionState.lastResumedAt.getTime()\r\n      : 0;\r\n\r\n    const newState: ProductionState = {\r\n      ...productionState,\r\n      isRunning: false,\r\n      pausedAt: now,\r\n      totalRunTimeMs: productionState.totalRunTimeMs + currentSessionMs,\r\n    };\r\n    setProductionState(newState);\r\n    persistTimerState(newState);\r\n    showToast('Production paused - timer stopped', 'success');\r\n  }, [productionState, persistTimerState, showToast]);\r\n\r\n  // Continue production - show modal to get reason, then record downtime\r\n  const handleContinueProduction = useCallback(async () => {\r\n    if (!pauseDowntimeReason) {\r\n      showToast('Please select a downtime reason', 'error');\r\n      return;\r\n    }\r\n\r\n    if (!productionState.pausedAt) return;\r\n\r\n    const now = new Date();\r\n    const pauseDurationMs = now.getTime() - productionState.pausedAt.getTime();\r\n    const pauseDurationMinutes = Math.ceil(pauseDurationMs / 60000); // Round up to nearest minute\r\n\r\n    // Create downtime entry automatically\r\n    const newDowntimeEntry: DowntimeEntry = {\r\n      id: uuidv4(),\r\n      downtime: pauseDurationMinutes,\r\n      downtimeReason: pauseDowntimeReason,\r\n      notes: 'Auto-recorded from production pause',\r\n      timestamp: productionState.pausedAt,\r\n    };\r\n    setDowntimeEntries(prev => [...prev, newDowntimeEntry]);\r\n\r\n    // Add to database in real-time\r\n    if (liveSubmissionId) {\r\n      await addLiveDowntimeEntry(liveSubmissionId, pauseDurationMinutes, pauseDowntimeReason, productionState.pausedAt);\r\n    }\r\n\r\n    // Resume production\r\n    const newState: ProductionState = {\r\n      ...productionState,\r\n      isRunning: true,\r\n      pausedAt: null,\r\n      lastResumedAt: now,\r\n    };\r\n    setProductionState(newState);\r\n    persistTimerState(newState);\r\n\r\n    // Reset modal state\r\n    setShowContinueModal(false);\r\n    setPauseDowntimeReason('');\r\n    showToast(`Production resumed. ${pauseDurationMinutes} min downtime recorded.`, 'success');\r\n  }, [pauseDowntimeReason, productionState, persistTimerState, showToast, liveSubmissionId]);\r\n\r\n  // Handle Waste Entry from Modal\r\n  const handleWasteSubmit = async () => {\r\n    if (waste && wasteType) {\r\n      const timestamp = new Date();\r\n      const newEntry: WasteEntry = {\r\n        id: uuidv4(),\r\n        waste: Number(waste),\r\n        wasteType,\r\n        timestamp\r\n      };\r\n      setWasteEntries([...wasteEntries, newEntry]);\r\n      setWaste('');\r\n      setWasteType('');\r\n      setShowWasteModal(false);\r\n\r\n      // Add to database in real-time\r\n      if (liveSubmissionId) {\r\n        await addLiveWasteEntry(liveSubmissionId, Number(waste), wasteType, timestamp);\r\n      }\r\n\r\n      showToast('Waste entry added', 'success');\r\n    }\r\n  };\r\n\r\n  const handleDeleteWasteEntry = (id: string) => {\r\n    setWasteEntries(wasteEntries.filter(entry => entry.id !== id));\r\n    showToast('Entry removed', 'success');\r\n  };\r\n\r\n  const handleDeleteDowntimeEntry = (id: string) => {\r\n    setDowntimeEntries(downtimeEntries.filter(entry => entry.id !== id));\r\n    showToast('Entry removed', 'success');\r\n  };\r\n\r\n  // Handle Downtime Entry from Modal\r\n  const handleDowntimeSubmit = async () => {\r\n    if (downtime && downtimeReason) {\r\n      const timestamp = new Date();\r\n      const newEntry: DowntimeEntry = {\r\n        id: uuidv4(),\r\n        downtime: Number(downtime),\r\n        downtimeReason,\r\n        notes: undefined,\r\n        timestamp\r\n      };\r\n      setDowntimeEntries([...downtimeEntries, newEntry]);\r\n      setDowntime('');\r\n      setDowntimeReason('');\r\n      setShowDowntimeModal(false);\r\n\r\n      // Add to database in real-time\r\n      if (liveSubmissionId) {\r\n        await addLiveDowntimeEntry(liveSubmissionId, Number(downtime), downtimeReason, timestamp);\r\n      }\r\n\r\n      showToast('Downtime entry added', 'success');\r\n    }\r\n  };\r\n\r\n  const handleSubmitClick = (e: React.MouseEvent<HTMLButtonElement>) => {\r\n    e.preventDefault();\r\n\r\n    // Validation\r\n    if (!operatorName || !orderNumber || !product || !batchNumber) {\r\n      showToast('Please fill in all shift details', 'error');\r\n      return;\r\n    }\r\n\r\n    if (wasteEntries.length === 0 && downtimeEntries.length === 0) {\r\n      showToast('Please add at least one waste or downtime entry', 'error');\r\n      return;\r\n    }\r\n\r\n    // If outside submission window, show changeover dialog first\r\n    if (!isInSubmissionWindow) {\r\n      setWillChangeover(null);\r\n      setWillMaintenance(null);\r\n      setShowChangeoverDialog(true);\r\n    } else {\r\n      // Within window, go directly to confirmation\r\n      setShowConfirmDialog(true);\r\n    }\r\n  };\r\n\r\n  // Initiate changeover process\r\n  const handleInitiateChangeover = () => {\r\n    setWillChangeover(null);\r\n    setWillMaintenance(null);\r\n    setShowChangeoverDialog(true);\r\n  };\r\n\r\n  const handleChangeoverConfirm = async () => {\r\n    if (willChangeover === null || willMaintenance === null) {\r\n      showToast('Please answer both questions', 'error');\r\n      return;\r\n    }\r\n\r\n    setShowChangeoverDialog(false);\r\n\r\n    if (willChangeover) {\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const currentShift = getCurrentShift();\r\n\r\n      // Finalize the current live submission\r\n      if (liveSubmissionId) {\r\n        await finalizeLiveSubmission(liveSubmissionId);\r\n        console.log(' Finalized live submission before changeover:', liveSubmissionId);\r\n        setLiveSubmissionId(null);\r\n      }\r\n\r\n      // Clear the live session from Supabase\r\n      await deleteLiveSession(machineName, currentShift, currentDate);\r\n\r\n      // Clear local session storage\r\n      const sessionKey = getSessionKey(machineName, currentShift, currentDate);\r\n      localStorage.removeItem(sessionKey);\r\n\r\n      // Clear production timer\r\n      clearProductionTimer(machineName, currentShift, currentDate);\r\n\r\n      // Clear existing entries for the new order\r\n      setWasteEntries([]);\r\n      setDowntimeEntries([]);\r\n      setSpeedEntries([]);\r\n      setSachetMassEntries([]);\r\n      setLooseCasesEntries([]);\r\n      setPalletScanEntries([]);\r\n\r\n      // Changing to new order - enter changeover mode\r\n      setChangeoverStartTime(new Date());\r\n      setIsInChangeoverMode(true);\r\n\r\n      // Clear order fields for new selection\r\n      setOrderNumber('');\r\n      setProduct('');\r\n      setBatchNumber('');\r\n\r\n      // Pause production if running\r\n      if (productionState.isRunning) {\r\n        setProductionState(prev => ({\r\n          ...prev,\r\n          isRunning: false,\r\n          pausedAt: new Date(),\r\n        }));\r\n      }\r\n\r\n      showToast('Select your new order and enter machine speed to start production', 'success');\r\n    } else {\r\n      // Same order continues - just note the maintenance if any\r\n      if (willMaintenance) {\r\n        showToast('Maintenance/cleaning noted. Production continues with same order.', 'success');\r\n      } else {\r\n        showToast('Continuing with same order', 'success');\r\n      }\r\n    }\r\n  };\r\n\r\n  // Start production after changeover (new order selected)\r\n  const handleStartProductionAfterChangeover = async () => {\r\n    if (!orderNumber || !product || !batchNumber) {\r\n      showToast('Please select an order first', 'error');\r\n      return;\r\n    }\r\n\r\n    if (speedEntries.length === 0) {\r\n      showToast('Please enter the machine speed', 'error');\r\n      return;\r\n    }\r\n\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const currentShift = getCurrentShift();\r\n\r\n    // Create a new live submission for the new order\r\n    const newSubmissionId = await createLiveSubmission(\r\n      operatorName,\r\n      machineName,\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      currentShift,\r\n      currentDate\r\n    );\r\n    if (newSubmissionId) {\r\n      setLiveSubmissionId(newSubmissionId);\r\n      console.log(' New live submission created for changeover:', newSubmissionId);\r\n    }\r\n\r\n    // Calculate changeover duration\r\n    let changeoverDurationMinutes = 0;\r\n    if (changeoverStartTime) {\r\n      const now = new Date();\r\n      changeoverDurationMinutes = Math.round((now.getTime() - changeoverStartTime.getTime()) / 60000);\r\n\r\n      // Add changeover as a downtime entry\r\n      const changeoverEntry: DowntimeEntry = {\r\n        id: uuidv4(),\r\n        downtime: changeoverDurationMinutes,\r\n        downtimeReason: 'Changeover',\r\n        timestamp: changeoverStartTime,\r\n      };\r\n      setDowntimeEntries(prev => [...prev, changeoverEntry]);\r\n\r\n      // Add changeover downtime to database\r\n      if (newSubmissionId) {\r\n        await addLiveDowntimeEntry(newSubmissionId, changeoverDurationMinutes, 'Changeover', changeoverStartTime);\r\n      }\r\n\r\n      console.log(` Changeover completed in ${changeoverDurationMinutes} minutes`);\r\n    }\r\n\r\n    // Add speed entry to database\r\n    if (newSubmissionId && speedEntries.length > 0) {\r\n      const latestSpeed = speedEntries[speedEntries.length - 1];\r\n      await addLiveSpeedEntry(newSubmissionId, latestSpeed.speed, latestSpeed.timestamp);\r\n    }\r\n\r\n    // Exit changeover mode\r\n    setIsInChangeoverMode(false);\r\n    setChangeoverStartTime(null);\r\n\r\n    // Start production\r\n    const now = new Date();\r\n    setProductionState({\r\n      isRunning: true,\r\n      startTime: now,\r\n      pausedAt: null,\r\n      totalRunTimeMs: 0,\r\n      lastResumedAt: now,\r\n    });\r\n\r\n    // Save session\r\n    saveSession(false);\r\n\r\n    showToast(`Production started! Changeover took ${changeoverDurationMinutes} min`, 'success');\r\n  };\r\n\r\n  // Finish shift without changeover - save current order for next shift\r\n  const handleFinishShift = async () => {\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const currentShift = getCurrentShift();\r\n\r\n    // Finalize the live submission\r\n    if (liveSubmissionId) {\r\n      await finalizeLiveSubmission(liveSubmissionId);\r\n      console.log(' Finalized live submission on shift finish:', liveSubmissionId);\r\n      setLiveSubmissionId(null);\r\n    }\r\n\r\n    // Stop production if running\r\n    if (productionState.isRunning) {\r\n      setProductionState(prev => ({\r\n        ...prev,\r\n        isRunning: false,\r\n        pausedAt: new Date(),\r\n      }));\r\n    }\r\n\r\n    // Update machine status to idle\r\n    if (machineId) {\r\n      updateMachineStatus(machineId, 'idle');\r\n    }\r\n\r\n    // Clear the session lock\r\n    setIsSessionLocked(false);\r\n\r\n    // Clear local session storage\r\n    const sessionKey = getSessionKey(machineName, currentShift, currentDate);\r\n    localStorage.removeItem(sessionKey);\r\n\r\n    // Clear production timer\r\n    clearProductionTimer(machineName, currentShift, currentDate);\r\n\r\n    // Delete from Supabase live_sessions\r\n    await deleteLiveSession(machineName, currentShift, currentDate);\r\n\r\n    // Clear entries (they're already saved in the database)\r\n    setWasteEntries([]);\r\n    setDowntimeEntries([]);\r\n    setSpeedEntries([]);\r\n    setSachetMassEntries([]);\r\n    setLooseCasesEntries([]);\r\n    setPalletScanEntries([]);\r\n\r\n    // Reset operator for next shift but keep order details\r\n    setOperatorName('');\r\n\r\n    showToast('Shift completed! Order saved for next shift operator.', 'success');\r\n  };\r\n\r\n  // Handle shift change confirmation - update operator for new shift\r\n  const handleShiftChangeConfirm = () => {\r\n    if (!newOperatorName.trim()) {\r\n      showToast('Please enter the new operator name/number', 'error');\r\n      return;\r\n    }\r\n\r\n    // Update the operator name for the new shift\r\n    setOperatorName(newOperatorName.trim());\r\n    setShowShiftChangeModal(false);\r\n    setNewOperatorName('');\r\n\r\n    // Update machine status with new operator\r\n    if (machineId) {\r\n      updateMachineStatus(machineId, 'running', newOperatorName.trim(), orderNumber, shift);\r\n    }\r\n\r\n    // Update the session with new operator\r\n    const currentDate = new Date().toISOString().split('T')[0];\r\n    const sessionKey = getSessionKey(machineName, shift, currentDate);\r\n\r\n    const session: ShiftSession = {\r\n      machineName,\r\n      operatorName: newOperatorName.trim(),\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift,\r\n      date: currentDate,\r\n      locked: true,\r\n      wasteEntries,\r\n      downtimeEntries,\r\n      speedEntries,\r\n      sachetMassEntries,\r\n      looseCasesEntries,\r\n      palletScanEntries,\r\n    };\r\n\r\n    localStorage.setItem(sessionKey, JSON.stringify(session));\r\n    showToast(`Operator changed to ${newOperatorName.trim()} for ${shift} shift`, 'success');\r\n  };\r\n\r\n  const handleConfirmedSubmit = async () => {\r\n    setShowConfirmDialog(false);\r\n    setIsSubmitting(true);\r\n\r\n    // Calculate totals\r\n    const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n    const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n    // Create shift data object\r\n    const shiftData: ShiftData = {\r\n      id: uuidv4(),\r\n      operatorName,\r\n      machine: machineName,\r\n      orderNumber,\r\n      product,\r\n      batchNumber,\r\n      shift,\r\n      date: dateTime.toISOString().split('T')[0],\r\n      wasteEntries,\r\n      downtimeEntries,\r\n      speedEntries,\r\n      sachetMassEntries,\r\n      looseCasesEntries,\r\n      palletScanEntries,\r\n      totalWaste,\r\n      totalDowntime,\r\n      submittedAt: new Date()\r\n    };\r\n\r\n    // Prepare submission data for potential retry queue\r\n    const submissionPayload = {\r\n      shiftData: {\r\n        operator_name: operatorName,\r\n        machine: machineName,\r\n        order_number: orderNumber,\r\n        product,\r\n        batch_number: batchNumber,\r\n        shift,\r\n        submission_date: dateTime.toISOString().split('T')[0],\r\n        is_early_submission: !isInSubmissionWindow,\r\n        will_changeover: willChangeover ?? undefined,\r\n        will_maintenance_cleaning: willMaintenance ?? undefined,\r\n      },\r\n      wasteEntries: wasteEntries.map(e => ({ waste: e.waste, wasteType: e.wasteType, timestamp: e.timestamp })),\r\n      downtimeEntries: downtimeEntries.map(e => ({ downtime: e.downtime, downtimeReason: e.downtimeReason, timestamp: e.timestamp })),\r\n      speedEntries: speedEntries.map(e => ({ speed: e.speed, timestamp: e.timestamp })),\r\n      sachetMassEntries: sachetMassEntries.map(e => ({ mass: e.mass, timestamp: e.timestamp })),\r\n      looseCasesEntries: looseCasesEntries.map(e => ({ batchNumber: e.batchNumber, cases: e.cases, timestamp: e.timestamp })),\r\n      palletScanEntries: palletScanEntries.map(e => ({ qrCode: e.qrCode, batchNumber: e.batchNumber, palletNumber: e.palletNumber, casesCount: e.casesCount, timestamp: e.timestamp })),\r\n    };\r\n\r\n    try {\r\n      // Save to local storage first\r\n      saveShiftData(shiftData);\r\n\r\n      // Try to submit to Supabase with all data including changeover info\r\n      const result = await submitShiftData(\r\n        submissionPayload.shiftData,\r\n        submissionPayload.wasteEntries,\r\n        submissionPayload.downtimeEntries,\r\n        submissionPayload.speedEntries,\r\n        submissionPayload.sachetMassEntries,\r\n        submissionPayload.looseCasesEntries,\r\n        submissionPayload.palletScanEntries\r\n      );\r\n\r\n      // Show success with any warnings\r\n      if (result.warnings.length > 0) {\r\n        showToast(`Submitted with warnings: ${result.warnings.join(', ')}`, 'success');\r\n      } else {\r\n        showToast('Shift data submitted successfully', 'success');\r\n      }\r\n\r\n      // Reset form for new submission\r\n      // Unlock shift details\r\n      setIsSessionLocked(false);\r\n\r\n      // Update machine status to 'idle' since order is complete\r\n      if (machineId) {\r\n        updateMachineStatus(machineId, 'idle');\r\n      }\r\n\r\n      // Clear all entries\r\n      setWasteEntries([]);\r\n      setDowntimeEntries([]);\r\n      setSpeedEntries([]);\r\n      setSachetMassEntries([]);\r\n      setLooseCasesEntries([]);\r\n      setPalletScanEntries([]);\r\n\r\n      // Reset changeover state\r\n      setWillChangeover(null);\r\n      setWillMaintenance(false);\r\n\r\n      // Clear session storage so new details can be entered\r\n      sessionStorage.removeItem(`session_${machineId}`);\r\n\r\n      // Clear the localStorage session key as well\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const sessionKey = getSessionKey(machineName, shift, currentDate);\r\n      localStorage.removeItem(sessionKey);\r\n\r\n      // Delete from Supabase live_sessions so other browsers see it as available\r\n      deleteLiveSession(machineName, shift, currentDate);\r\n\r\n      // Clear order-specific fields from state\r\n      setOrderNumber('');\r\n      setProduct('');\r\n      setBatchNumber('');\r\n\r\n    } catch (error) {\r\n      console.error('Submission error:', error);\r\n\r\n      // Add to failed submissions queue for retry\r\n      addFailedSubmission(submissionPayload, String(error));\r\n\r\n      // Still saved locally, show partial success with retry info\r\n      showToast('Saved locally. Will retry sync automatically.', 'error');\r\n\r\n      // Clear form since data is saved locally\r\n      setIsSessionLocked(false);\r\n\r\n      // Update machine status to 'idle' since order is \"complete\" (saved locally)\r\n      if (machineId) {\r\n        updateMachineStatus(machineId, 'idle');\r\n      }\r\n\r\n      // Clear the localStorage session key\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const sessionKey = getSessionKey(machineName, shift, currentDate);\r\n      localStorage.removeItem(sessionKey);\r\n\r\n      // Also delete from Supabase live_sessions\r\n      deleteLiveSession(machineName, shift, currentDate);\r\n\r\n      setWasteEntries([]);\r\n      setDowntimeEntries([]);\r\n      setSpeedEntries([]);\r\n      setSachetMassEntries([]);\r\n      setLooseCasesEntries([]);\r\n      setPalletScanEntries([]);\r\n      setWillChangeover(null);\r\n      setWillMaintenance(false);\r\n      setOrderNumber('');\r\n      setProduct('');\r\n      setBatchNumber('');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleBack = () => {\r\n    // Only warn if session is NOT locked (entries won't be auto-saved)\r\n    const hasEntries = wasteEntries.length > 0 || downtimeEntries.length > 0 ||\r\n      speedEntries.length > 0 || sachetMassEntries.length > 0 ||\r\n      looseCasesEntries.length > 0 || palletScanEntries.length > 0;\r\n\r\n    if (hasEntries && !isSessionLocked) {\r\n      if (window.confirm('You have entries that are not saved to a session. Are you sure you want to go back? Lock your shift details first to save entries.')) {\r\n        navigate('/');\r\n      }\r\n    } else {\r\n      // Session is locked = entries are auto-saved, safe to go back\r\n      navigate('/');\r\n    }\r\n  };\r\n\r\n  // Handle Speed Entry\r\n  const handleSpeedSubmit = () => {\r\n    if (speedInput && speedInput > 0) {\r\n      const newEntry: SpeedEntry = {\r\n        id: uuidv4(),\r\n        speed: Number(speedInput),\r\n        timestamp: new Date()\r\n      };\r\n      setSpeedEntries([...speedEntries, newEntry]);\r\n      setSpeedInput('');\r\n      setShowSpeedModal(false);\r\n      showToast('Machine speed recorded', 'success');\r\n\r\n      // Save to shared line storage so other machines can see it\r\n      const currentDate = new Date().toISOString().split('T')[0];\r\n      const shift = getCurrentShift();\r\n      saveLineSpeed(machineName, shift, currentDate, Number(speedInput));\r\n    }\r\n  };\r\n\r\n  // Speed entry deletion (available for future UI enhancement)\r\n  const _handleDeleteSpeedEntry = (id: string) => {\r\n    setSpeedEntries(speedEntries.filter(entry => entry.id !== id));\r\n    showToast('Speed entry removed', 'success');\r\n  };\r\n  // Suppress unused variable warning\r\n  void _handleDeleteSpeedEntry;\r\n\r\n  // Handle Sachet Mass Entry\r\n  const handleSachetMassSubmit = () => {\r\n    if (sachetMassInput && sachetMassInput > 0) {\r\n      const newEntry: SachetMassEntry = {\r\n        id: uuidv4(),\r\n        mass: Number(sachetMassInput),\r\n        timestamp: new Date()\r\n      };\r\n      setSachetMassEntries([...sachetMassEntries, newEntry]);\r\n      setSachetMassInput('');\r\n      setShowSachetModal(false);\r\n      showToast('Sachet mass recorded', 'success');\r\n    }\r\n  };\r\n\r\n  const handleToggleSachetIgnore = (id: string) => {\r\n    setSachetMassEntries(sachetMassEntries.map(entry =>\r\n      entry.id === id ? { ...entry, ignored: !entry.ignored } : entry\r\n    ));\r\n  };\r\n\r\n  // Handle Loose Cases Entry (cases not part of a full pallet)\r\n  const handleLooseCasesSubmit = () => {\r\n    if (looseCasesBatchInput && looseCasesBatchInput.length === 5 && looseCasesQuantityInput && looseCasesQuantityInput > 0) {\r\n      const newEntry: LooseCasesEntry = {\r\n        id: uuidv4(),\r\n        batchNumber: looseCasesBatchInput,\r\n        cases: Number(looseCasesQuantityInput),\r\n        timestamp: new Date()\r\n      };\r\n      setLooseCasesEntries([...looseCasesEntries, newEntry]);\r\n      setLooseCasesBatchInput('');\r\n      setLooseCasesQuantityInput('');\r\n      setShowLooseCasesModal(false);\r\n      showToast('Loose cases recorded', 'success');\r\n    } else if (looseCasesBatchInput.length !== 5) {\r\n      showToast('Batch number must be 5 digits', 'error');\r\n    }\r\n  };\r\n\r\n  const handleToggleLooseCasesIgnore = (id: string) => {\r\n    setLooseCasesEntries(looseCasesEntries.map(entry =>\r\n      entry.id === id ? { ...entry, ignored: !entry.ignored } : entry\r\n    ));\r\n  };\r\n\r\n  // Parse 13-digit QR code: BBBBBPPPPCCCC\r\n  // B = batch (5 digits), P = pallet number (4 digits), C = cases count (4 digits)\r\n  const parsePalletQRCode = (qrData: string): { batchNumber: string; palletNumber: string; casesCount: number } | null => {\r\n    // Remove any whitespace\r\n    const cleaned = qrData.trim();\r\n\r\n    // Check if it's exactly 13 digits\r\n    if (!/^\\d{13}$/.test(cleaned)) {\r\n      return null;\r\n    }\r\n\r\n    const casesCount = parseInt(cleaned.substring(9, 13), 10);\r\n\r\n    // Extra safety check for NaN (shouldn't happen given regex validation)\r\n    if (Number.isNaN(casesCount)) {\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      batchNumber: cleaned.substring(0, 5),    // First 5 digits\r\n      palletNumber: cleaned.substring(5, 9),   // Next 4 digits\r\n      casesCount\r\n    };\r\n  };\r\n\r\n  // Handle QR Code Pallet Scan\r\n  const handlePalletScan = (qrData: string) => {\r\n    const parsed = parsePalletQRCode(qrData);\r\n\r\n    if (!parsed) {\r\n      showToast('Invalid QR code format. Expected 13 digits: BBBBBPPPPCCCC', 'error');\r\n      return;\r\n    }\r\n\r\n    // Check for duplicate pallet scan (same QR code already scanned)\r\n    const isDuplicate = palletScanEntries.some(entry => entry.qrCode === qrData);\r\n    if (isDuplicate) {\r\n      showToast(`Pallet ${parsed.palletNumber} has already been scanned!`, 'error');\r\n      return;\r\n    }\r\n\r\n    const newEntry: PalletScanEntry = {\r\n      id: uuidv4(),\r\n      qrCode: qrData,\r\n      batchNumber: parsed.batchNumber,\r\n      palletNumber: parsed.palletNumber,\r\n      casesCount: parsed.casesCount,\r\n      timestamp: new Date()\r\n    };\r\n    setPalletScanEntries([...palletScanEntries, newEntry]);\r\n    showToast(`Pallet ${parsed.palletNumber} scanned (${parsed.casesCount} cases)`, 'success');\r\n  };\r\n\r\n  const handleTogglePalletIgnore = (id: string) => {\r\n    setPalletScanEntries(palletScanEntries.map(entry =>\r\n      entry.id === id ? { ...entry, ignored: !entry.ignored } : entry\r\n    ));\r\n  };\r\n\r\n  // Format timestamp for pallet scans\r\n  const formatScanTime = (timestamp: Date) => {\r\n    const date = new Date(timestamp);\r\n    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n  };\r\n\r\n  // Calculate totals for preview\r\n  const totalWaste = wasteEntries.reduce((sum, e) => sum + e.waste, 0);\r\n  const totalDowntime = downtimeEntries.reduce((sum, e) => sum + e.downtime, 0);\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"capture-screen-v2\"\r\n      initial={{ opacity: 0, x: 20 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: -20 }}\r\n    >\r\n      {/* Loading Overlay */}\r\n      {isSubmitting && (\r\n        <div className=\"spinner-overlay-v2\">\r\n          <div className=\"spinner-v2\"></div>\r\n          <p>Submitting shift data...</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Toast Notification */}\r\n      {toast && (\r\n        <motion.div\r\n          className=\"toast-container-v2\"\r\n          initial={{ opacity: 0, y: -20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          exit={{ opacity: 0, y: -20 }}\r\n        >\r\n          <div className={`toast-message-v2 ${toast.type}`}>\r\n            <span className=\"toast-icon\">{toast.type === 'success' ? '' : '!'}</span>\r\n            {toast.message}\r\n          </div>\r\n        </motion.div>\r\n      )}\r\n\r\n      {/* Header */}\r\n      <header className=\"capture-header-v2\">\r\n        <button className=\"back-btn-v2\" onClick={handleBack}>\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n            <path d=\"M19 12H5M12 19l-7-7 7-7\" />\r\n          </svg>\r\n          Back\r\n        </button>\r\n        <div className=\"capture-title-v2\">\r\n          <h1>{machineName}</h1>\r\n          <span className=\"capture-subtitle\">Recording Waste & Downtime</span>\r\n        </div>\r\n        <div className={`shift-badge-v2 ${shift.toLowerCase()}`}>\r\n          <span className=\"shift-icon\">{shift === 'Day' ? '' : ''}</span>\r\n          {shift} Shift\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"capture-main\">\r\n        {/* Left Column - Form */}\r\n        <div className=\"capture-form-column\">\r\n          <section className=\"form-section\">\r\n            <h2 className=\"section-heading\">\r\n              Shift Details\r\n              {isSessionLocked && <span className=\"locked-badge\"> Locked</span>}\r\n            </h2>\r\n\r\n            {/* Order Queue Selection */}\r\n            {!isSessionLocked && (\r\n              <div className=\"order-queue-select\">\r\n                <div className=\"order-buttons-row\">\r\n                  <button\r\n                    className=\"select-order-btn add-new\"\r\n                    onClick={() => setShowAddOrderModal(true)}\r\n                  >\r\n                    <span className=\"btn-icon\">+</span>\r\n                    Add New Order\r\n                  </button>\r\n                  <button\r\n                    className=\"select-order-btn existing\"\r\n                    onClick={() => setShowOrderSelect(true)}\r\n                    disabled={availableOrders.length === 0}\r\n                  >\r\n                    <span className=\"btn-icon\"></span>\r\n                    Select Existing{availableOrders.length > 0 ? ` (${availableOrders.length})` : ''}\r\n                  </button>\r\n                </div>\r\n                {orderNumber && (\r\n                  <span className=\"current-order-badge\">\r\n                    Current: {orderNumber}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"form-grid\">\r\n              <MainForm\r\n                operatorName={operatorName}\r\n                setOperatorName={isSessionLocked ? () => { } : setOperatorName}\r\n                machine={machineName}\r\n                setMachine={() => { }}\r\n                orderNumber={orderNumber}\r\n                setOrderNumber={isSessionLocked ? () => { } : setOrderNumber}\r\n                product={product}\r\n                setProduct={isSessionLocked ? () => { } : setProduct}\r\n                batchNumber={batchNumber}\r\n                setBatchNumber={isSessionLocked ? () => { } : setBatchNumber}\r\n                hideMachine={true}\r\n                disabled={isSessionLocked}\r\n              />\r\n              <ShiftInfo dateTime={dateTime} shift={shift} />\r\n            </div>\r\n\r\n            {/* Machine Speed in Shift Details */}\r\n            <div className=\"speed-setting\">\r\n              <div className=\"speed-display\">\r\n                <span className=\"speed-label\"> Machine Speed</span>\r\n                <span className=\"speed-value\">\r\n                  {speedEntries.length > 0\r\n                    ? `${speedEntries[speedEntries.length - 1].speed} PPM`\r\n                    : 'Not Set'}\r\n                </span>\r\n                {speedEntries.length > 1 && (\r\n                  <span className=\"speed-history-count\" title=\"Speed change history\">\r\n                    ({speedEntries.length} changes)\r\n                  </span>\r\n                )}\r\n              </div>\r\n              <button\r\n                className=\"speed-change-btn\"\r\n                onClick={() => setShowSpeedModal(true)}\r\n              >\r\n                {speedEntries.length > 0 ? 'Change' : 'Set Speed'}\r\n              </button>\r\n            </div>\r\n\r\n            {!isSessionLocked && operatorName && orderNumber && product && batchNumber && (\r\n              speedEntries.length > 0 ? (\r\n                <button\r\n                  className=\"lock-session-btn\"\r\n                  onClick={() => {\r\n                    saveSession(true);\r\n                    handleStartProduction();\r\n                  }}\r\n                >\r\n                   Lock Shift Details & Start Production\r\n                </button>\r\n              ) : (\r\n                <button\r\n                  className=\"lock-session-btn disabled\"\r\n                  onClick={() => setShowSpeedModal(true)}\r\n                  title=\"Set machine speed to continue\"\r\n                >\r\n                   Set Machine Speed to Start\r\n                </button>\r\n              )\r\n            )}\r\n          </section>\r\n\r\n          {/* Machine Details Section - Production Timer */}\r\n          {isSessionLocked && (\r\n            <section className=\"form-section machine-details-section\">\r\n              <h2 className=\"section-heading\">\r\n                <span className=\"section-icon\"></span>\r\n                Machine Details\r\n                <span className={`production-status-badge ${productionState.isRunning ? 'running' : 'paused'}`}>\r\n                  {productionState.isRunning ? ' Running' : ' Paused'}\r\n                </span>\r\n              </h2>\r\n\r\n              <div className=\"machine-details-grid\">\r\n                {/* Production Start Time */}\r\n                <div className=\"detail-card\">\r\n                  <span className=\"detail-label\">Production Started</span>\r\n                  <span className=\"detail-value\">\r\n                    {productionState.startTime\r\n                      ? productionState.startTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\r\n                      : '--:--'}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Run Time Timer */}\r\n                <div className=\"detail-card timer-card\">\r\n                  <span className=\"detail-label\">Run Time</span>\r\n                  <span className=\"detail-value timer-value\">{displayRunTime}</span>\r\n                </div>\r\n\r\n                {/* Pause/Continue Button */}\r\n                <div className=\"detail-card action-card\">\r\n                  {productionState.isRunning ? (\r\n                    <button\r\n                      className=\"pause-continue-btn pause\"\r\n                      onClick={handlePauseProduction}\r\n                    >\r\n                      <span className=\"btn-icon\"></span>\r\n                      Pause Production\r\n                    </button>\r\n                  ) : (\r\n                    <button\r\n                      className=\"pause-continue-btn continue\"\r\n                      onClick={() => setShowContinueModal(true)}\r\n                    >\r\n                      <span className=\"btn-icon\"></span>\r\n                      Continue Production\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Pause Duration Display */}\r\n              {productionState.pausedAt && (\r\n                <div className=\"pause-duration-display\">\r\n                  <span className=\"pause-icon\"></span>\r\n                  Paused since {productionState.pausedAt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                </div>\r\n              )}\r\n            </section>\r\n          )}\r\n\r\n          {/* Waste Section - Button Based */}\r\n          <section className=\"form-section capture-section compact-capture waste-section\">\r\n            <h2 className=\"section-heading\">\r\n              <span className=\"section-icon\"></span>\r\n              Record Waste\r\n              {wasteEntries.length > 0 && (\r\n                <span className=\"entry-count-badge waste-badge\">{wasteEntries.length}</span>\r\n              )}\r\n            </h2>\r\n            <div className=\"capture-section-content\">\r\n              <button\r\n                className=\"capture-add-btn waste-btn\"\r\n                onClick={() => setShowWasteModal(true)}\r\n              >\r\n                <span className=\"btn-icon\">+</span>\r\n                Record Waste\r\n              </button>\r\n              {wasteEntries.length > 0 && (\r\n                <div className=\"capture-entries-list\">\r\n                  {wasteEntries.slice().reverse().map((entry, index) => (\r\n                    <div key={entry.id} className={`capture-entry-item waste-entry ${index === 0 ? 'latest' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"entry-value\">{entry.waste}</span>\r\n                        <span className=\"entry-unit\">kg</span>\r\n                      </div>\r\n                      <span className=\"entry-type\">{entry.wasteType}</span>\r\n                      <span className=\"entry-time\">\r\n                        {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                      </span>\r\n                      <button\r\n                        className=\"entry-delete-btn\"\r\n                        onClick={() => handleDeleteWasteEntry(entry.id)}\r\n                        title=\"Delete this entry\"\r\n                      >\r\n                        \r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n              {wasteEntries.length > 0 && (\r\n                <div className=\"section-total\">\r\n                  <span>Total Waste:</span>\r\n                  <strong>{wasteEntries.reduce((sum, e) => sum + e.waste, 0).toFixed(1)} kg</strong>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </section>\r\n\r\n          {/* Downtime Section - Button Based */}\r\n          <section className=\"form-section capture-section compact-capture downtime-section\">\r\n            <h2 className=\"section-heading\">\r\n              <span className=\"section-icon\"></span>\r\n              Record Downtime\r\n              {downtimeEntries.length > 0 && (\r\n                <span className=\"entry-count-badge downtime-badge\">{downtimeEntries.length}</span>\r\n              )}\r\n            </h2>\r\n            <div className=\"capture-section-content\">\r\n              <button\r\n                className=\"capture-add-btn downtime-btn\"\r\n                onClick={() => setShowDowntimeModal(true)}\r\n              >\r\n                <span className=\"btn-icon\">+</span>\r\n                Record Downtime\r\n              </button>\r\n              {downtimeEntries.length > 0 && (\r\n                <div className=\"capture-entries-list\">\r\n                  {downtimeEntries.slice().reverse().map((entry, index) => (\r\n                    <div key={entry.id} className={`capture-entry-item downtime-entry ${index === 0 ? 'latest' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"entry-value\">{entry.downtime}</span>\r\n                        <span className=\"entry-unit\">min</span>\r\n                      </div>\r\n                      <span className=\"entry-reason\">{entry.downtimeReason}</span>\r\n                      <span className=\"entry-time\">\r\n                        {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                      </span>\r\n                      <button\r\n                        className=\"entry-delete-btn\"\r\n                        onClick={() => handleDeleteDowntimeEntry(entry.id)}\r\n                        title=\"Delete this entry\"\r\n                      >\r\n                        \r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n              {downtimeEntries.length > 0 && (\r\n                <div className=\"section-total\">\r\n                  <span>Total Downtime:</span>\r\n                  <strong>{Math.floor(downtimeEntries.reduce((sum, e) => sum + e.downtime, 0) / 60)}h {downtimeEntries.reduce((sum, e) => sum + e.downtime, 0) % 60}m</strong>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </section>\r\n\r\n          {/* Sachet Mass Section */}\r\n          <section className=\"form-section capture-section compact-capture\">\r\n            <h2 className=\"section-heading\">\r\n              <span className=\"section-icon\"></span>\r\n              Sachet Mass\r\n            </h2>\r\n            <div className=\"capture-section-content\">\r\n              <button\r\n                className=\"capture-add-btn\"\r\n                onClick={() => setShowSachetModal(true)}\r\n              >\r\n                <span className=\"btn-icon\">+</span>\r\n                Record\r\n              </button>\r\n              {sachetMassEntries.length > 0 && (\r\n                <div className=\"capture-entries-list\">\r\n                  {sachetMassEntries.map(entry => (\r\n                    <div key={entry.id} className={`capture-entry-item ${entry.ignored ? 'ignored' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"entry-value\">{entry.mass}</span>\r\n                        <span className=\"entry-unit\">g</span>\r\n                      </div>\r\n                      <span className=\"entry-time\">\r\n                        {new Date(entry.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                      </span>\r\n                      <button\r\n                        className={`entry-ignore-btn ${entry.ignored ? 'ignored' : ''}`}\r\n                        onClick={() => handleToggleSachetIgnore(entry.id)}\r\n                        title={entry.ignored ? 'Include this entry' : 'Ignore this entry'}\r\n                      >\r\n                        {entry.ignored ? '' : ''}\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </section>\r\n\r\n          {/* Product Confirmation Section - Pallets and Loose Cases */}\r\n          <section className=\"form-section capture-section product-confirmation-section\">\r\n            <h2 className=\"section-heading\">\r\n              <span className=\"section-icon\"></span>\r\n              Product Confirmation\r\n              {(palletScanEntries.length > 0 || looseCasesEntries.length > 0) && (\r\n                <span className=\"entry-count-badge\">\r\n                  {palletScanEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.casesCount, 0) +\r\n                    looseCasesEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.cases, 0)} cases\r\n                </span>\r\n              )}\r\n            </h2>\r\n\r\n            {/* Action Buttons */}\r\n            <div className=\"product-action-buttons\">\r\n              <button\r\n                className=\"capture-add-btn scan-btn\"\r\n                onClick={() => setShowQRScanner(true)}\r\n              >\r\n                <span className=\"btn-icon\"></span>\r\n                Scan Pallet\r\n              </button>\r\n              <button\r\n                className=\"capture-add-btn loose-cases-btn\"\r\n                onClick={() => setShowLooseCasesModal(true)}\r\n              >\r\n                <span className=\"btn-icon\">+</span>\r\n                Add Loose Cases\r\n              </button>\r\n            </div>\r\n\r\n            {/* Pallet Scans List */}\r\n            {palletScanEntries.length > 0 && (\r\n              <div className=\"product-entries-section\">\r\n                <h4 className=\"entries-subheading\">Scanned Pallets ({palletScanEntries.filter(e => !e.ignored).length})</h4>\r\n                <div className=\"capture-entries-list pallet-list\">\r\n                  {palletScanEntries.slice().reverse().map((entry, index) => (\r\n                    <div key={entry.id} className={`capture-entry-item pallet-entry ${entry.ignored ? 'ignored' : ''} ${index === 0 ? 'latest' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"pallet-badge\">P{entry.palletNumber}</span>\r\n                        <div className=\"pallet-details\">\r\n                          <span className=\"pallet-batch\">Batch: {entry.batchNumber}</span>\r\n                          <span className=\"pallet-cases\">{entry.casesCount} cases</span>\r\n                        </div>\r\n                      </div>\r\n                      <span className=\"entry-time\">\r\n                        {formatScanTime(entry.timestamp)}\r\n                      </span>\r\n                      <button\r\n                        className={`entry-ignore-btn ${entry.ignored ? 'ignored' : ''}`}\r\n                        onClick={() => handleTogglePalletIgnore(entry.id)}\r\n                        title={entry.ignored ? 'Include this pallet' : 'Ignore this pallet'}\r\n                      >\r\n                        {entry.ignored ? '' : ''}\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Loose Cases List */}\r\n            {looseCasesEntries.length > 0 && (\r\n              <div className=\"product-entries-section\">\r\n                <h4 className=\"entries-subheading\">Loose Cases ({looseCasesEntries.filter(e => !e.ignored).length})</h4>\r\n                <div className=\"capture-entries-list loose-cases-list\">\r\n                  {looseCasesEntries.slice().reverse().map((entry, index) => (\r\n                    <div key={entry.id} className={`capture-entry-item loose-entry ${entry.ignored ? 'ignored' : ''}`}>\r\n                      <div className=\"entry-main\">\r\n                        <span className=\"loose-badge\">LC</span>\r\n                        <div className=\"loose-details\">\r\n                          <span className=\"loose-batch\">Batch: {entry.batchNumber}</span>\r\n                          <span className=\"loose-cases\">{entry.cases} cases</span>\r\n                        </div>\r\n                      </div>\r\n                      <span className=\"entry-time\">\r\n                        {formatScanTime(entry.timestamp)}\r\n                      </span>\r\n                      <button\r\n                        className={`entry-ignore-btn ${entry.ignored ? 'ignored' : ''}`}\r\n                        onClick={() => handleToggleLooseCasesIgnore(entry.id)}\r\n                        title={entry.ignored ? 'Include this entry' : 'Ignore this entry'}\r\n                      >\r\n                        {entry.ignored ? '' : ''}\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Summary */}\r\n            {(palletScanEntries.length > 0 || looseCasesEntries.length > 0) && (\r\n              <div className=\"product-summary\">\r\n                <div className=\"summary-item\">\r\n                  <span className=\"summary-label\">Total Pallets:</span>\r\n                  <span className=\"summary-value\">{palletScanEntries.filter(e => !e.ignored).length}</span>\r\n                </div>\r\n                <div className=\"summary-item\">\r\n                  <span className=\"summary-label\">Total Cases:</span>\r\n                  <span className=\"summary-value\">\r\n                    {palletScanEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.casesCount, 0) +\r\n                      looseCasesEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.cases, 0)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </section>\r\n        </div>\r\n\r\n        {/* Right Column - Summary & Charts */}\r\n        <div className=\"capture-summary-column\">\r\n          {/* Live Stats */}\r\n          <div className=\"live-stats-card\">\r\n            <h3>Session Totals</h3>\r\n            <div className=\"stats-grid\">\r\n              <div className=\"stat-box waste\">\r\n                <span className=\"stat-number\">{totalWaste.toFixed(1)}</span>\r\n                <span className=\"stat-unit\">kg waste</span>\r\n              </div>\r\n              <div className=\"stat-box downtime\">\r\n                <span className=\"stat-number\">{totalDowntime}</span>\r\n                <span className=\"stat-unit\">min downtime</span>\r\n              </div>\r\n              <div className=\"stat-box cases\">\r\n                <span className=\"stat-number\">\r\n                  {palletScanEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.casesCount, 0) +\r\n                    looseCasesEntries.filter(e => !e.ignored).reduce((sum, e) => sum + e.cases, 0)}\r\n                </span>\r\n                <span className=\"stat-unit\">cases</span>\r\n              </div>\r\n              <div className=\"stat-box pallets\">\r\n                <span className=\"stat-number\">{palletScanEntries.filter(e => !e.ignored).length}</span>\r\n                <span className=\"stat-unit\">pallets</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Charts */}\r\n          <div className=\"charts-card\">\r\n            <h3>Visual Summary</h3>\r\n            <DashboardCharts wasteEntries={wasteEntries} downtimeEntries={downtimeEntries} />\r\n          </div>\r\n\r\n          {/* Changeover Mode UI */}\r\n          {isInChangeoverMode && (\r\n            <motion.div\r\n              className=\"submission-card changeover-mode-card\"\r\n              initial={{ opacity: 0, scale: 0.95 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n            >\r\n              <div className=\"changeover-header\">\r\n                <h3> Changeover Mode</h3>\r\n                <div className=\"changeover-timer\">\r\n                  <span className=\"timer-label\">Elapsed:</span>\r\n                  <span className=\"timer-value\">{changeoverElapsed}</span>\r\n                </div>\r\n              </div>\r\n              <p className=\"changeover-instructions\">\r\n                Select your new order and enter machine speed to start production.\r\n              </p>\r\n\r\n              {/* Order Selection */}\r\n              <div className=\"changeover-order-section\">\r\n                {orderNumber ? (\r\n                  <div className=\"selected-order-display\">\r\n                    <span className=\"label\">Selected Order:</span>\r\n                    <strong>{orderNumber}</strong>\r\n                    <span className=\"product-name\">({product})</span>\r\n                    <button\r\n                      className=\"change-order-btn\"\r\n                      onClick={() => setShowOrderSelect(true)}\r\n                    >\r\n                      Change\r\n                    </button>\r\n                  </div>\r\n                ) : (\r\n                  <button\r\n                    className=\"capture-add-btn select-order-btn\"\r\n                    onClick={() => setShowOrderSelect(true)}\r\n                  >\r\n                    <span className=\"btn-icon\"></span>\r\n                    Select Order\r\n                  </button>\r\n                )}\r\n              </div>\r\n\r\n              {/* Speed Entry */}\r\n              <div className=\"changeover-speed-section\">\r\n                {speedEntries.length > 0 ? (\r\n                  <div className=\"speed-display\">\r\n                    <span className=\"label\">Machine Speed:</span>\r\n                    <strong>{speedEntries[speedEntries.length - 1].speed} PPM</strong>\r\n                    <button\r\n                      className=\"change-speed-btn\"\r\n                      onClick={() => setShowSpeedModal(true)}\r\n                    >\r\n                      Change\r\n                    </button>\r\n                  </div>\r\n                ) : (\r\n                  <button\r\n                    className=\"capture-add-btn enter-speed-btn\"\r\n                    onClick={() => setShowSpeedModal(true)}\r\n                  >\r\n                    <span className=\"btn-icon\"></span>\r\n                    Enter Machine Speed\r\n                  </button>\r\n                )}\r\n              </div>\r\n\r\n              {/* Start Production Button */}\r\n              <button\r\n                className=\"start-production-btn\"\r\n                onClick={handleStartProductionAfterChangeover}\r\n                disabled={!orderNumber || !product || !batchNumber || speedEntries.length === 0}\r\n              >\r\n                 Start Production\r\n              </button>\r\n\r\n              {changeoverStartTime && (\r\n                <p className=\"changeover-time\">\r\n                  Changeover started: {changeoverStartTime.toLocaleTimeString()}\r\n                </p>\r\n              )}\r\n            </motion.div>\r\n          )}\r\n\r\n          {/* Changeover Button (when not in changeover mode) */}\r\n          {isSessionLocked && !isInChangeoverMode && (\r\n            <motion.div\r\n              className=\"submission-card changeover-card\"\r\n              initial={{ opacity: 0, scale: 0.95 }}\r\n              animate={{ opacity: 1, scale: 1 }}\r\n            >\r\n              <div className=\"live-status\">\r\n                <span className=\"live-indicator\"></span>\r\n                <span>Data syncing live</span>\r\n              </div>\r\n              <div className=\"session-summary\">\r\n                <div className=\"detail-row\">\r\n                  <span>Order</span>\r\n                  <strong>{orderNumber || ''}</strong>\r\n                </div>\r\n                <div className=\"detail-row highlight waste\">\r\n                  <span>Total Waste</span>\r\n                  <strong>{totalWaste.toFixed(1)} kg</strong>\r\n                </div>\r\n                <div className=\"detail-row highlight downtime\">\r\n                  <span>Total Downtime</span>\r\n                  <strong>{Math.floor(totalDowntime / 60)}h {totalDowntime % 60}m</strong>\r\n                </div>\r\n              </div>\r\n              <div className=\"shift-action-buttons\">\r\n                <button\r\n                  className=\"changeover-btn\"\r\n                  onClick={handleInitiateChangeover}\r\n                >\r\n                   Changeover\r\n                </button>\r\n                <button\r\n                  className=\"finish-shift-btn\"\r\n                  onClick={handleFinishShift}\r\n                >\r\n                   Finish Shift\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </div>\r\n      </main>\r\n\r\n      {/* Confirmation Dialog */}\r\n      <ConfirmDialog\r\n        isOpen={showConfirmDialog}\r\n        title=\"Confirm Submission\"\r\n        message={`You are about to submit ${wasteEntries.length} waste entries and ${downtimeEntries.length} downtime entries for ${machineName}.${willChangeover !== null ? ` Changeover: ${willChangeover ? 'Yes' : 'No'}. Maintenance/Cleaning: ${willMaintenance ? 'Yes' : 'No'}.` : ''} This action cannot be undone.`}\r\n        confirmText=\"Submit\"\r\n        cancelText=\"Review\"\r\n        type=\"success\"\r\n        onConfirm={handleConfirmedSubmit}\r\n        onCancel={() => setShowConfirmDialog(false)}\r\n      />\r\n\r\n      {/* Changeover Dialog (shown when submitting outside window) */}\r\n      <AnimatePresence>\r\n        {showChangeoverDialog && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal changeover-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Early Submission\r\n              </h3>\r\n              <p className=\"changeover-intro\">\r\n                You are submitting before the end of shift window. Please answer the following:\r\n              </p>\r\n\r\n              <div className=\"changeover-question\">\r\n                <label className=\"question-label\">\r\n                  Will there be a changeover to a new product and order?\r\n                </label>\r\n                <div className=\"question-options\">\r\n                  <button\r\n                    className={`option-btn ${willChangeover === true ? 'selected yes' : ''}`}\r\n                    onClick={() => setWillChangeover(true)}\r\n                  >\r\n                     Yes\r\n                  </button>\r\n                  <button\r\n                    className={`option-btn ${willChangeover === false ? 'selected no' : ''}`}\r\n                    onClick={() => setWillChangeover(false)}\r\n                  >\r\n                     No\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"changeover-question\">\r\n                <label className=\"question-label\">\r\n                  Will there be maintenance or cleaning before next production start?\r\n                </label>\r\n                <div className=\"question-options\">\r\n                  <button\r\n                    className={`option-btn ${willMaintenance === true ? 'selected yes' : ''}`}\r\n                    onClick={() => setWillMaintenance(true)}\r\n                  >\r\n                     Yes\r\n                  </button>\r\n                  <button\r\n                    className={`option-btn ${willMaintenance === false ? 'selected no' : ''}`}\r\n                    onClick={() => setWillMaintenance(false)}\r\n                  >\r\n                     No\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => setShowChangeoverDialog(false)}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleChangeoverConfirm}\r\n                  disabled={willChangeover === null || willMaintenance === null}\r\n                >\r\n                  Continue to Submit\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Shift Change Modal */}\r\n      <AnimatePresence>\r\n        {showShiftChangeModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal shift-change-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Shift Change Detected\r\n              </h3>\r\n              <p className=\"modal-description\">\r\n                The shift has changed to <strong>{shift}</strong> shift.\r\n                Please enter the new operator's name or number.\r\n              </p>\r\n              <div className=\"modal-form\">\r\n                <label className=\"modal-label\">New Operator Name/Number</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"modal-input\"\r\n                  placeholder=\"Enter operator name or number...\"\r\n                  value={newOperatorName}\r\n                  onChange={e => setNewOperatorName(e.target.value)}\r\n                  autoFocus\r\n                />\r\n              </div>\r\n              <div className=\"shift-change-info\">\r\n                <p><strong>Current Order:</strong> {orderNumber}</p>\r\n                <p><strong>Previous Operator:</strong> {operatorName}</p>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleShiftChangeConfirm}\r\n                  disabled={!newOperatorName.trim()}\r\n                >\r\n                  Confirm Operator Change\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Machine Speed Modal */}\r\n      <AnimatePresence>\r\n        {showSpeedModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowSpeedModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Record Machine Speed\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <label className=\"modal-label\">Speed (PPM - Packs Per Minute)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  className=\"modal-input\"\r\n                  placeholder=\"Enter speed...\"\r\n                  value={speedInput}\r\n                  onChange={e => setSpeedInput(e.target.value ? Number(e.target.value) : '')}\r\n                  autoFocus\r\n                />\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => { setShowSpeedModal(false); setSpeedInput(''); }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleSpeedSubmit}\r\n                  disabled={!speedInput || speedInput <= 0}\r\n                >\r\n                  Confirm\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Sachet Mass Modal */}\r\n      <AnimatePresence>\r\n        {showSachetModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowSachetModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Record Sachet Mass\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <label className=\"modal-label\">Mass (grams)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.1\"\r\n                  className=\"modal-input\"\r\n                  placeholder=\"Enter mass in grams...\"\r\n                  value={sachetMassInput}\r\n                  onChange={e => setSachetMassInput(e.target.value ? Number(e.target.value) : '')}\r\n                  autoFocus\r\n                />\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => { setShowSachetModal(false); setSachetMassInput(''); }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleSachetMassSubmit}\r\n                  disabled={!sachetMassInput || sachetMassInput <= 0}\r\n                >\r\n                  Confirm\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Waste Modal */}\r\n      <AnimatePresence>\r\n        {showWasteModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowWasteModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal waste-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Record Waste\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Waste Type</label>\r\n                  <select\r\n                    className=\"modal-select\"\r\n                    value={wasteType}\r\n                    onChange={e => setWasteType(e.target.value)}\r\n                  >\r\n                    <option value=\"\">Select waste type...</option>\r\n                    {WASTE_TYPES.map(type => (\r\n                      <option key={type} value={type}>{type}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Weight (kg)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    step=\"0.1\"\r\n                    className=\"modal-input\"\r\n                    placeholder=\"Enter weight in kg...\"\r\n                    value={waste}\r\n                    onChange={e => setWaste(e.target.value ? Number(e.target.value) : '')}\r\n                    min={0}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => {\r\n                    setShowWasteModal(false);\r\n                    setWaste('');\r\n                    setWasteType('');\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm waste-confirm\"\r\n                  onClick={handleWasteSubmit}\r\n                  disabled={!waste || waste <= 0 || !wasteType}\r\n                >\r\n                  Add Waste Entry\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Downtime Modal */}\r\n      <AnimatePresence>\r\n        {showDowntimeModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowDowntimeModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal downtime-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Record Downtime\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Downtime Reason</label>\r\n                  <select\r\n                    className=\"modal-select\"\r\n                    value={downtimeReason}\r\n                    onChange={e => setDowntimeReason(e.target.value)}\r\n                  >\r\n                    <option value=\"\">Select reason...</option>\r\n                    {DOWNTIME_REASONS.map(reason => (\r\n                      <option key={reason} value={reason}>{reason}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Duration (minutes)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    className=\"modal-input\"\r\n                    placeholder=\"Enter minutes...\"\r\n                    value={downtime}\r\n                    onChange={e => setDowntime(e.target.value ? Number(e.target.value) : '')}\r\n                    min={1}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => {\r\n                    setShowDowntimeModal(false);\r\n                    setDowntime('');\r\n                    setDowntimeReason('');\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm downtime-confirm\"\r\n                  onClick={handleDowntimeSubmit}\r\n                  disabled={!downtime || downtime <= 0 || !downtimeReason}\r\n                >\r\n                  Add Downtime Entry\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Continue Production Modal */}\r\n      <AnimatePresence>\r\n        {showContinueModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowContinueModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal continue-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Continue Production\r\n              </h3>\r\n              <div className=\"modal-form\">\r\n                <div className=\"pause-info\">\r\n                  <span className=\"pause-duration-label\">Paused Duration:</span>\r\n                  <span className=\"pause-duration-value\">\r\n                    {productionState.pausedAt\r\n                      ? `${Math.ceil((Date.now() - productionState.pausedAt.getTime()) / 60000)} minutes`\r\n                      : '0 minutes'}\r\n                  </span>\r\n                </div>\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">What was the reason for this downtime?</label>\r\n                  <select\r\n                    className=\"modal-select\"\r\n                    value={pauseDowntimeReason}\r\n                    onChange={e => setPauseDowntimeReason(e.target.value)}\r\n                    autoFocus\r\n                  >\r\n                    <option value=\"\">Select reason...</option>\r\n                    {DOWNTIME_REASONS.map(reason => (\r\n                      <option key={reason} value={reason}>{reason}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => {\r\n                    setShowContinueModal(false);\r\n                    setPauseDowntimeReason('');\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm continue-confirm\"\r\n                  onClick={handleContinueProduction}\r\n                  disabled={!pauseDowntimeReason}\r\n                >\r\n                  Record & Continue\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Loose Cases Modal */}\r\n      <AnimatePresence>\r\n        {showLooseCasesModal && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowLooseCasesModal(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal loose-cases-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Add Loose Cases\r\n              </h3>\r\n              <p className=\"modal-description\">\r\n                Enter cases that are not part of a full pallet scan\r\n              </p>\r\n              <div className=\"modal-form\">\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Batch Number (5 digits)</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className=\"modal-input\"\r\n                    placeholder=\"e.g., 12345\"\r\n                    value={looseCasesBatchInput}\r\n                    onChange={e => {\r\n                      const value = e.target.value.replace(/\\D/g, '').slice(0, 5);\r\n                      setLooseCasesBatchInput(value);\r\n                    }}\r\n                    maxLength={5}\r\n                    autoFocus\r\n                  />\r\n                </div>\r\n                <div className=\"form-row\">\r\n                  <label className=\"modal-label\">Number of Cases</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    className=\"modal-input\"\r\n                    placeholder=\"Enter quantity...\"\r\n                    value={looseCasesQuantityInput}\r\n                    onChange={e => setLooseCasesQuantityInput(e.target.value ? Number(e.target.value) : '')}\r\n                    min={1}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => {\r\n                    setShowLooseCasesModal(false);\r\n                    setLooseCasesBatchInput('');\r\n                    setLooseCasesQuantityInput('');\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn confirm\"\r\n                  onClick={handleLooseCasesSubmit}\r\n                  disabled={looseCasesBatchInput.length !== 5 || !looseCasesQuantityInput || looseCasesQuantityInput <= 0}\r\n                >\r\n                  Add Cases\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* QR Scanner for Pallet Scans */}\r\n      <QRScanner\r\n        isOpen={showQRScanner}\r\n        onClose={() => setShowQRScanner(false)}\r\n        onScan={handlePalletScan}\r\n        recentScans={palletScanEntries.map(e => e.qrCode)}\r\n      />\r\n\r\n      {/* Order Queue Selection Modal */}\r\n      <AnimatePresence>\r\n        {showOrderSelect && (\r\n          <motion.div\r\n            className=\"capture-modal-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setShowOrderSelect(false)}\r\n          >\r\n            <motion.div\r\n              className=\"capture-modal order-select-modal\"\r\n              initial={{ scale: 0.9, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              onClick={e => e.stopPropagation()}\r\n            >\r\n              <h3 className=\"modal-title\">\r\n                <span className=\"modal-icon\"></span>\r\n                Select Order\r\n              </h3>\r\n              <p className=\"modal-description\">\r\n                Choose an order from the queue (sorted by priority)\r\n              </p>\r\n              <div className=\"order-queue-list\">\r\n                {availableOrders.map((order, index) => (\r\n                  <button\r\n                    key={order.id}\r\n                    className={`order-queue-item ${orderNumber === order.order_number ? 'selected' : ''}`}\r\n                    onClick={() => handleOrderSelect(order)}\r\n                  >\r\n                    <span className=\"order-priority\">#{index + 1}</span>\r\n                    <div className=\"order-details\">\r\n                      <span className=\"order-number\">{order.order_number}</span>\r\n                      <span className=\"order-product\">{order.product}</span>\r\n                      <span className=\"order-batch\">Batch: {order.batch_number}</span>\r\n                    </div>\r\n                    {orderNumber === order.order_number && (\r\n                      <span className=\"order-selected-badge\"></span>\r\n                    )}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n              <div className=\"modal-actions\">\r\n                <button\r\n                  className=\"modal-btn add-order\"\r\n                  onClick={() => {\r\n                    setShowOrderSelect(false);\r\n                    setShowAddOrderModal(true);\r\n                  }}\r\n                >\r\n                  + Add New Order\r\n                </button>\r\n                <button\r\n                  className=\"modal-btn cancel\"\r\n                  onClick={() => setShowOrderSelect(false)}\r\n                >\r\n                  Cancel\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      {/* Add Order Modal */}\r\n      <AddOrderModal\r\n        isOpen={showAddOrderModal}\r\n        onClose={() => setShowAddOrderModal(false)}\r\n        machineId={machineId || ''}\r\n        machineName={machineName}\r\n        onOrderAdded={handleOrderAdded}\r\n      />\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default CaptureScreen;\r\n","import React from 'react';\r\nimport { format } from 'date-fns';\r\n\r\ninterface ShiftInfoProps {\r\n  dateTime: Date;\r\n  shift: string;\r\n}\r\n\r\nconst ShiftInfo: React.FC<ShiftInfoProps> = ({ dateTime, shift }) => {\r\n  return (\r\n    <div className=\"shift-info-card\">\r\n      <div className=\"shift-info-header\">\r\n        <span className=\"info-label\">Current Date</span>\r\n        <span className=\"info-value date\">{format(dateTime, 'EEEE,')}</span>\r\n        <span className=\"info-value\">{format(dateTime, 'MMM d, yyyy')}</span>\r\n      </div>\r\n      <div className=\"shift-info-time\">\r\n        <span className=\"info-label\">Current Time</span>\r\n        <span className=\"time-display\">{format(dateTime, 'HH:mm:ss')}</span>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ShiftInfo;\r\n","import { supabase, isSupabaseConfigured } from './supabase';\r\n\r\n// ==========================================\r\n// LIVE SESSIONS - Cross-device sync with offline fallback\r\n// ==========================================\r\n\r\nexport interface LiveSession {\r\n    id: string; // Format: \"machineName_shift_date\"\r\n    machine_name: string;\r\n    operator_name: string;\r\n    order_number: string;\r\n    product: string;\r\n    batch_number: string;\r\n    shift: string;\r\n    session_date: string;\r\n    is_locked: boolean;\r\n    total_waste?: number;\r\n    total_downtime?: number;\r\n    // JSON-encoded entries for cross-device sync\r\n    entries_json?: string;\r\n    created_at?: string;\r\n    updated_at?: string;\r\n}\r\n\r\n// Entry types for cross-device sync\r\nexport interface SyncedWasteEntry {\r\n    id: string;\r\n    waste: number;\r\n    wasteType: string;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedDowntimeEntry {\r\n    id: string;\r\n    downtime: number;\r\n    downtimeReason: string;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedSpeedEntry {\r\n    id: string;\r\n    speed: number;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedSachetMassEntry {\r\n    id: string;\r\n    mass: number;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedLooseCasesEntry {\r\n    id: string;\r\n    batchNumber: string;\r\n    cases: number;\r\n    timestamp: string;\r\n}\r\n\r\nexport interface SyncedPalletScanEntry {\r\n    id: string;\r\n    qrCode: string;\r\n    batchNumber: string;\r\n    palletNumber: string;\r\n    casesCount: number;\r\n    timestamp: string;\r\n    ignored?: boolean;\r\n}\r\n\r\nexport interface SyncedEntries {\r\n    wasteEntries: SyncedWasteEntry[];\r\n    downtimeEntries: SyncedDowntimeEntry[];\r\n    speedEntries: SyncedSpeedEntry[];\r\n    sachetMassEntries: SyncedSachetMassEntry[];\r\n    looseCasesEntries: SyncedLooseCasesEntry[];\r\n    palletScanEntries: SyncedPalletScanEntry[];\r\n}\r\n\r\n// Generate session ID from components\r\nexport const getLiveSessionId = (machineName: string, shift: string, date: string): string => {\r\n    return `${machineName}_${shift}_${date}`;\r\n};\r\n\r\n// Cache for active sessions (used when offline or for quick lookups)\r\nlet sessionsCache: Map<string, LiveSession> = new Map();\r\nlet lastFetchTime: number = 0;\r\nconst CACHE_TTL_MS = 30000; // 30 seconds cache\r\n\r\n// ==========================================\r\n// UPSERT SESSION (Save/Update)\r\n// ==========================================\r\nexport const upsertLiveSession = async (session: {\r\n    machineName: string;\r\n    operatorName: string;\r\n    orderNumber: string;\r\n    product: string;\r\n    batchNumber: string;\r\n    shift: string;\r\n    date: string;\r\n    locked: boolean;\r\n    totalWaste?: number;\r\n    totalDowntime?: number;\r\n}): Promise<boolean> => {\r\n    const sessionId = getLiveSessionId(session.machineName, session.shift, session.date);\r\n\r\n    const liveSession: LiveSession = {\r\n        id: sessionId,\r\n        machine_name: session.machineName,\r\n        operator_name: session.operatorName,\r\n        order_number: session.orderNumber,\r\n        product: session.product,\r\n        batch_number: session.batchNumber,\r\n        shift: session.shift,\r\n        session_date: session.date,\r\n        is_locked: session.locked,\r\n        total_waste: session.totalWaste || 0,\r\n        total_downtime: session.totalDowntime || 0,\r\n        updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    // Always update local cache first\r\n    sessionsCache.set(sessionId, liveSession);\r\n\r\n    // Try to sync to Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('live_sessions')\r\n                .upsert({\r\n                    id: sessionId,\r\n                    machine_name: session.machineName,\r\n                    operator_name: session.operatorName,\r\n                    order_number: session.orderNumber,\r\n                    product: session.product,\r\n                    batch_number: session.batchNumber,\r\n                    shift: session.shift,\r\n                    session_date: session.date,\r\n                    is_locked: session.locked,\r\n                    total_waste: session.totalWaste || 0,\r\n                    total_downtime: session.totalDowntime || 0,\r\n                    updated_at: new Date().toISOString(),\r\n                }, { onConflict: 'id' });\r\n\r\n            if (error) {\r\n                console.error('Failed to upsert live session:', error.message);\r\n                return false;\r\n            }\r\n            console.log(' Live session synced to Supabase:', sessionId);\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Failed to upsert live session:', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // Offline - cached locally, will sync later\r\n    return true;\r\n};\r\n\r\n// ==========================================\r\n// DELETE SESSION (When submitted or cleared)\r\n// ==========================================\r\nexport const deleteLiveSession = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string\r\n): Promise<boolean> => {\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    // Remove from local cache\r\n    sessionsCache.delete(sessionId);\r\n\r\n    // Try to delete from Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('live_sessions')\r\n                .delete()\r\n                .eq('id', sessionId);\r\n\r\n            if (error) {\r\n                console.error('Failed to delete live session:', error.message);\r\n                return false;\r\n            }\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Failed to delete live session:', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n// ==========================================\r\n// FETCH ACTIVE SESSIONS (For Dashboard)\r\n// ==========================================\r\nexport const fetchActiveSessions = async (): Promise<LiveSession[]> => {\r\n    const now = Date.now();\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    // Return cache if fresh and online fetch fails\r\n    const shouldUseCache = now - lastFetchTime < CACHE_TTL_MS;\r\n\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('live_sessions')\r\n                .select('*')\r\n                .eq('session_date', today)\r\n                .eq('is_locked', true);\r\n\r\n            if (error) {\r\n                console.error('Failed to fetch live sessions:', error.message);\r\n                // Fall back to cache\r\n                return Array.from(sessionsCache.values()).filter(\r\n                    s => s.session_date === today && s.is_locked\r\n                );\r\n            }\r\n\r\n            // Update cache with fetched data\r\n            sessionsCache.clear();\r\n            (data || []).forEach(session => {\r\n                sessionsCache.set(session.id, session);\r\n            });\r\n            lastFetchTime = now;\r\n\r\n            console.log(' Fetched active sessions from Supabase:', (data || []).length, data?.map(s => s.machine_name));\r\n            return data || [];\r\n        } catch (e) {\r\n            console.error('Failed to fetch live sessions:', e);\r\n            // Fall back to cache\r\n            return Array.from(sessionsCache.values()).filter(\r\n                s => s.session_date === today && s.is_locked\r\n            );\r\n        }\r\n    }\r\n\r\n    // Offline - return cached sessions\r\n    if (shouldUseCache) {\r\n        return Array.from(sessionsCache.values()).filter(\r\n            s => s.session_date === today && s.is_locked\r\n        );\r\n    }\r\n\r\n    return [];\r\n};\r\n\r\n// ==========================================\r\n// FETCH SESSION BY MACHINE NAME\r\n// ==========================================\r\nexport const fetchLiveSessionByMachine = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string\r\n): Promise<LiveSession | null> => {\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    // Check cache first\r\n    if (sessionsCache.has(sessionId)) {\r\n        return sessionsCache.get(sessionId) || null;\r\n    }\r\n\r\n    if (!isSupabaseConfigured) {\r\n        return null;\r\n    }\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('live_sessions')\r\n            .select('*')\r\n            .eq('id', sessionId)\r\n            .eq('is_locked', true)\r\n            .maybeSingle();\r\n\r\n        if (error) {\r\n            console.error('Failed to fetch session:', error.message);\r\n            return null;\r\n        }\r\n\r\n        if (data) {\r\n            // Update cache\r\n            sessionsCache.set(sessionId, data);\r\n            console.log(' Restored session from Supabase:', machineName);\r\n        }\r\n\r\n        return data;\r\n    } catch (e) {\r\n        console.error('Failed to fetch session by machine:', e);\r\n        return null;\r\n    }\r\n};\r\n\r\n// ==========================================\r\n// GET ACTIVE SUB-MACHINES (Replacement for localStorage check)\r\n// ==========================================\r\nexport const getActiveSubMachinesFromSupabase = async (\r\n    parentMachineName: string,\r\n    subMachineCount: number\r\n): Promise<Set<number>> => {\r\n    const activeSet = new Set<number>();\r\n    const sessions = await fetchActiveSessions();\r\n\r\n    for (let i = 1; i <= subMachineCount; i++) {\r\n        const fullName = `${parentMachineName} - Machine ${i}`;\r\n        const isActive = sessions.some(s => s.machine_name === fullName && s.is_locked);\r\n        if (isActive) {\r\n            activeSet.add(i);\r\n        }\r\n    }\r\n\r\n    return activeSet;\r\n};\r\n\r\n// ==========================================\r\n// SUBSCRIBE TO SESSION CHANGES (Real-time)\r\n// ==========================================\r\nexport const subscribeToSessionChanges = (\r\n    onUpdate: (sessions: LiveSession[]) => void\r\n) => {\r\n    if (!isSupabaseConfigured) {\r\n        return () => { }; // No-op unsubscribe\r\n    }\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    const channel = supabase\r\n        .channel('live-sessions-changes')\r\n        .on(\r\n            'postgres_changes',\r\n            { event: '*', schema: 'public', table: 'live_sessions' },\r\n            async (payload) => {\r\n                console.log(' Real-time session update received:', payload.eventType);\r\n                // Refetch all sessions on any change\r\n                const sessions = await fetchActiveSessions();\r\n                onUpdate(sessions);\r\n            }\r\n        )\r\n        .subscribe((status) => {\r\n            console.log(' Session subscription status:', status);\r\n        });\r\n\r\n    return () => {\r\n        supabase.removeChannel(channel);\r\n    };\r\n};\r\n\r\n// ==========================================\r\n// SYNC PENDING SESSIONS (On reconnection)\r\n// ==========================================\r\nexport const syncPendingSessions = async (): Promise<void> => {\r\n    if (!isSupabaseConfigured) return;\r\n\r\n    // Any sessions in cache that might not be synced yet\r\n    for (const session of Array.from(sessionsCache.values())) {\r\n        try {\r\n            await supabase\r\n                .from('live_sessions')\r\n                .upsert({\r\n                    id: session.id,\r\n                    machine_name: session.machine_name,\r\n                    operator_name: session.operator_name,\r\n                    order_number: session.order_number,\r\n                    product: session.product,\r\n                    batch_number: session.batch_number,\r\n                    shift: session.shift,\r\n                    session_date: session.session_date,\r\n                    is_locked: session.is_locked,\r\n                    updated_at: new Date().toISOString(),\r\n                }, { onConflict: 'id' });\r\n        } catch (e) {\r\n            console.error('Failed to sync session:', session.id, e);\r\n        }\r\n    }\r\n};\r\n\r\n// ==========================================\r\n// ACTIVITY FEED - Real-time machine events\r\n// ==========================================\r\n\r\nexport type ActivityEventType =\r\n    | 'machine_start'\r\n    | 'machine_pause'\r\n    | 'machine_resume'\r\n    | 'waste_recorded'\r\n    | 'downtime_recorded'\r\n    | 'pallet_scanned'\r\n    | 'cases_added'\r\n    | 'sachet_mass_added'\r\n    | 'shift_submitted'\r\n    | 'speed_recorded';\r\n\r\nexport interface ActivityEvent {\r\n    id: string;\r\n    type: ActivityEventType;\r\n    machine_name: string;\r\n    operator_name?: string;\r\n    message: string;\r\n    details?: string;\r\n    timestamp: Date;\r\n}\r\n\r\n// In-memory activity log (most recent first)\r\nlet activityLog: ActivityEvent[] = [];\r\nconst MAX_ACTIVITY_ITEMS = 50;\r\nlet activityListeners: ((events: ActivityEvent[]) => void)[] = [];\r\n\r\n// Add an activity event\r\nexport const addActivityEvent = (event: Omit<ActivityEvent, 'id' | 'timestamp'>) => {\r\n    const newEvent: ActivityEvent = {\r\n        ...event,\r\n        id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n        timestamp: new Date(),\r\n    };\r\n\r\n    activityLog = [newEvent, ...activityLog].slice(0, MAX_ACTIVITY_ITEMS);\r\n\r\n    // Notify listeners\r\n    activityListeners.forEach(listener => listener([...activityLog]));\r\n\r\n    // Also broadcast to Supabase for cross-device sync\r\n    if (isSupabaseConfigured) {\r\n        broadcastActivityEvent(newEvent);\r\n    }\r\n};\r\n\r\n// Broadcast activity to other clients via Supabase Realtime\r\nconst broadcastActivityEvent = async (event: ActivityEvent) => {\r\n    try {\r\n        const channel = supabase.channel('activity-broadcast');\r\n        await channel.send({\r\n            type: 'broadcast',\r\n            event: 'activity',\r\n            payload: {\r\n                ...event,\r\n                timestamp: event.timestamp.toISOString(),\r\n            },\r\n        });\r\n    } catch (e) {\r\n        // Silently fail - activity feed is non-critical\r\n    }\r\n};\r\n\r\n// Subscribe to activity events\r\nexport const subscribeToActivityFeed = (\r\n    onUpdate: (events: ActivityEvent[]) => void\r\n) => {\r\n    // Add listener\r\n    activityListeners.push(onUpdate);\r\n\r\n    // Send current log immediately\r\n    onUpdate([...activityLog]);\r\n\r\n    // Subscribe to Supabase broadcast for cross-device events\r\n    let channel: ReturnType<typeof supabase.channel> | null = null;\r\n\r\n    if (isSupabaseConfigured) {\r\n        channel = supabase\r\n            .channel('activity-broadcast')\r\n            .on('broadcast', { event: 'activity' }, (payload) => {\r\n                const eventData = payload.payload as ActivityEvent & { timestamp: string };\r\n                const event: ActivityEvent = {\r\n                    ...eventData,\r\n                    timestamp: new Date(eventData.timestamp),\r\n                };\r\n\r\n                // Avoid duplicates\r\n                if (!activityLog.some(e => e.id === event.id)) {\r\n                    activityLog = [event, ...activityLog].slice(0, MAX_ACTIVITY_ITEMS);\r\n                    activityListeners.forEach(listener => listener([...activityLog]));\r\n                }\r\n            })\r\n            .subscribe();\r\n    }\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n        activityListeners = activityListeners.filter(l => l !== onUpdate);\r\n        if (channel) {\r\n            supabase.removeChannel(channel);\r\n        }\r\n    };\r\n};\r\n\r\n// Get current activity log\r\nexport const getActivityLog = (): ActivityEvent[] => [...activityLog];\r\n\r\n// Clear activity log\r\nexport const clearActivityLog = () => {\r\n    activityLog = [];\r\n    activityListeners.forEach(listener => listener([]));\r\n};\r\n\r\n// ==========================================\r\n// ENTRY SYNC - Real-time cross-device sync\r\n// ==========================================\r\n\r\n// Sync all entries to Supabase for cross-device access\r\n// Note: Requires entries_json column in live_sessions table\r\nexport const syncEntriesToSupabase = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string,\r\n    entries: SyncedEntries\r\n): Promise<boolean> => {\r\n    if (!isSupabaseConfigured) return false;\r\n\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n    const entriesJson = JSON.stringify(entries);\r\n\r\n    try {\r\n        const { error } = await supabase\r\n            .from('live_sessions')\r\n            .update({\r\n                entries_json: entriesJson,\r\n                updated_at: new Date().toISOString(),\r\n            })\r\n            .eq('id', sessionId);\r\n\r\n        if (error) {\r\n            // Silently fail if entries_json column doesn't exist yet\r\n            if (error.message.includes('entries_json') || error.message.includes('column')) {\r\n                // Column doesn't exist - sync feature not available yet\r\n                return false;\r\n            }\r\n            console.error('Failed to sync entries:', error.message);\r\n            return false;\r\n        }\r\n\r\n        console.log(' Entries synced to Supabase:', sessionId);\r\n        return true;\r\n    } catch (e) {\r\n        // Silently fail - sync feature may not be available\r\n        return false;\r\n    }\r\n};\r\n\r\n// Fetch entries from Supabase for a session\r\n// Note: Requires entries_json column in live_sessions table\r\nexport const fetchEntriesFromSupabase = async (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string\r\n): Promise<SyncedEntries | null> => {\r\n    if (!isSupabaseConfigured) return null;\r\n\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('live_sessions')\r\n            .select('entries_json')\r\n            .eq('id', sessionId)\r\n            .maybeSingle();\r\n\r\n        if (error) {\r\n            // Silently fail if entries_json column doesn't exist yet\r\n            if (error.message.includes('entries_json') || error.message.includes('column')) {\r\n                return null;\r\n            }\r\n            console.error('Failed to fetch entries:', error.message);\r\n            return null;\r\n        }\r\n\r\n        if (data?.entries_json) {\r\n            const entries = JSON.parse(data.entries_json) as SyncedEntries;\r\n            console.log(' Entries restored from Supabase:', sessionId);\r\n            return entries;\r\n        }\r\n\r\n        return null;\r\n    } catch (e) {\r\n        // Silently fail - sync feature may not be available\r\n        return null;\r\n    }\r\n};\r\n\r\n// Subscribe to entry changes for real-time sync\r\nexport const subscribeToEntryChanges = (\r\n    machineName: string,\r\n    shift: string,\r\n    date: string,\r\n    onEntriesUpdate: (entries: SyncedEntries) => void\r\n) => {\r\n    if (!isSupabaseConfigured) {\r\n        return () => { }; // No-op unsubscribe\r\n    }\r\n\r\n    const sessionId = getLiveSessionId(machineName, shift, date);\r\n\r\n    const channel = supabase\r\n        .channel(`entries-${sessionId}`)\r\n        .on(\r\n            'postgres_changes',\r\n            {\r\n                event: 'UPDATE',\r\n                schema: 'public',\r\n                table: 'live_sessions',\r\n                filter: `id=eq.${sessionId}`\r\n            },\r\n            (payload) => {\r\n                const newData = payload.new as { entries_json?: string };\r\n                if (newData.entries_json) {\r\n                    try {\r\n                        const entries = JSON.parse(newData.entries_json) as SyncedEntries;\r\n                        console.log(' Real-time entries update received:', sessionId);\r\n                        onEntriesUpdate(entries);\r\n                    } catch (e) {\r\n                        console.error('Failed to parse entries update:', e);\r\n                    }\r\n                }\r\n            }\r\n        )\r\n        .subscribe((status) => {\r\n            console.log(' Entry sync subscription status:', status, sessionId);\r\n        });\r\n\r\n    return () => {\r\n        supabase.removeChannel(channel);\r\n    };\r\n};\r\n\r\n// Helper to safely convert timestamp to ISO string\r\nconst toISOString = (timestamp: Date | string): string => {\r\n    if (typeof timestamp === 'string') return timestamp;\r\n    if (timestamp instanceof Date) return timestamp.toISOString();\r\n    return new Date(timestamp).toISOString();\r\n};\r\n\r\n// Helper to convert local entries to synced format\r\nexport const convertToSyncedEntries = (\r\n    wasteEntries: { id: string; waste: number; wasteType: string; timestamp: Date | string }[],\r\n    downtimeEntries: { id: string; downtime: number; downtimeReason: string; timestamp: Date | string }[],\r\n    speedEntries: { id: string; speed: number; timestamp: Date | string }[],\r\n    sachetMassEntries: { id: string; mass: number; timestamp: Date | string }[],\r\n    looseCasesEntries: { id: string; batchNumber: string; cases: number; timestamp: Date | string }[],\r\n    palletScanEntries: { id: string; qrCode: string; batchNumber: string; palletNumber: string; casesCount: number; timestamp: Date | string; ignored?: boolean }[]\r\n): SyncedEntries => {\r\n    return {\r\n        wasteEntries: wasteEntries.map(e => ({\r\n            id: e.id,\r\n            waste: e.waste,\r\n            wasteType: e.wasteType,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        downtimeEntries: downtimeEntries.map(e => ({\r\n            id: e.id,\r\n            downtime: e.downtime,\r\n            downtimeReason: e.downtimeReason,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        speedEntries: speedEntries.map(e => ({\r\n            id: e.id,\r\n            speed: e.speed,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        sachetMassEntries: sachetMassEntries.map(e => ({\r\n            id: e.id,\r\n            mass: e.mass,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        looseCasesEntries: looseCasesEntries.map(e => ({\r\n            id: e.id,\r\n            batchNumber: e.batchNumber,\r\n            cases: e.cases,\r\n            timestamp: toISOString(e.timestamp),\r\n        })),\r\n        palletScanEntries: palletScanEntries.map(e => ({\r\n            id: e.id,\r\n            qrCode: e.qrCode,\r\n            batchNumber: e.batchNumber,\r\n            palletNumber: e.palletNumber,\r\n            casesCount: e.casesCount,\r\n            timestamp: toISOString(e.timestamp),\r\n            ignored: e.ignored,\r\n        })),\r\n    };\r\n};\r\n\r\n// Helper to convert synced entries back to local format\r\nexport const convertFromSyncedEntries = (synced: SyncedEntries) => {\r\n    return {\r\n        wasteEntries: synced.wasteEntries.map(e => ({\r\n            id: e.id,\r\n            waste: e.waste,\r\n            wasteType: e.wasteType,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        downtimeEntries: synced.downtimeEntries.map(e => ({\r\n            id: e.id,\r\n            downtime: e.downtime,\r\n            downtimeReason: e.downtimeReason,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        speedEntries: synced.speedEntries.map(e => ({\r\n            id: e.id,\r\n            speed: e.speed,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        sachetMassEntries: synced.sachetMassEntries.map(e => ({\r\n            id: e.id,\r\n            mass: e.mass,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        looseCasesEntries: synced.looseCasesEntries.map(e => ({\r\n            id: e.id,\r\n            batchNumber: e.batchNumber,\r\n            cases: e.cases,\r\n            timestamp: new Date(e.timestamp),\r\n        })),\r\n        palletScanEntries: synced.palletScanEntries.map(e => ({\r\n            id: e.id,\r\n            qrCode: e.qrCode,\r\n            batchNumber: e.batchNumber,\r\n            palletNumber: e.palletNumber,\r\n            casesCount: e.casesCount,\r\n            timestamp: new Date(e.timestamp),\r\n            ignored: e.ignored,\r\n        })),\r\n    };\r\n};\r\n\r\n// ==========================================\r\n// CURRENT MACHINE ORDER - Persists across shifts\r\n// ==========================================\r\n\r\nexport interface CurrentMachineOrder {\r\n    machine_name: string;\r\n    order_number: string;\r\n    product: string;\r\n    batch_number: string;\r\n    updated_at: string;\r\n}\r\n\r\n// Save the current order for a machine (persists across shifts)\r\nexport const saveCurrentMachineOrder = async (\r\n    machineName: string,\r\n    orderNumber: string,\r\n    product: string,\r\n    batchNumber: string\r\n): Promise<boolean> => {\r\n    // Save to localStorage as fallback\r\n    const key = `current_machine_order_${machineName}`;\r\n    const order: CurrentMachineOrder = {\r\n        machine_name: machineName,\r\n        order_number: orderNumber,\r\n        product: product,\r\n        batch_number: batchNumber,\r\n        updated_at: new Date().toISOString(),\r\n    };\r\n    localStorage.setItem(key, JSON.stringify(order));\r\n\r\n    // Try to sync to Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { error } = await supabase\r\n                .from('current_machine_orders')\r\n                .upsert({\r\n                    machine_name: machineName,\r\n                    order_number: orderNumber,\r\n                    product: product,\r\n                    batch_number: batchNumber,\r\n                    updated_at: new Date().toISOString(),\r\n                }, { onConflict: 'machine_name' });\r\n\r\n            if (error) {\r\n                // Table might not exist - that's ok, localStorage is the fallback\r\n                console.log('Current order saved to localStorage (Supabase table may not exist)');\r\n                return true;\r\n            }\r\n            console.log(' Current machine order synced to Supabase:', machineName);\r\n        } catch (e) {\r\n            // Silently continue - localStorage has the data\r\n        }\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n// Fetch the current order for a machine\r\nexport const fetchCurrentMachineOrder = async (\r\n    machineName: string\r\n): Promise<CurrentMachineOrder | null> => {\r\n    // Try Supabase first\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('current_machine_orders')\r\n                .select('*')\r\n                .eq('machine_name', machineName)\r\n                .maybeSingle();\r\n\r\n            if (!error && data) {\r\n                console.log(' Current machine order loaded from Supabase:', machineName);\r\n                return data;\r\n            }\r\n        } catch (e) {\r\n            // Fall through to localStorage\r\n        }\r\n    }\r\n\r\n    // Fallback to localStorage\r\n    const key = `current_machine_order_${machineName}`;\r\n    const saved = localStorage.getItem(key);\r\n    if (saved) {\r\n        try {\r\n            const order = JSON.parse(saved) as CurrentMachineOrder;\r\n            console.log(' Current machine order loaded from localStorage:', machineName);\r\n            return order;\r\n        } catch (e) {\r\n            // Invalid data\r\n        }\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\n// Clear the current order for a machine (on changeover)\r\nexport const clearCurrentMachineOrder = async (machineName: string): Promise<void> => {\r\n    // Clear localStorage\r\n    const key = `current_machine_order_${machineName}`;\r\n    localStorage.removeItem(key);\r\n\r\n    // Try to clear from Supabase\r\n    if (isSupabaseConfigured) {\r\n        try {\r\n            await supabase\r\n                .from('current_machine_orders')\r\n                .delete()\r\n                .eq('machine_name', machineName);\r\n        } catch (e) {\r\n            // Silently continue\r\n        }\r\n    }\r\n};\r\n","import React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\ninterface ConfirmDialogProps {\r\n  isOpen: boolean;\r\n  title: string;\r\n  message: string;\r\n  confirmText?: string;\r\n  cancelText?: string;\r\n  onConfirm: () => void;\r\n  onCancel: () => void;\r\n  type?: 'default' | 'danger' | 'success';\r\n}\r\n\r\nconst ConfirmDialog: React.FC<ConfirmDialogProps> = ({\r\n  isOpen,\r\n  title,\r\n  message,\r\n  confirmText = 'Confirm',\r\n  cancelText = 'Cancel',\r\n  onConfirm,\r\n  onCancel,\r\n  type = 'default',\r\n}) => {\r\n  const getButtonClass = () => {\r\n    switch (type) {\r\n      case 'danger':\r\n        return 'btn-danger';\r\n      case 'success':\r\n        return 'btn-success';\r\n      default:\r\n        return 'btn-primary';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <motion.div\r\n          className=\"confirm-dialog-overlay\"\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          onClick={onCancel}\r\n        >\r\n          <motion.div\r\n            className=\"confirm-dialog\"\r\n            initial={{ opacity: 0, scale: 0.9, y: 20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.9, y: 20 }}\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"confirm-dialog-header\">\r\n              <h3>{title}</h3>\r\n            </div>\r\n            <div className=\"confirm-dialog-body\">\r\n              <p>{message}</p>\r\n            </div>\r\n            <div className=\"confirm-dialog-footer\">\r\n              <button \r\n                className=\"btn btn-outline-secondary\" \r\n                onClick={onCancel}\r\n              >\r\n                {cancelText}\r\n              </button>\r\n              <button \r\n                className={`btn ${getButtonClass()}`} \r\n                onClick={onConfirm}\r\n              >\r\n                {confirmText}\r\n              </button>\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n};\r\n\r\nexport default ConfirmDialog;\r\n"],"names":["_ref","operatorName","setOperatorName","machine","setMachine","orderNumber","setOrderNumber","product","setProduct","batchNumber","setBatchNumber","hideMachine","disabled","_jsxs","className","children","_jsx","htmlFor","type","id","value","onChange","e","target","placeholder","readOnly","COLORS","EmptyChart","message","icon","_ref2","wasteEntries","downtimeEntries","wasteData","reduce","acc","entry","existing","find","item","name","wasteType","waste","push","downtimeData","downtimeReason","downtime","length","ResponsiveContainer","width","height","BarChart","data","margin","top","right","left","bottom","CartesianGrid","strokeDasharray","stroke","XAxis","dataKey","tick","fill","fontSize","axisLine","tickLine","YAxis","Tooltip","contentStyle","background","border","borderRadius","color","Bar","radius","PieChart","Pie","cx","cy","labelLine","label","_ref3","percent","concat","toFixed","outerRadius","innerRadius","strokeWidth","map","index","Cell","formatter","style","isOpen","onClose","onScan","recentScans","error","setError","useState","setIsScanning","lastScanned","setLastScanned","showSuccess","setShowSuccess","scannerRef","useRef","containerRef","isOpenRef","useEffect","current","timeoutId","setTimeout","startScannerInternal","clearTimeout","stopScannerInternal","async","getState","Html5QrcodeScannerState","SCANNING","stop","clear","err","console","scanner","Html5Qrcode","start","facingMode","fps","qrbox","aspectRatio","decodedText","handleSuccessfulScan","toString","includes","qrData","navigator","vibrate","handleClose","AnimatePresence","motion","div","initial","opacity","animate","exit","onClick","scale","stopPropagation","ref","Button","variant","size","iconPosition","loading","fullWidth","props","_objectWithoutProperties","_excluded","isDisabled","_objectSpread","Modal","title","subtitle","footer","closeOnOverlay","showCloseButton","document","body","overflow","handleEscape","key","addEventListener","removeEventListener","transition","duration","undefined","y","ease","viewBox","d","FormField","required","hint","AddOrderModal","machineId","machineName","onOrderAdded","setLoading","trim","addMachineOrder","r","getSessionKey","shift","date","CaptureScreen","useParams","location","useLocation","navigate","useNavigate","getMachineName","_location$state","stateKey","fromState","state","sessionStorage","setItem","restored","getItem","parentMachineId","getParentMachineId","_location$state2","split","localStorage","removeItem","runAllCleanup","dateTime","setDateTime","Date","setShift","isSubmitting","setIsSubmitting","toast","setToast","showConfirmDialog","setShowConfirmDialog","isSessionLocked","setIsSessionLocked","liveSubmissionId","setLiveSubmissionId","setWaste","setWasteType","setDowntime","setDowntimeReason","setWasteEntries","setDowntimeEntries","speedEntries","setSpeedEntries","sachetMassEntries","setSachetMassEntries","looseCasesEntries","setLooseCasesEntries","palletScanEntries","setPalletScanEntries","showSpeedModal","setShowSpeedModal","showSachetModal","setShowSachetModal","showLooseCasesModal","setShowLooseCasesModal","showQRScanner","setShowQRScanner","showWasteModal","setShowWasteModal","showDowntimeModal","setShowDowntimeModal","speedInput","setSpeedInput","sachetMassInput","setSachetMassInput","looseCasesBatchInput","setLooseCasesBatchInput","looseCasesQuantityInput","setLooseCasesQuantityInput","isInSubmissionWindow","setIsInSubmissionWindow","setTimeToWindow","availableOrders","setAvailableOrders","showOrderSelect","setShowOrderSelect","showAddOrderModal","setShowAddOrderModal","lastKnownShift","setLastKnownShift","showShiftChangeModal","setShowShiftChangeModal","newOperatorName","setNewOperatorName","showChangeoverDialog","setShowChangeoverDialog","willChangeover","setWillChangeover","willMaintenance","setWillMaintenance","isInChangeoverMode","setIsInChangeoverMode","changeoverStartTime","setChangeoverStartTime","changeoverElapsed","setChangeoverElapsed","productionState","setProductionState","isRunning","startTime","pausedAt","totalRunTimeMs","lastResumedAt","displayRunTime","setDisplayRunTime","showContinueModal","setShowContinueModal","pauseDowntimeReason","setPauseDowntimeReason","showToast","sessionConflict","setSessionConflict","unsubscribeConflictRef","unsubscribeEntrySyncRef","checkSubmissionWindowCallback","useCallback","currentDateTime","result","checkSubmissionWindow","isInWindow","timeToWindow","loadSession","currentDate","toISOString","currentShift","getCurrentShift","sessionKey","hasConflict","activeSession","checkForActiveSession","operator_name","started_at","toLocaleTimeString","showWarning","timerState","loadProductionTimer","formatRunTime","calculateCurrentRunTime","savedSession","session","JSON","parse","locked","sharedSpeed","getLineSpeed","sharedSpeedEntry","uuidv4","speed","timestamp","updatedAt","log","updatedBy","fetchLiveSessionByMachine","liveSession","is_locked","order_number","batch_number","restoredWasteEntries","restoredDowntimeEntries","restoredSpeedEntries","restoredSachetMassEntries","restoredLooseCasesEntries","restoredPalletScanEntries","syncedEntries","fetchEntriesFromSupabase","convertFromSyncedEntries","sachet","loose","pallets","localSession","machine_name","session_date","stringify","fetchActiveOrderDetails","activeOrder","adminOrderDetails","details","saveSession","showMessage","arguments","lockResult","acquireSessionLock","success","showError","subscribeToSessionConflicts","conflictSession","totalWaste","sum","totalDowntime","upsertLiveSession","submissionId","findLiveSubmission","createLiveSubmission","now","timerStateToSave","pauseHistory","saveProductionTimer","updateMachineStatus","productionStateRef","autoSaveInterval","setInterval","_productionState$star","_productionState$paus","_productionState$last","clearInterval","_state$startTime","_state$pausedAt","_state$lastResumedAt","releaseSessionLock","orders","fetchMachineOrders","loadMachineOrders","syncTimeout","convertToSyncedEntries","syncEntriesToSupabase","unsubscribe","subscribeToEntryChanges","prev","timer","newShift","updateElapsed","elapsedMs","getTime","minutes","Math","floor","seconds","padStart","interval","timerInterval","currentSessionMs","totalMs","totalSeconds","hours","persistTimerState","_state$startTime2","_state$pausedAt2","_state$lastResumedAt2","handleStartProduction","newState","handlePauseProduction","handleContinueProduction","pauseDurationMs","pauseDurationMinutes","ceil","newDowntimeEntry","notes","addLiveDowntimeEntry","formatScanTime","hour","minute","x","handleBack","window","confirm","toLowerCase","MainForm","ShiftInfo","slice","reverse","handleDeleteWasteEntry","filter","handleDeleteDowntimeEntry","ignored","mass","handleToggleSachetIgnore","casesCount","cases","palletNumber","handleTogglePalletIgnore","handleToggleLooseCasesIgnore","DashboardCharts","newSubmissionId","changeoverDurationMinutes","round","changeoverEntry","latestSpeed","addLiveSpeedEntry","handleInitiateChangeover","finalizeLiveSubmission","clearProductionTimer","deleteLiveSession","ConfirmDialog","confirmText","cancelText","onConfirm","shiftData","submittedAt","submissionPayload","submission_date","is_early_submission","will_changeover","will_maintenance_cleaning","qrCode","saveShiftData","submitShiftData","warnings","join","addFailedSubmission","String","onCancel","autoFocus","handleShiftChangeConfirm","Number","handleSpeedSubmit","newEntry","saveLineSpeed","step","handleSachetMassSubmit","WASTE_TYPES","min","addLiveWasteEntry","DOWNTIME_REASONS","reason","replace","maxLength","handleLooseCasesSubmit","QRScanner","parsed","cleaned","test","parseInt","substring","isNaN","parsePalletQRCode","some","order","handleOrderSelect","then","catch","format","getLiveSessionId","sessionsCache","Map","lastFetchTime","sessionId","total_waste","total_downtime","updated_at","set","isSupabaseConfigured","supabase","from","upsert","onConflict","delete","eq","fetchActiveSessions","today","shouldUseCache","select","Array","values","s","forEach","has","get","maybeSingle","subscribeToSessionChanges","onUpdate","channel","on","event","schema","table","payload","eventType","sessions","subscribe","status","removeChannel","activityLog","activityListeners","subscribeToActivityFeed","eventData","listener","l","entries","entriesJson","update","entries_json","onEntriesUpdate","newData","new","synced","getButtonClass"],"ignoreList":[],"sourceRoot":""}