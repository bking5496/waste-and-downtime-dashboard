"use strict";(self.webpackChunkwaste_and_downtime_dashboard=self.webpackChunkwaste_and_downtime_dashboard||[]).push([[82],{1082:(e,s,a)=>{a.r(s),a.d(s,{default:()=>N});var n=a(5043),t=a(8163),i=a(9570),c=a(6446),l=a(9908),r=a(8283),o=a(6316),d=a(1737),h=a(7051),m=a(6820),u=a(579);const x=e=>{let{isOpen:s,onClose:a,onMachinesUpdated:t}=e;const[l,o]=(0,n.useState)([]),[d,x]=(0,n.useState)(null),[,j]=(0,n.useState)(!1),[v,p]=(0,n.useState)(""),[N,b]=(0,n.useState)("idle"),[g,y]=(0,n.useState)(0),[f,w]=(0,n.useState)(null),[M,C]=(0,n.useState)("machines"),[,k]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s&&(S(),C("machines"))},[s]);const S=()=>{const e=(0,r.Rg)();o(e)},B=(e,s)=>{w({message:e,type:s}),setTimeout(()=>w(null),3e3)},W=async(e,s)=>{if(l.find(s=>s.id===e))try{await(0,r.te)(e,{status:s}),S(),t()}catch(a){B("Failed to update status","error")}},D=e=>{switch(e){case"running":return"#00ff88";case"idle":return"#00f5ff";case"maintenance":return"#ff4757"}},U=e=>{switch(e){case"running":return"\u25b6";case"idle":return"\u25fc";case"maintenance":return"\u26a0"}};return s?(0,u.jsx)(i.N,{children:(0,u.jsx)(c.P.div,{className:"settings-modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,children:(0,u.jsxs)(c.P.div,{className:"settings-modal-container",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),children:[(0,u.jsxs)("div",{className:"settings-modal-header",children:[(0,u.jsxs)("div",{className:"settings-header-content",children:[(0,u.jsx)("div",{className:"settings-icon-wrapper",children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,u.jsx)("path",{d:"M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"})]})}),(0,u.jsxs)("div",{className:"settings-title-group",children:[(0,u.jsx)("h2",{children:"Machine Settings"}),(0,u.jsxs)("span",{className:"settings-subtitle",children:[l.length," machines configured"]})]})]}),(0,u.jsx)("button",{className:"settings-close-btn",onClick:a,children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,u.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),(0,u.jsxs)("div",{className:"settings-tabs",children:[(0,u.jsxs)("button",{className:"settings-tab ".concat("machines"===M?"active":""),onClick:()=>C("machines"),children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,u.jsx)("path",{d:"M8 21h8M12 17v4"})]}),(0,u.jsx)("span",{children:"Machines"})]}),(0,u.jsxs)("button",{className:"settings-tab ".concat("add"===M?"active":""),onClick:()=>C("add"),children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,u.jsx)("path",{d:"M12 8v8M8 12h8"})]}),(0,u.jsx)("span",{children:"Add New"})]})]}),(0,u.jsx)(i.N,{children:f&&(0,u.jsxs)(c.P.div,{className:"settings-toast-v2 ".concat(f.type),initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[(0,u.jsx)("span",{className:"toast-icon",children:"success"===f.type?"\u2713":"\u2715"}),f.message]})}),(0,u.jsx)("div",{className:"settings-content",children:"machines"===M?(0,u.jsx)("div",{className:"machine-list-v2",children:0===l.length?(0,u.jsxs)("div",{className:"empty-machines",children:[(0,u.jsx)("div",{className:"empty-icon",children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,u.jsx)("path",{d:"M8 21h8M12 17v4"})]})}),(0,u.jsx)("p",{children:"No machines configured"}),(0,u.jsx)("button",{className:"empty-add-btn",onClick:()=>C("add"),children:"Add your first machine"})]}):l.map((e,s)=>(0,u.jsx)(c.P.div,{className:"machine-card ".concat((null===d||void 0===d?void 0:d.id)===e.id?"editing":""),initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.03*s},children:(null===d||void 0===d?void 0:d.id)===e.id?(0,u.jsxs)("div",{className:"machine-edit-mode",children:[(0,u.jsxs)("div",{className:"edit-section",children:[(0,u.jsx)("label",{className:"edit-label",children:"Machine Name"}),(0,u.jsx)("input",{type:"text",className:"edit-input",value:d.name,onChange:e=>x((0,h.A)((0,h.A)({},d),{},{name:e.target.value})),autoFocus:!0})]}),(0,u.jsx)("div",{className:"edit-row",children:(0,u.jsxs)("div",{className:"edit-section",children:[(0,u.jsx)("label",{className:"edit-label",children:"Status"}),(0,u.jsx)("div",{className:"status-select-group",children:["running","idle","maintenance"].map(e=>(0,u.jsxs)("button",{className:"status-select-btn ".concat(e," ").concat(d.status===e?"selected":""),onClick:()=>x((0,h.A)((0,h.A)({},d),{},{status:e})),children:[(0,u.jsx)("span",{className:"status-select-icon",children:U(e)}),(0,u.jsx)("span",{className:"status-select-text",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]})}),(0,u.jsxs)("div",{className:"edit-section",children:[(0,u.jsx)("label",{className:"edit-label",children:"Sub-machines (for machine groups)"}),(0,u.jsxs)("select",{className:"edit-select",value:d.subMachineCount||0,onChange:e=>x((0,h.A)((0,h.A)({},d),{},{subMachineCount:parseInt(e.target.value)||void 0})),children:[(0,u.jsx)("option",{value:"0",children:"None - Single machine"}),(0,u.jsx)("option",{value:"2",children:"2 sub-machines"}),(0,u.jsx)("option",{value:"3",children:"3 sub-machines"}),(0,u.jsx)("option",{value:"4",children:"4 sub-machines"}),(0,u.jsx)("option",{value:"5",children:"5 sub-machines"}),(0,u.jsx)("option",{value:"6",children:"6 sub-machines"}),(0,u.jsx)("option",{value:"8",children:"8 sub-machines"}),(0,u.jsx)("option",{value:"10",children:"10 sub-machines"})]})]}),(0,u.jsxs)("div",{className:"edit-actions",children:[(0,u.jsxs)("button",{className:"edit-save-btn",onClick:()=>(async e=>{k(!0);try{await(0,r.te)(e.id,e),S(),x(null),t(),B("".concat(e.name," updated successfully"),"success")}catch(s){B("Failed to update machine","error")}finally{k(!1)}})(d),children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:(0,u.jsx)("path",{d:"M20 6L9 17l-5-5"})}),"Save Changes"]}),(0,u.jsx)("button",{className:"edit-cancel-btn",onClick:()=>x(null),children:"Cancel"})]})]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"machine-card-header",children:[(0,u.jsxs)("div",{className:"machine-identity",children:[(0,u.jsx)("div",{className:"machine-status-dot",style:{backgroundColor:D(e.status)},children:(0,u.jsx)("span",{className:"status-pulse"})}),(0,u.jsxs)("div",{className:"machine-name-info",children:[(0,u.jsx)("span",{className:"machine-card-name",children:e.name}),e.subMachineCount&&e.subMachineCount>0&&(0,u.jsxs)("span",{className:"machine-group-badge",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"12",height:"12",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),(0,u.jsx)("path",{d:"M8 21h8M12 17v4"})]}),e.subMachineCount," machines"]})]})]}),(0,u.jsxs)("div",{className:"machine-card-actions",children:[(0,u.jsx)("button",{className:"card-action-btn edit",onClick:()=>x(e),title:"Edit machine",children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,u.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),(0,u.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,u.jsx)("button",{className:"card-action-btn delete",onClick:()=>(async e=>{if(window.confirm('Are you sure you want to delete "'.concat(e.name,'"? This cannot be undone.'))){k(!0);try{await(0,r.Rn)(e.id),S(),t(),B("".concat(e.name," deleted"),"success")}catch(s){B("Failed to delete machine","error")}finally{k(!1)}}})(e),title:"Delete machine",children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,u.jsx)("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]})]}),(0,u.jsxs)("div",{className:"machine-quick-status",children:[(0,u.jsx)("span",{className:"quick-status-label",children:"Quick Status:"}),(0,u.jsxs)("div",{className:"quick-status-buttons",children:[(0,u.jsx)("button",{className:"quick-btn running ".concat("running"===e.status?"active":""),onClick:()=>W(e.id,"running"),children:"\u25b6 Run"}),(0,u.jsx)("button",{className:"quick-btn idle ".concat("idle"===e.status?"active":""),onClick:()=>W(e.id,"idle"),children:"\u25fc Idle"}),(0,u.jsx)("button",{className:"quick-btn maintenance ".concat("maintenance"===e.status?"active":""),onClick:()=>W(e.id,"maintenance"),children:"\u26a0 Maint"})]})]})]})},e.id))}):(0,u.jsxs)("div",{className:"add-machine-form-v2",children:[(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsxs)("label",{className:"form-label",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[(0,u.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"}),(0,u.jsx)("circle",{cx:"12",cy:"7",r:"4"})]}),"Machine Name"]}),(0,u.jsx)("input",{type:"text",className:"form-input",placeholder:"e.g., Universal 2, CNC Mill 1...",value:v,onChange:e=>p(e.target.value),autoFocus:!0})]}),(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsxs)("label",{className:"form-label",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,u.jsx)("path",{d:"M12 6v6l4 2"})]}),"Initial Status"]}),(0,u.jsx)("div",{className:"status-picker",children:["running","idle","maintenance"].map(e=>(0,u.jsxs)("button",{className:"status-picker-btn ".concat(e," ").concat(N===e?"selected":""),onClick:()=>b(e),children:[(0,u.jsx)("span",{className:"picker-icon",children:U(e)}),(0,u.jsx)("span",{className:"picker-label",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]}),(0,u.jsxs)("div",{className:"form-section",children:[(0,u.jsxs)("label",{className:"form-label",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,u.jsx)("path",{d:"M8 21h8M12 17v4"})]}),"Sub-machines (Optional)"]}),(0,u.jsx)("p",{className:"form-hint",children:"If this is a group name for multiple machines, select how many."}),(0,u.jsxs)("select",{className:"form-select",value:g,onChange:e=>y(parseInt(e.target.value)),children:[(0,u.jsx)("option",{value:"0",children:"None - This is a single machine"}),(0,u.jsx)("option",{value:"2",children:"2 sub-machines"}),(0,u.jsx)("option",{value:"3",children:"3 sub-machines"}),(0,u.jsx)("option",{value:"4",children:"4 sub-machines"}),(0,u.jsx)("option",{value:"5",children:"5 sub-machines"}),(0,u.jsx)("option",{value:"6",children:"6 sub-machines"}),(0,u.jsx)("option",{value:"8",children:"8 sub-machines"}),(0,u.jsx)("option",{value:"10",children:"10 sub-machines"})]})]}),(0,u.jsx)("div",{className:"form-actions",children:(0,u.jsxs)("button",{className:"form-submit-btn",onClick:async()=>{if(v.trim()){k(!0);try{const e={id:"machine-".concat((0,m.A)().slice(0,8)),name:v.trim(),status:N,subMachineCount:g>0?g:void 0};await(0,r.zl)(e),S(),j(!1),p(""),b("idle"),y(0),C("machines"),t(),B("".concat(e.name," added successfully"),"success")}catch(e){B("Failed to add machine","error")}finally{k(!1)}}else B("Please enter a machine name","error")},children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,u.jsx)("path",{d:"M12 8v8M8 12h8"})]}),"Add Machine"]})})]})}),(0,u.jsx)("div",{className:"settings-modal-footer",children:(0,u.jsxs)("button",{className:"settings-done-btn",onClick:a,children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:(0,u.jsx)("path",{d:"M20 6L9 17l-5-5"})}),"Done"]})})]})})}):null},j=e=>{let{isOpen:s,machine:a,onClose:n,onSelectSubMachine:t,activeSubMachines:l=new Set}=e;if(!s||!a||!a.subMachineCount)return null;const r=Array.from({length:a.subMachineCount},(e,s)=>s+1);return(0,u.jsx)(i.N,{children:s&&(0,u.jsx)(c.P.div,{className:"sub-machine-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,children:(0,u.jsxs)(c.P.div,{className:"sub-machine-modal",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},onClick:e=>e.stopPropagation(),children:[(0,u.jsxs)("div",{className:"sub-machine-header",children:[(0,u.jsxs)("div",{className:"sub-machine-title",children:[(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"24",height:"24",children:[(0,u.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,u.jsx)("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),(0,u.jsx)("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("h2",{children:a.name}),(0,u.jsx)("span",{className:"sub-machine-subtitle",children:"Select a machine"})]})]}),(0,u.jsx)("button",{className:"sub-machine-close",onClick:n,children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:[(0,u.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,u.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,u.jsx)("div",{className:"sub-machine-grid",children:r.map(e=>{const s=l.has(e);return(0,u.jsxs)(c.P.button,{className:"sub-machine-btn ".concat(s?"busy":""),onClick:()=>t(a,e,s),whileHover:{scale:1.02},whileTap:{scale:.98},title:s?"In Use - Click to continue":"Available",children:[(0,u.jsx)("div",{className:"sub-machine-icon",children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",width:"32",height:"32",children:[(0,u.jsx)("rect",{x:"3",y:"4",width:"18",height:"12",rx:"2"}),(0,u.jsx)("path",{d:"M7 20h10"}),(0,u.jsx)("path",{d:"M9 16v4"}),(0,u.jsx)("path",{d:"M15 16v4"}),(0,u.jsx)("circle",{cx:"12",cy:"10",r:"2"})]})}),(0,u.jsxs)("div",{className:"sub-machine-info",children:[(0,u.jsxs)("span",{className:"sub-machine-name",children:["Machine ",e]}),(0,u.jsx)("span",{className:"sub-machine-label",children:a.name})]}),(0,u.jsx)("div",{className:"sub-machine-arrow",children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,u.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7"})})})]},e)})}),(0,u.jsx)("div",{className:"sub-machine-footer",children:(0,u.jsx)("button",{className:"sub-machine-cancel",onClick:n,children:"Cancel"})})]})})})},v=e=>{let{value:s,decimals:a=0,suffix:t=""}=e;const[i,c]=(0,n.useState)(0);return(0,n.useEffect)(()=>{const e=s/30;let a=0;const n=setInterval(()=>{a+=e,a>=s?(c(s),clearInterval(n)):c(a)},1e3/30);return()=>clearInterval(n)},[s]),(0,u.jsxs)(u.Fragment,{children:[i.toFixed(a),t]})},p=e=>{let{color:s}=e;return(0,u.jsxs)("span",{className:"pulse-indicator",children:[(0,u.jsx)("span",{className:"pulse-dot",style:{backgroundColor:s}}),(0,u.jsx)("span",{className:"pulse-ring",style:{borderColor:s}})]})},N=()=>{const e=(0,t.Zp)(),[s,a]=(0,n.useState)(new Date),[h,m]=(0,n.useState)(""),[N,b]=(0,n.useState)([]),[g,y]=(0,n.useState)({totalWaste:0,totalDowntime:0,submissionCount:0}),[f,w]=(0,n.useState)([]),[M,C]=(0,n.useState)("grid"),[k,S]=(0,n.useState)(!1),[B,W]=(0,n.useState)(null),[,D]=(0,n.useState)(!0),[U,A]=(0,n.useState)(!1),[I,P]=(0,n.useState)([]),[R,_]=(0,n.useState)([]),H=n.useRef(null);(0,n.useEffect)(()=>()=>{H.current&&clearTimeout(H.current)},[]);const F=(0,n.useCallback)((e,s,a)=>{const n=new Set;for(let i=1;i<=s;i++){const s="".concat(e," - Machine ").concat(i);R.some(e=>e.machine_name===s&&e.is_locked)&&n.add(i)}if(0===n.size&&!d.$G){const a=(new Date).toISOString().split("T")[0],i=(new Date).getUTCHours()+2,c=i>=6&&i<18?"Day":"Night";for(let l=1;l<=s;l++){const s="".concat(e," - Machine ").concat(l),i="shift_session_".concat(s,"_").concat(c,"_").concat(a),r=localStorage.getItem(i);if(r)try{JSON.parse(r).locked&&n.add(l)}catch(t){console.warn("Invalid session data for ".concat(s,":"),t)}}}return n},[R]),T=(0,n.useCallback)(()=>{const e=(0,r.Rg)();b(e);const s=(0,r.F$)();y(s);const a=(0,r.LO)().slice(0,7);w(a)},[]);(0,n.useEffect)(()=>{(async()=>{D(!0);try{(0,r.mg)();const e=await(0,r.bR)();b(e);const s=(0,r.F$)();y(s);const a=(0,r.LO)().slice(0,7);w(a);const n=await(0,o.yw)();_(n);const t=(0,r.Bh)().length;t>0&&(console.log("Retrying ".concat(t," failed submissions...")),(0,r.D$)().then(e=>{e.succeeded>0&&console.log("Successfully synced ".concat(e.succeeded," previously failed submissions")),e.remaining>0&&console.warn("".concat(e.remaining," submissions still pending retry"))}))}catch(e){console.error("Failed to initialize:",e),T()}finally{D(!1)}})();const e=(0,r.Hc)(e=>{console.log("Real-time update received:",e.length,"machines"),b(e)}),s=(0,o.b6)(e=>{console.log("\ud83d\udd04 Session update received:",e.length,"active sessions",e.map(e=>e.machine_name)),_(e)});return()=>{e(),s()}},[T]),(0,n.useEffect)(()=>{const e=setInterval(()=>{const e=new Date;a(e);const s=e.getUTCHours()+2;m(s>=6&&s<18?"Day":"Night")},1e3),s=(new Date).getUTCHours()+2;return m(s>=6&&s<18?"Day":"Night"),()=>clearInterval(e)},[]);const O=s=>{"maintenance"!==s.status&&(s.subMachineCount&&s.subMachineCount>0?W(s):e("/capture/".concat(s.id),{state:{machineName:s.name}}))},L=(s,a,n)=>{const t="".concat(s.name," - Machine ").concat(a);if(U){if(I.length>0){const e=I[0].split(" - ")[0];if(s.name!==e)return}P(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}else{const n="".concat(s.id,"-sub-").concat(a);e("/capture/".concat(n),{state:{machineName:t,parentMachine:s.name,parentMachineId:s.id,subMachineNumber:a,subMachineId:n}})}W(null)},E=(e,s,a)=>{const n="".concat(e.name," - Machine ").concat(s);H.current=setTimeout(()=>{A(!0),P([n])},500)},z=()=>{H.current&&(clearTimeout(H.current),H.current=null)},q=I.length>0?I[0].split(" - ")[0]:null,V=e=>{switch(e){case"running":return"#00ff88";case"idle":default:return"#00f5ff";case"maintenance":return"#ff4757"}},G=e=>{switch(e){case"running":return"linear-gradient(135deg, #00ff88 0%, #00cc6a 100%)";case"idle":default:return"linear-gradient(135deg, #00f5ff 0%, #00c4cc 100%)";case"maintenance":return"linear-gradient(135deg, #ff4757 0%, #cc3945 100%)"}},$=(0,n.useMemo)(()=>{const e=N.filter(e=>"running"===e.status).length,s=N.filter(e=>"maintenance"!==e.status).length;return s>0?Math.round(e/s*100):0},[N]),J=N.filter(e=>"running"===e.status).length,Q=N.filter(e=>"idle"===e.status).length,Z=N.filter(e=>"maintenance"===e.status).length;return(0,u.jsxs)("div",{className:"dashboard-v2",children:[(0,u.jsxs)("header",{className:"top-nav",children:[(0,u.jsxs)("div",{className:"nav-brand",children:[(0,u.jsx)("div",{className:"brand-icon",children:(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,u.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})})}),(0,u.jsxs)("div",{className:"brand-text",children:[(0,u.jsx)("span",{className:"brand-name",children:"Production Control"}),(0,u.jsx)("span",{className:"brand-subtitle",children:"Waste & Downtime Tracking"})]})]}),(0,u.jsx)("div",{className:"nav-center",children:(0,u.jsxs)("div",{className:"live-clock",children:[(0,u.jsx)(p,{color:"#10b981"}),(0,u.jsx)("span",{className:"clock-time",children:(0,l.GP)(s,"HH:mm:ss")}),(0,u.jsx)("span",{className:"clock-date",children:(0,l.GP)(s,"dd MMM yyyy")})]})}),(0,u.jsxs)("div",{className:"nav-actions",children:[(0,u.jsxs)("div",{className:"shift-indicator ".concat(h.toLowerCase()),children:[(0,u.jsx)("span",{className:"shift-icon",children:"Day"===h?"\u25d0":"\u25d1"}),(0,u.jsxs)("span",{className:"shift-text",children:[h," Shift"]})]}),(0,u.jsxs)("button",{className:"nav-btn admin-btn",onClick:()=>e("/admin"),children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:(0,u.jsx)("path",{d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Admin"]}),(0,u.jsx)("button",{className:"nav-btn",onClick:()=>e("/history"),children:"History"}),(0,u.jsxs)("button",{className:"nav-btn settings-btn",onClick:()=>S(!0),children:[(0,u.jsxs)("svg",{className:"settings-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:[(0,u.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,u.jsx)("path",{d:"M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"})]}),(0,u.jsx)("span",{className:"settings-text",children:"Settings"})]})]})]}),(0,u.jsx)(x,{isOpen:k,onClose:()=>S(!1),onMachinesUpdated:T}),(0,u.jsx)(j,{isOpen:!!B,machine:B,onClose:()=>W(null),onSelectSubMachine:L,activeSubMachines:B?F(B.name,B.subMachineCount||0,B.id):new Set}),(0,u.jsxs)("main",{className:"dashboard-main",children:[(0,u.jsxs)("aside",{className:"stats-panel",children:[(0,u.jsxs)("div",{className:"efficiency-card",children:[(0,u.jsxs)("div",{className:"efficiency-ring",children:[(0,u.jsxs)("svg",{viewBox:"0 0 120 120",children:[(0,u.jsx)("circle",{cx:"60",cy:"60",r:"50",className:"ring-bg"}),(0,u.jsx)("circle",{cx:"60",cy:"60",r:"50",className:"ring-progress",strokeDasharray:"".concat(3.14*$," 314"),style:{stroke:$>70?"#10b981":$>40?"#f59e0b":"#ef4444"}})]}),(0,u.jsx)("div",{className:"efficiency-value",children:(0,u.jsx)(v,{value:$,suffix:"%"})})]}),(0,u.jsx)("span",{className:"efficiency-label",children:"Line Efficiency"})]}),(0,u.jsxs)("div",{className:"quick-stats",children:[(0,u.jsxs)("div",{className:"stat-item running",children:[(0,u.jsx)("div",{className:"stat-indicator"}),(0,u.jsxs)("div",{className:"stat-info",children:[(0,u.jsx)("span",{className:"stat-value",children:J}),(0,u.jsx)("span",{className:"stat-label",children:"Running"})]})]}),(0,u.jsxs)("div",{className:"stat-item idle",children:[(0,u.jsx)("div",{className:"stat-indicator"}),(0,u.jsxs)("div",{className:"stat-info",children:[(0,u.jsx)("span",{className:"stat-value",children:Q}),(0,u.jsx)("span",{className:"stat-label",children:"Idle"})]})]}),(0,u.jsxs)("div",{className:"stat-item maintenance",children:[(0,u.jsx)("div",{className:"stat-indicator"}),(0,u.jsxs)("div",{className:"stat-info",children:[(0,u.jsx)("span",{className:"stat-value",children:Z}),(0,u.jsx)("span",{className:"stat-label",children:"Maintenance"})]})]})]})]}),(0,u.jsxs)("section",{className:"machines-section ".concat(U?"multi-select-mode":""),children:[(0,u.jsxs)("div",{className:"section-header",children:[(0,u.jsxs)("h2",{children:["Production Lines",U&&(0,u.jsx)("span",{className:"multi-select-hint",children:" \u2014 Hold to select machines"})]}),(0,u.jsxs)("div",{className:"header-actions",children:[U&&(0,u.jsxs)("button",{className:"cancel-select-btn",onClick:()=>{A(!1),P([])},children:[(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"18",height:"18",children:(0,u.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})}),"Cancel"]}),(0,u.jsxs)("div",{className:"view-toggle",children:[(0,u.jsx)("button",{className:"grid"===M?"active":"",onClick:()=>C("grid"),children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:[(0,u.jsx)("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),(0,u.jsx)("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1"}),(0,u.jsx)("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1"}),(0,u.jsx)("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"})]})}),(0,u.jsx)("button",{className:"list"===M?"active":"",onClick:()=>C("list"),children:(0,u.jsxs)("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18",children:[(0,u.jsx)("rect",{x:"3",y:"4",width:"18",height:"4",rx:"1"}),(0,u.jsx)("rect",{x:"3",y:"10",width:"18",height:"4",rx:"1"}),(0,u.jsx)("rect",{x:"3",y:"16",width:"18",height:"4",rx:"1"})]})})]})]})]}),(0,u.jsx)(i.N,{mode:"wait",children:"grid"===M?(0,u.jsx)(c.P.div,{className:"machines-grid-v2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:N.map((e,s)=>{var a;const n=e.subMachineCount&&e.subMachineCount>0?F(e.name,e.subMachineCount,e.id):new Set,t=n.size>0,i="running"===e.status||!!e.currentOrder||t,l=i||"maintenance"===e.status,r=i?"running":e.status;return(0,u.jsxs)(c.P.div,{className:"machine-tile ".concat(r," ").concat(l?"disabled":""," ").concat(e.subMachineCount&&e.subMachineCount>0?"has-sub-machines":""),initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.05*s},onClick:()=>{e.subMachineCount&&e.subMachineCount>0||O(e)},whileHover:l||e.subMachineCount&&e.subMachineCount>0?{}:{scale:1.02,y:-4},whileTap:l||e.subMachineCount&&e.subMachineCount>0?{}:{scale:.98},children:[(0,u.jsx)("div",{className:"tile-glow",style:{background:G(r)}}),(0,u.jsxs)("div",{className:"tile-content",children:[(0,u.jsxs)("div",{className:"tile-header",children:[(0,u.jsx)("span",{className:"tile-name",children:e.name}),(0,u.jsx)("div",{className:"tile-status",children:(0,u.jsx)(p,{color:V(r)})})]}),(0,u.jsxs)("div",{className:"tile-status-text",children:[i?"Running":e.status.charAt(0).toUpperCase()+e.status.slice(1),e.subMachineCount&&e.subMachineCount>0&&(0,u.jsx)("span",{className:"sub-count-badge",children:n.size>0?"".concat(n.size,"/").concat(e.subMachineCount," active"):"".concat(e.subMachineCount," units")})]}),e.subMachineCount&&e.subMachineCount>0&&n.size>0?(0,u.jsx)("div",{className:"active-members-info",children:Array.from(n).sort((e,s)=>e-s).map(s=>{const a="".concat(e.name," - Machine ").concat(s),n=R.find(e=>e.machine_name===a);return(0,u.jsxs)("div",{className:"member-info",children:[(0,u.jsxs)("span",{className:"member-label",children:["M",s,":"]}),n?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("span",{className:"member-order",children:n.order_number}),(0,u.jsxs)("span",{className:"member-operator",children:["(",n.operator_name,")"]})]}):(0,u.jsx)("span",{className:"member-order",children:"Active"})]},s)})}):(0,u.jsxs)(u.Fragment,{children:[i&&e.currentOrder&&(0,u.jsxs)("div",{className:"tile-order",children:["Order: ",e.currentOrder]}),e.currentOperator&&(0,u.jsx)("div",{className:"tile-operator",children:e.currentOperator})]}),e.subMachineCount&&e.subMachineCount>0&&n.size>0?(0,u.jsx)("div",{className:"members-stats",children:Array.from(n).sort((e,s)=>e-s).map(s=>{const a="".concat(e.name," - Machine ").concat(s),n=R.find(e=>e.machine_name===a),t=(null===n||void 0===n?void 0:n.total_waste)||0,i=(null===n||void 0===n?void 0:n.total_downtime)||0;return(0,u.jsxs)("div",{className:"member-stats-row",children:[(0,u.jsxs)("span",{className:"member-label",children:["M",s,":"]}),(0,u.jsxs)("div",{className:"tile-stat waste",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\ud83d\uddd1\ufe0f"}),(0,u.jsx)("span",{className:"stat-value",children:t.toFixed(1)}),(0,u.jsx)("span",{className:"stat-unit",children:"kg"})]}),(0,u.jsxs)("div",{className:"tile-stat downtime",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\u23f1\ufe0f"}),(0,u.jsx)("span",{className:"stat-value",children:i}),(0,u.jsx)("span",{className:"stat-unit",children:"min"})]})]},s)})}):(0,u.jsxs)("div",{className:"tile-stats",children:[(0,u.jsxs)("div",{className:"tile-stat waste",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\ud83d\uddd1\ufe0f"}),(0,u.jsx)("span",{className:"stat-value",children:(null===(a=e.todayWaste)||void 0===a?void 0:a.toFixed(1))||"0.0"}),(0,u.jsx)("span",{className:"stat-unit",children:"kg"})]}),(0,u.jsxs)("div",{className:"tile-stat downtime",children:[(0,u.jsx)("span",{className:"stat-icon",children:"\u23f1\ufe0f"}),(0,u.jsx)("span",{className:"stat-value",children:e.todayDowntime||0}),(0,u.jsx)("span",{className:"stat-unit",children:"min"})]})]}),e.subMachineCount&&e.subMachineCount>0&&"maintenance"!==e.status?(0,u.jsx)("div",{className:"sub-machine-inline-grid",children:Array.from({length:e.subMachineCount},(e,s)=>s+1).map(s=>{const a="".concat(e.name," - Machine ").concat(s),t=n.has(s),i=I.includes(a),l=Boolean(U&&q&&q!==e.name),r=l;return(0,u.jsxs)(c.P.button,{className:"sub-machine-inline-btn ".concat(t?"busy":""," ").concat(i?"selected":""," ").concat(r?"disabled":""),onClick:a=>{a.stopPropagation(),L(e,s)},onMouseDown:()=>E(e,s),onMouseUp:z,onMouseLeave:z,onTouchStart:()=>E(e,s),onTouchEnd:z,whileHover:r?{}:{scale:1.1},whileTap:r?{}:{scale:.95},title:t?"In Use - Click to continue":l?"Different group":U?"Tap to select":"Hold to multi-select",disabled:r,children:[s,t&&(0,u.jsx)("span",{className:"status-dot busy"}),i&&(0,u.jsx)("span",{className:"check-mark",children:"\u2713"})]},s)})}):(0,u.jsxs)("div",{className:"tile-footer",children:[(0,u.jsx)("span",{className:"tile-time",children:e.lastSubmission||"No entries"}),"maintenance"!==e.status&&(0,u.jsx)("span",{className:"tile-action",children:"Record \u2192"})]})]})]},e.id)})},"grid"):(0,u.jsx)(c.P.div,{className:"machines-list",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:N.map((e,s)=>(0,u.jsxs)(c.P.div,{className:"machine-row ".concat(e.status," ").concat("maintenance"===e.status?"disabled":""),initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.03*s},onClick:()=>O(e),children:[(0,u.jsx)("div",{className:"row-indicator",style:{background:G(e.status)}}),(0,u.jsx)("div",{className:"row-name",children:e.name}),(0,u.jsxs)("div",{className:"row-status",children:[(0,u.jsx)(p,{color:V(e.status)}),(0,u.jsx)("span",{children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),(0,u.jsx)("div",{className:"row-operator",children:e.currentOperator||"\u2014"}),(0,u.jsx)("div",{className:"row-time",children:e.lastSubmission||"No entries"}),"maintenance"!==e.status&&(0,u.jsx)("button",{className:"row-action",children:"Record"})]},e.id))},"list")}),(0,u.jsx)(i.N,{children:U&&I.length>0&&(0,u.jsxs)(c.P.div,{className:"multi-select-bar",initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},children:[(0,u.jsxs)("div",{className:"selection-info",children:[(0,u.jsx)("span",{className:"selection-parent-group",children:q}),(0,u.jsx)("span",{className:"selection-divider",children:"\u2014"}),(0,u.jsx)("span",{className:"selection-machines",children:I.map(e=>e.split(" - Machine ")[1]).join(", ")})]}),(0,u.jsxs)("button",{className:"start-capture-btn",onClick:()=>{if(0===I.length)return;const s=I[0].split(" - ")[0];e("/capture/multi",{state:{machineNames:I,parentGroup:s,isMultiMachine:!0}})},children:["Start Recording (",I.length,")",(0,u.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:(0,u.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7"})})]})]})})]}),(0,u.jsx)("aside",{className:"overview-panel",children:(0,u.jsxs)("div",{className:"recent-activity",children:[(0,u.jsx)("h3",{className:"section-title",children:"Recent Submissions"}),(0,u.jsxs)("div",{className:"activity-list",children:[f.slice(0,5).map((e,s)=>(0,u.jsxs)(c.P.div,{className:"activity-item",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*s},children:[(0,u.jsx)("div",{className:"activity-icon",children:(0,u.jsx)("span",{className:"icon-dot"})}),(0,u.jsxs)("div",{className:"activity-details",children:[(0,u.jsx)("span",{className:"activity-machine",children:e.machine}),(0,u.jsxs)("span",{className:"activity-meta",children:[e.totalWaste.toFixed(1),"kg waste \xb7 ",e.totalDowntime,"m downtime"]})]}),(0,u.jsx)("div",{className:"activity-time",children:(0,l.GP)(new Date(e.submittedAt),"HH:mm")})]},e.id||s)),0===f.length&&(0,u.jsx)("div",{className:"activity-empty",children:"No recent activity"})]})]})})]})]})}},6820:(e,s,a)=>{a.d(s,{A:()=>o});const n={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let t;const i=new Uint8Array(16);const c=[];for(let d=0;d<256;++d)c.push((d+256).toString(16).slice(1));function l(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(c[e[s+0]]+c[e[s+1]]+c[e[s+2]]+c[e[s+3]]+"-"+c[e[s+4]]+c[e[s+5]]+"-"+c[e[s+6]]+c[e[s+7]]+"-"+c[e[s+8]]+c[e[s+9]]+"-"+c[e[s+10]]+c[e[s+11]]+c[e[s+12]]+c[e[s+13]]+c[e[s+14]]+c[e[s+15]]).toLowerCase()}function r(e,s,a){var n,c,r,o;const d=null!==(n=null!==(c=(e=e||{}).random)&&void 0!==c?c:null===(r=(o=e).rng)||void 0===r?void 0:r.call(o))&&void 0!==n?n:function(){if(!t){if("undefined"===typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(i)}();if(d.length<16)throw new Error("Random bytes length must be >= 16");if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,s){if((a=a||0)<0||a+16>s.length)throw new RangeError("UUID byte range ".concat(a,":").concat(a+15," is out of buffer bounds"));for(let e=0;e<16;++e)s[a+e]=d[e];return s}return l(d)}const o=function(e,s,a){return!n.randomUUID||s||e?r(e,s,a):n.randomUUID()}}}]);
//# sourceMappingURL=82.c998c1dc.chunk.js.map