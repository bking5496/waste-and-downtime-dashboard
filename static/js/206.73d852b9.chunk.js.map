{"version":3,"file":"static/js/206.73d852b9.chunk.js","mappings":"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","sources":["types.ts","pages/HistoryPage.tsx","lib/storage.ts"],"sourcesContent":["export interface WasteEntry {\r\n  id: string;\r\n  waste: number;\r\n  wasteType: string;\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface DowntimeEntry {\r\n  id: string;\r\n  downtime: number;\r\n  downtimeReason: string;\r\n  notes?: string;\r\n  timestamp: Date;\r\n}\r\n\r\n// Production timer state for tracking run time and pauses\r\nexport interface ProductionState {\r\n  isRunning: boolean;\r\n  startTime: Date | null;       // When production started\r\n  pausedAt: Date | null;        // When current pause began\r\n  totalRunTimeMs: number;       // Accumulated run time in milliseconds\r\n  lastResumedAt: Date | null;   // When last resumed from pause\r\n}\r\n\r\nexport interface SpeedEntry {\r\n  id: string;\r\n  speed: number;\r\n  timestamp: Date;\r\n}\r\n\r\nexport interface SachetMassEntry {\r\n  id: string;\r\n  mass: number; // in grams\r\n  timestamp: Date;\r\n  ignored?: boolean; // Can be set to ignore but not deleted\r\n}\r\n\r\n// Loose cases entry - for cases not part of a full pallet\r\nexport interface LooseCasesEntry {\r\n  id: string;\r\n  batchNumber: string; // 5-digit batch number\r\n  cases: number; // number of loose cases\r\n  timestamp: Date;\r\n  ignored?: boolean;\r\n}\r\n\r\n// Pallet Scan entry - QR code is 13 digits: BBBBBPPPPCCCC\r\n// B = batch number (5 digits), P = pallet number (4 digits), C = cases count (4 digits)\r\nexport interface PalletScanEntry {\r\n  id: string;\r\n  qrCode: string; // Full 13-digit QR code\r\n  batchNumber: string; // Extracted: first 5 digits\r\n  palletNumber: string; // Extracted: digits 6-9 (4 digits)\r\n  casesCount: number; // Extracted: last 4 digits\r\n  timestamp: Date;\r\n  ignored?: boolean;\r\n}\r\n\r\n// Legacy CasesPerHourEntry - kept for backwards compatibility\r\nexport interface CasesPerHourEntry {\r\n  id: string;\r\n  cases: number;\r\n  hour: number;\r\n  timestamp: Date;\r\n  ignored?: boolean;\r\n}\r\n\r\nexport interface ShiftData {\r\n  id: string;\r\n  operatorName: string;\r\n  machine: string;\r\n  subMachine?: string; // For machines that are groups (e.g., \"Universal 2 - Machine 1\")\r\n  orderNumber: string;\r\n  product: string;\r\n  batchNumber: string;\r\n  shift: string;\r\n  date: string;\r\n  wasteEntries: WasteEntry[];\r\n  downtimeEntries: DowntimeEntry[];\r\n  speedEntries?: SpeedEntry[];\r\n  sachetMassEntries?: SachetMassEntry[];\r\n  casesPerHourEntries?: CasesPerHourEntry[]; // Legacy - kept for backwards compatibility\r\n  looseCasesEntries?: LooseCasesEntry[]; // New: loose cases with batch number\r\n  palletScanEntries?: PalletScanEntry[];\r\n  submittedAt: Date;\r\n  totalWaste: number;\r\n  totalDowntime: number;\r\n}\r\n\r\nexport interface ShiftSession {\r\n  machineName: string;\r\n  operatorName: string;\r\n  orderNumber: string;\r\n  product: string;\r\n  batchNumber: string;\r\n  shift: string;\r\n  date: string;\r\n  locked: boolean; // Once set, these values are locked for the shift\r\n  // Entry data persisted with session\r\n  wasteEntries?: WasteEntry[];\r\n  downtimeEntries?: DowntimeEntry[];\r\n  speedEntries?: SpeedEntry[];\r\n  sachetMassEntries?: SachetMassEntry[];\r\n  casesPerHourEntries?: CasesPerHourEntry[]; // Legacy\r\n  looseCasesEntries?: LooseCasesEntry[]; // New\r\n  palletScanEntries?: PalletScanEntry[];\r\n}\r\n\r\nexport interface Machine {\r\n  id: string;\r\n  name: string;\r\n  status: 'running' | 'idle' | 'maintenance';\r\n  currentOperator?: string;\r\n  currentOrder?: string;\r\n  currentShift?: string;\r\n  lastSubmission?: string;\r\n  todayWaste?: number;\r\n  todayDowntime?: number;\r\n  subMachineCount?: number; // Number of sub-machines (e.g., 4 for \"Universal 2\")\r\n}\r\n\r\n// ==============================================\r\n// DEFAULT DATA\r\n// ==============================================\r\n\r\nexport const OPERATORS: string[] = [];\r\nexport const MACHINES: Machine[] = [];\r\n\r\n// Waste Types - common manufacturing waste categories\r\nexport const WASTE_TYPES: string[] = [\r\n  'Start-up Waste',\r\n  'Changeover Waste',\r\n  'Defective Product',\r\n  'Material Spillage',\r\n];\r\n\r\n// Downtime Reasons - categorized by planned vs unplanned\r\nexport const PLANNED_DOWNTIME_REASONS: string[] = [\r\n  'Scheduled Maintenance',\r\n  'Changeover',\r\n];\r\n\r\nexport const UNPLANNED_DOWNTIME_REASONS: string[] = [\r\n  'Machine Breakdown',\r\n  'Material Shortage',\r\n];\r\n\r\n// Combined downtime reasons for selection\r\nexport const DOWNTIME_REASONS: string[] = [\r\n  'Machine Breakdown',\r\n  'Scheduled Maintenance',\r\n  'Changeover',\r\n  'Material Shortage',\r\n];\r\n\r\nexport const ORDER_NUMBERS: string[] = [];\r\nexport const PRODUCTS: string[] = [];\r\nexport const BATCH_NUMBERS: string[] = [];\r\n\r\n","import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { format, subDays, startOfDay, endOfDay } from 'date-fns';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  useReactTable,\r\n  getCoreRowModel,\r\n  getSortedRowModel,\r\n  getFilteredRowModel,\r\n  getPaginationRowModel,\r\n  flexRender,\r\n  SortingState,\r\n  ColumnDef,\r\n} from '@tanstack/react-table';\r\nimport { ShiftData } from '../types';\r\nimport { getShiftHistory, exportToCSV } from '../lib/storage';\r\nimport { getRecentSubmissions } from '../lib/supabase';\r\n\r\n// Type definitions for Supabase response\r\ninterface WasteRecordResponse {\r\n  id: number;\r\n  waste_amount: number;\r\n  waste_type: string;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface DowntimeRecordResponse {\r\n  id: number;\r\n  downtime_minutes: number;\r\n  downtime_reason: string;\r\n  recorded_at?: string;\r\n  created_at?: string;\r\n}\r\n\r\ninterface SubmissionResponse {\r\n  id: number;\r\n  operator_name: string;\r\n  machine: string;\r\n  order_number: string;\r\n  product: string;\r\n  batch_number: string;\r\n  shift: string;\r\n  submission_date: string;\r\n  total_waste?: number;\r\n  total_downtime?: number;\r\n  created_at: string;\r\n  waste_records?: WasteRecordResponse[];\r\n  downtime_records?: DowntimeRecordResponse[];\r\n}\r\n\r\nconst HistoryPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [data, setData] = useState<ShiftData[]>([]);\r\n  const [sorting, setSorting] = useState<SortingState>([{ id: 'submittedAt', desc: true }]);\r\n  const [globalFilter, setGlobalFilter] = useState('');\r\n  const [dateRange, setDateRange] = useState<'today' | 'week' | 'month' | 'all'>('all');\r\n  const [dataSource, setDataSource] = useState<'local' | 'database'>('database');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Transform Supabase submission to ShiftData\r\n  const transformSubmission = useCallback((sub: SubmissionResponse): ShiftData => ({\r\n    id: sub.id.toString(),\r\n    operatorName: sub.operator_name,\r\n    machine: sub.machine,\r\n    orderNumber: sub.order_number,\r\n    product: sub.product,\r\n    batchNumber: sub.batch_number,\r\n    shift: sub.shift,\r\n    date: sub.submission_date,\r\n    wasteEntries: (sub.waste_records || []).map((w: WasteRecordResponse) => ({\r\n      id: w.id.toString(),\r\n      waste: w.waste_amount,\r\n      wasteType: w.waste_type,\r\n      timestamp: new Date(w.recorded_at || w.created_at || Date.now()),\r\n    })),\r\n    downtimeEntries: (sub.downtime_records || []).map((d: DowntimeRecordResponse) => ({\r\n      id: d.id.toString(),\r\n      downtime: d.downtime_minutes,\r\n      downtimeReason: d.downtime_reason,\r\n      timestamp: new Date(d.recorded_at || d.created_at || Date.now()),\r\n    })),\r\n    totalWaste: sub.total_waste || 0,\r\n    totalDowntime: sub.total_downtime || 0,\r\n    submittedAt: new Date(sub.created_at),\r\n  }), []);\r\n\r\n  const loadData = useCallback(async () => {\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      let history: ShiftData[] = [];\r\n\r\n      if (dataSource === 'database') {\r\n        // Fetch from Supabase\r\n        const submissions = await getRecentSubmissions(100) as SubmissionResponse[];\r\n        history = submissions.map(transformSubmission);\r\n      } else {\r\n        // Fetch from localStorage\r\n        history = getShiftHistory();\r\n      }\r\n\r\n      const now = new Date();\r\n      switch (dateRange) {\r\n        case 'today':\r\n          const todayStart = startOfDay(now);\r\n          const todayEnd = endOfDay(now);\r\n          history = history.filter(item => {\r\n            const itemDate = new Date(item.submittedAt);\r\n            return itemDate >= todayStart && itemDate <= todayEnd;\r\n          });\r\n          break;\r\n        case 'week':\r\n          const weekAgo = subDays(now, 7);\r\n          history = history.filter(item => new Date(item.submittedAt) >= weekAgo);\r\n          break;\r\n        case 'month':\r\n          const monthAgo = subDays(now, 30);\r\n          history = history.filter(item => new Date(item.submittedAt) >= monthAgo);\r\n          break;\r\n      }\r\n\r\n      setData(history);\r\n    } catch (error) {\r\n      console.error('Error loading data:', error);\r\n      // Fallback to local storage if database fails\r\n      if (dataSource === 'database') {\r\n        setDataSource('local');\r\n      }\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [dataSource, dateRange, transformSubmission]);\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, [loadData]);\r\n\r\n  const columns = useMemo<ColumnDef<ShiftData>[]>(() => [\r\n    {\r\n      accessorKey: 'date',\r\n      header: 'Date',\r\n      cell: info => format(new Date(info.getValue() as string), 'MMM dd, yyyy'),\r\n    },\r\n    {\r\n      accessorKey: 'shift',\r\n      header: 'Shift',\r\n      cell: info => (\r\n        <span className={`shift-tag ${(info.getValue() as string).toLowerCase()}`}>\r\n          {info.getValue() as string}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      accessorKey: 'operatorName',\r\n      header: 'Operator',\r\n    },\r\n    {\r\n      accessorKey: 'machine',\r\n      header: 'Machine',\r\n    },\r\n    {\r\n      accessorKey: 'orderNumber',\r\n      header: 'Order',\r\n    },\r\n    {\r\n      accessorKey: 'totalWaste',\r\n      header: 'Waste (kg)',\r\n      cell: info => (\r\n        <span className=\"waste-value\">{(info.getValue() as number).toFixed(1)}</span>\r\n      ),\r\n    },\r\n    {\r\n      accessorKey: 'totalDowntime',\r\n      header: 'Downtime',\r\n      cell: info => {\r\n        const mins = info.getValue() as number;\r\n        const hours = Math.floor(mins / 60);\r\n        const remainingMins = mins % 60;\r\n        return (\r\n          <span className=\"downtime-value\">\r\n            {hours > 0 ? `${hours}h ` : ''}{remainingMins}m\r\n          </span>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      accessorKey: 'submittedAt',\r\n      header: 'Submitted',\r\n      cell: info => format(new Date(info.getValue() as Date), 'HH:mm'),\r\n    },\r\n  ], []);\r\n\r\n  const table = useReactTable({\r\n    data,\r\n    columns,\r\n    state: {\r\n      sorting,\r\n      globalFilter,\r\n    },\r\n    onSortingChange: setSorting,\r\n    onGlobalFilterChange: setGlobalFilter,\r\n    getCoreRowModel: getCoreRowModel(),\r\n    getSortedRowModel: getSortedRowModel(),\r\n    getFilteredRowModel: getFilteredRowModel(),\r\n    getPaginationRowModel: getPaginationRowModel(),\r\n    initialState: {\r\n      pagination: {\r\n        pageSize: 10,\r\n      },\r\n    },\r\n  });\r\n\r\n  const handleExport = () => {\r\n    const filename = `shift_history_${format(new Date(), 'yyyy-MM-dd')}`;\r\n    exportToCSV(data, filename);\r\n  };\r\n\r\n  // Calculate summary stats\r\n  const stats = useMemo(() => {\r\n    const totalWaste = data.reduce((sum, item) => sum + item.totalWaste, 0);\r\n    const totalDowntime = data.reduce((sum, item) => sum + item.totalDowntime, 0);\r\n    const avgWaste = data.length > 0 ? totalWaste / data.length : 0;\r\n    const avgDowntime = data.length > 0 ? totalDowntime / data.length : 0;\r\n    \r\n    return { totalWaste, totalDowntime, avgWaste, avgDowntime, count: data.length };\r\n  }, [data]);\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"history-page-v2\"\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n    >\r\n      {/* Header */}\r\n      <header className=\"history-header-v2\">\r\n        <div className=\"header-left-v2\">\r\n          <button className=\"back-btn-v2\" onClick={() => navigate('/')}>\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M19 12H5M12 19l-7-7 7-7\"/>\r\n            </svg>\r\n            Back\r\n          </button>\r\n          <div className=\"header-titles\">\r\n            <h1>Submission History</h1>\r\n            <span className=\"header-subtitle\">\r\n              {isLoading ? 'Loading...' : `${data.length} records from ${dataSource === 'database' ? 'Supabase' : 'Local Storage'}`}\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div className=\"header-actions-v2\">\r\n          <button \r\n            className=\"export-btn-v2\" \r\n            onClick={handleExport} \r\n            disabled={data.length === 0}\r\n          >\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n              <path d=\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3\"/>\r\n            </svg>\r\n            Export CSV\r\n          </button>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"history-main\">\r\n        {/* Filters */}\r\n        <div className=\"history-filters-v2\">\r\n          <div className=\"filter-group-v2\">\r\n            <label>Data Source</label>\r\n            <div className=\"filter-pills\">\r\n              <button\r\n                className={`filter-pill ${dataSource === 'database' ? 'active' : ''}`}\r\n                onClick={() => setDataSource('database')}\r\n              >\r\n                ‚òÅÔ∏è Database\r\n              </button>\r\n              <button\r\n                className={`filter-pill ${dataSource === 'local' ? 'active' : ''}`}\r\n                onClick={() => setDataSource('local')}\r\n              >\r\n                üíæ Local\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div className=\"filter-group-v2\">\r\n            <label>Time Period</label>\r\n            <div className=\"filter-pills\">\r\n              {(['today', 'week', 'month', 'all'] as const).map(range => (\r\n                <button\r\n                  key={range}\r\n                  className={`filter-pill ${dateRange === range ? 'active' : ''}`}\r\n                  onClick={() => setDateRange(range)}\r\n                >\r\n                  {range === 'today' ? 'Today' : range === 'week' ? '7 Days' : range === 'month' ? '30 Days' : 'All Time'}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          <div className=\"filter-group-v2 search-group\">\r\n            <label>Search</label>\r\n            <div className=\"search-input-wrapper\">\r\n              <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n                <path d=\"M21 21l-4.35-4.35\"/>\r\n              </svg>\r\n              <input\r\n                type=\"text\"\r\n                className=\"search-input-v2\"\r\n                placeholder=\"Search operator, machine, order...\"\r\n                value={globalFilter}\r\n                onChange={e => setGlobalFilter(e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stats Summary */}\r\n        <div className=\"history-stats-v2\">\r\n          <div className=\"stat-card-v2\">\r\n            <span className=\"stat-value-v2\">{stats.count}</span>\r\n            <span className=\"stat-label-v2\">Submissions</span>\r\n          </div>\r\n          <div className=\"stat-card-v2 waste\">\r\n            <span className=\"stat-value-v2\">{stats.totalWaste.toFixed(1)}<small>kg</small></span>\r\n            <span className=\"stat-label-v2\">Total Waste</span>\r\n          </div>\r\n          <div className=\"stat-card-v2 downtime\">\r\n            <span className=\"stat-value-v2\">{Math.floor(stats.totalDowntime / 60)}h {stats.totalDowntime % 60}m</span>\r\n            <span className=\"stat-label-v2\">Total Downtime</span>\r\n          </div>\r\n          <div className=\"stat-card-v2\">\r\n            <span className=\"stat-value-v2\">{stats.avgWaste.toFixed(1)}<small>kg</small></span>\r\n            <span className=\"stat-label-v2\">Avg per Shift</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Data Table */}\r\n        <div className=\"history-table-container-v2\">\r\n          {data.length === 0 ? (\r\n            <div className=\"empty-state-v2\">\r\n              <div className=\"empty-icon\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\r\n                  <path d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"/>\r\n                </svg>\r\n              </div>\r\n              <h3>No submissions found</h3>\r\n              <p>There are no shift submissions for the selected time period.</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <div className=\"table-wrapper\">\r\n                <table className=\"history-table-v2\">\r\n                  <thead>\r\n                    {table.getHeaderGroups().map(headerGroup => (\r\n                      <tr key={headerGroup.id}>\r\n                        {headerGroup.headers.map(header => (\r\n                          <th\r\n                            key={header.id}\r\n                            onClick={header.column.getToggleSortingHandler()}\r\n                            className={header.column.getCanSort() ? 'sortable' : ''}\r\n                          >\r\n                            <div className=\"th-content\">\r\n                              {flexRender(header.column.columnDef.header, header.getContext())}\r\n                              {header.column.getIsSorted() && (\r\n                                <span className=\"sort-indicator\">\r\n                                  {header.column.getIsSorted() === 'asc' ? '‚Üë' : '‚Üì'}\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          </th>\r\n                        ))}\r\n                      </tr>\r\n                    ))}\r\n                  </thead>\r\n                  <tbody>\r\n                    <AnimatePresence>\r\n                      {table.getRowModel().rows.map(row => (\r\n                        <motion.tr\r\n                          key={row.id}\r\n                          initial={{ opacity: 0, y: -10 }}\r\n                          animate={{ opacity: 1, y: 0 }}\r\n                          exit={{ opacity: 0, y: 10 }}\r\n                        >\r\n                          {row.getVisibleCells().map(cell => (\r\n                            <td key={cell.id}>\r\n                              {flexRender(cell.column.columnDef.cell, cell.getContext())}\r\n                            </td>\r\n                          ))}\r\n                        </motion.tr>\r\n                      ))}\r\n                    </AnimatePresence>\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n\r\n              {/* Pagination */}\r\n              <div className=\"table-pagination-v2\">\r\n                <div className=\"pagination-info-v2\">\r\n                  Showing {table.getState().pagination.pageIndex * table.getState().pagination.pageSize + 1} to{' '}\r\n                  {Math.min(\r\n                    (table.getState().pagination.pageIndex + 1) * table.getState().pagination.pageSize,\r\n                    data.length\r\n                  )}{' '}\r\n                  of {data.length} entries\r\n                </div>\r\n                <div className=\"pagination-controls-v2\">\r\n                  <button\r\n                    className=\"page-btn\"\r\n                    onClick={() => table.previousPage()}\r\n                    disabled={!table.getCanPreviousPage()}\r\n                  >\r\n                    ‚Üê Previous\r\n                  </button>\r\n                  <span className=\"page-indicator-v2\">\r\n                    {table.getState().pagination.pageIndex + 1} / {table.getPageCount()}\r\n                  </span>\r\n                  <button\r\n                    className=\"page-btn\"\r\n                    onClick={() => table.nextPage()}\r\n                    disabled={!table.getCanNextPage()}\r\n                  >\r\n                    Next ‚Üí\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </main>\r\n    </motion.div>\r\n  );\r\n};\r\n\r\nexport default HistoryPage;\r\n","import { ShiftData, Machine, MACHINES } from '../types';\r\nimport {\r\n  fetchMachines,\r\n  upsertMachine,\r\n  removeMachine,\r\n  syncMachinesToSupabase,\r\n  subscribeMachineChanges,\r\n  MachineRecord,\r\n  submitShiftData,\r\n  isSupabaseConfigured\r\n} from './supabase';\r\n\r\nconst STORAGE_KEY = 'waste_downtime_history';\r\nconst MACHINES_KEY = 'machines_data';\r\nconst MACHINES_SYNC_KEY = 'machines_last_sync';\r\nconst FAILED_SUBMISSIONS_KEY = 'failed_submissions_queue';\r\nconst HISTORY_MAX_DAYS = 90; // Keep history for 90 days\r\nconst HISTORY_MAX_ENTRIES = 1000; // Maximum entries to keep\r\n\r\n// ==========================================\r\n// FAILED SUBMISSIONS RETRY QUEUE\r\n// ==========================================\r\n\r\ninterface FailedSubmission {\r\n  id: string;\r\n  timestamp: string;\r\n  retryCount: number;\r\n  maxRetries: number;\r\n  data: {\r\n    shiftData: any;\r\n    wasteEntries: any[];\r\n    downtimeEntries: any[];\r\n    speedEntries?: any[];\r\n    sachetMassEntries?: any[];\r\n    looseCasesEntries?: any[];\r\n    palletScanEntries?: any[];\r\n  };\r\n  error: string;\r\n}\r\n\r\n// Get failed submissions queue\r\nexport const getFailedSubmissions = (): FailedSubmission[] => {\r\n  const stored = localStorage.getItem(FAILED_SUBMISSIONS_KEY);\r\n  if (!stored) return [];\r\n  try {\r\n    return JSON.parse(stored);\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\n// Add a failed submission to the retry queue\r\nexport const addFailedSubmission = (\r\n  data: FailedSubmission['data'],\r\n  error: string\r\n): void => {\r\n  const queue = getFailedSubmissions();\r\n  const newEntry: FailedSubmission = {\r\n    id: `failed_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n    timestamp: new Date().toISOString(),\r\n    retryCount: 0,\r\n    maxRetries: 3,\r\n    data,\r\n    error,\r\n  };\r\n  queue.push(newEntry);\r\n  localStorage.setItem(FAILED_SUBMISSIONS_KEY, JSON.stringify(queue));\r\n};\r\n\r\n// Remove a submission from the failed queue\r\nexport const removeFailedSubmission = (id: string): void => {\r\n  const queue = getFailedSubmissions();\r\n  const filtered = queue.filter(s => s.id !== id);\r\n  localStorage.setItem(FAILED_SUBMISSIONS_KEY, JSON.stringify(filtered));\r\n};\r\n\r\n// Retry all failed submissions\r\nexport const retryFailedSubmissions = async (): Promise<{\r\n  succeeded: number;\r\n  failed: number;\r\n  remaining: number;\r\n}> => {\r\n  if (!isSupabaseConfigured) {\r\n    return { succeeded: 0, failed: 0, remaining: getFailedSubmissions().length };\r\n  }\r\n\r\n  const queue = getFailedSubmissions();\r\n  let succeeded = 0;\r\n  let failed = 0;\r\n\r\n  for (const submission of queue) {\r\n    if (submission.retryCount >= submission.maxRetries) {\r\n      // Max retries reached, keep in queue but don't retry\r\n      failed++;\r\n      continue;\r\n    }\r\n\r\n    try {\r\n      await submitShiftData(\r\n        submission.data.shiftData,\r\n        submission.data.wasteEntries,\r\n        submission.data.downtimeEntries,\r\n        submission.data.speedEntries,\r\n        submission.data.sachetMassEntries,\r\n        submission.data.looseCasesEntries,\r\n        submission.data.palletScanEntries\r\n      );\r\n      removeFailedSubmission(submission.id);\r\n      succeeded++;\r\n    } catch (e) {\r\n      // Update retry count\r\n      const updatedQueue = getFailedSubmissions().map(s =>\r\n        s.id === submission.id\r\n          ? { ...s, retryCount: s.retryCount + 1, error: String(e) }\r\n          : s\r\n      );\r\n      localStorage.setItem(FAILED_SUBMISSIONS_KEY, JSON.stringify(updatedQueue));\r\n      failed++;\r\n    }\r\n  }\r\n\r\n  return {\r\n    succeeded,\r\n    failed,\r\n    remaining: getFailedSubmissions().length,\r\n  };\r\n};\r\n\r\n// Clear all failed submissions (manual clear)\r\nexport const clearFailedSubmissions = (): void => {\r\n  localStorage.removeItem(FAILED_SUBMISSIONS_KEY);\r\n};\r\n\r\n// ==========================================\r\n// LOCALSTORAGE CLEANUP\r\n// ==========================================\r\n\r\n// Clean up old history entries\r\nexport const cleanupOldHistory = (): { removed: number; remaining: number } => {\r\n  const history = getShiftHistory();\r\n  const now = new Date();\r\n  const cutoffDate = new Date(now.getTime() - HISTORY_MAX_DAYS * 24 * 60 * 60 * 1000);\r\n\r\n  // Filter out entries older than cutoff date\r\n  let cleaned = history.filter(item => {\r\n    const itemDate = new Date(item.date);\r\n    return itemDate >= cutoffDate;\r\n  });\r\n\r\n  // Also limit to max entries (keep most recent)\r\n  if (cleaned.length > HISTORY_MAX_ENTRIES) {\r\n    cleaned = cleaned.slice(0, HISTORY_MAX_ENTRIES);\r\n  }\r\n\r\n  const removed = history.length - cleaned.length;\r\n\r\n  if (removed > 0) {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(cleaned));\r\n    console.log(`Cleaned up ${removed} old history entries`);\r\n  }\r\n\r\n  return { removed, remaining: cleaned.length };\r\n};\r\n\r\n// Get localStorage usage stats\r\nexport const getStorageStats = (): {\r\n  historyCount: number;\r\n  failedCount: number;\r\n  totalSizeKB: number;\r\n  oldestEntry: string | null;\r\n} => {\r\n  const history = getShiftHistory();\r\n  const failed = getFailedSubmissions();\r\n\r\n  // Estimate total localStorage size\r\n  let totalSize = 0;\r\n  for (let i = 0; i < localStorage.length; i++) {\r\n    const key = localStorage.key(i);\r\n    if (key) {\r\n      const value = localStorage.getItem(key) || '';\r\n      totalSize += key.length + value.length;\r\n    }\r\n  }\r\n\r\n  const oldestEntry = history.length > 0\r\n    ? history[history.length - 1].date\r\n    : null;\r\n\r\n  return {\r\n    historyCount: history.length,\r\n    failedCount: failed.length,\r\n    totalSizeKB: Math.round(totalSize / 1024),\r\n    oldestEntry,\r\n  };\r\n};\r\n\r\n// Run cleanup on app startup (debounced to run once per day)\r\nexport const maybeRunCleanup = (): void => {\r\n  const lastCleanupKey = 'last_storage_cleanup';\r\n  const lastCleanup = localStorage.getItem(lastCleanupKey);\r\n  const now = new Date();\r\n\r\n  if (lastCleanup) {\r\n    const lastDate = new Date(lastCleanup);\r\n    const hoursSinceCleanup = (now.getTime() - lastDate.getTime()) / (1000 * 60 * 60);\r\n    if (hoursSinceCleanup < 24) {\r\n      return; // Already cleaned up today\r\n    }\r\n  }\r\n\r\n  // Run cleanup\r\n  const result = cleanupOldHistory();\r\n  localStorage.setItem(lastCleanupKey, now.toISOString());\r\n\r\n  if (result.removed > 0) {\r\n    console.log(`Storage cleanup: removed ${result.removed} entries, ${result.remaining} remaining`);\r\n  }\r\n};\r\n\r\n// Flag to track if we're using Supabase\r\nlet useSupabase = true;\r\nlet machinesCache: Machine[] | null = null;\r\nlet machinesListeners: ((machines: Machine[]) => void)[] = [];\r\n\r\n// Convert Supabase record to local Machine type\r\nconst toLocalMachine = (record: MachineRecord): Machine => ({\r\n  id: record.id,\r\n  name: record.name,\r\n  status: record.status,\r\n  currentOperator: record.current_operator,\r\n  currentOrder: record.current_order,\r\n  currentShift: record.current_shift,\r\n  lastSubmission: record.last_submission,\r\n  todayWaste: record.today_waste,\r\n  todayDowntime: record.today_downtime,\r\n  subMachineCount: record.sub_machine_count,\r\n});\r\n\r\n// Convert local Machine to Supabase record\r\nconst toSupabaseRecord = (machine: Machine): MachineRecord => ({\r\n  id: machine.id,\r\n  name: machine.name,\r\n  status: machine.status,\r\n  current_operator: machine.currentOperator,\r\n  current_order: machine.currentOrder,\r\n  current_shift: machine.currentShift,\r\n  last_submission: machine.lastSubmission,\r\n  today_waste: machine.todayWaste,\r\n  today_downtime: machine.todayDowntime,\r\n  sub_machine_count: machine.subMachineCount,\r\n});\r\n\r\n// Initialize machines from Supabase\r\nexport const initializeMachines = async (): Promise<Machine[]> => {\r\n  try {\r\n    const records = await fetchMachines();\r\n\r\n    if (records.length > 0) {\r\n      machinesCache = records.map(toLocalMachine);\r\n      // Also save to localStorage as backup\r\n      localStorage.setItem(MACHINES_KEY, JSON.stringify(machinesCache));\r\n      localStorage.setItem(MACHINES_SYNC_KEY, new Date().toISOString());\r\n      return machinesCache;\r\n    } else {\r\n      // No machines in Supabase, sync default machines\r\n      console.log('No machines in Supabase, syncing defaults...');\r\n      const defaultMachines = MACHINES.map(toSupabaseRecord);\r\n      await syncMachinesToSupabase(defaultMachines);\r\n      machinesCache = MACHINES;\r\n      localStorage.setItem(MACHINES_KEY, JSON.stringify(MACHINES));\r\n      return MACHINES;\r\n    }\r\n  } catch (error) {\r\n    console.error('Failed to initialize from Supabase, using localStorage:', error);\r\n    useSupabase = false;\r\n    return getMachinesDataLocal();\r\n  }\r\n};\r\n\r\n// Subscribe to real-time machine updates - OPTIMIZED\r\nexport const subscribeToMachineUpdates = (callback: (machines: Machine[]) => void) => {\r\n  machinesListeners.push(callback);\r\n\r\n  // Provide current machines getter for optimized real-time updates\r\n  const getCurrentMachines = (): MachineRecord[] => {\r\n    const current = machinesCache || getMachinesDataLocal();\r\n    return current.map(toSupabaseRecord);\r\n  };\r\n\r\n  // Set up Supabase real-time subscription with optimized handler\r\n  const unsubscribe = subscribeMachineChanges(\r\n    (records) => {\r\n      machinesCache = records.map(toLocalMachine);\r\n      localStorage.setItem(MACHINES_KEY, JSON.stringify(machinesCache));\r\n\r\n      // Notify all listeners\r\n      machinesListeners.forEach(listener => listener(machinesCache!));\r\n    },\r\n    getCurrentMachines\r\n  );\r\n\r\n  // Return cleanup function\r\n  return () => {\r\n    machinesListeners = machinesListeners.filter(l => l !== callback);\r\n    if (machinesListeners.length === 0) {\r\n      unsubscribe();\r\n    }\r\n  };\r\n};\r\n\r\n// Get machines from localStorage (fallback)\r\nconst getMachinesDataLocal = (): Machine[] => {\r\n  const stored = localStorage.getItem(MACHINES_KEY);\r\n  if (!stored) {\r\n    localStorage.setItem(MACHINES_KEY, JSON.stringify(MACHINES));\r\n    return MACHINES;\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(stored);\r\n  } catch {\r\n    return MACHINES;\r\n  }\r\n};\r\n\r\n// Save shift data to local storage\r\nexport const saveShiftData = (data: ShiftData): void => {\r\n  const existing = getShiftHistory();\r\n  existing.unshift(data);\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(existing));\r\n\r\n  // Update machine data\r\n  updateMachineLastSubmission(data.machine, data.submittedAt.toISOString());\r\n};\r\n\r\n// Get all shift history\r\nexport const getShiftHistory = (): ShiftData[] => {\r\n  const stored = localStorage.getItem(STORAGE_KEY);\r\n  if (!stored) return [];\r\n\r\n  try {\r\n    const parsed = JSON.parse(stored);\r\n    return parsed.map((item: any) => ({\r\n      ...item,\r\n      submittedAt: new Date(item.submittedAt),\r\n      wasteEntries: item.wasteEntries.map((w: any) => ({\r\n        ...w,\r\n        timestamp: new Date(w.timestamp),\r\n      })),\r\n      downtimeEntries: item.downtimeEntries.map((d: any) => ({\r\n        ...d,\r\n        timestamp: new Date(d.timestamp),\r\n      })),\r\n    }));\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\n// Get shift history for a specific date range\r\nexport const getShiftHistoryByDateRange = (startDate: Date, endDate: Date): ShiftData[] => {\r\n  const history = getShiftHistory();\r\n  return history.filter(item => {\r\n    const itemDate = new Date(item.date);\r\n    return itemDate >= startDate && itemDate <= endDate;\r\n  });\r\n};\r\n\r\n// Get shift history for a specific machine\r\nexport const getShiftHistoryByMachine = (machineName: string): ShiftData[] => {\r\n  const history = getShiftHistory();\r\n  return history.filter(item => item.machine === machineName);\r\n};\r\n\r\n// Get today's statistics\r\nexport const getTodayStats = () => {\r\n  const today = new Date().toISOString().split('T')[0];\r\n  const history = getShiftHistory();\r\n  const todayData = history.filter(item => item.date === today);\r\n\r\n  const totalWaste = todayData.reduce((sum, item) => sum + item.totalWaste, 0);\r\n  const totalDowntime = todayData.reduce((sum, item) => sum + item.totalDowntime, 0);\r\n  const submissionCount = todayData.length;\r\n\r\n  return { totalWaste, totalDowntime, submissionCount };\r\n};\r\n\r\n// Update machine last submission\r\nexport const updateMachineLastSubmission = (machineName: string, timestamp: string): void => {\r\n  const machines = getMachinesData();\r\n  const machineIndex = machines.findIndex(m => m.name === machineName);\r\n  if (machineIndex !== -1) {\r\n    machines[machineIndex].lastSubmission = getTimeAgo(new Date(timestamp));\r\n  }\r\n  localStorage.setItem(MACHINES_KEY, JSON.stringify(machines));\r\n};\r\n\r\n// Get machines data with local modifications\r\nexport const getMachinesData = (): Machine[] => {\r\n  // Return cache if available\r\n  if (machinesCache) {\r\n    return machinesCache;\r\n  }\r\n\r\n  // Otherwise return from localStorage\r\n  return getMachinesDataLocal();\r\n};\r\n\r\n// Update a single machine\r\nexport const updateMachine = async (machineId: string, updates: Partial<Machine>): Promise<void> => {\r\n  const machines = getMachinesData();\r\n  const index = machines.findIndex(m => m.id === machineId);\r\n  if (index !== -1) {\r\n    machines[index] = { ...machines[index], ...updates };\r\n    machinesCache = machines;\r\n    localStorage.setItem(MACHINES_KEY, JSON.stringify(machines));\r\n\r\n    // Sync to Supabase\r\n    if (useSupabase) {\r\n      try {\r\n        await upsertMachine(toSupabaseRecord(machines[index]));\r\n      } catch (error) {\r\n        console.error('Failed to sync machine update to Supabase:', error);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n// Add a new machine\r\nexport const addMachine = async (machine: Machine): Promise<void> => {\r\n  const machines = getMachinesData();\r\n  machines.push(machine);\r\n  machinesCache = machines;\r\n  localStorage.setItem(MACHINES_KEY, JSON.stringify(machines));\r\n\r\n  // Sync to Supabase\r\n  if (useSupabase) {\r\n    try {\r\n      await upsertMachine(toSupabaseRecord(machine));\r\n    } catch (error) {\r\n      console.error('Failed to sync new machine to Supabase:', error);\r\n    }\r\n  }\r\n};\r\n\r\n// Delete a machine\r\nexport const deleteMachine = async (machineId: string): Promise<void> => {\r\n  const machines = getMachinesData();\r\n  const filtered = machines.filter(m => m.id !== machineId);\r\n  machinesCache = filtered;\r\n  localStorage.setItem(MACHINES_KEY, JSON.stringify(filtered));\r\n\r\n  // Sync to Supabase\r\n  if (useSupabase) {\r\n    try {\r\n      await removeMachine(machineId);\r\n    } catch (error) {\r\n      console.error('Failed to delete machine from Supabase:', error);\r\n    }\r\n  }\r\n};\r\n\r\n// Reset machines to default\r\nexport const resetMachines = async (): Promise<void> => {\r\n  machinesCache = MACHINES;\r\n  localStorage.setItem(MACHINES_KEY, JSON.stringify(MACHINES));\r\n\r\n  // Sync to Supabase\r\n  if (useSupabase) {\r\n    try {\r\n      await syncMachinesToSupabase(MACHINES.map(toSupabaseRecord));\r\n    } catch (error) {\r\n      console.error('Failed to reset machines in Supabase:', error);\r\n    }\r\n  }\r\n};\r\n\r\n// Helper function to format time ago\r\nexport const getTimeAgo = (date: Date): string => {\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffMins = Math.floor(diffMs / 60000);\r\n  const diffHours = Math.floor(diffMins / 60);\r\n  const diffDays = Math.floor(diffHours / 24);\r\n\r\n  if (diffMins < 1) return 'Just now';\r\n  if (diffMins < 60) return `${diffMins} min ago`;\r\n  if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;\r\n  return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;\r\n};\r\n\r\n// Export data to CSV\r\nexport const exportToCSV = (data: ShiftData[], filename: string): void => {\r\n  const headers = [\r\n    'Date',\r\n    'Shift',\r\n    'Operator',\r\n    'Machine',\r\n    'Order Number',\r\n    'Product',\r\n    'Batch Number',\r\n    'Entry Type',\r\n    'Waste Type',\r\n    'Waste (kg)',\r\n    'Downtime Reason',\r\n    'Downtime (min)',\r\n    'Submitted At',\r\n  ];\r\n\r\n  const rows: string[][] = [];\r\n\r\n  data.forEach(item => {\r\n    const baseRow = [\r\n      item.date,\r\n      item.shift,\r\n      item.operatorName,\r\n      item.machine,\r\n      item.orderNumber,\r\n      item.product,\r\n      item.batchNumber,\r\n    ];\r\n    const submittedAt = new Date(item.submittedAt).toLocaleString();\r\n\r\n    // Add a row for each waste entry\r\n    if (item.wasteEntries && item.wasteEntries.length > 0) {\r\n      item.wasteEntries.forEach(w => {\r\n        rows.push([\r\n          ...baseRow,\r\n          'Waste',\r\n          w.wasteType,\r\n          w.waste.toFixed(2),\r\n          '',\r\n          '',\r\n          submittedAt,\r\n        ]);\r\n      });\r\n    }\r\n\r\n    // Add a row for each downtime entry\r\n    if (item.downtimeEntries && item.downtimeEntries.length > 0) {\r\n      item.downtimeEntries.forEach(d => {\r\n        rows.push([\r\n          ...baseRow,\r\n          'Downtime',\r\n          '',\r\n          '',\r\n          d.downtimeReason,\r\n          d.downtime.toString(),\r\n          submittedAt,\r\n        ]);\r\n      });\r\n    }\r\n\r\n    // If no entries at all, still add one summary row\r\n    if ((!item.wasteEntries || item.wasteEntries.length === 0) &&\r\n      (!item.downtimeEntries || item.downtimeEntries.length === 0)) {\r\n      rows.push([\r\n        ...baseRow,\r\n        'Summary',\r\n        '',\r\n        item.totalWaste.toFixed(2),\r\n        '',\r\n        item.totalDowntime.toString(),\r\n        submittedAt,\r\n      ]);\r\n    }\r\n  });\r\n\r\n  const csvContent = [\r\n    headers.join(','),\r\n    ...rows.map(row => row.map(cell => `\"${cell}\"`).join(',')),\r\n  ].join('\\n');\r\n\r\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const link = document.createElement('a');\r\n  const url = URL.createObjectURL(blob);\r\n  link.setAttribute('href', url);\r\n  link.setAttribute('download', `${filename}.csv`);\r\n  link.style.visibility = 'hidden';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  // Clean up the object URL to prevent memory leak\r\n  URL.revokeObjectURL(url);\r\n};\r\n\r\n// Clear all history (for testing)\r\nexport const clearHistory = (): void => {\r\n  localStorage.removeItem(STORAGE_KEY);\r\n  localStorage.removeItem(MACHINES_KEY);\r\n};\r\n\r\n// ==========================================\r\n// SHARED LINE SPEED - Syncs across sub-machines\r\n// ==========================================\r\n\r\nconst LINE_SPEED_KEY_PREFIX = 'line_speed_';\r\n\r\n/**\r\n * Extract parent machine name from a sub-machine name\r\n * e.g., \"Cubes - Machine 1\" ‚Üí \"Cubes\"\r\n * e.g., \"Universal 2 - Machine 3\" ‚Üí \"Universal 2\"\r\n */\r\nexport const getParentMachineName = (machineName: string): string => {\r\n  // Check if it matches the pattern \"Parent - Machine N\"\r\n  const match = machineName.match(/^(.+?)\\s*-\\s*Machine\\s*\\d+$/i);\r\n  if (match) {\r\n    return match[1].trim();\r\n  }\r\n  // Return the original name if no sub-machine pattern found\r\n  return machineName;\r\n};\r\n\r\n/**\r\n * Get the storage key for shared line speed\r\n */\r\nconst getLineSpeedKey = (parentMachineName: string, shift: string, date: string): string => {\r\n  return `${LINE_SPEED_KEY_PREFIX}${parentMachineName}_${shift}_${date}`;\r\n};\r\n\r\n/**\r\n * Save shared line speed (called when any sub-machine sets speed)\r\n */\r\nexport const saveLineSpeed = (\r\n  machineName: string,\r\n  shift: string,\r\n  date: string,\r\n  speed: number\r\n): void => {\r\n  const parentName = getParentMachineName(machineName);\r\n  const key = getLineSpeedKey(parentName, shift, date);\r\n\r\n  const data = {\r\n    speed,\r\n    updatedAt: new Date().toISOString(),\r\n    updatedBy: machineName,\r\n  };\r\n\r\n  localStorage.setItem(key, JSON.stringify(data));\r\n  console.log(`üíæ Saved line speed ${speed} PPM for ${parentName}`);\r\n};\r\n\r\n/**\r\n * Get shared line speed (returns the speed set by any sibling machine)\r\n */\r\nexport const getLineSpeed = (\r\n  machineName: string,\r\n  shift: string,\r\n  date: string\r\n): { speed: number; updatedBy: string; updatedAt: string } | null => {\r\n  const parentName = getParentMachineName(machineName);\r\n  const key = getLineSpeedKey(parentName, shift, date);\r\n\r\n  const stored = localStorage.getItem(key);\r\n  if (!stored) return null;\r\n\r\n  try {\r\n    const data = JSON.parse(stored);\r\n    console.log(`üìñ Loaded line speed ${data.speed} PPM for ${parentName} (set by ${data.updatedBy})`);\r\n    return data;\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Clear shared line speed (called when session ends)\r\n */\r\nexport const clearLineSpeed = (\r\n  machineName: string,\r\n  shift: string,\r\n  date: string\r\n): void => {\r\n  const parentName = getParentMachineName(machineName);\r\n  const key = getLineSpeedKey(parentName, shift, date);\r\n  localStorage.removeItem(key);\r\n};\r\n\r\n/**\r\n * Clean up old line speed entries (called periodically)\r\n */\r\nexport const cleanupOldLineSpeeds = (retentionDays: number = 7): number => {\r\n  const cutoff = Date.now() - (retentionDays * 24 * 60 * 60 * 1000);\r\n  let removed = 0;\r\n\r\n  for (let i = localStorage.length - 1; i >= 0; i--) {\r\n    const key = localStorage.key(i);\r\n    if (key?.startsWith(LINE_SPEED_KEY_PREFIX)) {\r\n      try {\r\n        const data = localStorage.getItem(key);\r\n        if (data) {\r\n          const parsed = JSON.parse(data);\r\n          const updatedAt = new Date(parsed.updatedAt).getTime();\r\n          if (updatedAt < cutoff) {\r\n            localStorage.removeItem(key);\r\n            removed++;\r\n          }\r\n        }\r\n      } catch {\r\n        // Invalid data - remove it\r\n        localStorage.removeItem(key);\r\n        removed++;\r\n      }\r\n    }\r\n  }\r\n\r\n  return removed;\r\n};\r\n"],"names":["MACHINES","WASTE_TYPES","DOWNTIME_REASONS","HistoryPage","navigate","useNavigate","data","setData","useState","sorting","setSorting","id","desc","globalFilter","setGlobalFilter","dateRange","setDateRange","dataSource","setDataSource","isLoading","setIsLoading","transformSubmission","useCallback","sub","toString","operatorName","operator_name","machine","orderNumber","order_number","product","batchNumber","batch_number","shift","date","submission_date","wasteEntries","waste_records","map","w","waste","waste_amount","wasteType","waste_type","timestamp","Date","recorded_at","created_at","now","downtimeEntries","downtime_records","d","downtime","downtime_minutes","downtimeReason","downtime_reason","totalWaste","total_waste","totalDowntime","total_downtime","submittedAt","loadData","async","history","getRecentSubmissions","getShiftHistory","todayStart","startOfDay","todayEnd","endOfDay","filter","item","itemDate","weekAgo","subDays","monthAgo","error","console","useEffect","columns","useMemo","accessorKey","header","cell","info","format","getValue","_jsx","className","concat","toLowerCase","children","toFixed","mins","hours","Math","floor","remainingMins","_jsxs","table","useReactTable","state","onSortingChange","onGlobalFilterChange","getCoreRowModel","getSortedRowModel","getFilteredRowModel","getPaginationRowModel","initialState","pagination","pageSize","stats","reduce","sum","avgWaste","length","avgDowntime","count","motion","div","initial","opacity","animate","exit","onClick","viewBox","fill","stroke","strokeWidth","handleExport","filename","exportToCSV","disabled","range","cx","cy","r","type","placeholder","value","onChange","e","target","_Fragment","getHeaderGroups","headerGroup","headers","column","getToggleSortingHandler","getCanSort","flexRender","columnDef","getContext","getIsSorted","AnimatePresence","getRowModel","rows","row","tr","y","getVisibleCells","getState","pageIndex","min","previousPage","getCanPreviousPage","getPageCount","nextPage","getCanNextPage","STORAGE_KEY","MACHINES_KEY","FAILED_SUBMISSIONS_KEY","getFailedSubmissions","stored","localStorage","getItem","JSON","parse","_unused","addFailedSubmission","queue","newEntry","random","substr","toISOString","retryCount","maxRetries","push","setItem","stringify","removeFailedSubmission","filtered","s","retryFailedSubmissions","isSupabaseConfigured","succeeded","failed","remaining","submission","submitShiftData","shiftData","speedEntries","sachetMassEntries","looseCasesEntries","palletScanEntries","updatedQueue","_objectSpread","String","maybeRunCleanup","lastCleanupKey","lastCleanup","lastDate","getTime","result","cleanupOldHistory","cutoffDate","HISTORY_MAX_DAYS","cleaned","slice","removed","log","useSupabase","machinesCache","machinesListeners","toLocalMachine","record","name","status","currentOperator","current_operator","currentOrder","current_order","currentShift","current_shift","lastSubmission","last_submission","todayWaste","today_waste","todayDowntime","today_downtime","subMachineCount","sub_machine_count","toSupabaseRecord","initializeMachines","records","fetchMachines","defaultMachines","syncMachinesToSupabase","getMachinesDataLocal","subscribeToMachineUpdates","callback","unsubscribe","subscribeMachineChanges","forEach","listener","getCurrentMachines","l","_unused2","saveShiftData","existing","unshift","updateMachineLastSubmission","_unused3","getTodayStats","today","split","todayData","submissionCount","machineName","machines","getMachinesData","machineIndex","findIndex","m","getTimeAgo","updateMachine","machineId","updates","index","upsertMachine","addMachine","deleteMachine","removeMachine","diffMs","diffMins","diffHours","diffDays","baseRow","toLocaleString","csvContent","join","blob","Blob","link","document","createElement","url","URL","createObjectURL","setAttribute","style","visibility","body","appendChild","click","removeChild","revokeObjectURL","LINE_SPEED_KEY_PREFIX","getParentMachineName","match","trim","getLineSpeedKey","parentMachineName","saveLineSpeed","speed","parentName","key","updatedAt","updatedBy","getLineSpeed","_unused4"],"ignoreList":[],"sourceRoot":""}